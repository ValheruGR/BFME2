
;--------------------------------------------------------------------Patch 1.09---------------------------------------------------------------------------------------

Object MordorWitchKingOnFellBeast                ;;;           ChildObject MordorWitchKingOnFellBeast MordorFellBeastInterface		;Real witchking
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPWitchKing
	Scale = 0.952 ;;-;; 0.80
	;;-;; This was never applied, now it is. ;;-;; Scale = 1.04
		
		ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

	Draw = W3DScriptedModelDraw ModuleTag_01
	    ExtraPublicBone = B_PASSENGER

	    OkToChangeModelColor = Yes
	    StaticModelLODMode = Yes


		DefaultModelConditionState
			Model = MUWchKngFB_SKN
		End
		
			;;-;;
 			ModelConditionState = USER_3
			Model               = MUWchKngFB_SKN
				;;-;; ParticleSysBone     = None BlackRiderFlare FXTrigger:NONE Persist:SPAWN PersistID:100 dont want flare on flyer
				
			End
		;;-;;ModelConditionState = RIDER2
		;;-;;	Model = MUWchKngFB_SKN
		;;-;;End
 		

      IdleAnimationState
			StateName = Idle
			Animation = IDLA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRA
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
			End
		End

 		AnimationState	= BACKING_UP
   			StateName = backup
   			Animation = IDLA
   				AnimationName = CUFellBst_SKL.CUFellBst_HVRA
   				AnimationMode = LOOP
   				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
   			End
   		End
   
   		AnimationState = DIVING
   			StateName = Diving
   			Animation = Diving
   				AnimationName = CUFellBst_SKL.CUFellBst_DIVA ; ; CUFellBst_SKL.CUFellBst_ATKD
   				AnimationMode = LOOP
   				AnimationBlendTime = 10
 				AnimationSpeedFactorRange = 0.95 1.05
  			End
   		End

		AnimationState = ABOUT_TO_HIT ; clawing
			StateName = Claw
			Animation = Claw
				AnimationName = CUFellBst_SKL.CUFellBst_ATKD ; ;ATKD
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
          ; BeginScript
 				;CurDrawableSetTransitionAnimState("Trans_Begin_Attacking") return 
 			;EndScript
			
		End
		TransitionState = Trans_Begin_Attacking 
			Animation = Grab
				AnimationName = CUFellBst_SKL.CUFellBst_GRBA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.4 0.4
			End
		End



	    AnimationState  STUNNED SPECIAL_DAMAGED
			StateName =  STUNNED
			Animation = HitA
				AnimationName = CUFellBst_SKL.CUFellBst_ATKH
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End
	    AnimationState  STUNNED
			StateName =  STUNNED
			Animation = HitA
				AnimationName = CUFellBst_SKL.CUFellBst_HITA
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End
		//-----------------Ecthelion2019Animating--------------//
		;;-;;	Screech			// Fellbeast
  		AnimationState 						= PACKING_TYPE_2 PACKING ;; PACKING_TYPE_2 ;;-;; SPECIAL_WEAPON_TWO
			Animation		
				AnimationName				= CUFellBst_SKL.CUFellBst_ATKA
				AnimationMode				= ONCE
				;AnimationBlendTime			= 15 ;;-;; 20
			End		
			FXEvent							= Frame:30 Name:FX_FearBlastwkmount
		End
		//-----------------------------------------------------


		;--- HARD FLAPPING ------------------------
		AnimationState = CLIMBING
			StateName = Climbing
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_HVRB
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
			End
		End
		AnimationState = FREEFALL
			StateName = Freefall
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_IDLA
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
		End
		
		AnimationState = ACCELERATE 
			StateName = Accelerate
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_FLYA
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
			BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 				if Prev == "Climbing"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
		End
		
		AnimationState = DECELERATE 
			StateName = decelerate
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
				AnimationMode = LOOP_BACKWARDS
				AnimationBlendTime = 10
			End
		End		

		AnimationState = MOVING SPECIAL_WEAPON_ONE
			StateName = Moving
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_DIVA ; ;  ;CUFellBst_SKL.CUFellBst_ATKB ; ; AnimationName = CUFellBst_SKL.CUFellBst_ATKB
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
 	 		BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 				if Prev == "Climbing"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
	    End
	
		AnimationState = MOVING
			StateName = Moving
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_IDLA  ; ; AnimationName = CUFellBst_SKL.CUFellBst_FLYA
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationPriority   = 10
				AnimationSpeedFactorRange = 0.9 1.1
			End
			;;AnimationState = MOVING
			;StateName = Moving
			;Animation = Moving
				;AnimationName = CUFellBst_SKL.CUFellBst_DIVA
				;AnimationMode = LOOP
				;AnimationBlendTime = 10
				;AnimationPriority   = 20
				;;AnimationSpeedFactorRange = 0.9 1.1
			;End
 	 		BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 				if Prev == "Climbing"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
	    End

   	    TransitionState = Trans_Begin_Moving
   			Animation = Transition
   				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
   				AnimationMode = ONCE
   				AnimationBlendTime = 6
   			End  
   		End


		;;AnimationState = FREEFALL
		;;	StateName = Freefall
			;;Animation = Moving
				;;AnimationName = CUFellBst_SKL.CUFellBst_IDLA
				;;AnimationMode = LOOP
				;;AnimationBlendTime = 10
			;;End
		;End
			
			;;AnimationState = MOVING
			;StateName = Moving
			;Animation = Moving
				;AnimationName = CUFellBst_SKL.CUFellBst_DIVA
				;AnimationMode = LOOP
				;AnimationBlendTime = 10
				;AnimationPriority   = 20
				;;AnimationSpeedFactorRange = 0.9 1.1
			;End
 	 		

		AnimationState = DYING
 			Animation = DyingA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
  				AnimationMode = LOOP
  				AnimationBlendTime = 10
                AnimationSpeedFactorRange = 0.5 0.5
  			End
  			StateName = DYING
		End

		AnimationState = RUBBLE 
			Animation = RubbleDieF
				AnimationName = CUFellBst_SKL.CUFellBst_DIVA
				AnimationMode = ONCE
				AnimationBlendTime = 4
			End
		End
	    
	End ; Draw
	

	
	;;;;;
; ***DESIGN parameters ***
	Side				= Mordor
	EditorSorting		= UNIT
	ThreatLevel			= FELL_BEAST_THREAT_LEVEL
	ThingClass			= LARGE_MONSTER
	TransportSlotCount	= TRANSPORTSLOTCOUNT_NOT_TRANSPORTABLE

	;//DisplayMeleeDamage = NAZGUL_PLOW_DAMAGE_INNER			
	BountyValue			= 1250 ; ;
	DisplayName			= OBJECT:MordorWitchKingOnFellBeast
	DisplayNameStrategic = OBJECT:MordorWitchKingOnFellBeast
	RecruitText			= CONTROLBAR:MordorWitchKingOnFellBeastRecruit
	ReviveText			= CONTROLBAR:MordorWitchKingOnFellBeastRevive
	Hotkey				= CONTROLBAR:MordorWitchKingOnFellBeastHotkey
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
    ButtonImage			= HIWitchKing
        
    CommandSet			= MordorWitchKingRidingFellBeastCommandSet
	BuildCost			= WITCHKING_ON_FELLBEAST_BUILDCOST		
	BuildTime			= WITCHKING_ON_FELLBEAST_BUILDTIME		
	CommandPoints		= WITCHKING_COMMAND_POINTS
	;;;
	VisionRange			= VISION_FLIER
	ShroudClearingRange = SHROUD_CLEAR_FLIER
	RamPower			= 45
	RamZMult			= 0.5
	CrusherLevel		= 3  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
	CrushKnockback		= 50
	CrushZFactor		= 1.0
	

WeaponSet
		Weapon				= PRIMARY		WitchKingPlowAttack
		PreferredAgainst	= PRIMARY		STRUCTURE MACHINE HORDE SHIP

		Weapon				= SECONDARY		WitchKingGrabAttack
		PreferredAgainst	= SECONDARY		INFANTRY THROWN_OBJECT CAVALRY

		Weapon				= TERTIARY		WitchKingClawAttack ;;-;;
		OnlyAgainst			= TERTIARY		MONSTER
		
		ReadyStatusSharedWithinSet = Yes
	End
; ;
	ArmorSet
		Conditions      = None
		Armor           = WitchKingArmor
		DamageFX        = None
	End

	;--- AUDIO Parameters ---

	SoundMoveStart		= NoSound
; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain
	AutoResolveBody = AutoResolve_NazgulBody
	
	AutoResolveWeapon
		Weapon = AutoResolve_NazgulWeapon
	End
	AutoResolveArmor
		Armor = AutoResolve_NazgulArmor
	End

	;AutoResolveLeadership = AutoResolve_NazgulBonus
	

	; *** AUDIO Parameters ***;

	VoiceAttack			= FellBeastVoiceAttack ; ; MS
       ; VoiceAttack2		= FellBeastVox2
	;VoiceCreated		= CampOrcCreateNazgul		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	;VoiceFullyCreated 	= CampOrcCreateNazgul		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	VoiceFear			= FellBeastAlert
	VoiceMove			= FellBeastVoiceMove;MS
        ;VoiceMove2                      = FellBeastVox2
	VoicePriority		= 76
	VoiceSelect			= FellBeastVoiceSelect ; MS
        ;VoiceSelect2		= FellBeastVox2
	VoiceGuard			= FellBeastVoiceMove

	SoundAmbient		= FellBeastVoxAmbientLoop
	SoundMoveStart		= FellBeastMoveStart
	SoundImpact			= ImpactHorse			;FellBeastDie
  
	;UnitSpecificSounds
	;End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehaviorG
		MaxUpdateRangeCap = 800

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_IDLA Frames: 33

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKB Frames: 1 24 65 87 112
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKD Frames: 5

		AnimationSound = Sound: FellBeastEagleAttack	Animation:CUFELLBST_SKL.CUFELLBST_ATKD Frames: 10

		AnimationSound = Sound: FellBeastHurt		Animation:CUFELLBST_SKL.CUFELLBST_ATKH Frames: 0
		AnimationSound = Sound: FellBeastHurt		Animation:CUFELLBST_SKL.CUFELLBST_HITA Frames: 0
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HITA Frames: 10

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_FLYA Frames: 5
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HVRA Frames: 7
		AnimationSound = Sound: FellBeastWingFlapsShort	Animation:CUFELLBST_SKL.CUFELLBST_HVRB Frames: 3 
		AnimationSound = Sound: FellBeastWingFlapsShort	Animation:CUFELLBST_SKL.CUFELLBST_HVRC Frames: 5 32 
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HVRC Frames: 62 103

		;-------- animation unused anymore -----------
		;AnimationSound = Sound: FellBeastEagleAttack	Animation:CUFELLBST_SKL.CUFELLBST_ATKE Frames: 20
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKA Frames: 1 24 46
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKC Frames: 16
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKE Frames: 7
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKF Frames: 7 
		;AnimationSound = Sound: FellBeastDie		Animation:CUFELLBST_SKL.CUFELLBST_DIEC Frames: 5
	End
	;-------
	
	RadarPriority = UNIT
	KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER SCARY MONSTER CANNOT_RETALIATE ARMY_SUMMARY
 
	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = WITCHKING_ON_FELLBEAST_HEALTH	
   		DodgePercent      	= FELLBEAST_DODGE_PERCENT				
		;HealingBuffFx     = None
	End
    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End
  Behavior = AutoHealBehavior ModuleTag_WitchKingHealing
		StartsActive			= Yes
		HealingAmount			= WITCHKING_HEAL_AMOUNT
		HealingDelay			= 1000
		StartHealingDelay		= HERO_HEAL_DELAY
		HealOnlyIfNotInCombat	= Yes
		UnitHealPulseFX 		= FX_DefaultUnitHealBuffFakeMonster_New ;;-;;
	End
    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim					= DYING
		DeathFX						= FX_WitchKingDieToRespawn	;FXList to play when killed-to-respawn
		;DeathAnimationTime			= 5500 ;1133				;How long DeathAnim will take.
		InitialSpawnFX				= FX_MinasMorgulUpgraded ;;FX_WitchKingInitialSpawn
		RespawnFX					= FX_MinasMorgulUpgraded ;;FX_WitchKingRespawn		;FXList to play when respawning.
		;RespawnAnim				= LEVELED					;Animation to play when respawning.
		;RespawnAnimationTime		= 2000						;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP			;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage					= HIWitchKing_res
		RespawnAsTemplate			= MordorWitchKingonFellbeast		
				

		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No		Cost:2500		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1000 )	Health:100%		;DEFAULT VALUES
		RespawnEntry =	Level:2				Cost:2875		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1500 )					; ;50% cost, 1x buildtime ;For other levels, only override what is different.
		RespawnEntry =	Level:3				Cost:2875		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1500 )
		RespawnEntry =	Level:4				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )
		RespawnEntry =	Level:5				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )						; ;65% cost, 2x buildtime
		RespawnEntry =	Level:6				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )
		RespawnEntry =	Level:7				Cost:3625		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2500 )
		RespawnEntry =	Level:8				Cost:3625		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2500 ) 					; ;80% cost, 3x buildtime
		RespawnEntry =	Level:9				Cost:4000		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 3000 ) 
		RespawnEntry =	Level:10			Cost:4000		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 3000 ) 
	End

	

      Behavior = GiantBirdAIUpdate ModuleTag_GiantBirdAIG
	    AutoAcquireEnemiesWhenIdle	=	Yes ATTACK_BUILDINGS
	    MoodAttackCheckRate			=	500
	    AILuaEventsList				=	FellBeastFunctions	
		FollowThroughDistance		=	200
		FollowThroughCheckStep		=	50
		FollowThroughGradient		=	1.0
		
		GrabTossTimeTrigger			=	2.5
		GrabTossHeightTrigger		=   100.0
		TossFX				= FX_DiebyFalling
		SpecialContactPoints		= Swoop
		
		AttackPriority = AttackPriority_FellBeast
	  End
	
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ;BALANCE FellBeast
	    Condition = SET_NORMAL 
	    Speed     = NORMAL_FLYING_HERO_SPEED_WITCHKING
	  End
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ; BALANCE FellBeast
	    Condition = SET_SUPERSONIC 
	    Speed     = SUPERSONIC_FLYING_HERO_SPEED_WITCHKING
	  End
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ; BALANCE FellBeast
	    Condition = SET_WANDER 
	    Speed     = 78
	  End
	  LocomotorSet
	    Locomotor = FellBeastSwoopLocomotor ; BALANCE FellBeast
	    Condition = SET_PANIC
	    Speed     = 160
	  End
	
	Behavior = PhysicsBehavior ModuleTag_04
		;;VehicleCrashesIntoBuildingWeaponTemplate = NazgulCrashingOnBuildingWeapon
		;;VehicleCrashesIntoNonBuildingWeaponTemplate = NazgulCrashingOnNonBuildingWeapon
	End
	

	Behavior = TransportContain TransportContainModuleTag
		
		;Victim passenger
		ObjectStatusOfContained = UNSELECTABLE UNATTACKABLE
		PassengerFilter = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER
		Slots = 1
	
		;Standard TransportContain stuff
		ShowPips = No
		CollidePickup = No
		AllowEnemiesInside = Yes
		AllowNeutralInside = Yes
		AllowAlliesInside  = Yes
		DamagePercentToUnits = 0%
		PassengerBonePrefix = PassengerBone:B_PASSENGER       KindOf:GRAB_AND_DROP
		EjectPassengersOnDeath = No
		
		GrabWeapon = WitchKingGrabWeapon ; fire this weapon when fellbeast grabs a victim
		FireGrabWeaponOnVictim = No
	End
	
	;Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
		;TriggeredBy		= Upgrade_DwarvenMithrilMail
		;UpgradeTexture	= muwtchkngfllbst.tga  0 muwtchkngfllbst2.tga
		;UpgradeTexture  = muwtchkngfllbstwings.tga  0 muwtchkngfllbstwings2.tga
		;RecolorHouse	= Yes
		;ExcludeSubobjects = Forged_Blade
	;End
	
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;fdsfdssd
	
	
	Behavior = SubObjectsUpgrade Armor_Upgrade
  		TriggeredBy		= Upgrade_ObjectLevel5 ;;-;; was actually coming from lvl 4
  		UpgradeTexture	= muwtchkngfllbstwings.tga 0 muwtchkngfllbstwingsupg.tga
		UpgradeTexture	= muwtchkngfllbst.tga 0 muwtchkngfllbstupg.tga
 		RecolorHouse	= Yes
  	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL -FADED
		DestructionDelay	= 500
		ShadowWhenDead		= No
		FX					= INITIAL FX_WitchKingDeathMounted ;;-;; FX_FellBeastDeath
		Sound 				= INITIAL WKFootDieExplodeM ;;-;; INITIAL FellBeastDie
	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathFaded
		DeathTypes			= NONE +FADED
		DestructionDelay	= 0
		FadeTime			= 1000
		FadeDelay			= 100
		ShadowWhenDead		= No
	End

	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
	
	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate ScreechAI
		CommandButtonName = Command_SpecialAbilityScreech
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
	EvaEventDieOwner 			= WitchKingDie		;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths
  ;End
	;;-;;Behavior = ModelConditionUpgrade ModuleTag_MakeUsAWitchKing
	;;-;;	TriggeredBy			= Upgrade_MordorFaction
	;;-;;	AddConditionFlags	= RIDER2
	;;-;;	Permanent			= Yes
	;;-;;End
	
;End

	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;fdsfds
	
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_DismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		InitiateSound				= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
 		SpecialPowerTemplate    = SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0									; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorWitchKing
 		SynchronizeTimerOnSpecialPower = SpecialAbilityCurseEnemy SpecialAbilityScreechWitchKing
 		UnpackTime              = 0
 		PreparationTime         = 1  
; 		PersistentPrepTime      = 250
 		PackTime                = 0
 		OpacityTarget			= 1										; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
	End


	;--------------------------------------------------------------------------
	 ; Mounted Screech		;;-;;Ecthelion2019Behaviors;;-;;
	;--------------------------------------------------------------------------
		;;=;; 10801 WK no longer uses an anim for screech when flying, jus like bfme1
		;;-;; 10902 Re added animations 
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ScreechUnPause
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
		TriggeredBy						= Upgrade_Screech
		ObeyRechageOnTrigger			= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_Screech                      
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
		UpdateModuleStartsAttack		= Yes
		StartsPaused					= Yes
		;;-;;TriggerFX			= FX_FearBlastwkmount // Currently coming from AnimationState
	End
	Behavior = SpecialAbilityUpdate ModuleTag_ScreechUpdate  
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
		UnpackTime						= 1 ;;-;; 100
		AwardXPForTriggering			= 0
		TriggerSound					= WitchKingScreechMS ;;-;; NazgulScreech
		EffectRange						= 180
		PreparationTime					= 1 ;;this was 2much; 10
		PackTime						= 3000 ;;-;;  1800 ; ; 3000
		UnpackingVariation				= 2 ; sets PACKING_TYPE_2
		;CustomAnimAndDuration			= AnimState:SPECIAL_WEAPON_TWO AnimTime:3000  ;;-;; It is the same if we use the unpacking variation or the customanimandduration, if animationstate doesn't get readed try moving it to top, under defaultmodelconditions.
 			ParalyzeDurationWhenCompleted	= 3000 ;;-;;
			ParalyzeDurationWhenAborted		= 1500 ;;-;;
			FreezeAfterTriggerDuration		= 2300 ;;-;;
	End	
 	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehaviorMountedScreech
 		SpecialAbility 					= SpecialAbilityScreechWitchKing
		MaxScanRange 					= 150.0
  		Query 							= 3 ANY ENEMIES +HORDE
  	End
 	;---------DREAD VISAGE------------------------------------------------------------------------

		Behavior = ModelConditionUpgrade ModuleTag_DreadVisageModelCondition
			TriggeredBy						= Upgrade_DreadVisage
			AddConditionFlags				= USER_3
		End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisage
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		TriggeredBy					= Upgrade_DreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisageAura
		StartsActive	= No														;If no, requires upgrade to turn on.
		TriggeredBy		= Upgrade_DreadVisage
		RefreshDelay	= 2000
		Range			= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF
		BonusName		= GenericDebuff
		ObjectFilter	= GENERIC_DEBUFF_RECIPIENT_OBJECT_FILTER
	End
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_DreadVisage
		WhichSpecialPower					= 1
		GenerateFear						= Yes
		EmotionPulseRadius					= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		EmotionPulseInterval				= 2000
	End
	
	;---------HOUR OF THE WITCH KING---------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HOFTWEnabler
		SpecialPowerTemplate		= SpecialAbilityCurseEnemy
		TriggeredBy					= Upgrade_HourOfTheWitchKing
		ObeyRechageOnTrigger		= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_HOFTW
		SpecialPowerTemplate		= SpecialAbilityCurseEnemy

		StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
		;InitiateSound				= FellBeastVoiceAttack
	End

 	Behavior = CurseSpecialPower ModuleTag_HOFTWUPdate
        SpecialPowerTemplate		= SpecialAbilityCurseEnemy

	    CursePercentage				= 80.0% ;;-;; 100.0% //Curse the target's power by this amount (will not exceed maximum charge time)

		StartAbilityRange			= 400 ; ; 200.0
		CursedFX					= FX_SarumanDominateTargets
		TriggerFX					= FX_CreateaHeroCurse
		UnpackTime					= 2000
		PreparationTime				= 1000
		PackTime					= 1000 ;;-;;
		;;-;; FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
    End	

	

	FormationPreviewDecal 
        	Texture = FPflyingUnitDecal
        	Width = 128
        	Height = 128
    	End

	Geometry			= CYLINDER
	GeometryMajorRadius = 39.0
	GeometryHeight		= 40.0
	GeometryOffset		= X:0 Y:0 Z:-10
	GeometryIsSmall		= No
	Shadow				= SHADOW_VOLUME_NON_SELF_3	; volumetric shadow that doesn't cast onto all objects using SHADOW_VOLUME_NON_SELF_3
	ShadowSunAngle		= 89						; clamp the angle so shadow casts straight down.
End


;------------------------------------------------------------------------------
; aka Witch King, WitchKingMordor, MordorFellBeast
Object MordorWitchKing                         ;BALANCE WitchKing 
	; *** ART Parameters ***
	
	Scale = 1.575 ;;-;; 1.5
	;;-;; This was never applied, now it is. ;;-;; 	Scale = 1.05
 	
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPWitchKing
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
	ButtonImage = HIWitchKing
	
	DescriptionStrategic = CONTROLBAR:LW_ToolTip_WitchKing

	Draw = W3DScriptedModelDraw ModuleTag_01
	
		OkToChangeModelColor = Yes
		  
		;GlowEnabled = Yes
		;GlowEmissive = No
		
		DefaultModelConditionState
			Model               = muwk_skn ;;=;; MUWchKng_SKN
			Skeleton			= MUWchKng_SKL
			ParticleSysBone = B_SWORD WitchkingFlamingSwordBlack FollowBone:Yes	       ;;=;;
		End
 			ModelConditionState = USER_3
			Model               = muwk_skn ;;=;; MUWchKng_SKN
			Skeleton			= MUWchKng_SKL
				ParticleSysBone 	= B_SWORD WitchkingFlamingSwordBlack FollowBone:Yes	       ;;=;;
				ParticleSysBone     = None BlackRiderFlare FXTrigger:NONE Persist:SPAWN PersistID:100
			End
 
		IdleAnimationState
			StateName				= Idle
			Animation
				AnimationName       = MUWchKng_IDLC
				AnimationPriority	= 1
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Animation
				AnimationName       = MUWchKng_IDLD
				AnimationPriority = 1
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Animation
				AnimationName       = MUWchKng_IDLE
				AnimationPriority = 1
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE		
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_to_Idle") end
			EndScript	
		End
		
		AnimationState        = DYING BURNINGDEATH
			Animation           = DIEA
				AnimationName     = MUWchKng_DIEB
				AnimationMode     = ONCE
				AnimationBlendTime = 10
			End
		End
		AnimationState        = DYING
			Animation           = DIEA
				AnimationName     = MUWchKng_DIEB
				AnimationMode     = ONCE
			End
		End

		AnimationState        = BURNINGDEATH
			Animation           = DIEA
				AnimationName     = MUWchKng_MFDA
				AnimationMode     = LOOP
				Distance	      = 60
			End
		End


		AnimationState = FREEFALL
			Animation
				AnimationName = MUWchKng_FLYA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
		End
		
		AnimationState = STUNNED_FLAILING
			Animation
				AnimationName = MUWchKng_FLYA
				AnimationMode = LOOP
				AnimationSpeedFactorRange	= 0.4 0.6
			End
			Flags = RANDOMSTART
		End
		
		AnimationState = STUNNED_STANDING_UP
			Animation
				AnimationName = MUWchKng_GTPB
				AnimationMode = ONCE
			End
		End		
		
		AnimationState			= STUNNED 
			Animation           = LNDA
				AnimationName   = MUWchKng_LNDB
				AnimationMode   = ONCE
			End
		End
    	//-----------------Ecthelion2019Animating--------------//	  
		;;-;;	Screech				// Foot Screech
 		AnimationState        				= SPECIAL_WEAPON_TWO ;;-;;	UNPACKING PACKING_TYPE_2
			Animation
				AnimationName				= MUWchKng_CHRA
				AnimationMode				= ONCE
                AnimationSpeedFactorRange	= .85 .85 ;;-;; 1 1 ;;-;; 0.4 0.4
             End
			;;-;; FXEvent = Frame:30 Name:FX_FearBlastwkmount ;;-;; This is being played via weapon
 			;;-;; ParticleSysBone = B_SWORD WitchkingFlamingSwordPurple FollowBone:Yes	;;-;; No more flame sword due to purple fx.
		End
		;;-;;	Curse
		AnimationState						= PACKING_TYPE_3 ;;-;; UNPACKING PACKING_TYPE_3
			Animation
				AnimationName				= MUWchKng_CHRA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.4 0.4
			End
			ParticleSysBone 				= B_SWORD WitchkingFlamingSword FollowBone:Yes		 
			FXEvent 						= Frame:5 Name:FX_GandalfPreAttackBlastRealWK  ; ; 
			;FXEvent  						= Frame:1 Name:FX_GandalfPreAttackBlastRealWKVoice  ; ;  		  
		End	
 		//-----------------Ecthelion2019Animating--------------//
		;I don't like he goes to sword.
 		;AnimationState						= MOVING FIRING_OR_PREATTACK_A ;;-;; 
		;	Animation						= RUNB
		;		AnimationName				= MUWchKng_ATRA
		;		AnimationMode				= LOOP
		;	End
 		;End
		//------------------------------------------------------//
		AnimationState        =  FIRING_OR_PREATTACK_A
			;Animation           = ATA1		// removing sword anims now that he does a big meta impact attack
			;	AnimationName     = MUWchKng_ATKA
			;	AnimationMode     = ONCE
			;	UseWeaponTiming		= Yes
			;End
			;Animation           = ATB1
			;	AnimationName     = MUWchKng_ATKB
			;	AnimationMode     = ONCE
			;	UseWeaponTiming		= Yes
			;End
			Animation           = ATA1
				AnimationName     = MUWchKng_ATKC
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			Animation           = ATB1
				AnimationName     = MUWchKng_ATKD
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
		End
;		AnimationState        = BETWEEN_FIRING_SHOTS_A
;			Animation           = ALERT_1
;				AnimationName     = MUWchKng_IDLC
;				AnimationMode     = LOOP
;				AnimationPriority = 10
;			End
;		End

		AnimationState        = MOVING
			Animation           = RUNB
				AnimationName     = MUWchKng_RUNB
				AnimationMode     = LOOP
			End
			Flags               = RANDOMSTART
		End
		
		AnimationState = LEVELED
			Animation = Hit_Level_1_a
				AnimationName = MUWchKng_LVLA
				AnimationMode = ONCE
			End
		End		
		
		; --------- Click and Hit Reactions ------------
		AnimationState = HIT_REACTION HIT_LEVEL_1
			Animation = Hit_Level_1_a
				AnimationName = MUWchKng_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState        = EMOTION_ALERT
			Animation           = ALERT_1
				AnimationName     = MUWchKng_IDLC
				AnimationMode     = ONCE
			End
			Flags               = RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
		End
		
		AnimationState = RAISING_FLAG
			Animation
				AnimationName = MUWchKng_CHRA
				AnimationMode = LOOP
			End
		End
								
		AnimationState = SELECTED
			Animation
				AnimationName = MUWchKng_ATNB
				AnimationMode = LOOP
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
			EndScript			
		End
				
		TransitionState       = TRANS_IdleToSelected
			Animation           = ATNA
				AnimationName     = MUWchKng_ATNA
				AnimationMode     = ONCE
			End
		End
		
		TransitionState       = TRANS_SelectedToIdle
			Animation           = ATNA
				AnimationName     = MUWchKng_ATNC
				AnimationMode     = ONCE
			End
			Flags = START_FRAME_LAST
		End
		
;		TransitionState       = TRANS_SelectedToMace
;			Animation           = ATNA
;				AnimationName     = MUWchKng_STHA
;				AnimationMode     = ONCE
;				AnimationSpeedFactorRange = 0.7 1.3
;			End
;			BeginScript
;					CurDrawableShowSubObject("MACE")
;			EndScript
;		End
		
;		TransitionState       = TRANS_MaceToSelected
;			Animation           = ATNA
;				AnimationName     = MUWchKng_STHB
;				AnimationMode     = ONCE
;				AnimationSpeedFactorRange = 0.7 1.3
;			End
;			BeginScript
;				CurDrawableShowSubObject("MACE")
;			EndScript
;		End
		
;		AnimationState = WAR_CHANT
;			Animation = Chant
;				AnimationName = MUWchKng_CHRA
;				AnimationMode = LOOP
;			End
;			BeginScript
;				CurDrawableHideSubObject("MACE")
;			EndScript
;		End

	End

	; ***DESIGN parameters ***
	Side				= Mordor
	EditorSorting		= UNIT
	ThreatLevel			= WITCHKING_THREAT_LEVEL
	ThingClass			= MEDIUM_MONSTER
	BuildCost			= WITCHKING_ON_FELLBEAST_BUILDCOST		
	BuildTime			= WITCHKING_ON_FELLBEAST_BUILDTIME		
	TransportSlotCount	= TRANSPORTSLOTCOUNT_HERO
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
	CommandSet			= MordorWitchKingCommandSet
	CommandPoints		= WITCHKING_COMMAND_POINTS

	VisionRange			= VISION_FLIER
	ShroudClearingRange = SHROUD_CLEAR_FLIER

	BountyValue			= WITCHKING_BOUNTY_VALUE
	DisplayName			= OBJECT:MordorWitchKing
	CrushableLevel		= 4 ;;-;; 2  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	RamPower			= 30
	RamZMult			= 0.5
    MaxSimultaneousOfType = 1
	 
	WeaponSet
		Weapon              = PRIMARY     WitchKingWarMace   ;WitchKingMorgulBlade
		Weapon				= TERTIARY	  WitchKingMorgulBladeSpecialPower
	    AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	    AutoChooseSources	= SECONDARY FROM_PLAYER
	    AutoChooseSources	= TERTIARY NONE
	End
	
	;WeaponSet
	;	Conditions			= WEAPONSET_TOGGLE_1
	;	Weapon				= PRIMARY	  WitchKingWarMace
	;	Weapon				= TERTIARY	  WitchKingMorgulBladeSpecialPower
	 ;   AutoChooseSources	= TERTIARY NONE
	;End

	ArmorSet
		Conditions      = None
		Armor           = ToughHeroWKArmor ; ;WitchKingArmor
		DamageFX        = None
	End


	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = AutoResolve_WitchKingBody
	
	AutoResolveArmor
		Armor = AutoResolve_WitchKingArmor
	End

	AutoResolveWeapon
		Weapon = AutoResolve_WitchKingWeapon
	End
	
	;AutoResolveLeadership = AutoResolve_MouthOfSauronBonus


	; *** AUDIO Parameters ***;

	VoiceAttack					= FellBeastVoiceAttackWitchKing
	VoiceAttackCharge			= FellBeastVoiceAttackWitchKing	
	VoiceAttackMachine			= FellBeastVoiceAttackWitchKing
	VoiceAttackStructure		= FellBeastVoiceAttackWitchKing
	;VoiceCreated				= EVA:WitchKingCreated
	;VoiceFullyCreated 			= EVA:WitchKingCreated
	VoiceMove					= FellBeastVoiceMoveWitchKing
	VoiceMoveToCamp				= FellBeastVoiceMoveWitchKing
	VoiceMoveWhileAttacking		= FellBeastVoiceMoveWitchKing
	VoicePriority				= 88
	VoiceRetreatToCastle		= FellBeastVoiceMoveWitchKing
	VoiceSelect					= FellBeastVoiceSelectWitchKing
	VoiceSelectBattle 			= FellBeastVoiceSelectWitchKing
	VoiceGuard					= FellBeastVoiceMoveWitchKing

	SoundImpact					= ImpactHorse

	UnitSpecificSounds
		VoiceEnterUnitEvilMenTransportShip	= FellBeastVoiceMove
		VoiceEnterUnitMordorMumakil			= FellBeastVoiceMove
		VoiceEnterUnitSlaughterHouse		= FellBeastVoiceMove
		VoiceGarrison						= FellBeastVoiceMove
		VoiceInitiateCaptureBuilding		= FellBeastVoiceSelectWitchKing
		VoiceSpecialAbilityCurseEnemy		= WitchkingresetBTP
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		;AnimationSound = Sound:FootstepDirtA	Animation:MUSAURON_SKL.MUSAURON_WLKA 	Frames:8 26 44 62 80 98 
		AnimationSound = Sound:BodyFallSoldier	Animation:MUWCHKNG_SKL.MUWCHKNG_DIEA	Frames:67
		AnimationSound = Sound:BodyFallSoldier	Animation:MUWCHKNG_SKL.MUWCHKNG_DIEB	Frames:122
		AnimationSound = Sound:BodyFallSoldier	Animation:MUWCHKNG_SKL.MUWCHKNG_LNDA	Frames:4
		AnimationSound = Sound:BodyFallSoldier	Animation:MUWCHKNG_SKL.MUWCHKNG_LNDB	Frames:4
	End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

	EvaEventDieOwner		= WitchKingDie			;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths
							;For deaths you can respawn from, use the DeathFX


	; *** ENGINEERING Parameters ***
	RadarPriority	= UNIT
	KindOf			= PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY MONSTER PATH_THROUGH_INFANTRY SCARY ARMY_SUMMARY HERO HEAVY_MELEE_HITTER SCORE
	 
	Body = RespawnBody ModuleTag_02
		CheerRadius 				= EMOTION_CHEER_RADIUS
		MaxHealth         			= WITCHKING_ON_FELLBEAST_HEALTH			;BALANCE Witchking Health
		PermanentlyKilledByFilter	= NONE	//	+RohanEowyn		Nope, that's BFME1.  This is BFME2
		BurningDeathBehavior		= Yes
		BurningDeathFX				= FX_InfantryBurningFlame
   		DodgePercent      			= WITCHKING_DODGE_PERCENT
	End
	
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim					= USER_1				;Model condition to play when killed-to-respawn
		DeathFX						= FX_WitchKingDeath		;FXList to play when killed-to-respawn
		DeathAnimationTime			= 5133					;How long DeathAnim will take.
		InitialSpawnFX   			 = FX_MinasMorgulUpgraded ;;=;; 
		RespawnAnim					= LEVELED				;Animation to play when respawning.
		RespawnFX					= FX_MinasMorgulUpgraded ;;=;; FX_Resurrection		;FXList to play when respawning.
		RespawnAnimationTime		= 2000					;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage					= HIWitchKing_res
		RespawnAsTemplate			= MordorWitchKingOnFellBeast

		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No		Cost:2500		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1000 )	Health:100%		;DEFAULT VALUES
		RespawnEntry =	Level:2				Cost:2875		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1500 )					; ;50% cost, 1x buildtime ;For other levels, only override what is different.
		RespawnEntry =	Level:3				Cost:2875		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 1500 )
		RespawnEntry =	Level:4				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )
		RespawnEntry =	Level:5				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )						; ;65% cost, 2x buildtime
		RespawnEntry =	Level:6				Cost:3250		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2000 )
		RespawnEntry =	Level:7				Cost:3625		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2500 )
		RespawnEntry =	Level:8				Cost:3625		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 2500 ) 					; ;80% cost, 3x buildtime
		RespawnEntry =	Level:9				Cost:4000		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 3000 ) 
		RespawnEntry =	Level:10			Cost:4000		Time:#MULTIPLY( WITCHKING_ON_FELLBEAST_RESPAWN_TIME 3000 ) 
	End
;;=Flyersrespawn=;;
	Behavior = AutoHealBehavior ModuleTag_WitchKingHealing
		StartsActive			= Yes
		HealingAmount			= WITCHKING_HEAL_AMOUNT
		HealingDelay			= 1000
		StartHealingDelay		= HERO_HEAL_DELAY
		HealOnlyIfNotInCombat	= Yes
	End

	;---------DREAD VISAGE------------------------------------------------------------------------
		Behavior = ModelConditionUpgrade ModuleTag_DreadVisageModelCondition
			TriggeredBy						= Upgrade_DreadVisage
			AddConditionFlags				= USER_3
		End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisage
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		TriggeredBy					= Upgrade_DreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisageAura
		StartsActive	= No														;If no, requires upgrade to turn on.
		TriggeredBy		= Upgrade_DreadVisage
		RefreshDelay	= 2000
		Range			= WITCHKING_DREADVISAGE_EFFECT_RADIUS
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF
		BonusName		= GenericDebuff
		ObjectFilter	= GENERIC_DEBUFF_RECIPIENT_OBJECT_FILTER
	End
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_DreadVisage
		WhichSpecialPower					= 1
		GenerateFear						= Yes
		EmotionPulseRadius					= WITCHKING_DREADVISAGE_EFFECT_RADIUS
		EmotionPulseInterval				= 2000
	End	
	 
	;---------MOUNT------------------------------------------------------------------------

	Behavior = CommandSetUpgrade ModuleTag_MordorTavernLevel2
		TriggeredBy		= Upgrade_IsengardFaction
		ConflictsWith	= Upgrade_MordorFaction
		CommandSet		= MordorWitchKingCommandSetIsengard
	End

	Behavior = CommandSetUpgrade ModuleTag_MordorTavernLevel3
		TriggeredBy		= Upgrade_MordorFaction
		ConflictsWith	= Upgrade_IsengardFaction
		CommandSet		= MordorWitchKingCommandSet
	End

 	Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter                      
 		SpecialPowerTemplate		= SpecialAbilityToggleMounted
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		;InitiateSound				= FellBeastVoiceMove
 	End

	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
 		SpecialPowerTemplate    = SpecialAbilityToggleMounted
 		MountedTemplate			= MordorWitchKingOnFellBeast
 		SynchronizeTimerOnSpecialPower = SpecialAbilityCurseEnemy SpecialAbilityScreechWitchKing
 		UnpackTime              = 2000
 		PreparationTime         = 0			; none, cause we hop onto our mount in no time at all :)
 		PackTime                = 0 		; none, cause we hop onto our mount in no time at all :)
 		OpacityTarget			= .0		; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
		TriggerSound			= MountFellBeastSound
	End
    
     
	;--------------------------------------------------------------------------
	 ; Non-mounted Screech		;;-;;Ecthelion2019Behaviors;;-;;
	;--------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ScreechUnPause
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
		TriggeredBy						= Upgrade_Screech
		ObeyRechageOnTrigger			= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_Screech                      
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
		UpdateModuleStartsAttack		= Yes
		StartsPaused					= Yes
		;;-;; TriggerFX					= FX_FearBlastRiderWK ;;-;; Currently coming from weapon.
	End
 	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ScreechUpdate ;;-;;   
		SpecialPowerTemplate			= SpecialAbilityScreechWitchKing
 		WhichSpecialWeapon				= 2 ;; sets SPECIAL_WEAPON_TWO ;;-;;
		SkipContinue					= Yes
		UnpackTime						= 550 ;; 400
		PackTime                		= 1533 ;;-;; I understood you don't like when he moves his swod ;; 2000 ;;-;; 900
        ;CustomAnimAndDuration			= AnimState:SPECIAL_WEAPON_TWO AnimTime:3000		
		TriggerSound					= WitchKingScreechMS 
		BusyForDuration					= 2000	;;-;;
		AwardXPForTriggering    		= 0		
 		StartAbilityRange				= 280 
		SpecialWeapon					= WitchKingScreechWeapon               
		;UnpackingVariation				= 2 ;; sets PACKING_TYPE_2
 			ParalyzeDurationWhenCompleted	= 1500 ;;-;;
			ParalyzeDurationWhenAborted		= 700 ;;-;;
			FreezeAfterTriggerDuration		= 1700 ;;-;;
	End
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
 		SpecialAbility 					= SpecialAbilityScreechWitchKing
		MaxScanRange 					= 150.0
  		Query 							= 3 ANY ENEMIES +HORDE
 		ForbiddenStatus 				= INSIDE_GARRISON
 	End
	;;-;; Behavior = SpecialAbilityUpdate ModuleTag_ScreechUpdateOld
	;;-;; 	SpecialPowerTemplate		= SpecialAbilityScreechWitchKing
	;;-;; 	UnpackTime					= 3400
	;;-;; 	UnpackingVariation		= 2
	;;-;; 	TriggerSound				= WitchKingScreechMS
	;;-;; 	FreezeAfterTriggerDuration	= 700
	;;-;; 	EffectRange					= 280 ; ; 180
	;;-;; End
 	;--------------------------------------------------------------------------
	 ; Non-mounted Screech		;;-;;Ecthelion2019Behaviors;;-;;
	;--------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HOFTWEnabler
		SpecialPowerTemplate			= SpecialAbilityCurseEnemy
		TriggeredBy						= Upgrade_HourOfTheWitchKing
 		ObeyRechageOnTrigger			= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_HOFTW
		SpecialPowerTemplate			= SpecialAbilityCurseEnemy
		StartsPaused					= Yes
		UpdateModuleStartsAttack		= Yes
		;AttributeModifier				= SpellBookDarkness  ;;,;;
		;AttributeModifierAffectsSelf	= No ;;,;;
		;AttributeModifierAffects 		= NONE +HERO -MordorBalrog
		;AttributeModifierFX 			= FX_TheodenGloriousChargeFX
		;AttributeModifierRange 		= 230
		AntiCategory					= LEADERSHIP BUFF
 		AttributeModifier				= WitchKingCurseRadialModifier09v2
		AttributeModifierRange			= WITCHKING_CURSE_RADIAL_EFFECT_RADIUS
		AttributeModifierAffects		= ANY +HERO ENEMIES;;-;;
	End
  	Behavior = CurseSpecialPower ModuleTag_HOFTWUPdate
        SpecialPowerTemplate			= SpecialAbilityCurseEnemy
        CursePercentage					= 80% ;;-;; 60.0% ; ; 100%//Curse the target's power by this amount (will not exceed maximum charge time)
        StartAbilityRange				= 230 ; ; 200.0
 		;;TriggerAttributeModifier		= LurtzCarnage // Affects me not them.
		;ChainedButton					= Command_SpecialAbilityActivateeDummyOne // With this we can do interesting things.
 		CursedFX						= FX_CreateaHeroCurseWK
		;TriggerFX						= FX_CreateaHeroCurseWK ; ; FX_CreateaHeroCurseWK
		UnpackingVariation				= 3 ;; sets PACKING_TYPE_3
 		UnpackTime              		= 4100 ; insant unpack
		PreparationTime         		= 1 ;;-;; 
		PackTime                		= 1100 ;;-;;  
		;;-;; FreezeAfterTriggerDuration		= 1000 ; Hold AI for this long after we fire.
    End	
 	;Behavior = SpecialPowerModule ModuleTag_HOFTW2
	;	SpecialPowerTemplate			= SpecialAbilityActivateeDummyOne
 	;	AttributeModifier				= WitchKingCurseRadialModifier09v2
	;	AttributeModifierRange			= WITCHKING_CURSE_RADIAL_EFFECT_RADIUS
	;	AttributeModifierAffects		= ANY +HERO ENEMIES;;-;;
	;End
 	Behavior = AutoAbilityBehavior ModuleTag_HotWKAutoAbility
		SpecialAbility					= SpecialAbilityCurseEnemy
		MaxScanRange					= 230
		ForbiddenStatus					= INSIDE_GARRISON
 		Query							= 1 ANY ENEMIES +HERO -MONSTER -STRUCTURE -SUMMONED ;;-;;
	End
	;--------------------------------------------------------------------------
    
    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End
        
	#include "..\..\..\includes\CaptureBuilding.inc"
	   
	Behavior = AIUpdateInterface ModuleTag_AI
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		AILuaEventsList = EvilMenBlackRiderFunctions
		BurningDeathTime = BURNINGDEATH_DURATION_INFANTRY
	End

	LocomotorSet
		Locomotor = NazgulLocomotor
		Condition = SET_NORMAL
		Speed     = NORMAL_EVIL_HERO_SPEED_WITCHKING
	End

	LocomotorSet
		Locomotor = BurningDeathLocomotorInfantry
		Condition = SET_BURNINGDEATH
		Speed	  = 75
	End

	Behavior = PhysicsBehavior ModuleTag_Physics
	End

	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes			= ALL 					;-KNOCKBACK
		SinkDelay			= 3000
		SinkRate			= 1.20     ; in Dist/Sec
		DestructionDelay	= 15000
		Sound 				= INITIAL WKFootDieExplode ;;=;; INITIAL FellBeastDieExplode
	End
	 
;	Behavior = SlowDeathBehavior ModuleTag_07
;		; Same as normal death, but no sound (sound already played by SoundImpact = ... )
;		DeathTypes			= NONE +KNOCKBACK
;		SinkDelay			= 3000
;		SinkRate			= 1.20     ; in Dist/Sec
;		DestructionDelay	= 15000
;	End

	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_WitchKingToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
	
	Behavior = AISpecialPowerUpdate ScreechAI
		CommandButtonName = Command_SpecialAbilityScreechWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
	
	Behavior = AISpecialPowerUpdate HourOfTheWitchKingAI
		CommandButtonName = Command_HourOfTheWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
	End

	Geometry			= CYLINDER
	GeometryMajorRadius = 8.0
	GeometryHeight		= 16.0
	GeometryIsSmall		= Yes
	
	Shadow				= SHADOW_DECAL
	ShadowSizeX			= 19
	ShadowSizeY			= 19
	ShadowTexture		= ShadowI
End

;--------------------

ChildObject MordorWitchKing_Mounted MordorWitchKing

	; Same except without HERO
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY MONSTER PATH_THROUGH_INFANTRY SCARY ARMY_SUMMARY
	
End



