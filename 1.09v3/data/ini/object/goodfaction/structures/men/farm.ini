;------------------------------------------------------------------------------ 
;Gondor Farm
ChildObject GondorFarm_Original FarmInterface ;;-;; GondorFarm FarmInterface
	EquivalentTo = GondorFarm ;;-;;
 
  Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
    OkToChangeModelColor  = Yes
   	DefaultModelConditionState
		Model = GBHCFarm
    End
    MultiPlayerOnly = Yes 
  End
    
	Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    AnimationState = ACTIVELY_BEING_CONSTRUCTED
	    End
		AnimationState = UPGRADE_ECONOMY_BONUS
			ParticleSysBone	= None IndustryMen09v2 ;;-;; FueltheFiresEmbers
		End
	End
	Draw = W3DScriptedModelDraw Draw_GrandHarvest09v2
	    DefaultModelConditionState
	      Model = None
	    End
	    AnimationState = ACTIVELY_BEING_CONSTRUCTED
	    End
 		AnimationState = USER_1
			ParticleSysBone	= None Grandharvest09v2
		End
	End

	DisplayName         = OBJECT:GondorFarm
	Description 	    = CONTROLBAR:ToolTipConstructMenFarm
	Side                = Men
	BuildCost           = GONDOR_FARM_BUILDCOST
	BuildTime           = GONDOR_FARM_BUILDTIME          ; in seconds
	BountyValue         = GONDOR_FARM_BOUNTY_VALUE
	ShroudClearingRange = GONDOR_FARM_SHROUD_CLEAR
	CommandPointBonus	= GENERIC_ECONOMY_COMMAND_POINT_BONUS

	;;--- to allow generation of peasants ----------------
	CommandSet          = SellableCommandSet

	;----------------------- AUDIO ------------------------

	VoiceSelect						= GondorFarmSelect

	SoundAmbientDamaged				= BuildingDamageFireMediumLoop
	SoundAmbientReallyDamaged		= BuildingDamageFireLargeLoop

	;---------------------------------------------------

	WeaponSet
		Conditions			= None
	End

	WeaponSet
		Weapon				= PRIMARY GondorStructureBow
		Conditions			= PLAYER_UPGRADE
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName		  = GondorWorkerNoSelect
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         		  	= GONDOR_FARM_HEALTH
		MaxHealthDamaged  			= GONDOR_FARM_HEALTH_DAMAGED
		MaxHealthReallyDamaged 		= GONDOR_FARM_HEALTH_REALLY_DAMAGED
	    
		DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK
		DamageCreationList = OCL_GBFarm_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk3 CATAPULT_ROCK BACK_DESTROYED
		DamageCreationList = OCL_GBFarm_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
	End

	;Flammability	; should be after the 'Body' statement
		;Fuel		=	MEN_FARM_FIRE_FUEL		
		;MaxBurnRate	=	MEN_FARM_FIRE_MAX_BURN_RATE
		;Decay		=	MEN_FARM_FIRE_DECAY
		;Resistance	=	MEN_FARM_FIRE_RESISTANCE
	;End

;	Behavior = AutoDepositUpdate AutoDepositModuleTag
;		DepositTiming			= GONDOR_FARM_MONEY_TIME   ; in milliseconds
;		DepositAmount			= GONDOR_FARM_MONEY_AMOUNT   ; cash amount to deposit every DepositTiming
;		InitialCaptureBonus		= 0  ; no initial bonus
;	    
;		Upgrade					= Upgrade_MarketplaceUpgradeGrandHarvest  
;		UpgradeBonusPercent		= GONDOR_GRANDHARVEST_PRODUCTION_INCREASE %
;		UpgradeMustBePresent	= ANY +GondorMarketPlace
;	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoney
		Radius = GONDOR_FARM_MONEY_RANGE		; How far we try to claim ground
		MaxIncome = GONDOR_FARM_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval = GONDOR_FARM_MONEY_TIME	; How often (in msec) we give that much money
		
		Upgrade					= Upgrade_MarketplaceUpgradeGrandHarvest  
		UpgradeBonusPercent		= GONDOR_GRANDHARVEST_PRODUCTION_INCREASE %
		UpgradeMustBePresent	= ANY +GondorMarketPlace
	End
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;Behavior = SpawnBehavior ModuleTag_Spawn
		;SpawnNumber			= 5
		;InitialBurst		= 1
		;SpawnTemplateName	=  GondorTownsPairA     
		;SpawnReplaceDelay	= 5000000
		;CanReclaimOrphans	= Yes
	;End

;Behavior = SpawnBehavior ModuleTag_Spawn2 ; For Theoden's Special Drafted Power
		;SpawnNumber			= 5
		;InitialBurst		= 1
		;SpawnTemplateName	=   GondorTownsmanA    
		;SpawnReplaceDelay	= 5000
		;CanReclaimOrphans	= Yes
	;End

;Behavior = SpawnBehavior ModuleTag_Spawn3 ; For Theoden's Special Drafted Power
		;SpawnNumber			= 5
		;InitialBurst		= 1
		;SpawnTemplateName	=   GondorTownsWomanA   
		;SpawnReplaceDelay	= 5000
		;CanReclaimOrphans	= Yes
	;End
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
	ClientBehavior = TerrainResourceClientBehavior ModuleTag_NewMoneyClient
	End

	Behavior = ProductionUpdate ProductionUpdateModuleTag
		; GiveNoXP                       = Yes  ;disable granting xp when producing units.
	End
	
	;//these are only needed for buildings that have a upgrade button
	
	;Behavior = LevelUpUpgrade ModuleTag_BarracksLevel2
	;End

	;Behavior = LevelUpUpgrade ModuleTag_BarracksLevel3
	;End
	
  	Behavior = WeaponSetUpgrade ModuleTag_Weapon
		TriggeredBy		= Upgrade_StructureLevel3
	End
	
	; Same as farm interface, except without the AUTO_RALLYPOINT
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION CASTLE_KEEP FS_CASH_PRODUCER LIVING_WORLD_BUILDING_MIRROR ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE ECONOMY_STRUCTURE IGNORE_FOR_VICTORY
	
End



;------------------------------------------------------------------------------ 
ChildObject GondorFarmMultiplayer GondorFarm_Original
	;;-;; Remains with old model since this object is rather a BFME1 thing.
	PlacementViewAngle  = 45

	KindOf		= PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION IGNORE_FOR_VICTORY CASTLE_KEEP MADE_OF_STONE ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK
	RefundValue	= 100									; Half the cost of an economy plot.
	BuildCost	= GONDOR_FLAG_ECONOMY_UNPACK_COST		; Bit of a hack, but stops build canceling from getting the wrong price.
  
	;----------------------- AUDIO ------------------------

	SoundAmbientDamaged				= BuildingDamageFireMediumLoop
	SoundAmbientReallyDamaged		= BuildingDamageFireLargeLoop

	;----------------------------------------------

End

;;-;;
;------------------------------------------------------------------------------ 
ChildObject GondorFarm GondorFarm_Original ;;-;;
	
 	  Draw = W3DScriptedModelDraw ModuleTag_Draw

		ExtraPublicBone = ARROW_01
		ExtraPublicBone = ARROW_02
		ExtraPublicBone = ARROW_03
		ExtraPublicBone = ARROW_04
		ExtraPublicBone = ARROW_05
		ExtraPublicBone = ARROW_06
		ExtraPublicBone = ARROW_07
		ExtraPublicBone = ARROW_08
		ExtraPublicBone = ARROW_09
		ExtraPublicBone = ARROW_10

		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD  
	  
		DefaultModelConditionState
			Model = gbferma_skn
			WeaponLaunchBone = PRIMARY ARROW_01
		End

		ModelConditionState = WORLD_BUILDER
			Model = gbferma_skn
		End

		
		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
		  BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("V1")
			CurDrawableHideSubObject("V2")
				CurDrawableHideSubObject("OBJDEFAUL0")
			CurDrawableHideSubObject("HOE")
			CurDrawableShowSubObject("V1HIDE")
			CurDrawableShowSubObject("V2HIDE")
			  
		  EndScript
		End
		
		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
		  BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("V1")
			CurDrawableHideSubObject("V2")
				CurDrawableHideSubObject("OBJDEFAUL0")
			CurDrawableHideSubObject("HOE")
			CurDrawableShowSubObject("V1HIDE")
			CurDrawableShowSubObject("V2HIDE")
		  EndScript
		End
		
		IdleAnimationState
			Animation = IDLE
				AnimationName		=	GBFarm_SKL.GBFarm_IDLA
				AnimationMode			=	ONCE	
				AnimationBlendTime = 0
			End

		End	

	;-------------- SNOW BUILDUP ---------------------
			
			ModelConditionState   = AWAITING_CONSTRUCTION SNOW
				Model               = gbferma_a
				Texture					= gbferma.tga gbferma_sn.tga
			ParticleSysBone	  = NONE BuildingDoughnutCloud
			End
			AnimationState        = AWAITING_CONSTRUCTION SNOW
				Animation
					AnimationName	= gbferma_a.gbferma_a
					AnimationMode	= MANUAL
				End
				Flags				= START_FRAME_FIRST
			End
			
			ModelConditionState		=	ACTIVELY_BEING_CONSTRUCTED SNOW
				Model				=	gbferma_a
					Texture					= gbferma.tga gbferma_sn.tga
				ParticleSysBone   = Chimney BuildingContructMenFarm
			End;
			AnimationState        = ACTIVELY_BEING_CONSTRUCTED SNOW
				Animation
					AnimationName     = gbferma_a.gbferma_a
					AnimationMode     = MANUAL
				End
				Flags				= START_FRAME_FIRST
				StateName			= BeingConstructed
				BeginScript
				EndScript
			End
			
			;--------------------------------------------------
			
			ModelConditionState   = AWAITING_CONSTRUCTION
				Model               = gbferma_a
	;			ParticleSysBone	  = NONE BuildingDoughnutCloud
			End
			AnimationState        = AWAITING_CONSTRUCTION
				Animation
					AnimationName	= gbferma_a.gbferma_a
					AnimationMode	= MANUAL
				End
				Flags				= START_FRAME_FIRST
			End
			
			ModelConditionState		=	ACTIVELY_BEING_CONSTRUCTED
				Model				=	gbferma_a
				ParticleSysBone   = Chimney BuildingContructMenFarm
			End;
			AnimationState        = ACTIVELY_BEING_CONSTRUCTED
				Animation
					AnimationName     = gbferma_a.gbferma_a
					AnimationMode     = MANUAL
				End
				Flags				= START_FRAME_FIRST
				StateName			= BeingConstructed
				BeginScript
					CurDrawablePlaySound("GondorBarracksBeginConstruction")
				EndScript
			End
		   
		   
		
		 ;--damaged building
		ModelConditionState  = DAMAGED
			Model         = gbferma_d
			ParticleSysBone = FIRE_BONE01 FireBuildingLarge FollowBone:Yes
				ParticleSysBone = FIRE_BONE02 FireBuildingLarge FollowBone:Yes
				ParticleSysBone = SMOKE_BONE02 SmokeBuildingLarge FollowBone:Yes
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_BuildingDamaged
				BeginScript
				CurDrawableHideSubObject("OBJDEFAUL0")
				CurDrawableHideSubObject("HOE")
			EndScript

		End

		ModelConditionState  = REALLYDAMAGED
			Model         = gbferma_d2
			ParticleSysBone = FIRE_BONE01 FireBuildingLarge FollowBone:Yes
				ParticleSysBone = FIRE_BONE02 FireBuildingLarge FollowBone:Yes
				ParticleSysBone = SMOKE_BONE02 SmokeBuildingLarge FollowBone:Yes
		End
		
		AnimationState = REALLYDAMAGED
			EnteringStateFX	= FX_BuildingReallyDamaged
			;Animation	= ReallyDamagedAnimation
			;	AnimationName		=	gbferma_d2.gbferma_d2
			;	AnimationMode		=	ONCE	
			;End
			BeginScript
				CurDrawableHideSubObject("OBJDEFAUL0")
				CurDrawableHideSubObject("HOE")
			EndScript
		End

		ModelConditionState  = RUBBLE
			Model         = gbferma_d2
			ParticleSysBone = SMOKE_BONE02 SmokeBuildingLarge FollowBone:Yes
		End
		
		AnimationState = RUBBLE
			EnteringStateFX	= FX_BuildingReallyDamaged
			;Animation	= ReallyDamagedAnimation
			;	AnimationName		=	gbferma_d2.gbferma_d2
			;	AnimationMode		=	ONCE	
			;End
			BeginScript
				CurDrawableShowSubObject("WINDOW_F01")
				CurDrawableHideSubObject("GBFarm_01")
				CurDrawableHideSubObject("GBFarm_02")
				CurDrawableHideSubObject("GBFarm_03")
				CurDrawableHideSubObject("GBFarm_04")
			EndScript
		End

		ModelConditionState  = POST_RUBBLE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

		ModelConditionState  = POST_COLLAPSE
			 Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

		ModelConditionState = SNOW
			Model	= gbferma_skn		
			Texture = gbferma.tga gbferma_sn.tga;GBFarm.tga GBFarm_Snow.tga
			;Texture	= GBVet.tga GBVet_snow.tga
		End  
		
	End
   
	Behavior                  = StructureCollapseUpdate ModuleTag_07
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 100 ;;-;; 66
	End

	Geometry				= BOX
    GeometryName			= Geom_Orig
  	GeometryMajorRadius		= 28.0
	GeometryMinorRadius		= 37.5
	GeometryHeight			= 18.0
	GeometryOffset			= X:-18 Y:0 Z:0	
		
	AdditionalGeometry		= BOX
	GeometryName			= Geom_Orig
	GeometryMajorRadius		= 17.5
	GeometryMinorRadius		= 20.0
	GeometryHeight			= 40.0
	GeometryOffset			= X:22 Y:0 Z:0	
	
	AdditionalGeometry		= BOX
	GeometryName			= Geom_V1
	GeometryMajorRadius		= 45.0
	GeometryMinorRadius		= 36.0
	GeometryHeight			= 20.0
	GeometryOffset			= X:-3 Y:0 Z:0	
		
	AdditionalGeometry		= BOX
	GeometryName			= Geom_V1
	GeometryMajorRadius		= 17.5
	GeometryMinorRadius		= 20.0
	GeometryHeight			= 40.0
	GeometryOffset			= X:22 Y:0 Z:0	

	AdditionalGeometry		= BOX
	GeometryName			= Geom_V2
	GeometryMajorRadius		= 45.0
	GeometryMinorRadius		= 36.0
	GeometryHeight			= 20.0
	GeometryOffset			= X:-3 Y:0 Z:0	
		
	AdditionalGeometry		= BOX
	GeometryName			= Geom_V2
	GeometryMajorRadius		= 17.5
	GeometryMinorRadius		= 20.0
	GeometryHeight			= 65.0
	GeometryOffset			= X:22 Y:0 Z:0	
		
	;AdditionalGeometry		= BOX
	;GeometryName			= TERRAIN_BOUNDS
	;GeometryMajorRadius		= 200
	;GeometryMinorRadius		= 200
	;GeometryHeight			= 65.0
	;GeometryOffset			= X:0 Y:0 Z:0	
	;GeometryActive			= No
		
	GeometryIsSmall       = No
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
	
	GeometryContactPoint = X:-80	Y:70	Z:0			Repair
	GeometryContactPoint = X:80		Y:-29	Z:0	 		Repair
	GeometryContactPoint = X:47.782		Y:27.677	Z:0
	GeometryContactPoint = X:-53.507	Y:-27.336	Z:0
	GeometryContactPoint = X:21.744		Y:0.19		Z:52.222	Swoop
End
;------------------------------------------------------------------------------ 