;This once simple ini turned out a mess in the end. 39000+ lines, man. wtf.


;001 Custom Sciences
;002 Custom Upgrades
;003 Custom Special Powers
;004 Modifier List
;005 Custom Command Buttons
;006 Custom Command Sets (shopkeeper objects)
;007 Spellbook object
;008 Create-A-Hero object
;009 Faction config
;010 Environment FX
;011 Retextures
;012 Treasure Drops
;013 Weapon modifications (long)
;014 Bosses stuff
;015 Modified Hero Skills
;018 Custom Characters


;MissionObjectiveList
;MissionObjectiveTag = SCRIPT:MissionObjective_01
;END




;--------------------------------------------
;(001) CUSTOM SCIENCES > GIVEN TO PLAYER AT THE SAME TIME AS UPGRADES ARE GIVEN TO MAIN HERO (These are just for looks)
;--------------------------------------------



Science SCIENCE_ImprovedArmorL1
PrerequisiteSciences = SCIENCE_GOOD
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_ImprovedArmorL2
PrerequisiteSciences = SCIENCE_GOOD
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_BootsOfSpeed
PrerequisiteSciences = SCIENCE_GOOD
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_TalismanOfDeadlyRage
PrerequisiteSciences = SCIENCE_GOOD
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_BluemoonHeartstone
PrerequisiteSciences = SCIENCE_GOOD
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_HermitsStone
  PrerequisiteSciences = SCIENCE_GOOD
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_ElvenGifts
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = GOOD_RANK_1_COST
  SciencePurchasePointCostMP = 12
  IsGrantable = Yes
End

Science SCIENCE_Heal
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = GOOD_RANK_1_COST
  SciencePurchasePointCostMP = 12
  IsGrantable = Yes
End

Science SCIENCE_FreezingRain
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = EVIL_RANK_1_COST
  SciencePurchasePointCostMP = 5
  IsGrantable = Yes
End

Science SCIENCE_PotionOfHealing
  PrerequisiteSciences = SCIENCE_GOOD
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_PotionOfInvulnerability
  PrerequisiteSciences = SCIENCE_GOOD
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_ScrollOfRecall
  PrerequisiteSciences = SCIENCE_GOOD
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_PoisonReagent
  PrerequisiteSciences = SCIENCE_GOOD
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End


;NOTE TO SELF: Player upgrades (Bought at the shop, used as condition for Object Upgrade scripts),
;Object Upgrades (Given to heroes via script), and Sciences (Just for show to the player) work SEPARATEDLY

;------------------------------------------------
;(002) CUSTOM UPGRADES
;------------------------------------------------
; GIVEN TO MAIN HERO VIA SCRIPT (These give them the attribute bonus)

Upgrade Upgrade_ImprovedArmorL1Upgrade ;Give this with a script
  Type              = OBJECT
	UpgradeFX		= FX_PorterDeliverHeavyArmor
End

Upgrade Upgrade_ImprovedArmorL2Upgrade ;Give this with a script
  Type              = OBJECT
	UpgradeFX		= FX_PorterDeliverHeavyArmor
End

Upgrade Upgrade_BootsOfSpeedUpgrade ;Give this with a script
  Type              = OBJECT
End

Upgrade Upgrade_TalismanOfDeadlyRageUpgrade ;Give this with a script
  Type              = OBJECT
End

Upgrade Upgrade_BluemoonHeartstoneUpgrade ;Give this with a script
  Type              = OBJECT
End

Upgrade Upgrade_HermitsStoneUpgrade ;Give this with a script
  Type              = OBJECT
End

Upgrade Upgrade_UseInvulnerability	;Give this with a script
  Type              = OBJECT
End

Upgrade Upgrade_ElvenGift ;This one is actually given to the player so all his heroes are affected
  DisplayName       = CONTROLBAR:LegendsElvenGifts
  Type              = PLAYER
  PersistsInCampaign = Yes
End

;-----------------------------------------
; GIVEN TO PLAYER VIA BUYING AT THE SHOPS

Upgrade Upgrade_PotionOfHealingPlayerUpgrade
	DisplayName			= CONTROLBAR:PotionOfHealing
	Type				= PLAYER
	BuildCost			= 1000
	BuildTime			= 0
End

Upgrade Upgrade_PotionOfInvulnerabilityPlayerUpgrade
	DisplayName			= CONTROLBAR:PotionOfInvulnerability
	Type				= PLAYER
	BuildCost			= 750
	BuildTime			= 0
End

Upgrade Upgrade_ScrollOfRecallPlayerUpgrade
	DisplayName			= CONTROLBAR:ScrollOfrecall
	Type				= PLAYER
	BuildCost			= 750
	BuildTime			= 0
End

Upgrade Upgrade_PoisonReagentPlayerUpgrade
	DisplayName			= CONTROLBAR:PoisonReagent
	Type				= PLAYER
	BuildCost			= 2800
	BuildTime			= 1
End

Upgrade Upgrade_ImprovedArmorL1PlayerUpgrade
	DisplayName			= CONTROLBAR:ImprovedArmorL1
	Type				= PLAYER
	BuildCost			= 1000
	BuildTime			= 1
	ResearchCompleteEvaEvent	= UpgradeHeavyArmorReady
End

Upgrade Upgrade_ImprovedArmorL2PlayerUpgrade
	DisplayName			= CONTROLBAR:ImprovedArmorL2
	Type				= PLAYER
	BuildCost			= 2200
	BuildTime			= 1
	ResearchCompleteEvaEvent	= UpgradeElvenArmorReady
End

Upgrade Upgrade_BootsOfSpeedPlayerUpgrade
	DisplayName			= CONTROLBAR:BootsOfSpeed
	Type				= PLAYER
	BuildCost			= 2250
	BuildTime			= 1
End

Upgrade Upgrade_TalismanOfDeadlyRagePlayerUpgrade
	DisplayName			= CONTROLBAR:TalismanOfDeadlyRage
	Type				= PLAYER
	BuildCost			= 3600
	BuildTime			= 1
End

Upgrade Upgrade_BluemoonHeartstonePlayerUpgrade
	DisplayName			= CONTROLBAR:BluemoonHeartstone
	Type				= PLAYER
	BuildCost			= 3000
	BuildTime			= 1
End

Upgrade Upgrade_HermitsStonePlayerUpgrade
	DisplayName			= CONTROLBAR:BluemoonHeartstone
	Type				= PLAYER
	BuildCost			= 3200
	BuildTime			= 1
End

;--------------------------------------------
;(003) CUSTOM SPECIAL POWERS
;--------------------------------------------




SpecialPower SpecialAbilityDominateEnemy
	Enum			= SPECIAL_DOMINATE_ENEMY
	ReloadTime		= 200000	;	This value MUST	be greater than	the	DefectDuration in the Behavior 
	RadiusCursorRadius	= 50.0
End

SpecialPower SpellBookLegendsPoisonReagent
	Enum				= SPECIAL_SPELL_BOOK_ARMY_OF_THE_DEAD  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_PoisonReagent
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsPotionOfHealing
	Enum				= SPECIAL_SPELL_BOOK_EYE_OF_SAURON  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_PotionOfHealing
	ReloadTime			= 999999999999999999999999				 ; To infinity and beyond!
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsPotionOfInvulnerability
	Enum				= SPECIAL_SPELL_BOOK_CLOUD_BREAK  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_PotionOfInvulnerability
	ReloadTime			= 99999999999999999999				 ; To infinity and beyond!
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsScrollOfRecall
	Enum				= SPECIAL_SPELL_BOOK_SPAWN_LONE_TOWER  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_ScrollOfRecall
	ReloadTime			= 999999999999999999999999				 ; To infinity and beyond!
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpecialAbilityLegendsScrollOfRecall					; Used by the Createahero
	Enum				= SPECIAL_GENERAL_TARGETLESS ;SPECIAL_TELEPORT_TEAM_TO_CASTER
	RadiusCursorRadius		= 1000000.0
	ReloadTime			= 10000
	ObjectFilter			= ANY +HERO ALLIES
	InitiateSound			= CaH_TeleportPart1
End

SpecialPower SpellBookLegendsImprovedArmorL1
	Enum				= SPECIAL_SPELL_BOOK_FUEL_THE_FIRES  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_ImprovedArmorL1
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsImprovedArmorL2
	Enum				= SPECIAL_SPELL_BOOK_RAIN_OF_FIRE  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_ImprovedArmorL2
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsBootsOfSpeed
	Enum				= SPECIAL_SPELL_BOOK_CAVE_BATS  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_BootsOfSpeed
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsTalismanOfDeadlyRage
	Enum				= SPECIAL_SPELL_BOOK_SCAVENGER  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_TalismanOfDeadlyRage
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsBluemoonHeartstone
	Enum				= SPECIAL_SPELL_BOOK_INDUSTRY  ;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_BluemoonHeartstone
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookLegendsHermitsStone
	Enum				= SPECIAL_SPELL_BOOK_PALANTIR_VISION	;Make sure this enum isn't used by another spell on the Legends Spellbook
	RequiredSciences		= SCIENCE_HermitsStone
	ReloadTime      		= 0 ; in milliseconds
	Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower NoSpecialPower
	Enum 		= SPECIAL_SPELL_BOOK_RAIN_OF_FIRE
	ReloadTime 	= 0
	Flags 		= RESPECT_RECHARGE_TIME_DISCOUNT
END


;------------
; Items FX
;------------

FXParticleSystem BootsOfSpeedParticles
  System
    Priority		= VERY_LOW_OR_ABOVE
    ParticleName 	= EXLnzflar7.tga
    Lifetime		= 25 35
;    Shader		= ALPHA
;    SystemLifetime	= 4
    Size		= 1 5
    BurstDelay		= 8 11
    BurstCount		= 1 1
  End
  Color = DefaultColor
    Color1 = R:250 G:250 B:255 0
    Color1 = R:230 G:230 B:255 40
;    ColorScale = -80 80
  End
;  Alpha = DefaultAlpha
;    Alpha1 = 0.5 0.5 0
;    Alpha2 = 1 1 4
;    Alpha3 = 0 0 20
;  End
  Update = DefaultUpdate
;    SizeRate = 1 3
;    SizeRateDamping = 0.6 0.99
;    AngleZ = -1 1
;    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = -0.02
    VelocityDamping = 0.90 0.94
  End
  EmissionVelocity = OrthoEmissionVelocity
;    X = -0.4 0.4
;    Y = -0.4 0.4
    Z = 1 2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 10
    Length = 5
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End


FXList FXBootsOfSpeed
  ParticleSystem
    Name = BootsOfSpeedParticles
    Offset = X:0.0 Y:0.0 Z:0
    AttachToObject = Yes
  End
END



FXParticleSystem TalismanOfDeadlyRageParticles
  System
    Priority		= VERY_LOW_OR_ABOVE
    ParticleName 	= EXBlast2.tga
    Lifetime		= 20 30
;    Shader		= ALPHA
;    SystemLifetime	= 4
    Size		= 1 5
    BurstDelay		= 20 20
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End
  Color = DefaultColor
    Color1 = R:250 G:0 B:0 0
    Color1 = R:0 G:0 B:0 30
;    ColorScale = -80 80
  End
;  Alpha = DefaultAlpha
;    Alpha1 = 0.5 0.5 0
;    Alpha2 = 1 1 4
;    Alpha3 = 0 0 20
;  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.985 0.99
;    AngleZ = -1 1
;    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = -0.02
;    ParticlesAttachToBone = Yes
    VelocityDamping = 0.90 0.94
  End
  EmissionVelocity = OrthoEmissionVelocity
;    X = -0.4 0.4
;    Y = -0.4 0.4
;    Z = 1 2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 1
    Length = 1
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End


FXList FXTalismanOfDeadlyRage
  ParticleSystem
    Name = TalismanOfDeadlyRageParticles
    Offset = X:0.0 Y:0.0 Z:1
    AttachToObject = Yes
  End
END


FXParticleSystem StoneOfTheHermitParticles
  System
    Priority		= VERY_LOW_OR_ABOVE
    ParticleName 	= EXLnzflar7.tga
    Lifetime		= 20 30
;    Shader		= ALPHA
;    SystemLifetime	= 4
    Size		= 1 5
    BurstDelay		= 40 55
    BurstCount		= 1 1
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:200 0
    Color1 = R:0 G:0 B:0 30
;    ColorScale = -80 80
  End
;  Alpha = DefaultAlpha
;    Alpha1 = 0.5 0.5 0
;    Alpha2 = 1 1 4
;    Alpha3 = 0 0 20
;  End
  Update = DefaultUpdate
    SizeRate = -0.1 -1
    SizeRateDamping = 0.985 0.99
;    AngleZ = -1 1
;    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = -0.02
;    ParticlesAttachToBone = Yes
    VelocityDamping = 0.90 0.94
  End
  EmissionVelocity = OrthoEmissionVelocity
;    X = -0.4 0.4
;    Y = -0.4 0.4
;    Z = 1 2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 8
    Length = 4
    Offset = X:0 Y:0 Z:7
  End
  Draw = DefaultDraw
  End
End


FXList FXStoneOfTheHermit
  ParticleSystem
    Name = StoneOfTheHermitParticles
    Offset = X:0.0 Y:0.0 Z:1
    AttachToObject = Yes
  End
END


;--------------------------------------------
;(004) CUSTOM MODIFIER LISTS
;--------------------------------------------

ModifierList ImprovedArmorL1Bonus
	Category = BUFF
	Modifier = ARMOR 5% ;;.;; 10%			; +10% Armor
	Modifier = HEALTH_MULT 106% ;;.;; 111%			; +10% Armor
	Duration = 0
End

ModifierList ImprovedArmorL2Bonus
	Category = SPELL
	Modifier = ARMOR 5% ;;.;;  ;15%		; +15% Armor
	Modifier = HEALTH_MULT 106% ;;.;; 111%			; +10% Armor
	Duration = 0
End

ModifierList BootsOfSpeedBonus
	Category = SPELL
	Modifier = SPEED 150%			; +50% Speed
	Duration = 0
	FX	 = FXBootsOfSpeed
End

ModifierList HermitsStone
	Category = SPELL
	Modifier = RECHARGE_TIME 75%		; -25% Ability recharge time
	Duration = 0
	FX	 = FXStoneOfTheHermit
End

ModifierList TalismanOfDeadlyRageBonus
	Category = SPELL
	Modifier = RATE_OF_FIRE 120%		; +15% Rate of fire
	Duration = 0
	FX	 = FX_LurtzBloodRage
	FX2	 = FXTalismanOfDeadlyRage
	MultiLevelFX = Yes
End

ModifierList BluemoonHeartstoneBonus
	Category = SPELL
	Modifier = HEALTH_MULT 120%		; +20% Health
	Duration = 0
;	FX	 = FXBluemoonHeartstone
End

ModifierList LegendsGerardeBladerune
	Category = SPELL
	Modifier = DAMAGE_MULT 115%		; Damage increased 15%
	Duration = 0				; Lasts forever
End

ModifierList PoisonReagentBonus
	Category = BUFF
	Modifier = DAMAGE_MULT 110%		; Damage increased 10%
	Duration = 0
;	FX	 = FXPoisonReagent
End

ModifierList UsePotionOfInvulnerability
	Category  = SPELL
	Modifier  = INVULNERABLE CREATE_A_HERO_INVULNERABILITY_MODIFIER	
	Duration  = 10000					// Matches RefreshRate of giving	module
	FX	  = FX_CreateAHeroInvulnerability_20	 
End

;--------------------------------------------
;(005) CUSTOM COMMAND BUTTONS
;--------------------------------------------
;SPELLS BUTTONS

CommandButton Command_SpecialAbilityGlorfindelBladeOfPurity ; Was Command_SpellBookElvenGifts in older version
	Command			= SPELL_BOOK
	SpecialPower		= SpellBookElvenGifts
	Options			= NONPRESSABLE
	TextLabel		= CONTROLBAR:GerardeBladerune
	DescriptLabel		= CONTROLBAR:TooltipGerardeBladerune
	ButtonImage		= HSGlorfindelBladeofPurity
	Upgrade			= NONE
	NeededUpgrade		= NONE
	ButtonBorderType	= UPGRADE
	AutoAbility		= No
	InPalantir	   	= Yes
End

;Command_SpellBookPoison
CommandButton Command_PoisonedBlades
	Command			= SPELL_BOOK
	Options			= NONPRESSABLE
	SpecialPower		= SpellBookLegendsPoisonReagent
	TextLabel		= CONTROLBAR:PoisonReagent
	DescriptLabel		= CONTROLBAR:ToolTipPoisonReagent
	InPalantir		= No
	Radial			= No
	ButtonBorderType	= UPGRADE
	ButtonImage		= BWTreasureTrove_PoisonBlades
	InPalantir	   	= Yes
End

;Command_SpellBookImprovedArmorL1
CommandButton Command_PurchaseTechnologyDwarvenMithrilMail
	Command 		= SPELL_BOOK
	SpecialPower		= SpellBookLegendsImprovedArmorL1
	Options			= NONPRESSABLE
	TextLabel		= CONTROLBAR:ImprovedArmorL1
	DescriptLabel		= CONTROLBAR:TooltipImprovedArmorL1    
   	ButtonImage		= BDForgeWorks_MithrilMail
	Upgrade			= NONE
	NeededUpgrade		= NONE
	ButtonBorderType	= UPGRADE
	Radial			= No
	InPalantir		= Yes
End

; Command_SpellBookImprovedArmorL2
CommandButton Command_PurchaseTechnologyElvenHeavyArmor
	Command 		= SPELL_BOOK
	SpecialPower		= SpellBookLegendsImprovedArmorL2
	Options			= NONPRESSABLE
	TextLabel		= CONTROLBAR:ImprovedArmorL2
	DescriptLabel		= CONTROLBAR:TooltipImprovedArmorL2   
	ButtonImage		= BEEregionForge_ElvenArmor
	Upgrade			= NONE
	NeededUpgrade		= NONE
	ButtonBorderType	= UPGRADE
	Radial			= No
	InPalantir	   	= Yes
End


;Command_SpellBookBootsOfSpeed
CommandButton Command_SpellBookEnshroudingMist
	Command 		= SPELL_BOOK
	SpecialPower		= SpellBookLegendsBootsOfSpeed
	Options			= NONPRESSABLE
	TextLabel		= CONTROLBAR:BootsOfSpeed
	DescriptLabel		= CONTROLBAR:TooltipBootsOfSpeed   
	ButtonImage		= SBGood_EnshroudingMist ;uccommon_dismountevil
	ButtonBorderType	= UPGRADE
	RadiusCursorType    	= EnshroudingMistRadiusCursor
	InPalantir	   	= Yes
End

CommandButton Command_SpellBookRainOfFire ; Command_SpellBookTalismanOfDeadlyRage
	Command			= SPELL_BOOK
	SpecialPower		= SpellBookLegendsTalismanOfDeadlyRage
	Options			= NONPRESSABLE 
	TextLabel		= CONTROLBAR:TalismanOfDeadlyRage
	DescriptLabel		= CONTROLBAR:TooltipTalismanOfDeadlyRage
  	ButtonImage		= SBEvil_RainofFire
	ButtonBorderType	= UPGRADE
    	RadiusCursorType	= RainOfFireRadiusCursor
    	CursorName		= GenericInvalid
    	InvalidCursorName	= GenericInvalid
	InPalantir	   	= Yes
End

CommandButton Command_SpecialAbilityPhialOfGaladrielSam ; CommandButton Command_SpellBookBluemoonHeartstone
	Command			= SPELL_BOOK
	SpecialPower		= SpellBookLegendsBluemoonHeartstone
	Options                 = NONPRESSABLE
	TextLabel		= CONTROLBAR:BluemoonHeartstone
	DescriptLabel		= CONTROLBAR:TooltipBluemoonHeartstone
	ButtonImage		= HSFrodoPhialOfGaladriel
	ButtonBorderType	= UPGRADE
	AutoAbility		= No
	PresetRange		= 0
	InPalantir		= Yes
End

CommandButton Command_FireWeaponMordorFortressMagmaCauldrons; Potion of Healing
	Command           	= SPELL_BOOK
	SpecialPower		= SpellBookLegendsPotionOfHealing
	Options			= CANCELABLE
	TextLabel         	= CONTROLBAR:PotionOfHealing
	DescriptLabel     	= CONTROLBAR:ToolTipPotionOfHealing
	ButtonImage       	= BMFortress_MagmaCauldrons
	ButtonBorderType  	= ACTION
	Radial            	= No
	InPalantir	   	= Yes
End


CommandButton Command_SpecialAbilityMoveUnseen 				; Unused
	Command			= SPELL_BOOK
	SpecialPower		= SpellBookLegendsPotionOfInvulnerability
	Options			= NONE
	TextLabel		= CONTROLBAR:PotionOfInvulnerability
	DescriptLabel		= CONTROLBAR:TooltipPotionOfInvulnerability
	ButtonImage		= HSThranduilMoveUnseen
	RadiusCursorType	= MoveUnseenRadiusCursor
	InvalidCursorName	= GenericInvalid
	ButtonBorderType	= ACTION
	InPalantir	   	= Yes
End

;CommandButton Command_ConstructElvenMirrorOfGaladriel			; Potion of Invulnerability
;	Command          	= SPELL_BOOK
;	Object           	= None
;	Options			= CANCELABLE
;	SpecialPower		= SpellBookLegendsPotionOfInvulnerability
;	TextLabel        	= CONTROLBAR:PotionOfInvulnerability
;	DescriptLabel     	= CONTROLBAR:TooltipPotionOfInvulnerability
;	ButtonImage      	= BEMirrorGaladriel
;	ButtonBorderType	= ACTION
;	Radial          	= No  
;	InPalantir	   	= Yes
;End


CommandButton Command_ToggleHobbitRockThrow			; Stone of the Hermit
	Command			= SPELL_BOOK
	Options			= NONPRESSABLE
	FlagsUsedForToggle	= None
	SpecialPower		= SpellBookLegendsHermitsStone
	TextLabel               = CONTROLBAR:HermitsStone
	DescriptLabel           = CONTROLBAR:TooltipHermitsStone
	ButtonImage             = HSPippinThrowRocks
	ButtonBorderType        = UPGRADE
	Radial			= Yes
	InPalantir		= Yes
End

;-----------------------------------
;BUYABLE AT SHOPS UPGRADE BUTTONS

CommandButton Command_ConstructMordorGateWatchersExpansion ; Purchase Poison Reagent
	Command          = PLAYER_UPGRADE
	Options		 = CANCELABLE
	Object           = None
	Upgrade		 = Upgrade_PoisonReagentPlayerUpgrade
	TextLabel        = CONTROLBAR:PoisonReagent
	ButtonImage      = BMFortress_GateWatchers
	ButtonBorderType = UPGRADE
	DescriptLabel    = CONTROLBAR:TooltipPoisonReagent
	Radial           = Yes
	InPalantir	 = No
End

CommandButton Command_PurchaseUpgradeDwarvenMithrilMail ; Purchase Improved Armor L1
	Options				= CANCELABLE
	NeededUpgrade			= NONE
	ButtonImage			= BDForgeWorks_MithrilMail
	Command				= PLAYER_UPGRADE
	Upgrade				= Upgrade_ImprovedArmorL1PlayerUpgrade
	TextLabel			= CONTROLBAR:ImprovedArmorL1
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:TooltipImprovedArmorL1
	Radial				= Yes
	InPalantir			= No
End

CommandButton Command_PurchaseUpgradeElvenHeavyArmor ; Purchase Improved Armor L2
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	NeededUpgrade			= NONE
	Upgrade				= Upgrade_ImprovedArmorL2PlayerUpgrade
	TextLabel			= CONTROLBAR:ImprovedArmorL2
	ButtonImage			= BEEregionForge_ElvenArmor
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:TooltipImprovedArmorL2
	Radial				= Yes
	InPalantir			= No
End


CommandButton Command_PurchaseUpgradeElvenFortressBlessedMist ; Purchase Boots Of Speed
	Command				= PLAYER_UPGRADE
	NeededUpgrade			= NONE
	Options				= CANCELABLE
	Upgrade				= Upgrade_BootsOfSpeedPlayerUpgrade
	TextLabel			= CONTROLBAR:BootsOfSpeed
	ButtonImage			= SBGood_EnshroudingMist ;uccommon_dismountevil
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:TooltipBootsOfSpeed
	Radial				= Yes
	InPalantir			= No
End

CommandButton Command_FiresOfDoom ; Purchase Talisman Of Deadly Rage
	Command                 = PLAYER_UPGRADE
	SpecialPower            = NONE
	Upgrade			= Upgrade_TalismanOfDeadlyRagePlayerUpgrade
	NeededUpgrade		= NONE
	TextLabel		= CONTROLBAR:TalismanOfDeadlyRage
	DescriptLabel		= CONTROLBAR:TooltipTalismanOfDeadlyRage
	Options                 = CANCELABLE
	RadiusCursorType	= RainOfFireRadiusCursor
	ButtonImage             = SBEvil_RainofFire
	ButtonBorderType        = UPGRADE
	Radial			= Yes
	InPalantir		= No
	AutoAbility		= No
End

CommandButton Command_SpecialAbilityPhialOfGaladriel ; Purchase Bluemoon Heartstone
	Command			= PLAYER_UPGRADE
	SpecialPower		= NONE
	Upgrade			= Upgrade_BluemoonHeartstonePlayerUpgrade
	Options			= CANCELABLE
	TextLabel		= CONTROLBAR:BluemoonHeartstone
  	ButtonImage		= HSFrodoPhialOfGaladriel
  	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:TooltipBluemoonHeartstone
  	AutoAbility		= No
 	PresetRange		= 0
	Radial			= Yes
	InPalantir		= No
End

CommandButton Command_PurchaseUpgradeMordorFortressMagmaCauldrons ; Purchase Potion Of Healing (first time)
	Command			= PLAYER_UPGRADE
	SpecialPower		= NONE
	Upgrade			= Upgrade_PotionOfHealingPlayerUpgrade
	TextLabel		= CONTROLBAR:PotionOfHealing
	ButtonImage		= BMFortress_UseMagmaCauldrons
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPotionOfHealing
	Radial			= Yes
	InPalantir		= No
End

CommandButton Command_PurchaseUpgradeElvenFortressMysticFountains	 ; Purchase Potion of invulnerability
  	Command			= PLAYER_UPGRADE
  	Upgrade			= Upgrade_PotionOfInvulnerabilityPlayerUpgrade
  	Options			= CANCELABLE
  	TextLabel         	= CONTROLBAR:PotionOfInvulnerability
  	DescriptLabel     	= CONTROLBAR:TooltipPotionOfInvulnerability
  	ButtonImage       	= BEFortress_MysticFountains
  	ButtonBorderType  	= UPGRADE
  	Radial            	= Yes
  	InPalantir	   	= No
End

CommandButton Command_ToggleFrodoWeapon				; Purchase Stone of the Hermit
	Command			= PLAYER_UPGRADE
  	Upgrade			= Upgrade_HermitsStonePlayerUpgrade
	Options			= CANCELABLE
	FlagsUsedForToggle	= None
	TextLabel               = CONTROLBAR:HermitsStone
	DescriptLabel           = CONTROLBAR:TooltipHermitsStone
	ButtonImage             = HSPippinThrowRocks
	ButtonBorderType        = ACTION
	Radial			= Yes
	InPalantir		= No
End

;--------------------------------------------
;(005b) CREATE A HERO > MODIFIED COMMAND BUTTONS
;--------------------------------------------

;-----------------------------------
;Starlight increased regen
;-----------------------------------

CommandButton Command_CreateAHero_Starlight
	Command					= SPECIAL_POWER
	SpecialPower				= SpecialAbilityCreateAHeroStarlight
	TextLabel				= CONTROLBAR:CAH_Starlight
	DescriptLabel				= CONTROLBAR:ToolTipLegendsCAH_Starlight
	ButtonImage				= HSGlorfindelStarlight
	ButtonBorderType			= ACTION
	InPalantir				= Yes
	AutoAbility				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel		= 1
	CreateAHeroUIPrerequisiteButtonName	= None
	UnitSpecificSound			= CaH_Starlight	
End

ChildObject CaH_StarlightObject FearRadiator
 
  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw
    DefaultModelConditionState
      Model               = None
      ParticleSysBone = None CloudBreakRays
    End
  End

	Behavior = LifetimeUpdate ModuleTag_01
		MinLifetime = 12000 ;30000
		MaxLifetime = 12000 ;30000
	End
	
	Behavior = AutoHealBehavior ModuleTag_HealUpdate
		StartsActive	= Yes
		HealingAmount	= 30.0 ;5
		HealingDelay	= 30
		Radius		= GLORFINDEL_STARLIGHT_RADIUS
		; no buff effect, GenericBuff below will supply
	End
	
	Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
		StartsActive	= Yes
		BonusName		= CaHStarlight ;;-;; GenericBuff
		RefreshDelay	= 2000
		Range			= 200
		ObjectFilter	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End	
End


;-----------------------------------
;Cripple Strike now target any units
;-----------------------------------

CommandButton Command_CreateAHero_CrippleStrikeRanged_Level1
	Command					= SPECIAL_POWER	
	SpecialPower				= SpecialAbilityCreateAHeroCrippleStrikeRanged_Level1
	Options					= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel				= CONTROLBAR:SpecialAbilityCrippleStrikeRanged_Level1
	CursorName				= EvilAbilityObj
	InvalidCursorName			= GenericInvalid 
	ButtonImage				= HSLurtzCrippleStrike
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsCrippleStrikeRanged_Level1
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel		= 1
	CreateAHeroUIPrerequisiteButtonName	= None
End

CommandButton Command_CreateAHero_CrippleStrikeRanged_Level2
	Command					= SPECIAL_POWER	
	SpecialPower				= SpecialAbilityCreateAHeroCrippleStrikeRanged_Level2
	Options					= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel				= CONTROLBAR:SpecialAbilityCrippleStrikeRanged_Level2
	CursorName				= EvilAbilityObj
	InvalidCursorName			= GenericInvalid 
	ButtonImage				= HSLurtzCrippleStrike
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsCrippleStrikeRanged_Level2
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel		= 3
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_CrippleStrikeRanged_Level1
End

CommandButton Command_CreateAHero_CrippleStrikeRanged_Level3
	Command					= SPECIAL_POWER	
	SpecialPower				= SpecialAbilityCreateAHeroCrippleStrikeRanged_Level3
	Options					= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel				= CONTROLBAR:SpecialAbilityCrippleStrikeRanged_Level3
	CursorName				= EvilAbilityObj
	InvalidCursorName			= GenericInvalid 
	ButtonImage				= HSLurtzCrippleStrike
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsCrippleStrikeRanged_Level2
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel		= 7
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_CrippleStrikeRanged_Level2
End

CommandButton Command_CreateAHero_CrippleStrikeRanged_Level4
	Command					= SPECIAL_POWER	
	SpecialPower				= SpecialAbilityCreateAHeroCrippleStrikeRanged_Level4
	Options					= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel				= CONTROLBAR:SpecialAbilityCrippleStrikeRanged_Level4
	CursorName				= EvilAbilityObj
	InvalidCursorName			= GenericInvalid 
	ButtonImage				= HSLurtzCrippleStrike
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsCrippleStrikeRanged_Level2
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel		= 10
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_CrippleStrikeRanged_Level3
End

CommandButton Command_CreateAHero_HotW_CrippleStrikeMelee_Level1
	Command                 		= SPECIAL_POWER 
	SpecialPower            		= SpecialAbilityCreateAHeroHotWCrippleStrikeMelee_Level1
	Options                 		= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel               		= CONTROLBAR:SpecialAbilityHotWCrippleStrikeMelee_Level1
	CursorName              		= EvilAbilityObj
	InvalidCursorName       		= GenericInvalid 
	ButtonImage             		= HSCrippleStrikeMelee
	ButtonBorderType        		= ACTION 
	DescriptLabel           		= CONTROLBAR:ToolTipLegendsCrippleStrikeMelee_Level1
	InPalantir			  	= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel		= 3
	CreateAHeroUIPrerequisiteButtonName	= None
End

CommandButton Command_CreateAHero_HotW_CrippleStrikeMelee_Level2
	Command                 		= SPECIAL_POWER 
	SpecialPower            		= SpecialAbilityCreateAHeroHotWCrippleStrikeMelee_Level2
	Options                 		= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel               		= CONTROLBAR:SpecialAbilityHotWCrippleStrikeMelee_Level2
	CursorName              		= EvilAbilityObj
	InvalidCursorName       		= GenericInvalid 
	ButtonImage             		= HSCrippleStrikeMelee
	ButtonBorderType        		= ACTION 
	DescriptLabel           		= CONTROLBAR:ToolTipLegendsCrippleStrikeMelee_Level2
	InPalantir			 	= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel		= 7
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_HotW_CrippleStrikeMelee_Level1
End

CommandButton Command_CreateAHero_SoS_CrippleStrikeMelee_Level1
	Command                 		= SPECIAL_POWER 
	SpecialPower            		= SpecialAbilityCreateAHeroSoSCrippleStrikeMelee_Level1
	Options                 		= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel               		= CONTROLBAR:SpecialAbilitySoSCrippleStrikeMelee_Level1
	CursorName              		= EvilAbilityObj
	InvalidCursorName       		= GenericInvalid 
	ButtonImage             		= HSCrippleStrikeMelee
	ButtonBorderType       			= ACTION 
	DescriptLabel          			= CONTROLBAR:ToolTipLegendsCrippleStrikeMelee_Level2
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel		= 3
	CreateAHeroUIPrerequisiteButtonName	= None
End

CommandButton Command_CreateAHero_SoS_CrippleStrikeMelee_Level2
	Command                 		= SPECIAL_POWER 
	SpecialPower            		= SpecialAbilityCreateAHeroSoSCrippleStrikeMelee_Level2
	Options                 		= NEED_TARGET_ENEMY_OBJECT // CONTEXTMODE_COMMAND
	TextLabel               		= CONTROLBAR:SpecialAbilitySoSCrippleStrikeMelee_Level2
	CursorName              		= EvilAbilityObj
	InvalidCursorName       		= GenericInvalid 
	ButtonImage             		= HSCrippleStrikeMelee
	ButtonBorderType        		= ACTION 
	DescriptLabel           		= CONTROLBAR:ToolTipLegendsCrippleStrikeMelee_Level2
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel		= 7
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_SoS_CrippleStrikeMelee_Level1
End

;-------------------------------
;HOWL OF RAGE now affects heroes
;-------------------------------

ModifierList LegendsHowlOfRageAttribute1
	Category	= BUFF
	Modifier	= ARMOR	10%
	Modifier	= DAMAGE_MULT 110%
	FX		= FX_GenericBuffPersistent20
	Duration	= 20000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes	
End

ModifierList LegendsHowlOfRageAttribute2
	Category	= BUFF
	Modifier	= ARMOR	15%
	Modifier	= DAMAGE_MULT 110%
	FX		= FX_GenericBuffPersistent40
	Duration	= 40000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes	
End

ModifierList LegendsHowlOfRageAttribute3
	Category	= BUFF
	Modifier	= ARMOR	15%
	Modifier	= DAMAGE_MULT 115%
	FX		= FX_GenericBuffPersistent60
	Duration	= 60000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes	
End

CommandButton Command_CreateAHero_HowlOfRage_Level1
	Command					= SPECIAL_POWER
	SpecialPower				= SpecialAbilityCreateAHeroHowlOfRage_Level1
	Options					= NEED_TARGET_POS
	TextLabel				= CONTROLBAR:CAH_HowlOfRage_Level1
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsHowlOfRage
	ButtonImage				= UCCommon_DrummerTrollRoar
	RadiusCursorType			= WarChantRadiusCursor
	InvalidCursorName			= GenericInvalid
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel		= 1
	CreateAHeroUIPrerequisiteButtonName	= None
End

CommandButton Command_CreateAHero_HowlOfRage_Level2
	Command					= SPECIAL_POWER
	SpecialPower				= SpecialAbilityCreateAHeroHowlOfRage_Level2
	Options					= NEED_TARGET_POS
	TextLabel				= CONTROLBAR:CAH_HowlOfRage_Level2
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsHowlOfRage
	ButtonImage				= UCCommon_DrummerTrollRoar
	RadiusCursorType    			= WarChantRadiusCursor
	InvalidCursorName			= GenericInvalid
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel		= 3
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_HowlOfRage_Level1
End

CommandButton Command_CreateAHero_HowlOfRage_Level3
	Command					= SPECIAL_POWER
	SpecialPower				= SpecialAbilityCreateAHeroHowlOfRage_Level3
	Options					= NEED_TARGET_POS
	TextLabel				= CONTROLBAR:CAH_HowlOfRage_Level3
	ButtonBorderType			= ACTION 
	DescriptLabel				= CONTROLBAR:TooltipLegendsHowlOfRage
	ButtonImage				= UCCommon_DrummerTrollRoar
	RadiusCursorType    			= WarChantRadiusCursor
	InvalidCursorName			= GenericInvalid
	InPalantir				= Yes

	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel		= 7
	CreateAHeroUIPrerequisiteButtonName	= Command_CreateAHero_HowlOfRage_Level2
End



;------------------
;LEADERSHIP also affecs heroes now
;------------------

CommandButton Command_CreateAHeroLeadership
	Command					= SPECIAL_POWER
	SpecialPower				= SpecialAbilityFakeLeadership
	Options					= NONPRESSABLE
	TextLabel				= CONTROLBAR:Leadership
	ButtonImage				= HSLurtzLeadership
	RadiusCursorType			= TrainingRadiusCursor
	//Upgrade				= Upgrade_LurtzLeadership
	ButtonBorderType			= ACTION
	DescriptLabel				= CONTROLBAR:ToolTipLegendsCreateAHeroLeadership
	InPalantir				= Yes
	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassHeroOfTheWest Upgrade_CreateAHero_ClassIstariWizard Upgrade_CreateAHero_ClassDwarf Upgrade_CreateAHero_ClassCorruptedMan	Upgrade_CreateAHero_ClassServantsOfSauron Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel		= 1
	CreateAHeroUIPrerequisiteButtonName	= None
End

ModifierList LegendsLeadership
	Category			= LEADERSHIP
	Modifier			= EXPERIENCE 108%
	Modifier			= DAMAGE_MULT 105%
	Duration			= 3000
;	FX				= FX_GenericLeadership
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
End



;---------------------------
;SELF HEAL IS NOW ATHELAS to prevent the Heal Glitch
;-------------------------------

CommandButton Command_CreateAHero_SpecialAbilityHealing_Level1 ;SelfHeal lv1
  Command                 = SPECIAL_POWER 
  SpecialPower	  	  = SpecialAbilityCreateAHeroAthelas ; SpecialAbilityCreateAHeroHealing_Level2
  TextLabel               = CONTROLBAR:LegendsHealing
  ButtonImage             = HPWyrm ; HSAragornAthelas, changing this has no effect in map.ini it seems.
   CursorName		  = Bombard
   RadiusCursorType   	  = AthelasRadiusCursor
   InvalidCursorName  	  = GenericInvalid
  ButtonBorderType        = ACTION 
  DescriptLabel           = CONTROLBAR:LegendsTooltipHealing
  InPalantir		  = Yes
  AutoAbility		  = Yes
  PresetRange		   = 150.0
	CreateAHeroUIAllowableUpgrades			  =	Upgrade_CreateAHero_ClassArcher
	CreateAHeroUIMinimumLevel				  = 1
	CreateAHeroUIPrerequisiteButtonName = None
End

CommandButton Command_CreateAHero_SpecialAbilityHealing_Level2 ;SelfHeal lv2
  Command                 = SPECIAL_POWER 
  SpecialPower	  	  = SpecialAbilityCreateAHeroAthelas ; SpecialAbilityCreateAHeroHealing_Level2
  TextLabel               = CONTROLBAR:LegendsHealing
  ButtonImage             = HSAragornAthelas
   CursorName		  = Bombard
   RadiusCursorType   	  = AthelasRadiusCursor
   InvalidCursorName  	  = GenericInvalid
  ButtonBorderType        = ACTION 
  DescriptLabel           = CONTROLBAR:LegendsTooltipHealing
  InPalantir		  = Yes
  AutoAbility		  = Yes
  PresetRange		   = 150.0
  CreateAHeroUIAllowableUpgrades  	= Upgrade_CreateAHero_ClassArcher
  CreateAHeroUIMinimumLevel	  	= 3
  CreateAHeroUIPrerequisiteButtonName 	= Command_CreateAHero_SpecialAbilityHealing_Level1
  NeedDamagedTarget  = Yes
End


;------------------------------
;COERCE and CONVERT ENEMY are now *temporary* conversions
;------------------------------

SpecialPower SpecialAbilityConvertEnemy_L1
	Enum									  =	SPECIAL_DOMINATE_ENEMY
	ReloadTime								  =	200000
	RadiusCursorRadius						  =	30.0
End	

SpecialPower SpecialAbilityConvertEnemy_L2
	Enum									  =	SPECIAL_DOMINATE_ENEMY
	ReloadTime								  =	160000 
	RadiusCursorRadius						  =	60.0
End

SpecialPower SpecialAbilityCreateAHeroCoerce_Level1
	Enum									  =	SPECIAL_KNIFE_ATTACK
	ReloadTime								  =	120000
	PublicTimer								  = No
	ObjectFilter				= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES NEUTRAL
End

SpecialPower SpecialAbilityCreateAHeroCoerce_Level2
	Enum									  =	SPECIAL_DOMINATE_ENEMY
	ReloadTime								  =	160000
	PublicTimer								  = No
	RadiusCursorRadius						  =	20
End

SpecialPower SpecialAbilityCreateAHeroCoerce_Level3
	Enum									  =	SPECIAL_DOMINATE_ENEMY
	ReloadTime								  =	160000
	PublicTimer								  = No
	RadiusCursorRadius						  =	35
End


CommandButton Command_CreateAHero_SpecialAbilityConvertEnemy_L1
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityConvertEnemy_L1
	Options			= NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:ConvertEnemy_L1
	ButtonImage		= CAHConvert
	RadiusCursorType	= DominateRadiusCursor
	ButtonBorderType	= ACTION
	DescriptLabel		= CONTROLBAR:ToolTipConvertEnemy_L1
	InPalantir		= Yes
	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassIstariWizard
	CreateAHeroUIMinimumLevel		= 7
	CreateAHeroUIPrerequisiteButtonName	= None
End

CommandButton Command_CreateAHero_SpecialAbilityConvertEnemy_L2
	Command				= SPECIAL_POWER
	SpecialPower			= SpecialAbilityConvertEnemy_L2
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel			= CONTROLBAR:ConvertEnemy_L2
	ButtonImage			= CAHConvert
	RadiusCursorType		= DominateRadiusCursor
	ButtonBorderType		= ACTION
	DescriptLabel			= CONTROLBAR:ToolTipConvertEnemy_L2
	InPalantir			= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassIstariWizard
	CreateAHeroUIMinimumLevel	= 10
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_SpecialAbilityConvertEnemy_L1
End

CommandButton Command_CreateAHero_SpecialAbilityCoerce_Level1
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityCreateAHeroCoerce_Level1
	Options			= NEED_TARGET_ENEMY_OBJECT CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:CAH_Coerce_Level1
	ButtonImage		= CAHCoerce
	CursorName		= Bombard
	ButtonBorderType	= ACTION
	InvalidCursorName	= GenericInvalid
	DescriptLabel		= CONTROLBAR:ToolTipLegendsCAH_Coerce_Level1
	InPalantir		= Yes
	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassCorruptedMan
	CreateAHeroUIMinimumLevel		= 1
	CreateAHeroUIPrerequisiteButtonName 	= None
End

CommandButton Command_CreateAHero_SpecialAbilityCoerce_Level2
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityCreateAHeroCoerce_Level2
	Options			= NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:CAH_Coerce_Level2
	ButtonImage		= CAHCoerce
	RadiusCursorType	= DominateRadiusCursor
	ButtonBorderType	= ACTION
	DescriptLabel		= CONTROLBAR:ToolTipLegendsCAH_Coerce_Level2
	InPalantir		= Yes
	CreateAHeroUIAllowableUpgrades			  =	Upgrade_CreateAHero_ClassCorruptedMan
	CreateAHeroUIMinimumLevel				  = 3
	CreateAHeroUIPrerequisiteButtonName = Command_CreateAHero_SpecialAbilityCoerce_Level1
End

CommandButton Command_CreateAHero_SpecialAbilityCoerce_Level3
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityCreateAHeroCoerce_Level3
	Options			= NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:CAH_Coerce_Level3
	ButtonImage		= CAHCoerce
	RadiusCursorType	= DominateRadiusCursor
	ButtonBorderType	= ACTION
	DescriptLabel		= CONTROLBAR:ToolTipLegendsCAH_Coerce_Level3
	InPalantir		= Yes
	CreateAHeroUIAllowableUpgrades		= Upgrade_CreateAHero_ClassCorruptedMan
	CreateAHeroUIMinimumLevel		= 10
	CreateAHeroUIPrerequisiteButtonName 	= Command_CreateAHero_SpecialAbilityCoerce_Level2
End


;-------------------------
;(015b) Legends Summons (Special Power, OCLs, and CommandButtons)
;-------------------------

SpecialPower SpecialAbilityLegendsSummonLv1
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 140000	 ; Spider becomes unsummoned in 60 seconds
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= SpellDragonAllyMS
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End

SpecialPower SpecialAbilityLegendsSummonLv2
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 140000	 ; Barrow Wight becomes unsummoned in 80 seconds
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= CaH_BerserkerRage
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End

SpecialPower SpecialAbilityLegendsSummonLv3
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 140000	 ; Cave Troll becomes unsummoned in 40 seconds
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= SpellDragonStrikeMS
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End

SpecialPower SpecialAbilityLegendsSummonLv4
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 160000	 ; FireDrake becomes unsummoned in 25 seconds
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= SpellDragonAllyMS
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End


ObjectCreationList OCL_LegendsSummonLv1
	CreateObject
		ObjectNames = GiantSpider_Small
		Count = 1
		FadeIn = Yes
		FadeTime = 4000
		Disposition = LIKE_EXISTING
	End
End

ObjectCreationList OCL_LegendsSummonLv2
	CreateObject
		ObjectNames = BarrowWight_Summoned
		Count = 1
		FadeIn = Yes
		FadeTime = 4000
		Disposition = LIKE_EXISTING
	End
End

ObjectCreationList OCL_LegendsSummonLv3			; TODO >> Make barrow wight stronger and lv3, create a Warg for lv2 or switch for spider in lv1
	CreateObject
		ObjectNames = CaveTroll_Slavedx
		Count = 1
		FadeIn = Yes
		FadeTime = 4000
		Disposition = LIKE_EXISTING
	End
End

ObjectCreationList OCL_LegendsSummonLv4
	CreateObject
		ObjectNames = WildFireDrake_Summoned
		Count = 1
		FadeIn = Yes
		FadeTime = 4000
		Disposition = LIKE_EXISTING
	End
End



CommandButton Command_CreateAHero_HotW_SummonAllies_Level1
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv1
	TextLabel		  	= CONTROLBAR:LegendsSummonLv1
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SpiderlingsRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv1
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel	= 1
	CreateAHeroUIPrerequisiteButtonName = None
End

CommandButton Command_CreateAHero_HotW_SummonAllies_Level2
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv2
	TextLabel		  	= CONTROLBAR:LegendsSummonLv2
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonOathBreakersRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv2
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel	= 3
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_HotW_SummonAllies_Level1
End

CommandButton Command_CreateAHero_HotW_SummonAllies_Level3
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv3
	TextLabel		  	= CONTROLBAR:LegendsSummonLv3
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonOathBreakersRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv3
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel	= 7
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_HotW_SummonAllies_Level2
End

CommandButton Command_CreateAHero_HotW_SummonAllies_Level4
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv4
	TextLabel		  	= CONTROLBAR:LegendsSummonLv4
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonDragonRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv4
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassHeroOfTheWest
	CreateAHeroUIMinimumLevel	= 10
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_HotW_SummonAllies_Level3
End


CommandButton Command_CreateAHero_SoS_SummonAllies_Level1
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv1
	TextLabel		  	= CONTROLBAR:LegendsSummonLv1
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SpiderlingsRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv1
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel	= 1
	CreateAHeroUIPrerequisiteButtonName =	None
End

CommandButton Command_CreateAHero_SoS_SummonAllies_Level2
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv2
	TextLabel		  	= CONTROLBAR:LegendsSummonLv2
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonOathBreakersRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv2
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel	= 3
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_SoS_SummonAllies_Level1
End

CommandButton Command_CreateAHero_SoS_SummonAllies_Level3
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv3
	TextLabel		  	= CONTROLBAR:LegendsSummonLv3
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonOathBreakersRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv3
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel	= 7
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_SoS_SummonAllies_Level2
End

CommandButton Command_CreateAHero_SoS_SummonAllies_Level4
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSummonLv4
	TextLabel		  	= CONTROLBAR:LegendsSummonLv4
	ButtonImage			= CAHSummonAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND
	RadiusCursorType  		= SummonDragonRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSummonLv4
	InPalantir		 	= Yes
	CreateAHeroUIAllowableUpgrades	= Upgrade_CreateAHero_ClassServantsOfSauron
	CreateAHeroUIMinimumLevel	= 10
	CreateAHeroUIPrerequisiteButtonName =	Command_CreateAHero_SoS_SummonAllies_Level3
End


;Summoned Objects
;----------------

;LegendsSummon Lv1 (Feral Spider)
;-----------------

Weapon LegendsSummonedSpiderlingMandibles
  LeechRangeWeapon      = Yes
  AttackRange           = 25.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = 1666				; time between shots, msec
  PreAttackDelay        = 900				; 300 is mace swing delay time before contact with target.
  PreAttackType         = PER_SHOT 			; Do the delay each time we attack
  FireFX                = FX_SpiderStabHit
  FiringDuration        = 766				; Duration of the mace swing 
  RequireFollowThru	= Yes
  
  DamageNugget						; A basic Nugget that just does damage
    Damage        = 1400
    DamageScalar  = 50% ANY +HERO +STRUCTURE ; ;
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = CAVALRY
    DeathType     = NORMAL
    FlankingBonus = 50%
  End
End

Object GiantSpider_Small ;ChildObject GiantSpider_Small GiantSpider
	CommandPoints = 0
	SelectPortrait = UPWild_Spiderlings
	ButtonImage	= WOR_Spiderling
	KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT MONSTER HERO PRELOAD SUMMONED SCORE PASS_EXPERIENCE_TO_PRODUCER
	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY LegendsSummonedSpiderlingMandibles
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

;This makes it fade after it's timer is over
AddModule
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= 50000
		MaxLifetime		= 50000
		DeathType		= FADED
	End
END

    Scale				= 0.5

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyStronger
		MaxHealth = 1200               ;BALANCE Summoned Spider Health
	End
END

	GeometryMajorRadius = 25.0
	GeometryMinorRadius = 25.0
	GeometryHeight		= 15.0

End

;LegendsSummon Lv2 (Barrow Wight)
;-----------------

Weapon LegendsBarrowWightTouch
	RadiusDamageAffects	= ENEMIES NEUTRALS
	ClearNuggets ;;.;;
	LeechRangeWeapon      = Yes
	AttackRange           = 20.0
	MeleeWeapon           = Yes
	DelayBetweenShots     = BARROWWIGHT_SWORD_DELAYBETWEENSHOTS   ; Bad Things happen if delay between shots is less than Preattack+Firing times.  You are ready to fire before you are done firing.
	PreAttackDelay        = BARROWWIGHT_SWORD_PREATTACKDELAY              ; 400 is sword swing delay time before contact with target.
	PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
	FireFX                = FX_BarrowWightHit	;FX_GondorSwordHit
	FiringDuration        = BARROWWIGHT_SWORD_FIRINGDURATION     ; Duration of the sword swing

	DamageNugget                        ; A basic Nugget that just does damage
		Damage        		= 150; 200
		Radius        		= 10.0
		DelayTime     		= 0
		DamageType    		= MAGIC
		DamageFXType  		= SWORD_SLASH
		DeathType     		= NORMAL
		DrainLife     		= Yes
		DrainLifeMultiplier	= 0.5
	End
	AttributeModifierNugget
		AttributeModifier	= BarrowWightTouchDebuff
		AntiCategories		= LEADERSHIP BUFF
		SpecialObjectFilter = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
End



ChildObject BarrowWight_Summoned BarrowWight
	KindOf			= PRELOAD MONSTER SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT ENVIRONMENT SELECTABLE SCARY SUMMONED HERO PASS_EXPERIENCE_TO_PRODUCER
	CommandPoints 		= 0
	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY LegendsBarrowWightTouch
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

AddModule
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdateNew
		MinLifetime		= 35000
		MaxLifetime		= 35000
		DeathType		= FADED
	End
END

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyStronger
		MaxHealth = 800               ;BALANCE Summoned Barrow Wight
	End
END
End


;LegendsSummon Lv3 (Cave Troll)
;-----------------

Weapon SummonedCaveTrollPunch
  LeechRangeWeapon		= Yes
  RadiusDamageAffects = ENEMIES 
	ClearNuggets ;;.;;
  AttackRange           = STANDARD_MELEE_ATTACK_RANGE
  MeleeWeapon           = Yes
  DelayBetweenShots     = MORDOR_TROLL_PUNCH_DELAYBETWEENSHOTS
  FiringDuration        = MORDOR_TROLL_PUNCH_FIRINGDURATION
  PreAttackDelay        = MORDOR_TROLL_PUNCH_PREATTACKDELAY
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  PreAttackFX          	= FX_TrollTreeSwing
  FireFX               	= FX_TrollPunchGeneric
  DamageDealtAtSelfPosition = Yes ; A melee based AoE.  Arc radiates from me, not them
  AcceptableAimDelta	= 15.0 

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 800
    Radius        = 70.0
    DamageArc      = 45
    DamageType    = SIEGE
    DamageFXType  = CLUBBING
    DeathType     = NORMAL
  End
  MetaImpactNugget                    ; A Nugget that throws things back with force
    ShockWaveAmount   = 20.0
    ShockWaveRadius   = 70.0
    ShockWaveTaperOff = 1.0
    ShockWaveArc      = 45
    ShockWaveZMult    = 1.20
 ;   HeroResist		= 0.90		; 90% chance heroes will resist this attack
  End
End


ChildObject CaveTroll_Slavedx CaveTroll_Slaved

RemoveModule ModuleTag_Slave

;RemoveModule LifetimeTag

	KindOf			= PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS HEAVY_MELEE_HITTER TROLL_BUFF_NUGGET MONSTER SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT SUMMONED NO_FREEWILL_ENTER PATH_THROUGH_INFANTRY SCARY CAN_ATTACK_WALLS ARMY_SUMMARY PASS_EXPERIENCE_TO_PRODUCER
	CommandPoints		= 0
	DisplayName		= OBJECT:GenericCaveTroll

	WeaponSet
		Conditions      =  None
		Weapon          =  PRIMARY	SummonedCaveTrollPunch
		Weapon          =  SECONDARY	MordorCaveTrollBash
		OnlyAgainst     =  SECONDARY	STRUCTURE BLOCKING_GATE
		Weapon		=  TERTIARY	SummonedCaveTrollPunch
		OnlyInCondition	=  TERTIARY	MOVING
	End

RemoveModule ModuleTag_02

AddModule
	Body = ActiveBody ModuleTag_02New	; DelayedDeathBody
		MaxHealth			= 4500
		MaxHealthDamaged		= 250
		MaxHealthReallyDamaged		= 100
;		DoHealthCheck			= No			;// Don't want to get the delayed death behaviour when we die normally.
;		DelayedDeathTime		= 5000
;		CanRespawn			= No			;// Unit can't get revived.
	End
END

AddModule
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= 40000
		MaxLifetime		= 40000
		DeathType		= FADED
	End
END



End





;LegendsSummon Lv4 (Firedrake)
;-----------------
ChildObject WildFireDrake_Summoned WildFireDrake
	IsTrainable	= No
	CommandPoints	= 0	
	KindOf 		= PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS MONSTER CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT SCORE
	Scale		= 0.8

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 2000 ; From 4000
		RecoveryTime      = FIREDRAKE_HEALTH_RECOVERY_TIME
	End
END

AddModule
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdateNew
		MinLifetime		= 25000
		MaxLifetime		= 25000
		DeathType		= FADED
	End
END

End





;------------------------------------
;(006) SPELLBOOK AND SHOPKEEPER COMMANDSETS (Spellbook commandsets are there so these "spells" show up on the powers bar when they are given to the player)
;------------------------------------

CommandSet LegendsSpellbookCommandSet
	1 = Command_SpellBookHeal
	2 = Command_SpellBookFreezingRain

	3 = Command_FireWeaponMordorFortressMagmaCauldrons	; Potion of Healing
	4 = Command_SpecialAbilityMoveUnseen	;Command_ConstructElvenMirrorOfGaladriel		; Potion of Invulnerability

	5 = Command_PoisonedBlades				; Poison Reagent
	6 = Command_SpecialAbilityGlorfindelBladeOfPurity	; Bladerune
	7 = Command_SpellBookRainOfFire				; Talisman Of Deadly Rage

	8 = Command_SpecialAbilityPhialOfGaladrielSam		; Bluemoon Heartstone
	9 = Command_ToggleHobbitRockThrow			; Stone of the Hermit
	10 = Command_SpellBookEnshroudingMist			; Boots Of Speed

	11 = Command_PurchaseTechnologyDwarvenMithrilMail	; Improved Armor L1
	12 = Command_PurchaseTechnologyElvenHeavyArmor		; Improved Armor L2
End

CommandSet LegendsSpellStoreCommandSet
	1 = Command_PurchaseSpellEnshroudingMistSP
	3 = Command_PurchaseSpellHeal
	11 = Command_PurchaseSpellFreezingRain
End

CommandSet LegendsShopKeeper1CommandSet
	1 = Command_PurchaseUpgradeDwarvenMithrilMail 		; Improved Armor L1
	2 = Command_PurchaseUpgradeMordorFortressMagmaCauldrons	; Potion of Healing
;	3 = Command_PurchaseUpgradeElvenFortressMysticFountains ; Potion of Invulnerability
;	4 = Command_PurchaseUpgradeElvenFortressBlessedMist	; Boots Of Speed
;	5 = Command_FiresOfDoom					; Talisman Of Deadly Rage
;	6 = Command_SpecialAbilityPhialOfGaladriel		; Bluemoon Heartstone
END

CommandSet LegendsShopKeeper2CommandSet
	1 = Command_PurchaseUpgradeElvenHeavyArmor		; Improved Armor L2
	2 = Command_PurchaseUpgradeElvenFortressBlessedMist	; Boots Of Speed
	3 = Command_FiresOfDoom					; Talisman Of Deadly Rage
	4 = Command_SpecialAbilityPhialOfGaladriel		; Bluemoon Heartstone
	5 = Command_ConstructMordorGateWatchersExpansion	; Poison Reagent
	6 = Command_ToggleFrodoWeapon				; Stone of the Hermit

;	7 = Command_PurchaseUpgradeElvenFortressMysticFountains ; Potion of Invulnerability
END

CommandSet GondorBarracksNoCommands
	1 = Command_Sell
END

Object GondorBarracks
	KindOf = IMMOBILE BASE_FOUNDATION CASTLE_CENTER CAN_CAST_REFLECTIONS CASTLE_KEEP COMMANDCENTER PRELOAD STRUCTURE SELECTABLE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR
  	CommandSet          = GondorBarracksNoCommands
END

Object DwarvenSiegeWorks
	CommandSet = LegendsShopKeeper2CommandSet
END

Object GondorWorker
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY LIVING_WORLD_BUILDING_MIRROR
	CommandSet = LegendsShopKeeper1CommandSet
	LocomotorSet
		Locomotor = WebbedLocomotor
		Condition = SET_NORMAL 
		Speed     = 0	
	End
AddModule
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		;;;UnitPreparationTime =8000;;;;;;;;;; 8.0 second prep needs to be set in THingTemplate, for Trebuchet, now
		GiveNoXP								= Yes
		NumDoorAnimations            =	1
		DoorOpeningTime              =	7000  ;in mSeconds how long you want doors to be in open state
		DoorWaitOpenTime             =	6000  ;in mSeconds time the door stays open, so units can exit
		DoorCloseTime                =	7000  ;in mSeconds how long you want doors to be in open state
		ConstructionCompleteDuration = 0  ;in mSeconds   wait time so if you have multiple units they don't run over each other
	End
END
AddModule
	Behavior = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint		= X:0.0 Y:-80.0	Z:0.0
		NaturalRallyPoint	= X:0.0 Y:-80.0	Z:0.0
		PlacementViewAngle	= 270
		ExitDelay			= 50
END
END
END

Object ElvenWorker
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY LIVING_WORLD_BUILDING_MIRROR
	CommandSet = LegendsShopKeeper2CommandSet
	LocomotorSet
		Locomotor = WebbedLocomotor
		Condition = SET_NORMAL 
		Speed     = 0	
	End
AddModule
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		;;;UnitPreparationTime =8000;;;;;;;;;; 8.0 second prep needs to be set in THingTemplate, for Trebuchet, now
		GiveNoXP								= Yes
		NumDoorAnimations            =	1
		DoorOpeningTime              =	7000  ;in mSeconds how long you want doors to be in open state
		DoorWaitOpenTime             =	6000  ;in mSeconds time the door stays open, so units can exit
		DoorCloseTime                =	7000  ;in mSeconds how long you want doors to be in open state
		ConstructionCompleteDuration = 0  ;in mSeconds   wait time so if you have multiple units they don't run over each other
	End
END
AddModule
	Behavior = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint		= X:0.0 Y:-80.0	Z:0.0
		NaturalRallyPoint	= X:0.0 Y:-80.0	Z:0.0
		PlacementViewAngle	= 270
		ExitDelay			= 50
END
END
END

;-------------------------------------------------------------
;(007) SPELLBOOK CONFIG
;-------------------------------------------------------------

Object LegendsSpellBook
AddModule ModuleTag_LegendsHeal
  	Behavior = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate  = SpellBookHeal
		HealAffects			  = INFANTRY CAVALRY SHIP DOZER ; ; MONSTER MACHINE 
		HealAmount			  = 0.5 ; ;1.0	; 0.5 = 50% of maximum health
		HealRadius			  = SPELL_HEAL_RADIUS_UNIT_SCAN
;		HealFX				  = FX_SpellHealUnitHealBuff		;FX_DefaultUnitHealBuff
		; To replenish hordes a bit
		HealOCL               = OCL_HealSpellHordeReplenishPing
		AvailableAtStart	  = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
END
AddModule ModuleTag_LegendsElvenGifts
	Behavior = PlayerUpgradeSpecialPower	SpellBookElvenGifts_ModuleTag
		SpecialPowerTemplate		= SpellBookElvenGifts
		UpgradeName 			= Upgrade_ElvenGift
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
END
AddModule ModuleTag_LegendsFreezingRain
	Behavior = FreezingRainSpecialPower ModuleTag_FreezingRain
		SpecialPowerTemplate			= SpellBookFreezingRain
;		AttributeModifier				= RainDebuff ; ;
;		AttributeModifierAffects		= ALL ENEMIES
		AntiCategory					= LEADERSHIP BUFF ; ;
;		AntiFX							= FX_AntiLeadership ; FX for anti category
		AttributeModifierWeatherBased	= Yes
		WeatherDuration					= SPELL_FREEZINGRAIN_DURATION
		ChangeWeather					= RAINY
		AvailableAtStart				= No
		BurnRateModifier				= -100
		BurnDecayModifier				= 20
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
END

;----------------------------------
;NOW LEGENDS BUYABLE UPGRADE SPELLS

   AddModule ModuleTag_LegendsPotionOfHealing
	Behavior = SpecialPowerModule		SpellBookPotionOfHealing_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsPotionOfHealing
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

   AddModule ModuleTag_LegendsPoisonReagent
	Behavior = SpecialPowerModule		SpellBookPoisonReagent_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsPoisonReagent
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

   AddModule ModuleTag_LegendsImprovedArmorL1
;	Behavior = PlayerUpgradeSpecialPower	SpellBookImprovedArmorL1_ModuleTag
	Behavior = SpecialPowerModule		SpellBookImprovedArmorL1_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsImprovedArmorL1
;		UpgradeName 			= Upgrade_ImprovedArmorL1Upgrade
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END


   AddModule ModuleTag_LegendsImprovedArmorL2
	Behavior = SpecialPowerModule		SpellBookImprovedArmorL2_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsImprovedArmorL2
;		UpgradeName 			= Upgrade_ImprovedArmorL2Upgrade
		AntiCategory			= BUFF ; This is so it doesn't stack with Improved Armor L1
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

   AddModule ModuleTag_LegendsBootsOfSpeed
	Behavior = SpecialPowerModule		SpellBookBootsOfSpeed_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsBootsOfSpeed
;		UpgradeName 			= Upgrade_BootsOfSpeedUpgrade
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

   AddModule ModuleTag_LegendsTalismanOfDeadlyRage
	Behavior = SpecialPowerModule		SpellBookTalismanOfDeadlyRage_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsTalismanOfDeadlyRage
;		UpgradeName 			= Upgrade_TalismanOfDeadlyRageUpgrade
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

   AddModule ModuleTag_LegendsBluemoonHeartstone
	Behavior = SpecialPowerModule		SpellBookBluemoonHeartstone_ModuleTag
		SpecialPowerTemplate		= SpellBookLegendsBluemoonHeartstone
;		UpgradeName 			= Upgrade_BluemoonHeartstoneUpgrade
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

	CommandSet          = LegendsSpellbookCommandSet
	RadarPriority       = NOT_ON_RADAR
	KindOf              = SPELL_BOOK IMMOBILE IGNORES_SELECT_ALL INERT
End


;-----------------------------------------------
; Create-A-Hero WEAPON IMPROVEMENTS
;-----------------------------------------------


CommandButton Command_CreateAHero_SpecialAbilityTeleportLevel2
	Command			   = SPECIAL_POWER
	SpecialPower	   = SpecialAbilityATeleportToCaster//SpecialAbilityTeleportToCaster		//	Name HACK - see special power
	Options			   = NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		   = CONTROLBAR:TeleportLevel1
	ButtonImage		   = HSKingDainSummonRoyalGuard
	RadiusCursorType   = DominateRadiusCursor
	ButtonBorderType   = ACTION
	DescriptLabel	   = CONTROLBAR:ToolTipTeleportLevel1
	InPalantir		   = Yes
	
	CreateAHeroUIAllowableUpgrades			  =	Upgrade_CreateAHero_ClassIstariWizard
	CreateAHeroUIMinimumLevel				  = 3
	CreateAHeroUIPrerequisiteButtonName = None
End

CommandButton Command_CreateAHero_SpecialAbilityTeleportLevel3
	Command			   = SPECIAL_POWER
	SpecialPower	   = SpecialAbilityATeleportToCaster//SpecialAbilityTeleportToCaster		//	Name HACK - see special power
	Options			   = NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		   = CONTROLBAR:TeleportLevel1
	ButtonImage		   = HSKingDainSummonRoyalGuard
	RadiusCursorType   = DominateRadiusCursor
	ButtonBorderType   = ACTION
	DescriptLabel	   = CONTROLBAR:ToolTipTeleportLevel1
	InPalantir		   = Yes
	
	CreateAHeroUIAllowableUpgrades			  =	Upgrade_CreateAHero_ClassIstariWizard
	CreateAHeroUIMinimumLevel				  = 3
	CreateAHeroUIPrerequisiteButtonName = None
End


;----------------- SHIELD BASH AND CHARGE -------------

ModifierList CreateAHeroShieldCrush_Level1New
	Category	 = FORMATION

	Modifier	 = ARMOR 0% PIERCE HERO_RANGED CAVALRY_RANGED STRUCTURAL
	Modifier	 = INVULNERABLE 0% PIERCE HERO_RANGED CAVALRY_RANGED STRUCTURAL

	Modifier	= SPEED 115%
	Modifier	 = DAMAGE_MULT 150%	

	Modifier	 = CRUSHER_LEVEL 3
	Modifier	 = CRUSH_DECELERATE 5%
	Duration	 = 14000					// Matches RefreshRate of giving	module
	FX		 = FX_CAHShieldCrush	 
End


ModifierList CreateAHeroShieldCrush_Level3New
	Category	 = FORMATION
	
	Modifier	 = ARMOR 0% PIERCE HERO_RANGED CAVALRY_RANGED STRUCTURAL
	Modifier	 = INVULNERABLE 0% PIERCE HERO_RANGED CAVALRY_RANGED STRUCTURAL

	Modifier	 = DAMAGE_MULT 150%	
	Modifier	= SPEED 115%	
	
	Modifier	 = CRUSHER_LEVEL 3
	Modifier	 = CRUSH_DECELERATE 0%
	Duration	 = 20000					// Matches RefreshRate of giving	module
	FX		 = FX_CAHShieldCrush02	 
End


ModifierList CreateAHeroChargeBonus_Level1New
	Category			= FORMATION
	Modifier			= DAMAGE_MULT 150%		// Multiplicitive.  Damage multiplied by this, will compound in multiple bonuses
	Modifier			= ARMOR	50%
	Modifier			= SPEED 125%
	Modifier			= CRUSHER_LEVEL 2
	Modifier			= CRUSH_DECELERATE 5%
	Duration			= 20000				// lasts for xx miliseconds
	FX				= FX_CAHBerserkerRage20
;	ReplaceInCategoryIfLongest	= Yes
End

ModifierList CreateAHeroChargeBonus_Level2New
	Category			= FORMATION
	Modifier			= DAMAGE_MULT 200%		// Multiplicitive.  Damage multiplied by this, will compound in multiple bonuses
	Modifier			= ARMOR	50%
	Modifier			= SPEED 125%
	Modifier			= CRUSHER_LEVEL 2
	Modifier			= CRUSH_DECELERATE 5%
	Duration			= 20000				// lasts for xx miliseconds
	FX				= FX_CAHBerserkerRage20
;	ReplaceInCategoryIfLongest	= Yes
End

ModifierList CreateAHeroChargeBonus_Level3New
	Category			= FORMATION
	Modifier			= DAMAGE_MULT 200%		// Multiplicitive.  Damage multiplied by this, will compound in multiple bonuses
	Modifier			= ARMOR	50%
	Modifier			= SPEED 125%
	Modifier			= CRUSHER_LEVEL 3
	Modifier			= CRUSH_DECELERATE 0%
	Modifier			= INVULNERABLE 0% PIERCE HERO_RANGED CAVALRY_RANGED
	Duration			= 20000				// lasts for xx miliseconds
	FX				= FX_CAHBerserkerRage20
;	ReplaceInCategoryIfLongest	= Yes
End



;-----------------------------------------------
;IMPROVED FIRERATE OF BOW
;-----------------------------------------------

Weapon CreateAHeroBasicRangedWeapon
    AttackRange			= 350				
    LeechRangeWeapon		= Yes
    WeaponSpeed			= 321         // dist/sec 
    MinWeaponSpeed		= 241
    MaxWeaponSpeed		= 481      // dist/sec Upper limit on scaling, when attacking past nominal "max" range
    FireFX			= FX_RohanArcherBowWeapon
    ScaleWeaponSpeed		= Yes // Used for lob weapons, scales speed proportional to range
    HitPercentage		= 100     //When this weapon is used it will hit exactly 75% of the time.
    ScatterRadius		= 0.0     //When this weapon misses it can randomly miss by as much as this distance.
    UseInnateAttributes		= Yes
   
    DelayBetweenShots		= 1000 ;1400 msec
    PreAttackDelay		= 800    ;1200 msec
    PreAttackType		= PER_POSITION
    FiringDuration		= 0
 
    ClipSize			= 1
    AutoReloadsClip		= Yes
    AutoReloadWhenIdle		= 1	
    ClipReloadTime		= Min:800 Max:1200 ;1000 and 1500
    ContinuousFireOne		= 0
    ContinuousFireCoast		= 1600
   	
    AntiAirborneVehicle	= Yes
    AntiAirborneMonster	= Yes  
    
    CanFireWhileMoving		= Yes
   
    ProjectileNugget                    // Default arrow
       ProjectileTemplateName	= GoodFactionArrow
       WarheadTemplateName		= CreateAHeroBasicRangedWarhead
	   ForbiddenUpgradeNames	= Upgrade_CreateAHeroArrowBonus_Level4
    End
   
    ProjectileNugget                    // Default arrow
       ProjectileTemplateName	= MirkwoodArcherSilverthornProjectile
       WarheadTemplateName		= CreateAHeroBasicRangedWarhead
	   RequiredUpgradeNames		= Upgrade_CreateAHeroArrowBonus_Level4
    End
End


;-------------------------------------------------------------------------------
;HERO MELEE ARC DAMAGE POWAA
;-------------------------------------------------------------------------------


Weapon CreateAHeroBasicMeleeWeapon
	LeechRangeWeapon      = Yes
	AttackRange           = STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon           = Yes
	FireFX                = FX_GondorSwordHit
	DelayBetweenShots     = FARAMIR_DELAYBETWEENSHOTS ; 1400 miliseconds
	PreAttackDelay        = FARAMIR_PREATTACKDELAY
	PreAttackType         = PER_SHOT
	FiringDuration        = FARAMIR_FIRINGDURATION
	UseInnateAttributes	  = Yes

	DamageNugget
		Damage        = CREATE_A_HERO_DAMAGE
		Radius        = 18.0 ;How far the damage reaches
		DelayTime     = 0
		DamageType    = HERO
		DamageArc     = 90 ;Angle of damage
		DamageFXType  = CLUBBING
		DeathType     = NORMAL
	End

	MetaImpactNugget ; This is where it gets epic... only used when enemy dies (Goblins rain apart! :P)
       		HeroResist      = .75
      		ShockWaveAmount = 40.0
        	ShockWaveArc    = 90 ;Angle of metaimpact
        	ShockWaveRadius = 18.0 ;How far the metaimpact reaches
        	ShockWaveTaperOff = 0.8 ; Lenght thrown forward (Approx x2 metres)
        	ShockWaveZMult = 1.4  ; Height thrown upwards (approx x metres)
		OnlyWhenJustDied = Yes
	End
End




;-----------------------------------------------
;(008b) CREATE A HERO NEW EXPERIENCE SYSTEM
;-----------------------------------------------
ExperienceLevel	CreateAHeroLevel1
	TargetNames		 = CreateAHero
	RequiredExperience	 = 1   
	ExperienceAward		 = CREATE_A_HERO_LVL1_EXP_AWARD 
	Rank			 = 1
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End	
End	

ExperienceLevel	CreateAHeroLevel2
	TargetNames		 = CreateAHero
	RequiredExperience	 = 100 ;100
	ExperienceAward		 = CREATE_A_HERO_LVL2_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 2
	AttributeModifiers	 = HeroLevelUpDamage1
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End	
End	

ExperienceLevel	CreateAHeroLevel3
	TargetNames		 = CreateAHero
	RequiredExperience	 = 500 ;200
	ExperienceAward		 = CREATE_A_HERO_LVL3_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 3
	AttributeModifiers	 = HeroLevelUpDamage2
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End	
End	

ExperienceLevel	CreateAHeroLevel4
	TargetNames		 = CreateAHero
	RequiredExperience	 = 1150 ;300
	ExperienceAward		 = CREATE_A_HERO_LVL4_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 4
	Upgrades		 = Upgrade_CreateAHeroGloriousCharge
	AttributeModifiers	 = HeroLevelUpDamage3
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End	

ExperienceLevel	CreateAHeroLevel5
	TargetNames		 = CreateAHero
	RequiredExperience	 = 2000 ;400
	ExperienceAward		 = CREATE_A_HERO_LVL5_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL

	Rank			 = 5
	AttributeModifiers	 = HeroLevelUpDamage4
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End	
End	

ExperienceLevel	CreateAHeroLevel6
	TargetNames		 = CreateAHero
	RequiredExperience	 = 2600 ;500
	ExperienceAward		 = CREATE_A_HERO_LVL6_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 6
	Upgrades		 = Upgrade_CreateAHeroKingsFavor
	AttributeModifiers	 = HeroLevelUpDamage5
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End	

ExperienceLevel	CreateAHeroLevel7
	TargetNames		 = CreateAHero
	RequiredExperience	 = 3800 ;700
	ExperienceAward		 = CREATE_A_HERO_LVL7_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 7
	AttributeModifiers	 = HeroLevelUpDamage6
;	Upgrades		 = CreateAHero_Dummy_not_used_reset_in_code_at_runtime
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End	

ExperienceLevel	CreateAHeroLevel8
	TargetNames		 = CreateAHero
	RequiredExperience	 = 5300 ;900
	ExperienceAward		 = CREATE_A_HERO_LVL8_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 8
	AttributeModifiers	 = HeroLevelUpDamage7
;	Upgrades		 = CreateAHero
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End	

ExperienceLevel	CreateAHeroLevel9
	TargetNames		 = CreateAHero
	RequiredExperience	 = 6900 ;1100
	ExperienceAward		 = CREATE_A_HERO_LVL9_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 9
	AttributeModifiers	 = HeroLevelUpDamage8
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End	

ExperienceLevel	CreateAHeroLevel10
	TargetNames		 = CreateAHero
	RequiredExperience	 = 8800 ;1400
	ExperienceAward		 = CREATE_A_HERO_LVL10_EXP_AWARD
	LevelUpFx		 = FX:GandalfLevelUp1FX
	;LevelUpOCL		 = OCL_GandalfLevelUp1OCL
	Rank			 = 10
	AttributeModifiers	 = HeroLevelUpDamage9
	SelectionDecal
		Texture		 = decal_hero_good
		Style		 = SHADOW_ALPHA_DECAL
		OpacityMin	 = 50% 
		OpacityMax	 = 100%
		MinRadius	 = 40 ;16
		MaxRadius	 = 200 ;16
		MaxSelectedUnits = 40 ;1
	End
End



;---------------------------------------------
;(008) CREATE A HERO OBJECT
	;;.;; CreateAHero.ini
;---------------------------------------------

Object CreateAHero

	DisplayMeleeDamage = #MULTIPLY( CREATE_A_HERO_DAMAGE 2 );;-;; Bbecause he added another nugget.
	CommandPoints = 0
	PathfindDiameter = 20.0
	ShockwaveResistance = 65 ; weak=20, Strong=74, Inmune=99, NeverMeta=9999 (Golem Guardians have Shockwave 60, Raselas blastwave has 90)

;Remove the star icon for collector's edition
;RemoveModule ModuleTag_IconDraw

;IMPROVED REGENERATION

;;-------------------------Ecthelion's 1.09 balance compatibility-------------------------------------------;;













;;-------------------------Ecthelion's animations bugfix-------------------------------------------;;

  ReplaceModule ModuleTag_DRAW
		Draw	   = W3DScriptedModelDraw ModuleTag_DRAW_FIX
	OkToChangeModelColor	   = Yes
	StaticModelLODMode		   = yes //Will	append M or	L to the skin name depending on	GameLOD
	ExtraPublicBone			   = arrow
	ExtraPublicBone			   = PASSENGERBONE
		
	DependencySharedModelFlags = TURN_LEFT_HIGH_SPEED TURN_RIGHT_HIGH_SPEED	MOVING ACCELERATE DECELERATE TURN_LEFT TURN_RIGHT ATTACKING	BACKING_UP

	//-----------------------------MODEL CONDITIONS----------------------//
	DefaultModelConditionState
	Model				 = CHHW_CG_U_SKN
	Skeleton			 = CHHW_CG_U_SKL
	ModelAnimationPrefix = CHHW_CG
	PortraitImageName	 = CPGamling
	ButtonImageName		 = CPGamlingAlpha
End


//--------------------------------------------------------------------------------------------------------------------------------------
// CAPTAIN OF GONDOR -	Upgrade_CreateAHero_ClassHeroOfTheWest/Upgrade_CreateAHero_SubClass_2
ModelConditionState	= MOUNTED CREATE_A_HERO_00
	Model				 = CHHW_MW_M_SKN
	Skeleton			 = CHHW_MW_M_SKL
	ModelAnimationPrefix = CHHW_MW
	PortraitImageName	 = CPCaptainofGondor
	ButtonImageName		 = HICAHCaptainGondor
	WeaponLaunchBone	 = PRIMARY ARROW
End
// CAPTAIN OF GONDOR -	Upgrade_CreateAHero_ClassHeroOfTheWest/Upgrade_CreateAHero_SubClass_2 (MOUNTED)
ModelConditionState	= CREATE_A_HERO_00
	Model				 = CHHW_CG_U_SKN
	Skeleton			 = CHHW_CG_U_SKL
	ModelAnimationPrefix = CHHW_CG
	PortraitImageName	 = CPCaptainofGondor
	ButtonImageName		 = HICAHCaptainGondor
	WeaponLaunchBone	 = PRIMARY SPEAR
End
// CAPTAIN OF GONDOR -	Upgrade_CreateAHero_ClassHeroOfTheWest/Upgrade_CreateAHero_SubClass_2 (Hero Creation Screen)
ModelConditionState	= CREATE_A_HERO_01
	Model				 = CHHW_CG_C_SKN
	Skeleton			 = CHHW_CG_C_SKL
	ModelAnimationPrefix = CHHW_CG
	PortraitImageName	 = CPCaptainofGondor
	ButtonImageName		 = HICAHCaptainGondor
End

//--------------------------------------------------------------------------------------------------------------------------------------
// Shield Maiden Upgrade_CreateAHero_ClassHeroOfTheWest_SubClass_1 MOUNTED
ModelConditionState	= MOUNTED CREATE_A_HERO_02
	Model				 = CHHW_SM_M_SKN
	Skeleton			 = CHHW_SM_M_SKL
	ModelAnimationPrefix = CHHW_SM
	PortraitImageName	 = CPShieldMaiden
	ButtonImageName		 = HICAHShieldMaiden
	WeaponLaunchBone	 = PRIMARY SPEAR
End
// Shield Maiden Upgrade_CreateAHero_ClassHeroOfTheWest_SubClass_1
ModelConditionState	= CREATE_A_HERO_02
	Model				 = CHHW_SM_U_SKN
	Skeleton			 = CHHW_SM_U_SKL
	ModelAnimationPrefix = CHHW_SM
	PortraitImageName	 = CPShieldMaiden
	ButtonImageName		 = HICAHShieldMaiden
	WeaponLaunchBone	 = PRIMARY SPEAR
End
// Shield Maiden Upgrade_CreateAHero_ClassHeroOfTheWest_SubClass_1 + Upgrade_CreateAHeroMapMode
ModelConditionState	= CREATE_A_HERO_03
	Model				 = CHHW_SM_C_SKN
	Skeleton			 = CHHW_SM_C_SKL
	ModelAnimationPrefix = CHHW_SM
	PortraitImageName	 = CPShieldMaiden
	ButtonImageName		 = HICAHShieldMaiden
End

//--------------------------------------------------------------------------------------------------------------------------------------
// WIZARD WANDERER Upgrade_CreateAHero_ClassIstariWizard/Upgrade_CreateAHero_SubClass_0
ModelConditionState	= CREATE_A_HERO_04
	Model				 = CHWZ_YW_U_SKN
	Skeleton			 = CHWZ_YW_U_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPWanderer
	ButtonImageName		 = HICAHWanderer
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End
// WIZARD WANDERER Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassIstariWizard/Upgrade_CreateAHero_SubClass_0
ModelConditionState	= CREATE_A_HERO_05
	Model				 = CHWZ_YW_C_SKN
	Skeleton			 = CHWZ_YW_C_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPWanderer
	ButtonImageName		 = HICAHWanderer
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End

//--------------------------------------------------------------------------------------------------------------------------------------
// WIZARD AVATAR Upgrade_CreateAHero_ClassIstariWizard Upgrade_CreateAHero_SubClass_2
ModelConditionState	= CREATE_A_HERO_06
	Model				 = CHWZ_AV_U_SKN
	Skeleton			 = CHWZ_YW_U_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPAvatar
	ButtonImageName		 = HICAHAvatar
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End
// WIZARD AVATAR Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassIstariWizard Upgrade_CreateAHero_SubClass_2 (Creation Screen)
ModelConditionState	= CREATE_A_HERO_07
	Model				 = CHWZ_AV_C_SKN
	Skeleton			 = CHWZ_YW_C_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPAvatar
	ButtonImageName		 = HICAHAvatar
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End

//--------------------------------------------------------------------------------------------------------------------------------------
// WIZARD HERMIT Upgrade_CreateAHero_ClassIstariWizard Upgrade_CreateAHero_SubClass_3
ModelConditionState	= CREATE_A_HERO_08
	Model				 = CHWZ_HR_U_SKN
	Skeleton			 = CHWZ_YW_U_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPHermit
	ButtonImageName		 = HICAHHermit
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End
// WIZARD HERMIT Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassIstariWizard Upgrade_CreateAHero_SubClass_3
ModelConditionState	= CREATE_A_HERO_09
	Model				 = CHWZ_HR_C_SKN
	Skeleton			 = CHWZ_YW_C_SKL
	ModelAnimationPrefix = CHWZ_YW
	PortraitImageName	 = CPHermit
	ButtonImageName		 = HICAHHermit
	WeaponLaunchBone	 = PRIMARY WizStaff02_FXBO
End

//--------------------------------------------------------------------------------------------------------------------------------------
// TROLL Upgrade_CreateAHero_ClassServantsOfSauron/Upgrade_CreateAHero_SubClass_0	
ModelConditionState	= CREATE_A_HERO_10
	Model				 = CHSS_TL_U_SKN
	Skeleton			 = CHSS_TL_U_SKL
	ModelAnimationPrefix = CHSS_TL
	PortraitImageName	 = CPTroll
	ButtonImageName		 = HICAHTroll
	WeaponLaunchBone	= PRIMARY Bat_HandL
End
// TROLL Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassServantsOfSauron/Upgrade_CreateAHero_SubClass_0	
ModelConditionState	= CREATE_A_HERO_11
	Model				 = CHSS_TL_C_SKN
	Skeleton			 = CHSS_TL_C_SKL
	ModelAnimationPrefix = CHSS_TL
	PortraitImageName	 = CPTroll
	ButtonImageName		 = HICAHTroll
	WeaponLaunchBone	= PRIMARY Bat_HandL
End

//--------------------------------------------------------------------------------------------------------------------------------------
// ELF ARCHER Upgrade_CreateAHero_ClassArcher / Upgrade_CreateAHero_SubClass_0
ModelConditionState	= CREATE_A_HERO_12 INVISIBLE_STEALTH
	Model				 = CHAR_EL_U_SKN
	Skeleton			 = CHAR_AR_U_SKL
	ModelAnimationPrefix = CHAR_AR
	PortraitImageName	 = CPMaleElfArcher
	ButtonImageName		 = HICAHMaleElfArcher
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_12
	Model				 = CHAR_EL_U_SKN
	Skeleton			 = CHAR_AR_U_SKL
	ModelAnimationPrefix = CHAR_AR
	PortraitImageName	 = CPMaleElfArcher
	ButtonImageName		 = HICAHMaleElfArcher
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
// ELF ARCHER Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassArcher / Upgrade_CreateAHero_SubClass_0
ModelConditionState	= CREATE_A_HERO_13 INVISIBLE_STEALTH
	Model				 = CHAR_EL_C_SKN
	Skeleton			 = CHAR_AR_C_SKL
	ModelAnimationPrefix = CHAR_AR
	PortraitImageName	 = CPMaleElfArcher
	ButtonImageName		 = HICAHMaleElfArcher
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_13
	Model				 = CHAR_EL_C_SKN
	Skeleton			 = CHAR_AR_C_SKL
	ModelAnimationPrefix = CHAR_AR
	PortraitImageName	 = CPMaleElfArcher
	ButtonImageName		 = HICAHMaleElfArcher
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End

//--------------------------------------------------------------------------------------------------------------------------------------
// FEMALE ELVEN ARCHER Upgrade_CreateAHero_ClassArcher Upgrade_CreateAHero_SubClass_1
ModelConditionState	= CREATE_A_HERO_14 INVISIBLE_STEALTH
	Model				 = CHAR_FE_U_SKN
	Skeleton			 = CHAR_FE_U_SKL
	ModelAnimationPrefix = CHAR_FE
	PortraitImageName	 = CPFemaleElfArcher
	ButtonImageName		 = HICAHFemaleElvenArcher
	WeaponLaunchBone	= PRIMARY B_Hand_L
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_14
	Model				 = CHAR_FE_U_SKN
	Skeleton			 = CHAR_FE_U_SKL
	ModelAnimationPrefix = CHAR_FE
	PortraitImageName	 = CPFemaleElfArcher
	ButtonImageName		 = HICAHFemaleElvenArcher
	WeaponLaunchBone	= PRIMARY B_Hand_L
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
// FEMALE ELVEN ARCHER Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassArcher Upgrade_CreateAHero_SubClass_1
ModelConditionState	= CREATE_A_HERO_15 INVISIBLE_STEALTH
	Model				 = CHAR_FE_C_SKN
	Skeleton			 = CHAR_FE_C_SKL
	ModelAnimationPrefix = CHAR_FE
	PortraitImageName	 = CPFemaleElfArcher
	ButtonImageName		 = HICAHFemaleElvenArcher
	WeaponLaunchBone	= PRIMARY B_Hand_L
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_15
	Model				 = CHAR_FE_C_SKN
	Skeleton			 = CHAR_FE_C_SKL
	ModelAnimationPrefix = CHAR_FE
	PortraitImageName	 = CPFemaleElfArcher
	ButtonImageName		 = HICAHFemaleElvenArcher
	WeaponLaunchBone	= PRIMARY B_Hand_L
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End

//--------------------------------------------------------------------------------------------------------------------------------------
// CORRUPTED MAN #1 Upgrade_CreateAHero_ClassCorruptedMan_SubClass_0
ModelConditionState	= CREATE_A_HERO_16 INVISIBLE_STEALTH
	Model				 = CHCM_CM_U_SKN1
	Skeleton			 = CHCM_CM_U_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPEasterling
	ButtonImageName		 = HICAHEasterling
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_16
	Model				 = CHCM_CM_U_SKN1
	Skeleton			 = CHCM_CM_U_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPEasterling
	ButtonImageName		 = HICAHEasterling
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
// CORRUPTED MAN #1 Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassCorruptedMan_SubClass_0
ModelConditionState	= CREATE_A_HERO_17 INVISIBLE_STEALTH
	Model				 = CHCM_CM_C_SKN
	Skeleton			 = CHCM_CM_C_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPEasterling
	ButtonImageName		 = HICAHEasterling
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_17
	Model				 = CHCM_CM_C_SKN
	Skeleton			 = CHCM_CM_C_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPEasterling
	ButtonImageName		 = HICAHEasterling
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End

//--------------------------------------------------------------------------------------------------------------------------------------
// CORRUPTED MAN #2 Upgrade_CreateAHero_ClassCorruptedMan_SubClass_1
ModelConditionState	= CREATE_A_HERO_18 INVISIBLE_STEALTH
	Model				 = CHCM_FN_U_SKN
	Skeleton			 = CHCM_CM_U_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPHaradrim
	ButtonImageName		 = HICAHHaradrim
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_18
	Model				 = CHCM_FN_U_SKN
	Skeleton			 = CHCM_CM_U_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPHaradrim
	ButtonImageName		 = HICAHHaradrim
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
// CORRUPTED MAN #2 Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassCorruptedMan_SubClass_1
ModelConditionState	= CREATE_A_HERO_19 INVISIBLE_STEALTH
	Model				 = CHCM_FN_C_SKN
	Skeleton			 = CHCM_CM_C_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPHaradrim
	ButtonImageName		 = HICAHHaradrim
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End
ModelConditionState	= CREATE_A_HERO_19
	Model				 = CHCM_FN_C_SKN
	Skeleton			 = CHCM_CM_C_SKL
	ModelAnimationPrefix = CHCM_CM
	PortraitImageName	 = CPHaradrim
	ButtonImageName		 = HICAHHaradrim
	ParticleSysBone		= NONE Predator FollowBone:Yes Persist:HOLD PersistID:100
	ParticleSysBone		= NONE Predator02 FollowBone:Yes Persist:HOLD PersistID:101
	WeaponLaunchBone	= PRIMARY ARROW
End


//--------------------------------------------------------------------------------------------------------------------------------------
// DWARF Taskmaster		Upgrade_CreateAHero_ClassDwarf_SubClass_0
ModelConditionState	= CREATE_A_HERO_20
	Model				 = CHDW_TM_U_SKN
	Skeleton			 = CHDW_DW_U_SKL
	ModelAnimationPrefix = CHDW_DW
	PortraitImageName	 = CPDwarfTaskmaster
	ButtonImageName		 = HICAHDwarfTaskmaster
	WeaponLaunchBone	= PRIMARY Axe02				; Needed for the WeaponFireSpecialAbility version as primary slot is used.
	WeaponLaunchBone	= TERTIARY Axe02
End
// DWARF Taskmaster Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassDwarf_SubClass_0
ModelConditionState	= CREATE_A_HERO_21
	Model				 = CHDW_TM_C_SKN
	Skeleton			 = CHDW_DW_C_SKL
	ModelAnimationPrefix = CHDW_DW
	PortraitImageName	 = CPDwarfTaskmaster
	ButtonImageName		 = HICAHDwarfTaskmaster
	WeaponLaunchBone	= PRIMARY Axe02				; Needed for the WeaponFireSpecialAbility version as primary slot is used.
	WeaponLaunchBone	= TERTIARY Axe02
End
//--------------------------------------------------------------------------------------------------------------------------------------
// DWARF Sage Upgrade_CreateAHero_ClassDwarf_SubClass_1
ModelConditionState	= CREATE_A_HERO_22
	Model				 = CHDW_SG_U_SKN // Change
	Skeleton			 = CHDW_DW_U_SKL
	ModelAnimationPrefix = CHDW_DW
	PortraitImageName	 = CPDwarfSage
	ButtonImageName		 = HICAHDwarfSage
	WeaponLaunchBone	= PRIMARY Axe02				; Needed for the WeaponFireSpecialAbility version as primary slot is used.
	WeaponLaunchBone	= TERTIARY Axe02
End
// DWARF Sage Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassDwarf_SubClass_1
ModelConditionState	= CREATE_A_HERO_23
	Model				 = CHDW_SG_C_SKN // Change
	Skeleton			 = CHDW_DW_C_SKL
	ModelAnimationPrefix = CHDW_DW
	PortraitImageName	 = CPDwarfSage
	ButtonImageName		 = HICAHDwarfSage
	WeaponLaunchBone	= PRIMARY Axe02				; Needed for the WeaponFireSpecialAbility version as primary slot is used.
	WeaponLaunchBone	= TERTIARY Axe02
End

//--------------------------------------------------------------------------------------------------------------------------------------
// ORC RAIDER Upgrade_CreateAHero_ClassServantsOfSauron_SubClass_2
ModelConditionState	= CREATE_A_HERO_24
	Model				 = CHSS_OR_U_SKN
	Skeleton			 = CHSS_GB_U_SKL
	ModelAnimationPrefix = CHSS_GB
	PortraitImageName	 = CPOrcRaider
	ButtonImageName		 = HICAHOrcRaider
	WeaponLaunchBone	= PRIMARY B_HAND_R
End
// ORC RAIDER Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassServantsOfSauron_SubClass_2
ModelConditionState	= CREATE_A_HERO_25
	Model				 = CHSS_OR_C_SKN
	Skeleton			 = CHSS_GB_C_SKL
	ModelAnimationPrefix = CHSS_GB
	PortraitImageName	 = CPOrcRaider
	ButtonImageName		 = HICAHOrcRaider
	WeaponLaunchBone	= PRIMARY B_HAND_R
End

//--------------------------------------------------------------------------------------------------------------------------------------
// URUK Upgrade_CreateAHero_ClassServantsOfSauron_SubClass_3
ModelConditionState	= CREATE_A_HERO_26
	Model				 = CHSS_UT_U_SKN
	Skeleton			 = CHSS_UK_U_SKL
	ModelAnimationPrefix = CHSS_UK
	PortraitImageName	 = CPUruk
	ButtonImageName		 = HICAHUrukhai
	WeaponLaunchBone	= PRIMARY B_HandR
End
// URUK Upgrade_CreateAHeroMapMode Upgrade_CreateAHero_ClassServantsOfSauron_SubClass_3
ModelConditionState	= CREATE_A_HERO_27
	Model				 = CHSS_UK_C_SKN
	Skeleton			 = CHSS_UK_C_SKL
	ModelAnimationPrefix = CHSS_UK
	PortraitImageName	 = CPUruk
	ButtonImageName		 = HICAHUrukhai
	WeaponLaunchBone	= PRIMARY B_HandR
End

	//================== ANIMATIONS =========HERE COMES THE REAL FIX========================================================

//----------- Special Create A Hero Creation Screen Animations ---------------
AnimationState = CREATE_A_HERO_IN_CREATION_SCREEN CREATE_A_HERO_EXAMINE_SELF CREATE_A_HERO_SELECTED_CHEER 
	StateName			   = STATE_ExamineSelf
	Animation			   = ExamineSelf
		AnimationName	   = #(MODEL)_C_CLRA
		AnimationMode	   = ONCE
		AnimationBlendTime = 20
	End
End

AnimationState = CREATE_A_HERO_IN_CREATION_SCREEN CREATE_A_HERO_EXAMINE_WEAPON_RIGHT CREATE_A_HERO_SELECTED_CHEER 
	StateName			   = STATE_ExamineWeapon
	Animation			   = WeaponSwap
		AnimationName	   = #(MODEL)_C_WPNA
		AnimationMode	   = ONCE
		AnimationBlendTime = 20
	End
End

AnimationState = CREATE_A_HERO_IN_CREATION_SCREEN USER_75
 	StateName			   = STATE_SwapModels
 	Animation			   = WeaponSwap
 		AnimationName	   = #(MODEL)_C_ATNB #(MODEL)_C_ATND
 		AnimationMode	   = MANUAL
 		AnimationBlendTime = 0
 	End
End





//-----------------------------------------------------------------------------
AnimationState = CREATE_A_HERO_IN_CREATION_SCREEN CREATE_A_HERO_SELECTED_CHEER
	StateName = STATE_SelectedCheer
	Animation = Foot_ATNB // Bored Idle
		AnimationName	   = #(MODEL)_C_ATNB #(MODEL)_C_ATND
		AnimationMode	   = ONCE
		AnimationPriority  = 90
		AnimationBlendTime = 20
	End
	Animation = Foot_ATND // Bored Fidget
		AnimationName	   = #(MODEL)_C_ATND #(MODEL)_C_ATNB
		AnimationMode	   = ONCE
		AnimationPriority  = 10
		AnimationBlendTime = 20
	End
	Animation = Foot_ATNE // Bored Fidget
		AnimationName	   = #(MODEL)_C_ATNE #(MODEL)_C_ATND #(MODEL)_C_ATNB
		AnimationMode	   = ONCE
		AnimationPriority  = 3
		AnimationBlendTime = 20
	End
	Flags =	RESTART_ANIM_WHEN_COMPLETE
	BeginScript //script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Unselected" then 
			CurDrawableSetTransitionAnimState("Trans_SelectedCheer") 
		end
//  		if Prev == "STATE_SwapModels" then 
//  			CurDrawableSetTransitionAnimState("Trans_SwapModels") 
//  		end
	EndScript
End

AnimationState = CREATE_A_HERO_IN_CREATION_SCREEN
	StateName = STATE_Unselected
	Animation = Foot_ATNB // Bored Idle
		AnimationName       = #(MODEL)_C_ATNB #(MODEL)_C_ATND
		AnimationMode       = ONCE
		AnimationPriority   = 90
		AnimationBlendTime = 10
	End
	Animation = Foot_ATND // Bored Fidget
		AnimationName       = #(MODEL)_C_ATND #(MODEL)_C_ATNB
		AnimationMode       = ONCE
		AnimationPriority   = 10
		AnimationBlendTime = 10
	End
	Animation = Foot_ATNE // Bored Fidget
		AnimationName       = #(MODEL)_C_ATNE #(MODEL)_C_ATND #(MODEL)_C_ATNB
		AnimationMode       = ONCE
		AnimationPriority   = 3
		AnimationBlendTime = 10
	End
	Flags =	RESTART_ANIM_WHEN_COMPLETE
 	BeginScript //script to set transition from moving
 		Prev = CurDrawablePrevAnimationState()
 		if Prev == "STATE_SwapModels" then 
 			CurDrawableSetTransitionAnimState("Trans_SwapModels") 
 		end
 	EndScript
End

TransitionState = Trans_ExamineWeapon
	Animation = Transition
		AnimationName = #(MODEL)_C_WPNA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End
TransitionState = Trans_ExamineSelf
	Animation = Transition
		AnimationName = #(MODEL)_C_CLRA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End
TransitionState = Trans_SelectedCheer
	Animation = Transition
		AnimationName = #(MODEL)_C_SLCA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End

TransitionState = Trans_SwapModels
	StateName = STATE_Unselected
	Animation = Transition
		AnimationName = #(MODEL)_C_ATNB #(MODEL)_C_ATND
		AnimationMode = ONCE
		AnimationBlendTime = 0
	End
End



//----------- Climbing/rappelling ---------------
AnimationState						= CLIMBING WEAPONSET_TOGGLE_1
	StateName						= STATE_Climbing
	Animation						= Climbing
		AnimationName				= #(MODEL)_U_WALB
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing_WeaponToggle") return end
	EndScript
End
TransitionState = Trans_RunningToClimbing_WeaponToggle
	Animation = Transition
		AnimationName = #(MODEL)_B_WALA
		AnimationMode = ONCE
	End
End

AnimationState						= CLIMBING
	StateName						= STATE_Climbing
	Animation						= Climbing
		AnimationName				= #(MODEL)_U_WALB
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing") return end
	EndScript
End
TransitionState = Trans_RunningToClimbing
	Animation = Transition
		AnimationName = #(MODEL)_U_WALA
		AnimationMode = ONCE
	End
End

AnimationState						= RAPPELLING WEAPONSET_TOGGLE_1
	StateName						= STATE_Rappelling
	Animation						= Rapelling
		AnimationName				= #(MODEL)_U_WALD
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRappelling") return end
	EndScript
End
AnimationState						= RAPPELLING
	StateName						= STATE_Rappelling
	Animation						= Rapelling
		AnimationName				= #(MODEL)_U_WALD
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRappelling") return end
	EndScript
End
TransitionState = Trans_ClimbingToRappelling
	Animation = Transition
		AnimationName = #(MODEL)_U_WALC
		AnimationMode = ONCE
	End
End
TransitionState = Trans_RappellingToRunning_WeaponToggle
	Animation = Transition
		AnimationName = MUGblnSwrd_B_WALE
		AnimationMode = ONCE
	End
End
TransitionState = Trans_RappellingToRunning
	Animation = Transition
		AnimationName = MUGblnSwrd_U_WALE
		AnimationMode = ONCE
	End
End
	



// --------- MOUNTED  ------------

// --- Dying Anims
AnimationState					=	DYING AFLAME MOUNTED
	Animation					=	Fire
		AnimationName			=	#(MODEL)_M_MFDA 
		AnimationSpeedFactorRange = 0.9 1.1
	End
	BeginScript
		CurDrawableHideSubObject("arrow") //Circumvents blend issues when the arrow is being shown...
	EndScript
End

AnimationState				=	DYING SPLATTED MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_LNDA
		AnimationMode		=	ONCE
	End
End
AnimationState        = DYING MOUNTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = #(MODEL)_M_DIEA
		AnimationMode     = ONCE
	End
End

AnimationState				=	STUNNED_STANDING_UP MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_GTPA
		AnimationMode		=	ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState				=	STUNNED MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_LNDA
		AnimationMode		=	ONCE
	End
End

AnimationState				=	FREEFALL MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_FLYA
		AnimationMode		=	LOOP
	End
	Flags					=	RANDOMSTART
End

AnimationState				=	STUNNED_FLAILING MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_FLYA
		AnimationMode		=	LOOP
	End
	Flags					=	RANDOMSTART
End

AnimationState        = PASSENGER MOUNTED
	Animation
		AnimationName       = #(MODEL)_M_GBDA
		AnimationMode       = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = MOUNTED LEVELED	// This state clears itself in 3 of your Earth seconds
	Animation
		AnimationName           = #(MODEL)_M_LVLA
		AnimationMode       = ONCE
	End
End

AnimationState        = MOUNTED RAISING_FLAG	// This state clears itself in 3 of your Earth seconds
	Animation
		AnimationName           = #(MODEL)_M_CHRA
		AnimationMode		=	ONCE
	End
	Flags					=	RESTART_ANIM_WHEN_COMPLETE
End

// --- Attacking Anims		
AnimationState				= FIRING_OR_PREATTACK_A MOUNTED	// Melee attack.
	Animation
		AnimationName		= #(MODEL)_M_ATKA #(MODEL)_M_ATKB
		AnimationMode		= ONCE
		UseWeaponTiming		= Yes
	End
End

// --- Moving Anims
AnimationState				=	MOUNTED TURN_LEFT_HIGH_SPEED
	Animation
		AnimationName		=	#(MODEL)_M_TNL1
		AnimationMode		=	LOOP
		AnimationSpeedFactorRange= 1.8 1.8
		AnimationBlendTime	=	20
	End
End

AnimationState				=	MOUNTED TURN_RIGHT_HIGH_SPEED
	Animation
		AnimationName		=	#(MODEL)_M_TNR1
		AnimationMode		=	LOOP
		AnimationSpeedFactorRange= 1.8 1.8
		AnimationBlendTime	=	20
	End
End

AnimationState				=	MOVING TURN_LEFT MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_TRNL
		AnimationMode		=	LOOP
	End
//			//ParticleSysBone			=	None CalvaryDustTrails
End

AnimationState				=	MOVING TURN_RIGHT MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_TRNR
		AnimationMode		=	LOOP
	End
//			//ParticleSysBone			=	None CalvaryDustTrails
End

AnimationState				=	MOVING ACCELERATE MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_ACCL
		AnimationMode		=	LOOP
	End
	//ParticleSysBone			=	None CalvaryDustTrails
End

AnimationState				=	MOVING DECELERATE MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_DECL
		AnimationMode		=	ONCE
	End
	//ParticleSysBone			=	None CalvaryDustTrails
End

AnimationState				=	MOVING WALKING MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_WLKA
		AnimationMode		=	LOOP
	End
	Flags					=	RANDOMSTART
	//ParticleSysBone			=	None InfantryDustTrails  
End

AnimationState				=	MOVING BACKING_UP MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_BAKA
		AnimationMode		=	LOOP
	End
	Flags					=	RANDOMSTART
	//ParticleSysBone			=	None InfantryDustTrails  
End

AnimationState        = MOUNTED MOVING FIRING_OR_PREATTACK_A
	ShareAnimation		= Yes
	Animation
		AnimationName       = #(MODEL)_M_ATRA
		AnimationMode       = LOOP
	End
	Flags               = RANDOMSTART  
End

AnimationState				=	MOVING MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_RUNA
		AnimationMode		=	LOOP
	End
 	Flags					=	RANDOMSTART
	//ParticleSysBone			=	None CalvaryDustTrails  
End

// --- Selected Anims
AnimationState				=	SELECTED MOUNTED
	SimilarRestart			=   Yes			
	StateName				=	AtAttentionIdleMounted
	Animation				=	ATNB
		AnimationName		=	#(MODEL)_M_ATNB
		AnimationMode		=	LOOP
	End
	BeginScript
		Prev = CurDrawablePrevAnimationState()
		if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
		if Prev == "AtAttentionIdleMounted" then CurDrawableSetTransitionAnimState("TRANS_Select") end
	EndScript
End

TransitionState				=	TRANS_Select
	Animation
		AnimationName		=	#(MODEL)_M_ATNA
		AnimationMode		=	ONCE
	End
End

// --- Idle Anims
AnimationState				= MOUNTED
	Animation
		AnimationName		=	#(MODEL)_M_IDLA
		AnimationPriority	=	20
		AnimationMode		=	ONCE
		AnimationBlendTime	=	15
	End
	Flags				=	RESTART_ANIM_WHEN_COMPLETE
End

// --------- UNMOUNTED  ------------

//------------------  DYING -------------------------------------------------------------

// --- Flying through the air.
AnimationState        = STUNNED_FLAILING WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = #(MODEL)_B_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = #(MODEL)_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

// --- Dying anims
AnimationState        = DYING SPLATTED WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = #(MODEL)_B_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = #(MODEL)_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING WEAPONSET_TOGGLE_1	//WEAPONSTATE_CLOSE_RANGE
	StateName           = STATE_Bow
	Animation
		AnimationName     = #(MODEL)_B_DIEA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = #(MODEL)_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = #(MODEL)_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims


AnimationState        = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = #(MODEL)_B_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = #(MODEL)_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = #(MODEL)_B_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = #(MODEL)_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------


// RAIN OF ARROWS SPECIAL POWER //
AnimationState				= PACKING_TYPE_1  WEAPONSET_TOGGLE_1
	StateName				= rainofarrows
	Animation
		AnimationName		= #(MODEL)_B_ATKA2
		AnimationMode		= LOOP
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= #(MODEL)_U_LVLA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= #(MODEL)_U_SPCA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

//--------------------- Wound Arrow anim
AnimationState        =  SPECIAL_WEAPON_TWO
	StateName = STATE_Bow
	Animation
		AnimationName       = #(MODEL)_U_SPCL #(MODEL)_U_ATKC
		AnimationMode       = ONCE
	End
	FrameForPristineBonePositions = 59
	BeginScript
		CurDrawableShowSubObject("arrow")
	EndScript
End
		
//------------------ ATTACKING --------------------------------------------------------------------
		// Attacking Anims [Weapon_A]
		
		
		
//		AnimationState        = MOVING WEAPONSET_TOGGLE_1 FIRING_OR_PREATTACK_A
//			Animation           = TrotAndFire
//				AnimationName       = #(MODEL)_U_ATRA
//				AnimationMode       = LOOP
//			End
//			Flags               = RANDOMSTART
//			StateName = RunAndSwing
//		End
//		
//		AnimationState        = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
//			StateName           = STATE_Sword
//			
//			Animation           = ATKD
//				AnimationName     = #(MODEL)_U_ATKD
//				AnimationMode     = ONCE
//				UseWeaponTiming		= Yes
//				AnimationSpeedFactorRange = 1.149 1.149
//			End
//			
//			Animation           = ATKE
//				AnimationName    = #(MODEL)_U_ATKE
//				AnimationMode     = ONCE
//				UseWeaponTiming		= Yes
//				AnimationSpeedFactorRange = 1.149 1.149
//			End
//			
//			Animation           = ATKF
//				AnimationName    = #(MODEL)_U_ATKF
//				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 1.47 1.47
//			End
//			Flags				=	RESTART_ANIM_WHEN_COMPLETE
//			//	FrameForPristineBonePositions = 59
//			BeginScript
//				Prev = CurDrawablePrevAnimationState()
//				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
//			EndScript
//		End

//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = #(MODEL)_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End

		//--- Running with bow
		AnimationState			= MOVING WEAPONSET_TOGGLE_1		//WEAPONSTATE_CLOSE_RANGE
			StateName           = STATE_RunningBow
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = #(MODEL)_B_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance		= 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
				if Prev == "STATE_RunningSword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning_WeaponToggle") return end
			EndScript
		End

		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = #(MODEL)_U_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

		//---------------------------------------------------
		//New style firing with bow
		AnimationState					=	PREATTACK_A WEAPONSET_TOGGLE_1
			StateName					=	STATE_Firing
			Animation					=	ReadyToDrawn
				AnimationName			=	#(MODEL)_B_ATKA1
				AnimationMode			=	ONCE
//				UseWeaponTiming			=	Yes			// UseWeaponTiming plus random weapon field equals desync.  Leaving as warning
				//AnimationBlendTime		=	10
			End
		End

		AnimationState					=	FIRING_OR_RELOADING_A WEAPONSET_TOGGLE_1
			StateName					=	STATE_Firing
			Animation					=	LooseReloadDraw
				AnimationName			=	#(MODEL)_B_ATKA2
				AnimationMode			=	ONCE
//				UseWeaponTiming			=	Yes			// UseWeaponTiming plus random weapon field equals desync.  Leaving as warning
				AnimationSpeedFactorRange = 1.1 1.1		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
				//AnimationBlendTime		=	10
			End
		End
		//---------------------End New style firing

		AnimationState					=	CONTINUOUS_FIRE_MEAN WEAPONSET_TOGGLE_1 ;;.;; uncommented
			Animation					=	HangFrameWhileCoasting
				AnimationName			=	#(MODEL)_B_ATKA2
				AnimationMode			=	MANUAL
			End
		End
		
		AnimationState						= CONTINUOUS_FIRE_SLOW WEAPONSET_TOGGLE_1 ;;.;; uncommented
			//StateName						= STATE_Idle_Bow
			Animation						= PutAwayArrow
				AnimationName				= #(MODEL)_U_ATKA3
				AnimationMode				= ONCE
			End
		End
				
		//End New style firing
		//---------------------------------------------------

		AnimationState				= FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
			StateName				= STATE_Firing
			Animation
				AnimationName		= #(MODEL)_B_ATKA1
				AnimationMode		= ONCE
				UseWeaponTiming		= No			// UseWeaponTiming plus random weapon field equals desync.  Leaving as warning
			End
		End

		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= #(MODEL)_U_ATKA1 #(MODEL)_U_ATKA #(MODEL)_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

// this hit animation attack stance
		AnimationState = EMOTION_ALERT HIT_REACTION WEAPONSET_TOGGLE_1
			Animation
				AnimationName = #(MODEL)_B_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION WEAPONSET_TOGGLE_1
			Animation
				AnimationName = #(MODEL)_B_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = #(MODEL)_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = #(MODEL)_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState		  =	THROWN_PROJECTILE
			Animation
				AnimationName =	#(MODEL)_U_LEP2
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	ABOUT_TO_HIT
			Animation
				AnimationName =	#(MODEL)_U_LEP3
				AnimationMode =	ONCE
			End
		End

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= #(MODEL)_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End

		//	WIZARD BLAST ANIMS MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_TWO MOUNTED
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPLD #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
		End
	
		//	WIZARD BLAST ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_TWO
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPCB #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
		End

		//	ISTARI LIGHT STAFF WEAPON MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_THREE MOUNTED	// FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	#(MODEL)_U_SPCD #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		//	ISTARI LIGHT STAFF WEAPON ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_THREE // FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	#(MODEL)_U_SPCE #(MODEL)_U_ATKA//	isitari's light?
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End
		
		; Throwing and cripple strike
		AnimationState		  =	SPECIAL_WEAPON_FOUR
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPCD
				AnimationMode =	ONCE
			End
			FrameForPristineBonePositions	= 44
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPCE
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX
			StateName		  =	Attacking
			Animation
				AnimationName =	#(MODEL)_U_SPCF
				AnimationMode =	ONCE
			End
		End

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	#(MODEL)_U_SPCC #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	#(MODEL)_U_SPCA #(MODEL)_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	#(MODEL)_U_SPCB #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	#(MODEL)_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	#(MODEL)_U_SPCC #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	#(MODEL)_U_SPCA #(MODEL)_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	#(MODEL)_U_SPCB #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
//----------- Captain of Gondor - Sword --------------------------------------------
		AnimationState        = PACKING_TYPE_2 WEAPONSET_TOGGLE_1
			StateName		  =	CaptainPower
			Animation           = GUHero_CHRC
				AnimationName     = #(MODEL)_U_CHRC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
		End

//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = #(MODEL)_U_SPCE #(MODEL)_U_SPCA #(MODEL)_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	#(MODEL)_U_SPCC #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	#(MODEL)_U_SPCA #(MODEL)_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	#(MODEL)_U_SPCB #(MODEL)_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	#(MODEL)_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	#(MODEL)_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	#(MODEL)_U_SPCA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 5
		
		//		AnimationState		  =	PACKING_TYPE_5 UNPACKING WEAPONSET_TOGGLE_1  
//			Animation		  
//				AnimationName =	#(MODEL)_B_SPCB
//				AnimationMode =	ONCE
//			End
//		End
//	
//		AnimationState		  =	PACKING_TYPE_5 PREPARING WEAPONSET_TOGGLE_1
//			Animation		 
//				AnimationName =	#(MODEL)_B_SPCB
//				AnimationMode =	ONCE
//			End
//		End

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	#(MODEL)_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		
//		AnimationState		  =	PACKING_TYPE_5 UNPACKING	  
//			Animation		  
//				AnimationName =	#(MODEL)_U_SPCB
//				AnimationMode =	ONCE
//			End
//		End
//	
//		AnimationState		  =	PACKING_TYPE_5 PREPARING
//			Animation		 
//				AnimationName =	#(MODEL)_U_SPCB
//				AnimationMode =	ONCE
//			End
//		End

		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	#(MODEL)_U_SPCB
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 6
//		AnimationState		  =	PACKING_TYPE_6 UNPACKING	  
//			Animation		  
//				AnimationName =	#(MODEL)_U_SPCD
//				AnimationMode =	ONCE
//			End
//		End
//	
//		AnimationState		  =	PACKING_TYPE_6 PREPARING
//			Animation		 
//				AnimationName =	#(MODEL)_U_SPCD
//				AnimationMode =	ONCE
//			End
//		End

		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	#(MODEL)_U_SPCD
				AnimationMode =	ONCE
			End
		End




//====== LEVELED
		AnimationState				= LEVELED WEAPONSET_TOGGLE_1	// This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= #(MODEL)_B_CHRA #(MODEL)_B_LVLA
				AnimationMode		= ONCE
			End
		End

		AnimationState				= LEVELED 						// This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= #(MODEL)_U_CHRA #(MODEL)_U_LVLA
				AnimationMode		= ONCE
			End
		End

//---------------------- EMOTIONS ---------------------------------------------------------------

		// cheer, mounted
		AnimationState				=	EMOTION_CELEBRATING MOUNTED
			Animation 
				AnimationName		=	#(MODEL)_M_CHRA #(MODEL)_M_IRFA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

		// cheer, w/ bow on foot
		AnimationState				=	EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
			Animation 
				AnimationName		=	#(MODEL)_B_CHRA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

		// cheer, on foot
		AnimationState				=	EMOTION_CELEBRATING
			Animation CHRA
				AnimationName		=	#(MODEL)_U_CHRA #(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	#(MODEL)_U_CHRB #(MODEL)_U_CHRA #(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// raise flag, w/ bow on foot
		AnimationState				=	RAISING_FLAG WEAPONSET_TOGGLE_1
			Animation 
				AnimationName		=	#(MODEL)_B_CHRA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

		// cheer, on foot
		AnimationState				=	RAISING_FLAG
			Animation CHRA
				AnimationName		=	#(MODEL)_U_CHRA #(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	#(MODEL)_U_CHRB #(MODEL)_U_CHRA #(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, mounted
		AnimationState				=	EMOTION_TAUNTING MOUNTED
			Animation 
				AnimationName		=	#(MODEL)_M_TNTA #(MODEL)_M_IRFA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, w/ bow on foot
		AnimationState				=	EMOTION_TAUNTING WEAPONSET_TOGGLE_1
			Animation 
				AnimationName		=	#(MODEL)_B_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation CHRA
				AnimationName		=	#(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	#(MODEL)_U_TNTB #(MODEL)_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
// 	Animation
// 		AnimationName				= RUMerry_CHRA
// 		AnimationMode				= ONCE
// 	End
// 	Animation
// 		AnimationName				= RUMerry_CHRB
// 		AnimationMode				= ONCE
// 	End
// 	Flags							= RESTART_ANIM_WHEN_COMPLETE
// End
// 
// AnimationState						= EMOTION_TAUNTING
// 	Animation
// 		AnimationName				= RUMerry_TNTB
// 		AnimationMode				= LOOP
// 	End
// End
// 
// AnimationState					= EMOTION_ALERT WEAPONSET_TOGGLE_1
// 	StateName					= STATE_Ready_Rocks
// 	Animation					= IDLA
// 		AnimationName			= RUMerry_IDLA
// 		AnimationMode			= LOOP
// 	End
// End
// AnimationState					= EMOTION_ALERT
// 	StateName					= STATE_Ready_Sword
// 	Animation
// 		AnimationName			= RUMerry_IDLB
// 		AnimationMode			= LOOP
// 	End
// End
		


//====== ENGAGED
		AnimationState				= ENGAGED WEAPONSET_TOGGLE_1
			StateName				= STATE_ready
			Animation
				AnimationName		= #(MODEL)_B_IDLA
				AnimationMode		= ONCE
			End
		End
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= #(MODEL)_U_IDLA
				AnimationMode		= ONCE
			End
		End
		AnimationState				= BETWEEN_FIRING_SHOTS_A WEAPONSET_TOGGLE_1
			StateName				= STATE_ready
			Animation
				AnimationName		= #(MODEL)_B_IDLA
				AnimationMode		= ONCE
			End
		End
		AnimationState				= BETWEEN_FIRING_SHOTS_A
			StateName				= STATE_ready
			Animation
				AnimationName		= #(MODEL)_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
// --- Idle Toggled

		AnimationState = SELECTED WEAPONSET_TOGGLE_1
			StateName				= STATE_Selected_Bow
			Animation				= Selected_Loop
				AnimationName		= #(MODEL)_B_ATNB
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedBow") end
			EndScript
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End

		AnimationState = SELECTED
			StateName				= STATE_Selected_Sword
			Animation				= Selected_Loop
				AnimationName		= #(MODEL)_U_ATNB
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedSword") end
			EndScript
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End


		AnimationState				= WEAPONSET_TOGGLE_1
			StateName				= STATE_Idle_Bow
			Animation
				AnimationName		=	#(MODEL)_B_IDLA
				AnimationPriority	=	20
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15s
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End

		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = #(MODEL)_U_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
			Animation = Foot_IDLC // Bored Fidget
				AnimationName       = #(MODEL)_U_IBFA
				AnimationMode       = ONCE
				AnimationPriority   = 2
			End
			//Animation = Foot_IDLD // Bored Fidget
			//	AnimationName       = #(MODEL)_U_IBFB
			//	AnimationMode       = ONCE
			//	AnimationPriority   = 1
			//End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		

	//---transitions--------------------------------------------

		TransitionState = TRANS_BoredToSelectedSword
		// Once we have proper animations for enter -> idle -> exit, fix this properly.
			Animation = ANTD
				AnimationName	= #(MODEL)_U_ATNA #(MODEL)_U_ATND #(MODEL)_U_IDLA
				AnimationMode	= ONCE
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= #(MODEL)_U_ATNC #(MODEL)_U_ATNF #(MODEL)_U_ATNE
				AnimationMode	= ONCE
			End		
		End	

		TransitionState = TRANS_BoredToSelectedBow
			Animation = ATNC
				AnimationName		= #(MODEL)_U_ATNF #(MODEL)_U_ATNE
				AnimationMode		= ONCE
			End		
		End
		
		TransitionState = TRANS_CaptainBowToSelectedBow
			Animation = ATNC
				AnimationName		= #(MODEL)_U_ATNF
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
				AnimationSpeedFactorRange = 1.5 1.5
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredBow
			Animation			= ATNA
				AnimationName	= #(MODEL)_U_ATNF
				AnimationMode	= ONCE
			End		
		End	


		TransitionState       = TRANS_BowToSword
			Animation           = CUHero_STHA
				AnimationName     = #(MODEL)_B_STHA
				AnimationMode     = ONCE
			End
		End

		TransitionState       = TRANS_SwordToBow
			Animation           = CUHero_STHB
				AnimationName     = #(MODEL)_U_STHA
				AnimationMode     = ONCE
			End
		End	

		TransitionState       		= TRANS_BowToSword_Running
			Animation           	= DrawSwords
				AnimationName       = #(MODEL)_B_STHB
				AnimationMode       = ONCE
			End
		End
		
		TransitionState       		= TRANS_SwordToBow_Running
			Animation           	= DrawBow
				AnimationName       = #(MODEL)_U_STHB
				AnimationMode       = ONCE
			End
		End		

	End

	End ;;Replacement
	
	
	
	
	
	
;;-------------------------END END END------------------------------------------------------------;;

	RemoveModule ModuleTag_StancesBehavior
	AddModule
		Behavior = StancesBehavior ModuleTag_StancesBehavior			; Allow stances
			   StanceTemplate = Hero
		End
	End
	
	
  ReplaceModule ModuleTag_FaramirHealing ;This makes CaH regenerate a lot faster
	Behavior = AutoHealBehavior ModuleTag_LegendsFaramirHealing
		StartsActive		  =	Yes
		HealingAmount		  =	100 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY ;15000
		HealOnlyIfNotInCombat =	Yes
	End
  END

;ELVEN ARCHER START WITH SWORD (commented, because people complained too much about having archer specialization and cripple strike, but no toggle weapon)
;RemoveModule ModuleTag_CreateAHeroMakeSureArcherUsesBowInitially



;-------------- Scroll of Recall (Need to test it) --------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_TeleportToCasterModuleExtra
		SpecialPowerTemplate		= SpecialAbilityLegendsScrollOfRecall
;		StartsPaused			= No ;Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= CaH_TeleportPart1
	End
END

AddModule
	Behavior = TeleportToCasterSpecialPower ModuleTag_TeleportToCasterExtra
		SpecialPowerTemplate		= SpecialAbilityLegendsScrollOfRecall
		UnpackingVariation		= 3
		StartAbilityRange		= 1000000.0 // i.e. pretty large
		ApproachRequiresLOS		= No		; can do this without seeing the target	units.
		Radius				= 1000000	   	; The radius that will capture units > ALL THE MAP!
		TargetFX			= FX_CAHBlink
		TriggerFX			= FX_CAHTeleport
		MinDestinationRadius	   	= 50		   // the inner	radius of the ring where units will	teleport to
		MaxDestinationRadius	   	= 100	   // the outer	radius of the ring where units will	teleport to
	
		UnpackTime			= 500 ; 2000
		PreparationTime			= 1	 
		FreezeAfterTriggerDuration	= 2500	   // Hold AI for this long	after we fire.		 
	End
END

;------------ Shield Bash ---------------

ReplaceModule ModuleTag_CreateAHeroShieldCrushEnabler_Level1
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroShieldCrushEnabler_Level1New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroShieldCrush_Level1
		TriggeredBy			= Upgrade_CreateAHeroShieldCrush_Level1
	End
END

ReplaceModule ModuleTag_CreateAHeroShieldCrushStarter_Level1
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroShieldCrushStarter_Level1New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroShieldCrush_Level1
		StartsPaused			= Yes
		AttributeModifier		= CreateAHeroShieldCrush_Level1New
		AttributeModifierAffectsSelf	= Yes
	End
END

ReplaceModule ModuleTag_CreateAHeroShieldCrushEnabler_Level3
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroShieldCrushEnabler_Level3New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroShieldCrush_Level3
		TriggeredBy			= Upgrade_CreateAHeroShieldCrush_Level3
	End
END

ReplaceModule ModuleTag_CreateAHeroShieldCrushStarter_Level3
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroShieldCrushStarter_Level3New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroShieldCrush_Level3
		StartsPaused			= Yes
		AttributeModifier		= CreateAHeroShieldCrush_Level3New
		AttributeModifierAffectsSelf	= Yes
	End
END

;---------------- Charge ----------------------

ReplaceModule ModuleTag_CreateAHeroChargeEnabler_Level1
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroChargeEnabler_Level1New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level1
		TriggeredBy			= Upgrade_CreateAHeroCharge_Level1
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeStarter_Level1
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroChargeStarter_Level1New
		SpecialPowerTemplate	 	= SpecialAbilityCreateAHeroCharge_Level1
		UpdateModuleStartsAttack 	= Yes
		StartsPaused			= Yes
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeUpdate_Level1
	Behavior = SpecialAbilityUpdate ModuleTag_CreateAHeroChargeUpdate_Level1New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level1
		StartAbilityRange		= 150.0
		AbilityAbortRange		= 50.0
		PreparationTime			= 0 
		PackTime			= 3000
		TriggerAttributeModifier	= CreateAHeroChargeBonus_Level1New
		AttributeModifierDuration	= 20000
		ChargeAttackSpeedBoost		= Yes
		IgnoreFacingCheck		= Yes
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeEnabler_Level2
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroChargeEnabler_Level2New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level2
		TriggeredBy			= Upgrade_CreateAHeroCharge_Level2
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeStarter_Level2
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroChargeStarter_Level2New
		SpecialPowerTemplate      	= SpecialAbilityCreateAHeroCharge_Level2
		UpdateModuleStartsAttack  	= Yes
		StartsPaused			= Yes
	END
End

ReplaceModule ModuleTag_CreateAHeroChargeUpdate_Level2
	Behavior = SpecialAbilityUpdate ModuleTag_CreateAHeroChargeUpdate_Level2New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level2
		StartAbilityRange		= 150.0
		AbilityAbortRange		= 50.0
		PreparationTime			= 0 
		PackTime			= 3000
		TriggerAttributeModifier	= CreateAHeroChargeBonus_Level2New
		AttributeModifierDuration	= 20000
		ChargeAttackSpeedBoost		= Yes
		IgnoreFacingCheck		= Yes
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeEnabler_Level3
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroChargeEnabler_Level3New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level3
		TriggeredBy			= Upgrade_CreateAHeroCharge_Level3
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeStarter_Level3
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroChargeStarter_Level3New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level3
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
	End
END

ReplaceModule ModuleTag_CreateAHeroChargeUpdate_Level3
	Behavior = SpecialAbilityUpdate ModuleTag_CreateAHeroChargeUpdate_Level3New
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroCharge_Level3
		StartAbilityRange		= 150.0 ;//Negative distances will cause the unit to overshoot the destination.
		AbilityAbortRange		= 50.0
		PreparationTime			= 0 
		PackTime			= 3000  ;// without this pack time, the charge would not complete
		TriggerAttributeModifier	= CreateAHeroChargeBonus_Level3New
		AttributeModifierDuration	= 20000
		ChargeAttackSpeedBoost		= Yes
		IgnoreFacingCheck		= Yes
	End
END

;------------- Leadership -------------

ReplaceModule ModuleTag_CreateAHeroLeaderShip
Behavior = AttributeModifierAuraUpdate ModuleTag_CreateAHeroLeaderShipNew
	StartsActive	= No // If no, requires upgrade to turn on.
	BonusName	= LegendsLeadership
	TriggeredBy	= Upgrade_CreateAHeroLeadership
	RefreshDelay	= 2000
	Range		= 200
	AntiCategory	= BUFF
	ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION +HERO	-DOZER -HORDE	; Now HEROes get this aura
End
END

;------------- Howl of Rage Lv1 -------------

;Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroHowlOfRageEnabler_Level1
;	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level1
;	TriggeredBy			= Upgrade_CreateAHeroHowlOfRage_Level1
;End 

ReplaceModule ModuleTag_CreateAHeroHowlOfRageStarter_Level1
  Behavior = SpecialPowerModule ModuleTag_CreateAHeroHowlOfRageStarter_Level1New
	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level1
	AttributeModifier		= LegendsHowlOfRageAttribute1
	AttributeModifierRange		= CREATE_A_HERO_HOWL_OF_RAGE_RADIUS_L1
	AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MONSTER +HERO
	TriggerFX			= FX_HowlofRage1
	UpdateModuleStartsAttack	= No
	StartsPaused			= Yes
	TargetEnemy			= No
  End
END

;------------- Howl of Rage Lv2 -------------

;Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroHowlOfRageEnabler_Level2
;	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level2
;	TriggeredBy			= Upgrade_CreateAHeroHowlOfRage_Level2
;End 

ReplaceModule ModuleTag_CreateAHeroHowlOfRageStarter_Level2
  Behavior = SpecialPowerModule ModuleTag_CreateAHeroHowlOfRageStarter_Level2New
	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level2
	AttributeModifier		= LegendsHowlOfRageAttribute2
	AttributeModifierRange		= CREATE_A_HERO_HOWL_OF_RAGE_RADIUS_L2
	AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MONSTER +HERO
	TriggerFX			= FX_HowlofRage2
	UpdateModuleStartsAttack	= No
	StartsPaused			= Yes
	TargetEnemy			= No
  End
End

;------------- Howl of Rage Lv3 -------------

;Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroHowlOfRageEnabler_Level3
;	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level3
;	TriggeredBy			= Upgrade_CreateAHeroHowlOfRage_Level3
;End 

ReplaceModule ModuleTag_CreateAHeroHowlOfRageStarter_Level3
  Behavior = SpecialPowerModule ModuleTag_CreateAHeroHowlOfRageStarter_Level3New
	SpecialPowerTemplate		= SpecialAbilityCreateAHeroHowlOfRage_Level3
	AttributeModifier		= LegendsHowlOfRageAttribute3
	AttributeModifierRange		= CREATE_A_HERO_HOWL_OF_RAGE_RADIUS_L3
	AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MONSTER +HERO
	TriggerFX			= FX_HowlofRage3
	UpdateModuleStartsAttack	= No
	StartsPaused			= Yes
	TargetEnemy			= No
  End
END

;------------- Temporal Convert Enemy Lv1 -------------

ReplaceModule ModuleTag_ConvertEnemySpecialPower_L1
Behavior = DominateEnemySpecialPower ModuleTag_ConvertEnemySpecialPower_L1New
    SpecialPowerTemplate		= SpecialAbilityConvertEnemy_L1 
	UnpackingVariation		= 2
	StartAbilityRange		= 200.0
	
	DominateRadius			= 30 //100 //150
	DominatedFX			= FX_SarumanDominateTargets
	TriggerFX			= FX_CreateaHeroConvert
	PermanentlyConvert		= No ;Yes
	UnpackTime			= 2000
	PreparationTime			= 1   
	FreezeAfterTriggerDuration	= 2500 // Hold AI for this long after we fire.		
	AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES NEUTRAL
End
END

;------------- Temporal Convert Enemy Lv2 -------------

ReplaceModule ModuleTag_ConvertEnemySpecialPower_L2
Behavior = DominateEnemySpecialPower ModuleTag_ConvertEnemySpecialPower_L2New
    SpecialPowerTemplate		= SpecialAbilityConvertEnemy_L2 
	UnpackingVariation		= 2
	StartAbilityRange		= 200.0
	
	DominateRadius			= 60 //100 //150
	DominatedFX			= FX_SarumanDominateTargets
	TriggerFX			= FX_CreateaHeroConvert
	PermanentlyConvert		= No ;Yes
	UnpackTime			= 2000
	PreparationTime			= 1   
	FreezeAfterTriggerDuration	= 2500 // Hold AI for this long after we fire.		
	AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES NEUTRAL
End
END

;------------- Temporal Coerce Lv1 -------------

ReplaceModule ModuleTag_CreateAHeroCoercePower_Level1
Behavior = DominateEnemySpecialPower ModuleTag_CreateAHeroCoercePower_Level1New
    SpecialPowerTemplate		= SpecialAbilityCreateAHeroCoerce_Level1
	UnpackingVariation		= 2
	StartAbilityRange		= CREATE_A_HERO_COERCE_RANGE_L1
	
	DominateRadius			= 1 ; 60
	DominatedFX			= FX_SarumanDominateTargets
	TriggerFX			= FX_CreateaHeroConvert
	TriggerSound			= SarumanWormtongue
;	PermanentlyConvert		= Yes
	UnpackTime			= 2000
	PreparationTime			= 1   
	FreezeAfterTriggerDuration	= 2500 // Hold AI for this long after we fire.	
	AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES ;NEUTRAL
End
END

;------------- Temporal Coerce Lv2 -------------

ReplaceModule ModuleTag_CreateAHeroCoercePower_Level2
Behavior = DominateEnemySpecialPower ModuleTag_CreateAHeroCoercePower_Level2New
    SpecialPowerTemplate		= SpecialAbilityCreateAHeroCoerce_Level2
	UnpackingVariation		= 2
	StartAbilityRange		= CREATE_A_HERO_COERCE_RANGE_L2
	
	DominateRadius			= 20 ;60
	DominatedFX			= FX_SarumanDominateTargets
	TriggerFX			= FX_CreateaHeroConvert
;	PermanentlyConvert		= Yes
	UnpackTime			= 2000
	PreparationTime			= 1   
	FreezeAfterTriggerDuration	= 2500 // Hold AI for this long after we fire.		
	AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES NEUTRAL
End
END

;------------- Temporal Coerce Lv3 -------------

ReplaceModule ModuleTag_CreateAHeroCoercePower_Level3
Behavior = DominateEnemySpecialPower ModuleTag_CreateAHeroCoercePower_Level3New
    SpecialPowerTemplate		= SpecialAbilityCreateAHeroCoerce_Level3
	UnpackingVariation		= 2
	StartAbilityRange		= CREATE_A_HERO_COERCE_RANGE_L3
	
	DominateRadius			= 35 ;90
	DominatedFX			= FX_SarumanDominateTargets
	TriggerFX			= FX_CreateaHeroConvert
;	PermanentlyConvert		= Yes
	UnpackTime			= 2000
	PreparationTime			= 1   
	FreezeAfterTriggerDuration	= 2500 // Hold AI for this long after we fire.		
	AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY ENEMIES NEUTRAL
End
END

;---------------- Assassin -------------------

ReplaceModule ModuleTag_CreateAHeroAssassinUpdate_Level1
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAssassinUpdate_Level1New
	SpecialPowerTemplate = SpecialAbilityCreateAHeroAssassin_Level1
	UnpackTime			= 2000
	PackTime			= 2000	
	AwardXPForTriggering		= 0
	StartAbilityRange		= CREATE_A_HERO_ASSASSIN_DO_POWER_RANGE
	ApproachRequiresLOS		= Yes
	SpecialWeapon			= LegendsCreateAHeroAssassinWeapon
	WhichSpecialWeapon		= 5
	LoseStealthOnTrigger		= Yes
	PreTriggerUnstealthTime		= 2100
End
END

ReplaceModule ModuleTag_CreateAHeroAssassinUpdate_Level2
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAssassinUpdate_Level2New
	SpecialPowerTemplate = SpecialAbilityCreateAHeroAssassin_Level2
	UnpackTime			= 2000
	PackTime			= 2000	
	AwardXPForTriggering		= 0
	StartAbilityRange		= CREATE_A_HERO_ASSASSIN_DO_POWER_RANGE
	ApproachRequiresLOS		= Yes
	SpecialWeapon			= LegendsCreateAHeroAssassinWeapon
	WhichSpecialWeapon		= 5
	LoseStealthOnTrigger		= Yes
	PreTriggerUnstealthTime		= 2100
End
END

ReplaceModule ModuleTag_CreateAHeroAssassinUpdate_Level3
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAssassinUpdate_Level3New
	SpecialPowerTemplate = SpecialAbilityCreateAHeroAssassin_Level3
	UnpackTime			= 2000
	PackTime			= 2000	
	AwardXPForTriggering		= 0
	StartAbilityRange		= CREATE_A_HERO_ASSASSIN_DO_POWER_RANGE
	ApproachRequiresLOS		= Yes
	SpecialWeapon			= LegendsCreateAHeroAssassinWeapon
	WhichSpecialWeapon		= 5
	LoseStealthOnTrigger		= Yes
	PreTriggerUnstealthTime		= 2100
End
END

ReplaceModule ModuleTag_CreateAHeroAssassinUpdate_Level4
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAssassinUpdate_Level4New
	SpecialPowerTemplate = SpecialAbilityCreateAHeroAssassin_Level4
	UnpackTime			= 2000
	PackTime			= 2000	
	AwardXPForTriggering		= 0
	StartAbilityRange		= CREATE_A_HERO_ASSASSIN_DO_POWER_RANGE
	ApproachRequiresLOS		= Yes
	SpecialWeapon			= LegendsCreateAHeroAssassinWeapon
	WhichSpecialWeapon		= 5
	LoseStealthOnTrigger		= Yes
	PreTriggerUnstealthTime		= 2100
End
END

;----------------- FIXED RANGE WIZARD BLAST --------------------

ReplaceModule ModuleTag_ForcePushUpdate_Level1
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ForcePushUpdate_Level1New
		SpecialPowerTemplate	= SpecialAbilityForcePush_Level1
		WhichSpecialWeapon	= 2
		SkipContinue		= Yes	

		UnpackTime		= 900
		PreparationTime		= 1   
		PersistentPrepTime	= 1500	
		PackTime		= 1100	

		AwardXPForTriggering	= 0	 
		StartAbilityRange	= 50.0	;100 buggy EA
		MustFinishAbility	= Yes
		SpecialWeapon		= ForcePush_Level1
	End
END

ReplaceModule ModuleTag_ForcePushUpdate_Level2
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ForcePushUpdate_Level2New
		SpecialPowerTemplate	= SpecialAbilityForcePush_Level2
		WhichSpecialWeapon	= 2
		SkipContinue		= Yes

		UnpackTime		= 900
		PreparationTime		= 1   
		PersistentPrepTime	= 1500	
		PackTime		= 1100	

		AwardXPForTriggering	= 0	 
		StartAbilityRange	= 70.0	;180 buggy EA
		MustFinishAbility	= Yes
		SpecialWeapon		= ForcePush_Level2
	End
END

ReplaceModule ModuleTag_ForcePushUpdate_Level3
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ForcePushUpdate_Level3New
		SpecialPowerTemplate	= SpecialAbilityForcePush_Level3
		WhichSpecialWeapon	= 2
		SkipContinue		= Yes	

		UnpackTime		= 900
		PreparationTime		= 1   
		PersistentPrepTime	= 1500	
		PackTime		= 1100	

		AwardXPForTriggering	= 0	 
		StartAbilityRange	= 70.0	;180 buggy EA
		MustFinishAbility	= Yes
		SpecialWeapon		= ForcePush_Level3
	End
END


;------------------- Light Blast (dunno what i changed here, check it later) -------------------


ReplaceModule ModuleTag_LightBlastPower_L1_Update
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LightBlastPower_L1_UpdateFixed
	SpecialPowerTemplate = SpecialAbilityLightBlast_L1
	SkipContinue		 = Yes
	UnpackTime		 = 2000	
	PreparationTime		 = 1  
	PersistentPrepTime	 = 2000
	PackTime		 = 500
	AwardXPForTriggering	 = 0
	StartAbilityRange	 = 180
	ApproachRequiresLOS	 = Yes		 
	SpecialWeapon		 = CreateAHeroLightBlastWeapon_L1
	MustFinishAbility	 = Yes
	WhichSpecialWeapon	 = 3
	BusyForDuration		 = 2500
End
END
ReplaceModule ModuleTag_LightBlastPower_L2_Update
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LightBlastPower_L2_UpdateFixed
	SpecialPowerTemplate = SpecialAbilityLightBlast_L2
	SkipContinue		 = Yes
	UnpackTime		 = 2000	
	PreparationTime		 = 1  
	PersistentPrepTime	 = 2000
	PackTime		 = 500
	AwardXPForTriggering	 = 0
	StartAbilityRange	 = 180
	ApproachRequiresLOS	 = Yes		 
	SpecialWeapon		 = CreateAHeroLightBlastWeapon_L2
	MustFinishAbility	 = Yes
	WhichSpecialWeapon	 = 3
	BusyForDuration		 = 2500
End
END	
ReplaceModule ModuleTag_LightBlastPower_L3_Update
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LightBlastPower_L3_UpdateFixed
	SpecialPowerTemplate = SpecialAbilityLightBlast_L3
	SkipContinue		 = Yes
	UnpackTime		 = 2000	
	PreparationTime		 = 1  
	PersistentPrepTime	 = 2000
	PackTime		 = 500
	AwardXPForTriggering	 = 0
	StartAbilityRange	 = 180
	ApproachRequiresLOS	 = Yes		 
	SpecialWeapon		 = CreateAHeroLightBlastWeapon_L3
	MustFinishAbility	 = Yes
	WhichSpecialWeapon	 = 3
	BusyForDuration		 = 2500
End
END

;------------------  LEGENDS' SUMMON LV1 ----------------------

AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsSummonLv1
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv1
	TriggeredBy		= Upgrade_CreateAHeroHotWSummonAllies_Level1 Upgrade_CreateAHeroSoSSummonAllies_Level1
End
END
AddModule
Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsSummonLv1
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv1
	OCL			= OCL_LegendsSummonLv1
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End
END

;------------------  LEGENDS' SUMMON LV2 ----------------------
AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsSummonLv2
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv2
	TriggeredBy		= Upgrade_CreateAHeroHotWSummonAllies_Level2 Upgrade_CreateAHeroSoSSummonAllies_Level2
End
END
AddModule
Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsSummonLv2
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv2
	OCL			= OCL_LegendsSummonLv2
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End
END

;------------------  LEGENDS' SUMMON LV3 ----------------------
AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsSummonLv3
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv3
	TriggeredBy		= Upgrade_CreateAHeroHotWSummonAllies_Level2 Upgrade_CreateAHeroSoSSummonAllies_Level3
End
END
AddModule
Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsSummonLv3
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv3
	OCL			= OCL_LegendsSummonLv3
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End
END

;------------------  LEGENDS' SUMMON LV4 ----------------------
AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsSummonLv4
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv4
	TriggeredBy		= Upgrade_CreateAHeroHotWSummonAllies_Level2 Upgrade_CreateAHeroSoSSummonAllies_Level4
End
END
AddModule
Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsSummonLv4
	SpecialPowerTemplate	= SpecialAbilityLegendsSummonLv4
	OCL			= OCL_LegendsSummonLv4
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End


END





;-----------------------------------------------------------------





;The following modules allow CaHs to be affected by my custom Upgrades, and gives them the appropiate bonus

;------------------- Poison Reagent --------------------------------

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_PoisonReagentDamage
	TriggeredBy 		= Upgrade_CreateAHeroPoisonAttack_Level4
	AttributeModifier 	= PoisonReagentBonus
	End
  END

;------------------- POTION OF INVULNERABILITY ----------------------

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_InvulnerabilityPotion
	TriggeredBy 		= Upgrade_UseInvulnerability
	AttributeModifier 	= CreateAHeroInvulnerabilityBonus_Level1
	End
  END

;------------------- BLADERUNE ----------------------


ReplaceModule ModuleTag_ElvenGiftBonus
	Behavior = AttributeModifierUpgrade ModuleTag_LegendsElvenGiftBonus
		TriggeredBy		=	Upgrade_ElvenGift
		AttributeModifier	=	LegendsGerardeBladerune
	End
END

;------------------- STONE OF THE HERMIT ----------------------


AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_StoneOfTheHermitBonus
		TriggeredBy		=	Upgrade_HermitsStoneUpgrade
		AttributeModifier 	=	HermitsStone
	End
END

;------------------- ARMOR L1 ----------------------

  AddModule ModuleTag_ImprovedArmorL1
	Behavior = AttributeModifierUpgrade ModuleTag_ImprovedArmorL1
		TriggeredBy		=	Upgrade_ImprovedArmorL1Upgrade
		AttributeModifier	=	ImprovedArmorL1Bonus
	End
  END

;------------------- ARMOR L2 ----------------------

  AddModule ModuleTag_ImprovedArmorL2
	Behavior = AttributeModifierUpgrade ModuleTag_ImprovedArmorL2
		TriggeredBy		=	Upgrade_ImprovedArmorL2Upgrade
		AttributeModifier	=	ImprovedArmorL2Bonus
	End
  END

;------------------- BOOTS OF SPEED ----------------------

  AddModule ModuleTag_BootsOfSpeed
	Behavior = AttributeModifierUpgrade ModuleTag_BootsOfSpeed
		TriggeredBy		=	Upgrade_BootsOfSpeedUpgrade
		AttributeModifier	=	BootsOfSpeedBonus
	End
  END

;------------------- TALISMAN OF DEADLY RAGE ----------------------

  AddModule ModuleTag_TalismanOfDeadlyRage
	Behavior = AttributeModifierUpgrade ModuleTag_TalismanOfDeadlyRage
		TriggeredBy		=	Upgrade_TalismanOfDeadlyRageUpgrade
		AttributeModifier	=	TalismanOfDeadlyRageBonus
	End
  END

;------------------- BLUEMOON HEARTSTONE ----------------------

  AddModule ModuleTag_BluemoonHeartstone
	Behavior = AttributeModifierUpgrade ModuleTag_BluemoonHeartstone
		TriggeredBy		=	Upgrade_BluemoonHeartstoneUpgrade
		AttributeModifier	=	BluemoonHeartstoneBonus
	End
  END

END



;-------------------------------------------------------------
;(009) FACTION CONFIG (No builders and assign custom spellbook)
;-------------------------------------------------------------

PlayerTemplate FactionMen
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
SpellBookMp = LegendsSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionElves
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
SpellBookMp = LegendsSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionDwarves
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
SpellBookMp = LegendsSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionIsengard
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
SpellBookMp = LegendsSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionMordor
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
SpellBookMp = LegendsSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionWild
SpellBookMp = LegendsSpellBook
IntrinsicSciencesMP = SCIENCE_GOOD
PurchaseScienceCommandSetMP = LegendsSpellStoreCommandSet
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End



;------------------------------
;(010) ENVIRONMENT
;------------------------------

WaterTransparency
  ReflectionPlaneZ = 167.0
  ReflectionOn = Yes
End

Weather
  HardwareFogColor = R:160 G:166 B:191
  HardwareFogEnable = Yes
  HardwareFogStart = 500
  HardwareFogEnd = 1900
  SnowEnabled = yes              ; enable/disable snow on the map.
  IsSnowing = no ; is it snowing today?
  SnowTexture = EXRainDrop.tga   ; texture used for each snow particle.
  SnowBoxHeight = 550            ; height from which snow falls
  SnowSpacing = 40               ; snow spacing -- less means more
  NumberTiles = 6
  SnowAmplitude = 0             ; amount of side-to-side movement.
  SnowFrequencyScaleX = 0        ; speed of side-to-side wave movement.
  SnowFrequencyScaleY = 0        ; speed of side-to-side wave movement.
  SnowSpeed = 300.0              ; speed at which snow falls
  SnowXYSpeed = X:10.0 Y:10.0         ; xy speed of snow
  SnowPointSize = 4              ; scale the size of snow particles.
  SnowMinPointSize = 40          ; min point size
  SnowMaxPointSize = 80          ; max point size
  SnowPointSprites = no          ; set to "no" for point-sprite emulation.
  SnowQuadSize = 10              ; scale the size of snow particles when using point-sprite emulation.
  SpellEnabled = yes             ; enable/disable spell
  SpellDuration = 50            ; duration of spell
  RampControl = X:0.2 Y:0.8      ; ramp fade in and out points (0, 1) relative to spell duration
  RampSpeed = X:150.0 Y:250.0     ; ramp min and max speed
  RampSpacing = X:20.0 Y:20.0    ; ramp min and max rain spacing; less means more rain
  CloudTextureSize = X:660.0 Y:660.0    ; size in world units that one repetition of the cloud texture spans
  CloudOffsetPerSecond = X:-0.012 Y:-0.018; offset in texture units that the cloud texture moves per second
End





;-------------------------------------------
;(011) Special retexturing
;-------------------------------------------

;lmtext.tga is black image

;HouseColor
;	BaseTexture	= exstar.tga
;	HouseTexture	= exstransparent.tga	; It shows a big solid square, nothing transparent
;END

HouseColor
	BaseTexture	= rugimli.tga
	HouseTexture	= rugimli.tga		; Rhakid's party Dwarf
END

HouseColor
	BaseTexture	= mudrmtroll.tga
	HouseTexture	= mudrmtroll.tga	; Rhakid's party Half-troll
END

HouseColor
	BaseTexture	= muharadim_ha.tga
	HouseTexture	= muharadim_ha.tga	; Rhakid's party Archer
END

HouseColor
	BaseTexture	= gugwaihir.tga
	HouseTexture	= gugwaihir_white.tga	; Aegion's white Hawk
END

HouseColor ;High res Ranger Retexture
	BaseTexture	= GURanger.tga
	HouseTexture	= Guranger_gry.tga
End

HouseColor
	BaseTexture	= IUWargFur_A.tga
	HouseTexture	= IUWargFur_C.tga
End

HouseColor
	BaseTexture	= IUWarg_A.tga
	HouseTexture	= IUWarg_C.tga
End

HouseColor
	BaseTexture	= IUWarg_AL.tga
	HouseTexture	= IUWarg_C.tga
End

HouseColor ;Gondor Archers, so they don't show any particular house color
	BaseTexture	= GUArcher.tga
	HouseTexture	= GUArcher.tga
End

HouseColor ;Gondor Archers Heavy Armor
	BaseTexture	= GUArcher_HA.tga
	HouseTexture	= GUArcher_HA.tga
End

HouseColor ;Gondor Soldiers, so they don't show any particular house color
	BaseTexture	= GUManAtArms.tga
	HouseTexture	= GUManAtArms.tga
End

HouseColor ; Gondor Soldiers Heavy Armor, so they don't show any particular house color
	BaseTexture	= GUManAtArms_HA.tga
	HouseTexture	= GUManAtArms_HA.tga
End

HouseColor ;Gondor Soldiers Special Black Shield! It's fun messing around texture changes
	BaseTexture	= GUMAArmsshield.tga
	HouseTexture	= Hero_Ise01.tga
End

HouseColor ; Stone Mountain Troll
	BaseTexture	= MUMntTroll.tga
	HouseTexture	= Hero_Ise01.tga ; or use bbmtn.tga
End

HouseColor ;Stone MountainGiant
	BaseTexture	= WUMntGiant.tga
	HouseTexture	= Hero_Ise01.tga ; or use bbmtn.tga
End

HouseColor ;Stone MountainGiant
	BaseTexture	= WUMntGiant_C.tga
	HouseTexture	= Hero_Ise01.tga ; or use bbmtn.tga
End

HouseColor ; Saruman is now a ghost
	BaseTexture	= iusaruman.tga
	HouseTexture	= iusarumanstatu01.tga
End

HouseColor ;spider black reskin
	BaseTexture	= mugntspdr.tga
	HouseTexture	= muspider_c.tga
End

HouseColor ;Banner carrier reskin (not workin)
	BaseTexture	= mugntspdrbannercarrier.tga
	HouseTexture	= mugntspdr.tga
End

HouseColor ;SHELOB reskin
	BaseTexture	= mushelobh.tga
	HouseTexture	= mugntspdrbannercarrier.tga
End

HouseColor
	BaseTexture	= GUTowrGrd.tga
	HouseTexture	= GUTowrGrd.tga
End

HouseColor
	BaseTexture	= GUTowrGrd_L.tga
	HouseTexture	= GUTowrGrd_L.tga
End

HouseColor
	BaseTexture	= GUTowrGrd_HA.tga
	HouseTexture	= GUTowrGrd_HA.tga
End



;---------------------------------------
;(012) TREASURE DROPS
;---------------------------------------

Object TreasureChest1

ReplaceModule ModuleTag_02
  Behavior = SalvageCrateCollide ModuleTag_02New
   	ForbiddenKindOf		= PROJECTILE ENVIRONMENT IGNORED_IN_GUI NEUTRALGOLLUM
   	BannerChance		= 0%   
    	LevelUpChance		= 0%
    	LevelUpRadius		= 100.0	
    	ResourceChance		= 100%
    	MinResource		= 160
    	MaxResource		= 200
    	AllowAIPickup		= No		;Yes
	ExecuteFX = FX_GoldChestPickup
  End
END

END

ObjectCreationList OCL_BossChest
	CreateObject
		ObjectNames				= TreasureChest1
		Count					= 3
		SpreadFormation				= Yes
		MinDistanceAFormation			= 0.0
		MinDistanceBFormation			= 40.0
		MaxDistanceFormation			= 65.0
		FadeIn					= No
;		Disposition				= SPAWN_AROUND
;		DispositionAngle			= 60	;SpawnAround uses this as the arc between guys
;		DispositionIntensity			= 100	;and this for distance from center
		IgnoreAllObjects			= Yes
		InvulnerableTime			= 3000	; This is the amount of time before we can pick this crate up.
	End
End

Object WildShelob ; THE QUEEN DROPS GOLD
	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
		CreationList			= OCL_BossChest
	  End
	End
END

Object IsengardWargRiderBanner
	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeLoadsOfTreasure
		CreationList			= OCL_SpawnRefugeeTreasure
	  End
	End
END

Object WildBannerMarauder ; MARAUDER LEADER TREASURE SPAWN
	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeLoadsOfTreasure
		CreationList			= OCL_SpawnRefugeeTreasure
	  End
	End
END

Object WildBannerSpiderling ; SPIDER LEADER TREASURE SPAWN
	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeLoadsOfTreasure
		CreationList			= OCL_SpawnRefugeeTreasure
	  End
	End
END

Object WildBannerGoblin ; GOBLIN LEADER TREASURE SPAWN
	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeLoadsOfTreasure
		CreationList			= OCL_SpawnRefugeeTreasure
	  End
	End
END
















;-------------------------------------------------------------------
;                         ARCH MAGIC GOLEM
;-------------------------------------------------------------------

;-------- Summoning animation and egg ----------


FXParticleSystem GolemSummonWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXEclipseBlur.tga ;EXRing01.tga
    Lifetime = 25 25
    SystemLifetime = 155
    SortLevel = 1
    Size = 300 300
    StartSizeRate = 1 1
    BurstDelay = 8 8
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:239 G:148 B:50 10
    Color3 = R:0 G:0 B:0 22
    ColorScale = -20 20
  End
  Update = DefaultUpdate
    SizeRate = -5 -5
    SizeRateDamping = 1.05 1.05
    AngleZ = -180 180
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -4 -4
    OtherSpeed = -4 -4
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:0 Z:-8
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemSummonLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXexplo01.tga
    Lifetime = 20 30
    SystemLifetime = 10
    SortLevel = 1
    Size = 5 5
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:255 G:165 B:90 0
    Color2 = R:0 G:0 B:0 30
  End
  Update = DefaultUpdate
    SizeRate = 30 90
    SizeRateDamping = 0.8 0.7
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemSummonGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 240 250
    SystemLifetime = 1
    Size = 20 30
    BurstCount = 3 3
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:255 G:160 B:90 40
    Color3 = R:0 G:0 B:0 250
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.03
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 50
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemSummonHeat
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 20 40
    SystemLifetime = 20
    Size = 80 80
    BurstCount = 1 1
    IsGroundAligned = Yes
;    ShroudEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -0.015 0.015
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
;    IsHollow = Yes
    Radius = 120
    Length = 1
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemSummonCore
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 2 2
    SystemLifetime = 210
    SortLevel = 1
    Size = 20 24
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:98 G:69 B:51 0
    Color2 = R:90 G:56 B:37 3
    Color3 = R:0 G:0 B:0 7
  End
  Update = DefaultUpdate
    SizeRate = -1 -1
    SizeRateDamping = 0.99 0.99
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = 0.16
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
;    Z			= 1 2
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
;    Offset		= X:0 Y:0 Z:35
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    SpeedMultiplier = 1
  End
End


FXParticleSystem GolemSummonChunks
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 210 210
    SystemLifetime	= 30
    Size		= 0.15 1.2
    BurstDelay		= 3 4
    BurstCount		= 5 8
  End
  Color			= DefaultColor
    Color1		= R:255 G:170 B:55 0
    Color2		= R:63 G:63 B:63 120
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0 0 0
    Alpha2		= 1 1 5
    Alpha3		= 0 0 210
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
    AngleZ		= -500 500
    AngularRateZ	= -0.02 0.02
    AngularDamping	= 1 1
    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    VelocityDamping	= 0.98 0.99
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
    Z			= 0.2 1.2
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 65
    Length		= 5
    Offset		= X:0 Y:0 Z:0
  End
  Draw = RenderObjectDraw
  End
End


FXParticleSystem GolemSummonChunksSmall
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= ALPHA_TEST
    ParticleName	= EXDirt.tga
    Lifetime		= 85 95
    SystemLifetime	= 230
    Size		= 30 45
    BurstDelay		= 3 4
    BurstCount		= 2 3
  End
  Color			= DefaultColor
    Color1		= R:73 G:73 B:63 0
    Color2		= R:0 G:0 B:0 70
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0.6 0.6 0
  End
  Update		= DefaultUpdate
    SizeRate		= 2 3
    SizeRateDamping	= 0.8 0.85
    AngleZ		= -0.1 0.1
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= 0.1
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 100
    Length		= 5
    Offset		= X:0 Y:0 Z:0
  End
  Draw			= DefaultDraw
  End
End

FXParticleSystem GolemSummoningDust
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCloudTrailDust.tga
    Lifetime = 120 120
    SystemLifetime = 140
    SortLevel = 1
    Size = 5 7
    BurstDelay = 2 2
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:186 G:158 B:141 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.45 0.55 0
    Alpha2 = 0 0 90
  End
  Update = DefaultUpdate
    SizeRate = 1 2
    SizeRateDamping = 0.99 0.99
    AngleZ = -0.5 0.5
    AngularRateZ = -0.1 0.1
    AngularDamping = 0.9 0.9
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.03
    VelocityDamping = 0.75 0.8
    DriftVelocity = X:0.4 Y:0 Z:0
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 8
    Length = 4
  End
  Draw = DefaultDraw
  End
End



FXList FX_GolemSummoningStart
	ParticleSystem 
		Name = GolemSummonWave
		Offset = X:0.0 Y:0.0 Z:35
	End
	ParticleSystem 
		Name = GolemSummonLight
		Offset = X:0.0 Y:0.0 Z:10
	End
	ParticleSystem 
		Name = GolemSummonGlow
		Offset = X:0.0 Y:0.0 Z:10
	End
	ParticleSystem 
		Name = GolemSummonHeat
		Offset = X:0.0 Y:0.0 Z:20
	End
	ParticleSystem 
		Name = GolemSummonCore
		Offset = X:0.0 Y:0.0 Z:35
	End
	ParticleSystem 
		Name = GolemSummonChunks
		Offset = X:0.0 Y:0.0 Z:1.5
	End
	ParticleSystem 
		Name = GolemSummonChunksSmall
		Offset = X:0.0 Y:0.0 Z:1.5
	End
	ParticleSystem 
		Name = GolemSummoningDust
		Offset = X:0.0 Y:0.0 Z:1
	End
       CameraShakerVolume
          Radius = 800
          Duration_Seconds = 12
          Amplitude_Degrees = 0.3
       End
  Sound
    Name = SpellSunflareMS
  End
END



FXParticleSystem GolemSummonFinishLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXexplo01.tga
    Lifetime = 40 40
    SystemLifetime = 8
    SortLevel = 1
    Size = 7 7
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:255 G:160 B:90 0
    Color2 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 80 160
    SizeRateDamping = 0.8 0.7
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemSummonFinishHeat
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 60 90
    SystemLifetime = 30
    Size = 80 80
    BurstCount = 2 3
    IsGroundAligned = Yes
;    ShroudEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -0.015 0.015
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
;    IsHollow = Yes
    Radius = 120
    Length = 1
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemChunkHitGroundParticles		; When the rocks hit the ground. Nuts.
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 100 100
    SystemLifetime = 1
    SortLevel = 1
    Size = 9 13
    BurstCount = 5 5
  End
  Color = DefaultColor
    Color1 = R:160 G:145 B:130 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.5 0.75 0
    Alpha2 = -2 0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics

    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:0.08
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 4
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemChunkHitGround
	ParticleSystem 
		Name = GolemChunkHitGroundParticles
		Offset = X:0.0 Y:0.0 Z:5
	End
END

FXParticleSystem GolemSummonFinishChunks
  System
    Priority		= MEDIUM_OR_ABOVE
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 120 120
    SystemLifetime	= 15
    Size		= 0.15 0.9
    BurstDelay		= 2 2
    BurstCount		= 12 14
  End
  Color			= DefaultColor
    Color1		= R:255 G:170 B:55 0
    Color2		= R:63 G:63 B:63 120
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0 0 0
    Alpha2		= 1 1 5
    Alpha3		= 0.7 0.7 90
    Alpha3		= 0 0 120
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
    AngleZ		= -500 500
    AngularRateZ	= -0.02 0.02
    AngularDamping	= 1 1
    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= -0.1
    VelocityDamping	= 1 1
  End
  EmissionVolume	= CylinderEmissionVolume
    IsHollow		= Yes
    Radius		= 15
    Length		= 58
    Offset		= X:0 Y:0 Z:0
  End
;  EmissionVelocity	= OrthoEmissionVelocity
;    X = -3 3
;    Y = -3 3
;    Z = 1.2 2.5
;  END
  EmissionVelocity	= CylindricalEmissionVelocity
	Radial		= 2 3.5
	Normal		= 2 4
  End
  Draw = RenderObjectDraw
  End
  Event = TerrainCollision
    HeightOffset = 0 0
    EventFX = FX_GolemChunkHitGround
;    OrientFXToTerrain = Yes
    PerParticle = Yes
;    KillAfterEvent = Yes
  End
End


FXList FX_GolemSummonFinish
	ParticleSystem 
		Name = GolemSummonFinishLight
		Offset = X:0.0 Y:0.0 Z:20
	End
	ParticleSystem 
		Name = GolemSummonFinishHeat
		Offset = X:0.0 Y:0.0 Z:20
	End
	ParticleSystem 
		Name = GolemSummonFinishChunks
		Offset = X:0.0 Y:0.0 Z:5
	End
       ViewShake
          Type = CINE_EXTREME
       End
       CameraShakerVolume
          Radius = 800
          Duration_Seconds = 3
          Amplitude_Degrees = 0.5
       End
  Sound
    Name = GandalfBlastWeapon
  End
END



ObjectCreationList OCL_Golem
	CreateObject
		ObjectNames = CINE_AttackTroll
		Count = 1
		FadeIn = Yes
		IgnoreCommandPointLimit = Yes
		FadeTime = 3000
		Disposition = ABSOLUTE_ANGLE
		DispositionAngle		= -120
	End
End

Object WildFireDrakeEgg

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_SpawnGolem
		DestructionDelay = 7000		
		FX		= INITIAL FX_GolemSummoningStart
		FX		= FINAL FX_GolemSummonFinish
		OCL		= FINAL OCL_Golem
;        	Weapon		= FINAL GolemSpawnShockWave
	End
End

END






;---------- Golem rock limbs ------------


FXParticleSystem GolemCore
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 2 2
    SortLevel = 1
    Size = 20 20
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:98 G:69 B:51 0
    Color2 = R:90 G:56 B:37 3
    Color3 = R:0 G:0 B:0 7
  End
  Update = DefaultUpdate
    SizeRate = -1 -1
    SizeRateDamping = 0.99 0.99
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.16
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    SpeedMultiplier = 1
  End
End


FXParticleSystem GolemRockPieceShoulder
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground01.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 1.75 1.75
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceElbows
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 0.8 0.8
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceHand
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 1.1 1.1
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 0
    Length		= 0
    Offset = X:0 Y:0 Z:-5	
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceThumb1
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 0.35 0.35
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceThumb2
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 0.25 0.25
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceThigh
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 1.05 1.05
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceKnee
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 0.8 0.8
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem GolemRockPieceFoot
  System
    Priority		= ALWAYS_RENDER
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground01.w3d
    Lifetime		= 5 5
;    SystemLifetime	= 10
    Size		= 1.3 1.3
    BurstDelay		= 1 1
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 5
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 1 1 4
    Alpha2		= 0 0 5
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
;    AngleZ		= -500 500
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
;    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
;    Gravity		= -0.2
    ParticlesAttachToBone = Yes
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
;    Z			= -0.2 -0.3
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End

;------------------------ end rock parts

FXParticleSystem GolemFootDust
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 100 100
    SystemLifetime = 1
    SortLevel = 1
    Size = 9 13
    BurstCount = 5 5
  End
  Color = DefaultColor
    Color1 = R:160 G:145 B:130 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.5 0.75 0
    Alpha2 = -2 0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics

    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:0.08
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 4
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemFootStep
	ParticleSystem
		Name = GolemFootDust
	End
	ParticleSystem
		Name = MumakilFootSplash
		OnlyIfOnWater = Yes
	End
    DynamicDecal
		DecalName		= SCCTrollFoot
		Size			= 24
		Color			= R:128 G:128 B:128

		OpacityStart		= 0
		OpacityFadeTimeOne	= 500
		OpacityPeak		= 255
		OpacityPeakTime		= 255
		OpacityFadeTimeTwo	= 28000
		OpacityEnd		= 0

		StartingDelay		= 0
		Lifetime		= 29000
	End
       ViewShake
          Type = NORMAL
       End
End


FXList FX_GolemRightFootStep
	FXListAtBonePos
		FX = FX_GolemFootStep
		BoneName = B_FOOTR
;		Weather = NORMAL
	End
	Sound
		Name = BalrogFootstep
	END
End

FXList FX_GolemLeftFootStep
	FXListAtBonePos
		FX = FX_GolemFootStep
		BoneName = B_FOOTL
;		Weather = NORMAL
	End
	Sound
		Name = BalrogFootstep
	END
End



SpecialPower SpecialAbilityRockSmasher
	Enum						   = SPECIAL_GENERAL_TARGETLESS ;SPECIAL_KNIFE_ATTACK
	ReloadTime					   = 40000
End

SpecialPower SpecialAbilityUltima
	Enum						   = SPECIAL_WORD_OF_POWER
	ReloadTime					   = 60000
End

CommandButton RockSmash
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityRockSmasher
;	Options			= NEED_TARGET_ENEMY_OBJECT CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:LegendsRockSmash
	DescriptLabel		= CONTROLBAR:TooltipLegendsRockSmash
    	ButtonBorderType	= ACTION
;	CursorName              = EvilAbilityObj
;	InvalidCursorName       = StabAttackInvalid
	InPalantir		= Yes
End

CommandButton Ultima
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityUltima
	TextLabel               = CONTROLBAR:Ultima
	DescriptLabel           = CONTROLBAR:ToolTipUltima
	ButtonImage             = Gandolf_radcircle
	ButtonBorderType        = ACTION
	PresetRange		= 60.0
	InPalantir		= Yes
End

CommandSet GolemCommandSet
	1	= Command_ToggleStance	
	2	= RockSmash
	3	= Ultima
	13	= Command_AttackMove
	14	= Command_Stop
End

;--------------------------------------------
; Golem's Special ability stuff

FXParticleSystem PreUltimaWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXEclipseBlur.tga ;EXRing01.tga
    Lifetime = 25 25
    SystemLifetime = 45
    SortLevel = 1
    Size = 400 400
    StartSizeRate = 1 1
    BurstDelay = 8 8
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:239 G:148 B:50 10
    Color3 = R:0 G:0 B:0 22
    ColorScale = -20 20
  End
  Update = DefaultUpdate
    SizeRate = -10 -10
    SizeRateDamping = 1.05 1.05
    AngleZ = -180 180
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -4 -4
    OtherSpeed = -4 -4
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:0 Z:-8
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem PreUltimaCenter
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar1.tga
    Lifetime = 40 40
    SystemLifetime = 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 5 5
    BurstCount = 1 1
    InitialDelay = 20 20
  End
  Color = DefaultColor
    Color2 = R:255 G:208 B:0 20
    Color3 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 1.03 1.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:8
    EndPoint = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem PreUltimaVortex
  System
    Priority = LOW_OR_ABOVE
    ParticleName = EXLnzFlar2.tga
    Lifetime = 40 40
    SystemLifetime = 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 1 1
    BurstCount = 20 20
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:255 G:200 B:120 5
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1.1 1.1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -0.4 -0.4
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 240
    Length = 16
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem PreUltimaHeat
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 25 25
    SystemLifetime = 25
    Size = 9 9
    BurstCount = 2 3
    InitialDelay = 15 15
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 3 3
    SizeRateDamping = 1 1
    AngleZ = 0.01 0.02
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial = 1 2
    Normal = 1 1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 32
    Length = 50
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemPreUltima
  ParticleSystem
    Name = PreUltimaWave
    Offset = X:0.0 Y:0.0 Z:34.0
  End
  ParticleSystem
    Name = PreUltimaCenter
    Offset = X:0.0 Y:0.0 Z:34.0
  End
  ParticleSystem
    Name = PreUltimaVortex
    Offset = X:0.0 Y:0.0 Z:34.0
  End
  ParticleSystem
    Name = PreUltimaHeat
    Offset = X:0.0 Y:0.0 Z:18.0
  End
       CameraShakerVolume
          Radius = 700
          Duration_Seconds = 4
          Amplitude_Degrees = 0.15
       End
  Sound
    Name = GandalfLightningSummon
  End
End





FXParticleSystem UltimaLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXexplo01.tga
    Lifetime = 20 20
    SystemLifetime = 5
    SortLevel = 1
    Size = 10 10
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:0 G:0 B:0 20
  End
  Update = DefaultUpdate
    SizeRate = 80 160
    SizeRateDamping = 0.8 0.7
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem UltimaShockwave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXHPCorestar.tga ;EXRing01.tga
    Lifetime = 65 65
    SystemLifetime = 5
    SortLevel = 1
    Size = 1 1
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:190 B:120 0
    Color2 = R:0 G:0 B:0 65
    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 18 18
    SizeRateDamping = 0.99 0.99
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem UltimaGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 190 210
    SystemLifetime = 1
    Size = 20 30
    BurstCount = 6 6
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:255 G:160 B:90 40
    Color3 = R:0 G:0 B:0 210
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.03
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 50
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem UltimaFinalHeat
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 120 130
    SystemLifetime = 40
    Size = 80 80
    BurstCount = 2 3
    IsGroundAligned = Yes
;    ShroudEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -0.015 0.015
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
;    IsHollow = Yes
    Radius = 120
    Length = 1
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemUltima
  ParticleSystem
    Name = UltimaLight
    Offset = X:0.0 Y:0.0 Z:20
  End
  ParticleSystem
    Name = UltimaFinalHeat
    Offset = X:0.0 Y:0.0 Z:20
  End
  ParticleSystem
    Name = UltimaGlow
    Offset = X:0.0 Y:0.0 Z:10
  End
  ParticleSystem
    Name = UltimaShockwave
    Offset = X:0.0 Y:0.0 Z:24.0
  End
       CameraShakerVolume
          Radius = 700
          Duration_Seconds = 5
          Amplitude_Degrees = 0.35
       End
  Sound
    Name = SpellRainOfFirePlume; GandalfBlastWeapon
  End
End


Weapon GolemUltima
	IdleAfterFiringDelay	= 0
	AttackRange		= 40
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 40
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 601
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ENEMIES NEUTRALS ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots	= 5000
	PreAttackDelay		= 2900
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_GolemPreUltima
	FireFX			= FX_GolemUltima
	FiringDuration		= 1600

	DamageNugget
		Damage		= 1000	; 1200 was way too much?
		Radius		= 190.0
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 200.0
	End
	MetaImpactNugget                    ; A Nugget that throws things back with force
		ShockWaveAmount   = 75.0
		ShockWaveRadius   = 190.0
		ShockWaveTaperOff = 0.3
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 200.0 
	End
End


FXParticleSystem GolemSmashRocksDust
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 190 190
    SystemLifetime = 5
    SortLevel = 1
    Size = 29 32
    BurstCount = 7 9
  End
  Color = DefaultColor
    Color1 = R:160 G:145 B:130 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.5 0.75 0
    Alpha2 = -2 0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics

    VelocityDamping = 0.85 0.9
    DriftVelocity = X:0 Y:0 Z:0.08
  End
  EmissionVelocity	= CylindricalEmissionVelocity
    Radial = 1 3
    Normal = 2 3
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 12
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GolemRockSmashRocks
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground02.w3d
    Lifetime		= 90 90
    SystemLifetime	= 5
    Size		= 0.4 0.9
    BurstDelay		= 2 2
    BurstCount		= 16 22
  End
  Color			= DefaultColor
    Color1		= R:255 G:170 B:55 0
    Color2		= R:63 G:63 B:63 50
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 0.7 0.7 70
    Alpha2		= 0 0 90
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
    AngleZ		= -500 500
    AngularRateZ	= -0.2 0.2
    AngularDamping	= 1 1
    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= -0.2
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= CylindricalEmissionVelocity
    Radial = 2 4.5
    Normal = 2 3.5
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 10
    Length		= 5
    Offset		= X:0 Y:0 Z:0
  End
  Draw = RenderObjectDraw
  End
  Event = TerrainCollision
    HeightOffset = 0 0
    EventFX = FX_GolemChunkHitGround
;    OrientFXToTerrain = Yes
    PerParticle = Yes
;    KillAfterEvent = Yes
  End
End



FXList FX_GolemRockSmash
  ParticleSystem
    Name = GolemSmashRocksDust
    Offset = X:40.0 Y:0.0 Z:5.0
  End
  ParticleSystem
    Name = GolemRockSmashRocks
    Offset = X:40.0 Y:0.0 Z:0.0
  End
  ViewShake
    Type = CINE_EXTREME
  End
    DynamicDecal
		DecalName		= SCCCracks
		Size			= 75
		Color			= R:6 G:3 B:0
		Offset			= X:40 Y:0

		OpacityStart		= 0
		OpacityFadeTimeOne	= 700
		OpacityPeak		= 90
		OpacityPeakTime		= 255
		OpacityFadeTimeTwo	= 28000
		OpacityEnd		= 0

		StartingDelay		= 0
		Lifetime		= 29000
	End
  Sound
    Name = SpellBarrageImpactsMeteor
  End
End


Weapon GolemRockSmash
	IdleAfterFiringDelay	= 0
	AttackRange		= 30
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 40
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 601
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots	= 5000
	PreAttackDelay		= 1300
	PreAttackType		= PER_ATTACK
	FireFX			= FX_GolemRockSmash
	FiringDuration		= 1700

	DamageNugget
		Damage		= 1600
		DamageArc	= 110
		Radius		= 70.0
		DamageType	= SIEGE
		DamageFXType	= BIG_ROCK
		DeathType	= EXPLODED
		DamageSpeed	= 200.0
	End
	MetaImpactNugget                    ; A Nugget that throws things back with force
;		HeroResist	= .75
		ShockWaveAmount   = 75.0
		ShockWaveRadius   = 70.0
		ShockWaveArc      = 110
		ShockWaveTaperOff = 0.8
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 200.0 
	End
End


;-----------------------------------

FXParticleSystem GolemPunchWaves
  System
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 30 30
    SystemLifetime = 3
    SortLevel = 1
    Size = 2 5
    BurstCount = 4 6
  End
  Color = DefaultColor
    Color1 = R:199 G:183 B:154 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.75 0.75 0
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 4 15
    SizeRateDamping = 0.95 0.8
    AngleZ = -0.5 0.5
    AngularRateZ = -0.1 0.1
    AngularDamping = 0.98 0.98
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.9 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 2 4
    Y = 0 1
    Z = 0 1
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:-27 Z:0
    EndPoint = X:0 Y:27 Z:0
  End
  Draw = DefaultDraw
  End
End


FXList FX_GolemPunchHit
  Sound
    Name = ImpactCatapultRock
  End
  ParticleSystem
    Name = GolemPunchWaves
    Offset = X:45.0 Y:0.0 Z:25.0
    OrientToObject = Yes
  End
  ViewShake 
    Type = SEVERE
  End
End


Weapon GolemPunches
	ClearNuggets ;;.;;
	LeechRangeWeapon		= Yes
	RadiusDamageAffects		= ENEMIES
	MeleeWeapon			= Yes
	AttackRange			= 30
	FireFX				= FX_GolemPunchHit
	DelayBetweenShots		= 1800
	FiringDuration			= 1600
	PreAttackDelay			= 1100
	PreAttackType			= PER_SHOT
	PreAttackFX			= FX_TrollTreeSwing
	DamageDealtAtSelfPosition	= Yes
	AcceptableAimDelta		= 35.0 

	DamageNugget
		Damage			= 650	;1200 was too much
		Radius			= 80.0
		DamageArc		= 45
		DamageType		= SIEGE
		DamageFXType		= CLUBBING
		DeathType		= NORMAL
	End

	MetaImpactNugget
		ShockWaveAmount		= 40.0
		ShockWaveRadius		= 80.0
		ShockWaveTaperOff	= 0.50
		ShockWaveArc		= 45
		ShockWaveZMult		= 1.20
		HeroResist		= 0.7
	End
End




;-------------

Locomotor GolemLocomotor
	Surfaces                = GROUND RUBBLE
	TurnTime                = 4000
	TurnTimeDamaged         = 3000
	TurnThreshold           = 0		; small because monsters look awful rotating on the spot without playing an anim.
	TurnThresholdHS         = 120
	EnableHighSpeedTurnModelconditions = No

	Acceleration		= 200

	Braking			= 200
	MinTurnSpeed            = 0%
	FastTurnRadius		= 0 ; Can turn in a 10 foot radius circle when moving.
	SlowTurnRadius		= 0 ; Turns in place from a standing start.
	ChargeAvailable         = Yes
	ChargeSpeed             = 120%
	FormationPriority	= MELEE1

	ZAxisBehavior           = NO_Z_MOTIVE_FORCE
	Appearance              = HUGE_TWO_LEGS
	StickToGround           = Yes
End

;---------------------------------

FXParticleSystem GolemDieWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXEclipseBlur.tga ;EXRing01.tga
    Lifetime = 25 25
    SystemLifetime = 70
    SortLevel = 1
    Size = 300 300
    StartSizeRate = 1 1
    BurstDelay = 8 8
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:239 G:148 B:50 10
    Color3 = R:0 G:0 B:0 22
    ColorScale = -20 20
  End
  Update = DefaultUpdate
    SizeRate = -8 -7
    SizeRateDamping = 1.05 1.05
    AngleZ = -180 180
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -4 -4
    OtherSpeed = -4 -4
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:0 Z:-8
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemDieStart
	ParticleSystem 
		Name = GolemDieWave
		Offset = X:0.0 Y:0.0 Z:35
	End
	ParticleSystem 
		Name = GolemSummonLight
		Offset = X:0.0 Y:0.0 Z:10
	End

       CameraShakerVolume
          Radius = 700
          Duration_Seconds = 3
          Amplitude_Degrees = 0.4
       End
	Sound
		Name = GaladrielTerribleFurySFX
	END
END


FXList FX_GolemDieFinish
	ParticleSystem 
		Name = GolemSummonFinishLight
		Offset = X:0.0 Y:0.0 Z:20
	End
	ParticleSystem 
		Name = GolemSummonFinishHeat
		Offset = X:0.0 Y:0.0 Z:20
	End
	ParticleSystem 
		Name = GolemSummonFinishChunks
		Offset = X:0.0 Y:0.0 Z:5
	End
	ParticleSystem
		Name = UltimaShockwave
		Offset = X:0.0 Y:0.0 Z:24.0
	End
       ViewShake
          Type = CINE_EXTREME
       End
       CameraShakerVolume
          Radius = 1000
          Duration_Seconds = 5
          Amplitude_Degrees = 0.5
       End
  Sound
    Name = GandalfBlastWeapon
  End
END

;---------------------------------

FXList FX_GolemMagicHit
  ParticleSystem
    Name = SauronHitFlare
;    Offset = X:0.0 Y:0.0 Z:0.0
    AttachToObject	= Yes
    AttachToBone	= BAT_SPINE1
  End
End

DamageFX GolemDamageFX
  ThrottleTime = DEFAULT 10
  AmountForMajorFX  = DEFAULT  0.0
  MajorFX           = DEFAULT  FX_GolemMagicHit
End


;---------------------------------

Armor GolemArmor
	Armor = DEFAULT		10%
	Armor = SLASH		10%
	Armor = PIERCE		7%
	Armor = SPECIALIST	5%
	Armor = CRUSH		0%
	Armor = SIEGE           50%
	Armor = FLAME           0%
	Armor = LOGICAL_FIRE    0%
	Armor = MAGIC           50%
	Armor = HERO            10%	
	Armor = HERO_RANGED     10%
	Armor = STRUCTURAL	10%
	Armor = CAVALRY		10%
End


Object CINE_AttackTroll

	ShockwaveResistance	= 999

	ButtonImage	= WOR_AttackTroll

	SelectPortrait         = UPIsengard_Banner

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01
;		WadingParticleSys = EntRipples
		OkToChangeModelColor = Yes
		ExtraPublicBone = Trunk
		ShowShadowWhileContained = Yes
;		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model = MUAtkTroll_SKN

			ParticleSysBone = BAT_SPINE1 GolemCore FollowBone:Yes			; CORE

			ParticleSysBone = B_PINKYR1 GolemRockPieceThumb1 FollowBone:Yes		; Finger2 proximal
			ParticleSysBone = B_PINKYL1 GolemRockPieceThumb1 FollowBone:Yes		; Finger2 proximal
			ParticleSysBone = B_PINKYR2 GolemRockPieceThumb2 FollowBone:Yes		; Finger2 distal
			ParticleSysBone = B_PINKYL2 GolemRockPieceThumb2 FollowBone:Yes		; Finger2 distal

			ParticleSysBone = B_POINTERL1 GolemRockPieceThumb1 FollowBone:Yes	; Finger1 proximal
			ParticleSysBone = B_POINTERR1 GolemRockPieceThumb1 FollowBone:Yes	; Finger1 proximal
			ParticleSysBone = B_POINTERR2 GolemRockPieceThumb2 FollowBone:Yes	; Finger1 distal
			ParticleSysBone = B_POINTERL2 GolemRockPieceThumb2 FollowBone:Yes	; Finger1 distal

			ParticleSysBone = B_THUMBL2 GolemRockPieceThumb1 FollowBone:Yes		; Thumb proximal
			ParticleSysBone = B_THUMBR2 GolemRockPieceThumb1 FollowBone:Yes		; Thumb proximal
			ParticleSysBone = B_THUMBL2 GolemRockPieceThumb2 FollowBone:Yes		; Thumb distal
			ParticleSysBone = B_THUMBR2 GolemRockPieceThumb2 FollowBone:Yes		; Thumb distal

			ParticleSysBone = BAT_HANDL GolemRockPieceHand FollowBone:Yes		; Hands
			ParticleSysBone = BAT_HANDR GolemRockPieceHand FollowBone:Yes		; Hands

			ParticleSysBone = BAT_UARML GolemRockPieceShoulder FollowBone:Yes	; Shoulders
			ParticleSysBone = BAT_UARMR GolemRockPieceShoulder FollowBone:Yes	; SHoulders

			ParticleSysBone = BAT_FARMR GolemRockPieceElbows FollowBone:Yes		; ELBOWS
			ParticleSysBone = BAT_FARML GolemRockPieceElbows FollowBone:Yes		; ELBOWS

			ParticleSysBone = BAT_THIGHR GolemRockPieceThigh FollowBone:Yes		; Thigs
			ParticleSysBone = BAT_THIGHL GolemRockPieceThigh FollowBone:Yes		; Thigs

			ParticleSysBone = BAT_CALFR GolemRockPieceKnee FollowBone:Yes		; Knee
			ParticleSysBone = BAT_CALFL GolemRockPieceKnee FollowBone:Yes		; Knee

			ParticleSysBone = B_FOOTL GolemRockPieceFoot FollowBone:Yes		; Foot
			ParticleSysBone = B_FOOTR GolemRockPieceFoot FollowBone:Yes		; Foot
		End

;		ModelConditionState = DYING
;			Model = MUAtkTroll_SKN
;		End

		AnimationState = DYING
			Animation
				AnimationName     =  MUMntTroll_SKL.MUMntTroll_DIEB
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode				= LOOP
			End
		End

; ---------------- Just Spawned -------------------

		AnimationState			= USER_2
			StateName = State_JustBuilt
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLF ;GTPA
				AnimationMode = ONCE
				AnimationBlendTime = 0
				AnimationSpeedFactorRange	=	0.7 0.7
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

; ------------------------- Ultima Special move -------------------------

		AnimationState = SPECIAL_WEAPON_ONE
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLF ;EATA
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange	=	0.5 0.5
			End
		End


; ------------------------- Rock Smash Special Move ------------------------

		AnimationState = SPECIAL_WEAPON_TWO
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKA ;B
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
		End

; ------------------------- Attacking -------------------------

		AnimationState = FIRING_OR_PREATTACK_A
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKA ;B
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKH ;C
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKI ;B
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
		End

		;Running attack
		AnimationState = MOVING FIRING_OR_PREATTACK_B
			Animation

				AnimationName = MUMntTroll_SKL.MUMntTroll_ATRB
				AnimationMode = LOOP
				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange = 0.5 0.5
			End
		End
	
; ------------------------- Idle -------------------------	

		IdleAnimationState
			Animation = BreathWithClub
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLJ ;B
				AnimationMode = ONCE
				AnimationPriority = 30
				AnimationSpeedFactorRange = 0.6 0.7
			End
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End

; ------------------------- Moving -------------------------

		AnimationState = TURN_LEFT
			Animation = Moving
				AnimationName = MUMntTroll_SKL.MUMntTroll_TRNL
				AnimationMode = LOOP
				AnimationBlendTime = 5
				AnimationSpeedFactorRange = 0.6 0.6
			End
			ParticleSysBone = None InfantryDustTrails
			FXEvent	= Frame:0 FireWhenSkipped Name:FX_GolemRightFootStep
			FXEvent	= Frame:15 FireWhenSkipped Name:FX_GolemLeftFootStep
		End

		AnimationState = TURN_RIGHT
			Animation = Moving
				AnimationName = MUMntTroll_SKL.MUMntTroll_TRNR
				AnimationMode = LOOP
				AnimationBlendTime = 5
				AnimationSpeedFactorRange = 0.6 0.6
			End
			ParticleSysBone = None InfantryDustTrails
			FXEvent	= Frame:0 FireWhenSkipped Name:FX_GolemRightFootStep
			FXEvent	= Frame:15 FireWhenSkipped Name:FX_GolemLeftFootStep
		End


		AnimationState = MOVING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_WLKA	;RUNA
				AnimationMode = LOOP
				AnimationSpeedFactorRange = 0.6 0.6
			End
			Flags               = RANDOMSTART
			FXEvent	= Frame:0 FireWhenSkipped Name:FX_GolemRightFootStep
			FXEvent	= Frame:15 FireWhenSkipped Name:FX_GolemLeftFootStep
		End


		AnimationState = ENGAGED
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLJ	;IDLA
				AnimationMode = LOOP
			End
		End


		; --------- Click and Hit Reactions ------------

		AnimationState = HIT_REACTION HIT_LEVEL_1
			Animation = Hit_Level_1_a
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITE ;C
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End

		AnimationState = HIT_REACTION HIT_LEVEL_2
			Animation = Hit_Level_2
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITE ;B
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End

		AnimationState = HIT_REACTION HIT_LEVEL_3
			Animation = Hit_Level_3
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITE ;A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End


		;-----------------------------------
		;Emotion

		AnimationState = EMOTION_CELEBRATING
			Animation
				AnimationName	=	MUMntTroll_SKL.MUMntTroll_IDLF
				AnimationMode	=	LOOP
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End
		
		AnimationState					= EMOTION_TAUNTING
			Animation
				AnimationName			= MUMntTroll_SKL.MUMntTroll_IDLF ;A
				AnimationMode			= ONCE
				AnimationPriority		= 20
				AnimationSpeedFactorRange = 0.7 0.7
			End
		End

;		ModelConditionState = USER_4 
;			Model			= MUAtkTr2_SKN
;		End 		
	End
END

AddModule	
	Draw = W3DScriptedModelDraw DustEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    IdleAnimationState
	    End
	    AnimationState = MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState =  MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOUNTED MOVING
	    End
	End
END

;--------------------------- ULTIMA ------------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_UltimaStarter       
		SpecialPowerTemplate		= SpecialAbilityUltima
		UpdateModuleStartsAttack	= Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_UltimaWeaponFireUpdate   
		SpecialPowerTemplate	  	= SpecialAbilityUltima
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes
		UnpackTime			= 3200
		PreparationTime			= 0
		PackTime			= 3100	   
		FreezeAfterTriggerDuration	= 3000
		AwardXPForTriggering		= 0	   
		StartAbilityRange		= 80.0
		SpecialWeapon			= GolemUltima
		PlayWeaponPreFireFX		= Yes
	End
END

;-----------------------------------------------------------------------

;--------------------------- ROCK SMASH --------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_RockSmashStarters       
		SpecialPowerTemplate		= SpecialAbilityRockSmasher
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= SauronVoiceAttackMS
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RockSmashWeaponFireUpdates  
		SpecialPowerTemplate	  	= SpecialAbilityRockSmasher
		SkipContinue			= Yes

		UnpackTime			= 1000
		PreparationTime			= 0
		PackTime			= 1000	   
		FreezeAfterTriggerDuration	= 1000

		AwardXPForTriggering		= 0	   
		StartAbilityRange		= 40.0
		ApproachRequiresLOS		= Yes
		SpecialWeapon			= GolemRockSmash
		WhichSpecialWeapon		= 2
	End
END


;-----------------------------------------------------------------------

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_BuildHackUpgrade
		UpgradeToGrant				= Upgrade_TestBuilding
		GiveOnBuildComplete			= Yes
	End
END

AddModule
	Behavior = ModelConditionUpgrade ModuleTag_BuildHackUserFlag
		TriggeredBy				= Upgrade_TestBuilding
		RequiresAllTriggers			= Yes
		AddTempConditionFlag			= ModelConditionState:USER_2 ;For buildup animation
		TempConditionTime			= 4.8 ; Model condition fades afterwards
	End
END

;-----------------

	VoiceAttack		= SauronVoiceAttackMS
;	VoiceCreated		= +SOUND:CampOrcCreateSauronGlobal
;	VoiceFullyCreated 	= EVA:SauronCreated
;	VoiceFullyCreated	= +SOUND:CampOrcCreateSauronGlobal
	VoiceMove		= SauronVoiceMoveMS
	VoicePriority		= 94
	VoiceSelect		= SauronVoiceSelectMS
	VoiceGuard		= SauronVoiceMoveMS



AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_RemoveSubObject
	TriggeredBy			= Upgrade_GandalfWhite

	HideSubObjects		   = ATTACK_TROLL_ME	; Body
	HideSubObjects		   = OBJECT03		; Armor
	HideSubObjects		   = SKELETON
	HideSubObjects		   = TRUNK01		; Weapon
	HideSubObjects		   = TROLL


	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End




AddModule
	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	= Yes ATTACK_BUILDINGS
		AttackPriority			= AttackPriority_Cavalry
	End
END




	WeaponSet
		Conditions	= None
		Weapon		= PRIMARY     GolemPunches
	End

	ArmorSet
		Conditions      = None
		Armor           = GolemArmor
		DamageFX        = GolemDamageFX
	End

;	LocomotorSet
;		Locomotor	= GolemLocomotor
;		Condition	= USER_2		;(Didn't work)
;		Speed		= 0
;	End

	LocomotorSet
		Locomotor	= GolemLocomotor
		Condition	= SET_NORMAL 
		Speed		= 40
	End


	Scale			= 1.7

	VisionRange		= 90.0
	ShroudClearingRange	= 120
	DisplayName		= Arcane
	CrushableLevel		= 2
	CommandSet		= GolemCommandSet

	RadarPriority		= UNIT
	KindOf			= PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS MONSTER SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT ;NO_FREEWILL_ENTER
 
	BuildCost		= 5000
	BuildTime		= 70.0

AddModule
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 7500
		MaxHealthDamaged  = 2000
		RecoveryTime      = 5000
	End
END

AddModule
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
		HitReactionLifeTimer1 = 45 ; level 1 (light  damage)  hit reaction animations in frames (30 per sec)
		HitReactionLifeTimer2 = 90 ; level 2 (medium damage)  hit reaction animations in frames (30 per sec)
		HitReactionLifeTimer3 = 60 ; level 3 (heavy  damage)  hit reaction animations in frames (30 per sec)

		HitReactionThreshold1 = 10.0   ; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 25.0  ; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 50.0  ; level 3 (heavy  damage) threshold trigger
	End
END

AddModule
	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStandingTime = 12000	;msec
	End 
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_50
		DeathTypes		= ALL
		DestructionDelay	= 3800
		FX 			= INITIAL FX_GolemDieStart
		FX 			= FINAL FX_GolemDieFinish
		Sound			= INITIAL BalrogInjuredA_Part1
		Sound			= FINAL SpellUndermine
;		DeathFlags		= DEATH_1
	End
END

AddModule
	Behavior = SquishCollide ModuleTag_06
	End
END

	Geometry		= CYLINDER
	GeometryMajorRadius	= 30.6
	GeometryHeight		= 42.0
	GeometryIsSmall		= No
	Shadow			= SHADOW_VOLUME
	HealthBoxScale		= 2.0
	HealthBoxHeightOffset	= 20
End






;-------------------------------------------------------------------
;-------------------------------------------------------------------


;-----------------------
; Heroes' Statue
;-----------------------


FXParticleSystem StatueDieHeat
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 20 20
    SystemLifetime = 10
    Size = 9 9
    BurstCount = 2 3
    InitialDelay = 15 15
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 3 3
    SizeRateDamping = 1 1
    AngleZ = 0.01 0.02
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial = 1 2
    Normal = 1 1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 32
    Length = 50
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem StatueDieChunks
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    Type = DRAWABLE
    ParticleName = exground02.w3d
    Lifetime = 160 160
    SystemLifetime = 2
    Size = 0.3 1
    BurstCount = 16 20
  End
  Color = DefaultColor
    Color2 = R:30 G:30 B:30 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -500 500
    AngularRateZ = -0.5 0.5
    AngularDamping = 1 1
    Rotation = ROTATE_V
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
    Z = 1.5 3
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:21 Y:10 Z:40
  END
  Draw = RenderObjectDraw
  End
;  Event = TerrainCollision
;    HeightOffset = 0 0
;;    EventFX = FX_CatapultRockChunks
;    OrientFXToTerrain = No
;    PerParticle = Yes
;    KillAfterEvent = Yes
;  End
End


FXParticleSystem StatueDieLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXexplo01.tga
    Lifetime = 20 30
    SystemLifetime = 10
    SortLevel = 1
    Size = 5 5
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:255 G:165 B:90 0
    Color2 = R:0 G:0 B:0 30
  End
  Update = DefaultUpdate
    SizeRate = 30 90
    SizeRateDamping = 0.8 0.7
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXList FX_StatueDie
  ParticleSystem
    Name = StatueDieLight
    Offset = X:0.0 Y:0.0 Z:0.0
  End
  ParticleSystem
    Name = StatueDieHeat
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  ParticleSystem
    Name = StatueDieChunks
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  ParticleSystem
    Name = PCTMediumDust
  End
  ViewShake 
    Type = SEVERE
  End
  Sound
    Name = BuildingSink
  End
END

FXParticleSystem StatuePreDieMagicFloor
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= ExCloudNazgul.tga
    Lifetime		= 300 300
    SystemLifetime	= 10
    SortLevel = 1
    Size		= 220 240
    BurstDelay		= 20 20
    BurstCount		= 2 2
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:180  G:0 B:0  0
    Color2		= R:0  G:0  B:0 190
  End
  Alpha = DefaultAlpha
    Alpha2		= 1 1 5
    Alpha3		= 0.9 0.9 190
    Alpha4		= 0 0 280
  End
  Update		= DefaultUpdate
    AngleZ		= 0 0
    AngularRateZ	= 0 0 ;-500 -500
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 1
    Length		= 5
  End
  Draw			= DefaultDraw
  END
END

FXParticleSystem StatuePreDieMagicParticles
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= ExCloudNazgul.tga
    Lifetime		= 80 80
    SystemLifetime	= 80
    SortLevel = 1
    Size		= 12 15
    BurstDelay		= 2 2
    BurstCount		= 7 8
  End
  Color			= DefaultColor
    Color1		= R:180  G:0 B:0  0
    Color2		= R:0  G:0  B:0 80
  End
  Alpha = DefaultAlpha
    Alpha2		= 0.4 0.4 5
    Alpha3		= 0.8 0.8 80
    Alpha4		= 0 0 180
  End
  Update		= DefaultUpdate
    AngleZ		= 0 0
    AngularRateZ	= 0 0 ;-500 -500
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
    X = 1 -1
    Y = 1 -1
    Z = 0.1 0.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 30
    Length		= 20
  End
  Draw			= DefaultDraw
  END
END

FXList FX_PreStatueDie
  ParticleSystem
    Name = StatuePreDieMagicFloor
;    Offset = X:0.0 Y:0.0 Z:0.0
  End
  ParticleSystem
    Name = StatuePreDieMagicParticles
;    Offset = X:0.0 Y:0.0 Z:0.0
  End
       CameraShakerVolume
          Radius = 800
          Duration_Seconds = 7
          Amplitude_Degrees = 0.25
       End
  Sound
    Name = SpellDarkness
  End
END


Weapon GolemSpawnShockWave
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	AttackRange		= 40
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 40
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 601
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ENEMIES NEUTRALS ALLIES
	DelayBetweenShots	= 5000
	PreAttackDelay		= 0
	PreAttackType		= PER_ATTACK
	FiringDuration		= 1600
	FireFX			= FX_StatueDie

	MetaImpactNugget                    ; A Nugget that throws things back with force
		HeroResist	= .75
		ShockWaveAmount   = 75.0
		ShockWaveRadius   = 290.0
		ShockWaveTaperOff = 0.5
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 200.0 
	End
End

CommandSet SellableStatue
	6 = Command_Sell
End

Object OsgiliathStatue01

		KindOf                = STRUCTURE IMMOBILE CAN_CAST_REFLECTIONS SELECTABLE
;		RadarPriority = STRUCTURE
	CommandSet = SellableStatue

ReplaceModule ModuleTag_SlowDeathWithoutRubble
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		SinkRate		= 15     ; in Dist/Sec - fast!
		DestructionDelay	= 0
		FX 			= INITIAL FX_StatueDie
;        	Weapon			= INITIAL GolemSpawnShockWave
;		OCL			= FINAL OCL_PreGolem		; Working on this
	End
END
		  
		Geometry              = BOX
		GeometryMajorRadius   = 12.0
		GeometryMinorRadius   = 20.0
		GeometryHeight        = 72.0
		GeometryIsSmall       = No
		;GeometryRotationAnchorOffset = X:1037.871 Y:0
		Shadow                = SHADOW_VOLUME
End















;-------------------------
;Healing/Restoration Well glow (so they can be removed)
;----------------------------

Object LothlorienLampGlow1
  KindOf = PRELOAD STRUCTURE NO_COLLIDE OPTIMIZED_PROP SCORE
AddModule
  Body                = StructureBody ModuleTag_05
    MaxHealth         = 20.0
  End
END
AddModule
	Behavior = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 1
		MaxBurstDelay           = 2
		BigBurstFrequency       = 1
		FXList                  = INITIAL   FX_StructureSmallCollapse
;		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
;		DestroyObjectWhenDone	= Yes
		CollapseHeight		= 70
	End
END
End

Object LothlorienLampGlow2
  KindOf = PRELOAD STRUCTURE NO_COLLIDE OPTIMIZED_PROP SCORE
AddModule
  Body                = StructureBody ModuleTag_05
    MaxHealth         = 20.0
  End
END
AddModule
	Behavior = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 1
		MaxBurstDelay           = 2
		BigBurstFrequency       = 1
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight		= 10
	End
END
End

Object LothlorienLampGlow3
  KindOf = PRELOAD STRUCTURE NO_COLLIDE OPTIMIZED_PROP SCORE
AddModule
  Body                = StructureBody ModuleTag_05
    MaxHealth         = 20.0
  End
END
AddModule
	Behavior = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 1
		MaxBurstDelay           = 2
		BigBurstFrequency       = 1
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight		= 10
	End
END
End


;-------------
; Temple release effect (works like an egg)
;-------------

FXParticleSystem TempleReleasedSparkles
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 120 120
    SystemLifetime = 80
    Size = 18 30
    BurstCount = 6 8
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:100 G:140 B:200 0
    Color2 = R:0 G:0 B:0 120
  End
  Update = DefaultUpdate
    SizeRate		= -0.3 -0.3
;    SizeRateDamping	= 0.1 0.1
    AngleZ = 0.01 0.01
    AngularRateZ = 0.1 0.1
    AngularDamping = 0.9 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.3
    VelocityDamping = 0.5 0.7
  End
  EmissionVelocity = OutwardEmissionVelocity
    OtherSpeed = 0 1.5
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 50
    Length = 5
;    Offset = X=0 Y=0 Z=0
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem TempleReleasedFlare
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar2.tga
    Lifetime = 200 200
    SystemLifetime = 20
    Size = 10 15
    BurstDelay = 4 4
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:193 G:200 B:255 0
    Color2 = R:0 G:0 B:0 200
  End
  Update = DefaultUpdate
    SizeRate = 3 3
    SizeRateDamping = 0.92 0.92
    AngleZ = -5 5
    AngularDamping = 0.8 0.85
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 0.5 0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
;	Z = 30 -30
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem TempleReleasedPermanent
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar2.tga
    Lifetime = 999999 999999
    SystemLifetime = 1
    Size = 40 40
    BurstDelay = 4 4
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:100 G:140 B:200 0
  End
  Update = DefaultUpdate
;    SizeRate = 3 3
;    SizeRateDamping = 0.92 0.92
    AngleZ = -5 5
    AngularDamping = 0.8 0.85
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.5 0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem TempleReleasedWaves
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXRing01.tga
    Lifetime = 40 40
    SystemLifetime = 5
    SortLevel = 1
    Size = 1 1
    BurstCount = 2 3
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:100 G:140 B:200 0
    Color2 = R:0 G:0 B:0 40
    ColorScale = -20 40

  End
  Update = DefaultUpdate
    SizeRate = 10 10
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem TempleReleasedDust
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    PerParticleAttachedSystem = GandalfBlastDustCore
    Lifetime = 100 100
    SystemLifetime = 55
    SortLevel = 1
    Size = 1 2
    BurstCount = 25 50
    InitialDelay = 5 5
  End
  Color = DefaultColor
    Color1 = R:181 G:190 B:196 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.2 0.3 0
    Alpha2 = -2 0 100
  End
  Update = DefaultUpdate
    SizeRate = 2 15
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.1 -0.1
    AngularDamping = 0.92 0.94
    Rotation = ROTATE_V
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.94
    DriftVelocity = X:0.032 Y:0.064 Z:0.15
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 20 20
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 12
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem TempleReleaseGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 580 580
    SystemLifetime = 1
    Size = 40 40
    BurstCount = 6 6
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:50 G:70 B:100 60
    Color3 = R:0 G:0 B:0 580
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.03
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 40
  End
  Draw = DefaultDraw
  End
End


FXList FX_TempleRelease 
	ParticleSystem
		Name = TempleReleasedSparkles
;		InitialDelay = 1000 1000
       	END
	ParticleSystem
		Name = TempleReleasedFlare
        	Offset = X:0.0 Y:0.0 Z:65.0
	End
	ParticleSystem
		Name = TempleReleasedPermanent
        	Offset = X:0.0 Y:0.0 Z:75.0
		InitialDelay = 2000 2000 UNIFORM
	End
	ParticleSystem
		Name = TempleReleasedDust
	End
	ParticleSystem
		Name = TempleReleaseGlow
		InitialDelay = 2000 2000 UNIFORM
	End
;	ParticleSystem
;		Name = TempleReleasedWaves
;	End
	Sound
		Name = SpellFloodStart
	End
	DynamicDecal	; A decal that belongs to nobody, but updates internally to fade and tint and such
		DecalName		= scccracks02 ; exhpjanx
		Size			= 200
		Color			= R:100 G:140 B:200
		OpacityStart		= 0
		OpacityFadeTimeOne	= 500
		OpacityPeak		= 190
		OpacityPeakTime		= 100
		OpacityFadeTimeTwo	= 5000
		OpacityEnd		= 0
		StartingDelay		= 400
		Lifetime		= 12000
	End
End

Object WildMenAlliesSummonEgg		; This is no longer used for wildmen :)

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 2000
		FX = INITIAL FX_TempleRelease
	End
END

End





Object SummonRohanRohirrimEgg	; Used for bonus goblin fight in the end

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 0
	End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_HellfireWarHead
    StartsActive = Yes
    DeathWeapon = GandalfWordOfPower
  End
END

End



;-------------
; Temple corruption release effect (works like an egg)
;-------------


FXParticleSystem CorruptionDestroyedParticles
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = EXWoodChip01.tga
    Lifetime = 50 100
    SystemLifetime = 30
    Size = 2.5 10
    BurstCount = 135 175
  End
  Color = DefaultColor
    Color1 = R:137 G:137 B:137 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.5 0.55
    AngleZ = -7 7
    AngularRateZ = -1 1
    AngularDamping = 0.99 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.95 0.99
    DriftVelocity = X:0 Y:0 Z:-4
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial = 5 10
    Normal = 4 8
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 50
    Length = 70
  End
  Draw = DefaultDraw
  End
End

FXList FX_CorruptionDestroy
	ParticleSystem
		Name = CorruptionDestroyedParticles
;		InitialDelay = 1000 1000
       	END
	Sound
		Name = SpellDragonStrikeMS ; SpellDarkness ; CaH_BerserkerRage
	END
End


Object GondorRangersSummonEgg		; This is no longer used for rangers :)

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 2000
		FX = INITIAL FX_CorruptionDestroy
	End
END

End


;-------------
; Eerie haze generator
;-------------

FXParticleSystem LegendsEvilHaze
  System
    Shader			= ALPHA
    SortLevel			= 1
    Priority = ALWAYS_RENDER
    ParticleName		= EXSnowCloud.tga
    Lifetime			= 250 250
    Size			= 40 65
    BurstDelay			= 30 70
    BurstCount			= 2 5
    IsGroundAligned		= Yes
    IsEmitAboveGroundOnly	= Yes
  End
  Color = DefaultColor
    Color1		= R:0 	G:0	B:0	1
    Color2		= R:180	G:180	B:180	100
    Color3		= R:0	G:0	B:0	400
  End
  Alpha = DefaultAlpha
    Alpha1		= 0 	0	0
    Alpha2		= 0.3	0.3	30
    Alpha3		= 0.4	0.4	190
    Alpha4		= 0	0	250
  End
  Update = DefaultUpdate
    SizeRate		= 0 0.1
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -0.01 0.01
    AngularDamping	= 0.3 0.3
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    DriftVelocity	= X:0.03 Y:0.02 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0.15 0.3
    Y = -0.07 0.07
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 105
    Length = 25
;    Offset = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.4
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

Object CINE_ParticleSysProxy

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
		ParticleSysBone = NONE LegendsEvilHaze
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

  DisplayName      = OBJECT:Smoke
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End


;----------------
; Pretty fireflies!
;----------------

FXParticleSystem LegendsFireflies
  System
;    Shader			= ALPHA
;    SortLevel			= 1
    Priority = ALWAYS_RENDER
    ParticleName		= EXEmbersLight.tga ;EXSnowCloud.tga
    Lifetime			= 270 270
    Size			= 24 29
    BurstDelay			= 39 46
    BurstCount			= 1 1
;    IsEmitAboveGroundOnly	= Yes
  End
  Color = DefaultColor
    Color1		= R:0 	G:0	B:0	1
    Color2		= R:240	G:180	B:15	45
    Color3		= R:200	G:160	B:15	180
    Color4		= R:0	G:0	B:0	270
  End
;  Alpha = DefaultAlpha
;    Alpha1		= 0 0 0
;    Alpha2		= 0.2 0.2 120
;    Alpha3		= 0.5 0.5 190
;    Alpha4		= 0 0 590
;  End
  Update = DefaultUpdate
    SizeRate		= 0.03 0.08
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -0.13 0.13
    AngularDamping	= 0.5 0.5
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    DriftVelocity	= X:0 Y:0 Z:0.01
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.05 0.05
    Y = -0.03 0.03
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 55
    Length = 25
    Offset = X:0 Y:0 Z:15
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

Object CINE_ParticleSysProxy2

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
		ParticleSysBone = NONE LegendsFireflies
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

  DisplayName      = OBJECT:Smoke
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End

;-------------
; Spider's nest brownish haze
;-------------

FXParticleSystem BrownHaze
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 200 200
;    SystemLifetime = 1
    Size = 90 90
    BurstDelay = 75 75
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:110 G:40 B:0 80
    Color2 = R:110 G:40 B:0 150
    Color3 = R:0 G:0 B:0 200
  End
  Update = DefaultUpdate
    SizeRate = 0.5 0.5
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.01
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 10
  End
  Draw = DefaultDraw
  End
End

Object CINE_ParticleSysProxy3

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
		ParticleSysBone = NONE BrownHaze
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

  DisplayName      = OBJECT:Smoke
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End

;-------------------
; VISIBLE SKYBOX


Object WaterReflectionSkydome_Celduin

Scale = 0.48

AddModule
  Body            = ActiveBody ModuleTag_Makeskillwork
    MaxHealth         = 999
  End
END

AddModule
  	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL
		DestructionDelay = 0
	End
END

  KindOf = PRELOAD IMMOBILE CAN_CAST_REFLECTIONS SELECTABLE INERT_SHROUD_REVEALER

End





Object WaterReflectionSkydome_DolGul

Scale = 0.45

AddModule
  Body            = ActiveBody ModuleTag_MakesKillwork
    MaxHealth         = 999
  End
END

AddModule
  	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL
		DestructionDelay = 0
	End
END

  KindOf = PRELOAD IMMOBILE CAN_CAST_REFLECTIONS SELECTABLE INERT_SHROUD_REVEALER

End







; BONUSGOBLIN battle goblins


Object GoblinFighterHorde_FromDefectedLair

ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContainNew
		FrontAngle = 270
		FlankedDelay = 2000
		ObjectStatusOfContained = 
		InitialPayload	= WildLaborer 20
		Slots			= 20
		PassengerFilter = ANY +INFANTRY
		ShowPips		= No
		
		; Banner Carrier info		
		BannerCarriersAllowed	= WildBannerGoblin								; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:GoblinFighter	Pos:X:60.0 Y:0.0	; (DEFAULT) position of banner carrier for fighter horde
		
		RandomOffset = X:5 Y:5	
		
		MeleeBehavior = Amoeba
		End
		
		RankInfo = RankNumber:1 UnitType:WildLaborer Position:X:50 Y:0		Position:X:60 Y:15		Position:X:72 Y:-28		Position:X:620 Y:40		Position:X:55 Y:-50 
		RankInfo = RankNumber:2 UnitType:WildLaborer Position:X:30 Y:5 Leader 1 0	Position:X:30 Y:25 Leader 1 1	Position:X:30 Y:-26 Leader 1 2	Position:X:30 Y:38 Leader 1 3	Position:X:30 Y:-38 Leader 1 4
		RankInfo = RankNumber:3 UnitType:WildLaborer Position:X:10 Y:-8 Leader 2 0	Position:X:-10 Y:35 Leader 2 1	Position:X:0 Y:-18 Leader 2 2	Position:X:10 Y:55 Leader 2 3	Position:X:10 Y:-44 Leader 2 4
		RankInfo = RankNumber:3 UnitType:WildLaborer Position:X:-30 Y:2 Leader 3 0	Position:X:-35 Y:20 Leader 3 1	Position:X:-20 Y:-20 Leader 3 2	Position:X:-10 Y:38 Leader 3 3	Position:X:-40 Y:-40 Leader 3 4

		RanksToReleaseWhenAttacking = 1

		MeleeAttackLeashDistance = 1; How far the hordes can move from the center of the horde when melee attacking.
	End
END

End


ChildObject WildLaborer GoblinFighter

	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP CAN_CLIMB_WALLS SALVAGER ;  Salvager makes them countable

END

;-------------
; Dwarven Fortress Gate Key Effect
;-------------

FXParticleSystem KeyGlimmer
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 5 5
    BurstCount = 0.2 1.1
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:236 G:199 B:136 50
    Color3 = R:0 G:0 B:0 100
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.1
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.5 0.5
    Y = -0.5 0.5
    Z = 0.25 0.5
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:-0.05 Y:0 Z:0.2
    EndPoint = X:0.05 Y:0 Z:0.2
  End
  Draw = DefaultDraw
  End
End





FXParticleSystem KeyPickup
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 50 50
    SystemLifetime = 7
    Size = 0.5 0.5
    StartSizeRate = 0 0.16
    BurstCount = 7 14
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:232 G:179 B:98 0
    Color2 = R:0 G:0 B:0 50
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.9 0.9
    AngleZ = 0.01 0.01
    AngularRateZ = 0.1 0.1
    AngularDamping = 0.9 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.5
    VelocityDamping = 0.5 0.9
  End
  EmissionVelocity = OutwardEmissionVelocity
    OtherSpeed = 0 1.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 1
    Length = 5
  End
  Draw = DefaultDraw
  End
End

FXList FX_KeyGet
  Sound
    Name = GUI_CreateAHeroMenuClick
  End
 ParticleSystem
    Name = KeyPickup
    Offset = X:0.0 Y:0.0 Z:1.0
  End
End


Object CINE_ParticleSysProxy4

  KindOf          = PRELOAD IMMOBILE CAN_CAST_REFLECTIONS SELECTABLE

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
		ParticleSysBone = NONE KeyGlimmer
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

  DisplayName      = OBJECT:Prop
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 2000
		FX = INITIAL FX_KeyGet
	End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End


;---------------------
; Fire lighting effect - Torches
;---------------------

Object CINE_ParticleSysProxy5

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

AddModule
Draw = W3DLightDraw ModuleTag_W3DLightDraw
    Ambient		= R:0 G:0 B:0        ;; Ambient Color...
    Diffuse		= R:255 G:180 B:0    ;; Diffusive Color...
    Radius		= 100            ;; Radius of Light.
    Intensity		= 1.5            ;; Intensity of light.
    FlickerAmplitude	= 0.5        ;; How strong it "flickers".
    FlickerFrequency	= 2        ;; How often it "flickers".    
;    AttachToBoneInAnotherModule = Torch
End
END

  DisplayName      = OBJECT:Prop
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End



;---------------------
; Pale Light lighting effect
;---------------------

Object CINE_ParticleSysProxy6

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

AddModule
Draw = W3DLightDraw ModuleTag_W3DLightDraw
    Ambient		= R:0 G:0 B:0        ;; Ambient Color...
    Diffuse		= R:213 G:240 B:255    ;; Diffusive Color...
    Radius		= 95            ;; Radius of Light.
    Intensity		= 1.4            ;; Intensity of light.
    FlickerAmplitude	= 0.3        ;; How strong it "flickers".
    FlickerFrequency	= 1        ;; How often it "flickers".    
;    AttachToBoneInAnotherModule = Torch
End
END

  DisplayName      = OBJECT:Prop
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End

;---------------------
; Fire lighting effect Bigger
;---------------------

Object CINE_MtDoomHeat

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

AddModule	; ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
    End    
    ModelConditionState = WORLD_BUILDER
			Model = locator		
	End
  End
END

AddModule
Draw = W3DLightDraw ModuleTag_W3DLightDraw
    Ambient		= R:0 G:0 B:0        ;; Ambient Color...
    Diffuse		= R:255 G:190 B:0    ;; Diffusive Color...
    Radius		= 120            ;; Radius of Light.
    Intensity		= 2.5            ;; Intensity of light.
    FlickerAmplitude	= 0.5        ;; How strong it "flickers".
    FlickerFrequency	= 3        ;; How often it "flickers".    
;    AttachToBoneInAnotherModule = Torch
End
END

  DisplayName      = OBJECT:Prop
 
  KindOf          = IMMOBILE
  Shadow          = NONE

AddModule
  Body            = ActiveBody ModuleTag_03
    MaxHealth       = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 0.8
  GeometryMinorRadius = 0.8
  GeometryHeight = 0.8
  GeometryIsSmall = Yes

End




;-------------
; Temple 3 glow generator
;-------------


FXParticleSystem Temple3PasiveGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 580 580
;    SystemLifetime = 1
    Size = 45 45
    BurstDelay = 130 130
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:50 G:70 B:100 60
    Color3 = R:0 G:0 B:0 580
  End
  Update = DefaultUpdate
    SizeRate = 0.7 0.7
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.003
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 65
    Offset = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

Object ParticleSysProxy3				; This is not a cine object, like the other ParticleSysProxy objects above. It is in Natureprop.ini

  KindOf          = IMMOBILE CAN_CAST_REFLECTIONS

ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = NONE
		ParticleSysBone = NONE Temple3PasiveGlow
    End    
    ModelConditionState = WORLD_BUILDER
	Model = locator		
    End
  End
END

  DisplayName      = OBJECT:Smoke
 
  KindOf          = IMMOBILE
  Shadow          = NONE

End

;----------
; Impaled skeleton and corruption vines (So I can delete them with a script)
;----------


Object PolesSkull02
  KindOf = PRELOAD IMMOBILE STRUCTURE ; NOT_AUTOACQUIRABLE  CLEARED_BY_BUILD INERT OPTIMIZED_PROP
End

Object VineBarricade01
  KindOf          = PRELOAD IMMOBILE STRUCTURE ; UNATTACKABLE NOT_AUTOACQUIRABLE CLEARED_BY_BUILD INERT OPTIMIZED_PROP
;AddModule
;	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;		DestructionDelay  = 1000
;	End
;END
End

Object VineBarricade02
  KindOf          = PRELOAD IMMOBILE STRUCTURE ; UNATTACKABLE NOT_AUTOACQUIRABLE CLEARED_BY_BUILD INERT OPTIMIZED_PROP
End

Object TownLamp4
  KindOf = PRELOAD IMMOBILE STRUCTURE
END


;----------
;Mechanism Lever
;----------

Object MoriaHammerB

  DisplayName      = OBJECT:Beams

  KindOf = PRELOAD STRUCTURE IMMOBILE MADE_OF_STONE NOT_AUTOACQUIRABLE

AddModule
  Body                  = ActiveBody ModuleTag_03sa
    MaxHealth       = 99999.0
  End
END

End


;----------
;Low Bridge
;----------

Object EreborBridge
  KindOf          = IMMOBILE UNATTACKABLE NOT_AUTOACQUIRABLE CAN_CAST_REFLECTIONS ; OPTIMIZED_PROP
End


;---------
; Some misc objects


Object MoriaBoxB					; Box containing key.
  ArmorSet
    Conditions			= None
    Armor			= TreasureBoxArmor
  End

  DisplayName      = OBJECT:Box

  KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE NOT_AUTOACQUIRABLE INFANTRY PATH_THROUGH_EACH_OTHER

AddModule
	Body = ActiveBody ModuleTag_Health
		MaxHealth		= 280
		MaxHealthDamaged	= 100.0
		MaxHealthReallyDamaged  = 50.0
	End
END

  Geometry		= BOX
  GeometryMajorRadius	= 1.0
  GeometryMinorRadius	= 1.0
  GeometryHeight	= 16     
  GeometryIsSmall	= Yes    
  Shadow          	= SHADOW_VOLUME
END

Object IsengardWargPit
RemoveModule DrawFloor_Bib
RemoveModule DrawFloor_V1

END

;--------------
; Treasure spawning Boxes
;--------------

FXParticleSystem TreasureBoxDebris
  System
    Priority		= MEDIUM_OR_ABOVE
    Shader		= ALPHA			;ALPHA_TEST
    ParticleName	= EXWoodChip01.tga
    Lifetime		= 100 100
    SystemLifetime	= 2
    Size		= 4 10
    BurstDelay		= 3 3			; Meaning only one burst
    BurstCount		= 11 15
  End
  Color = DefaultColor
    Color1 = R:162 G:137 B:100 0
    Color1 = R:162 G:137 B:100 100
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
    Alpha1 = 1 1 100
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.5 0.55
    AngleZ = -7 7
    AngularRateZ = -1 1
    AngularDamping = 0.99 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity		= -0.4
    VelocityDamping = 0.95 0.99
    DriftVelocity = X:0 Y:0 Z:2
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -3 3
    Y = -3 3
    Z = 2 4
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:6 Y:4 Z:4
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem TreasureBoxDust
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    Lifetime = 40 40
    SystemLifetime = 5
    SortLevel = 1
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:162 G:152 B:147 0
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.3 0.5 10
    Alpha3 = 0 0 40
  End
  Update = DefaultUpdate

    SizeRate = 30 35
    SizeRateDamping = 0.6 0.65
    AngleZ = -0.5 0.5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.5 0.5
    Y = -0.5 0.5
    Z = 0.25 0.25
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 10
    Offset = X:0 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End

FXList FX_TreasureBoxDebris
  ParticleSystem
    Name = TreasureBoxDust
  End
  ParticleSystem
    Name = TreasureBoxDebris
  End
       Sound
          Name = BuildingScaffoldShatterLightQuick
       End
End

Object TreasureChest2

ReplaceModule ModuleTag_02
  Behavior = SalvageCrateCollide ModuleTag_02New
    	ForbiddenKindOf		= PROJECTILE ENVIRONMENT IGNORED_IN_GUI NEUTRALGOLLUM
   	BannerChance		= 0%
    	LevelUpChance		= 0%
    	LevelUpRadius		= 1.0
    	ResourceChance		= 100%
    	MinResource		= 300
    	MaxResource		= 500
    	AllowAIPickup		= No ;Yes
	ExecuteFX = FX_GoldChestPickup
  End
END

END

ObjectCreationList OCL_BoxChest
	CreateObject
		ObjectNames				= TreasureChest2
		Count					= 2
		SpreadFormation				= Yes
		MinDistanceAFormation			= 0.0
		MinDistanceBFormation			= 18.0
		MaxDistanceFormation			= 35.0
		FadeIn					= No
;		Disposition				= SPAWN_AROUND
;		DispositionAngle			= 60	;SpawnAround uses this as the arc between guys
;		DispositionIntensity			= 100	;and this for distance from center
		IgnoreAllObjects			= Yes
		InvulnerableTime			= 3000	; This is the amount of time before we can pick this crate up.
	End
End

Armor TreasureBoxArmor
 Armor = DEFAULT		25%
 Armor = PIERCE			1%
 Armor = MAGIC			1%
 Armor = FLAME			1%
 Armor = CAVALRY_RANGED		1%
End

FXParticleSystem TreasureBoxFX
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= EXGandalfStaffFlare.tga
    Lifetime		= 65 65
    Size		= 0.8 1.2
;    StartSizeRate	= 0 0.16		; Interesting: This increases initial size as time passes by
    BurstDelay		= 7 7
    BurstCount		= 1 2
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = 	R:248	G:189	B:98	0
    Color2 = 	R:0	G:0	B:0	65
  End
  Update = DefaultUpdate
    SizeRate		= 0.5 0.5
    SizeRateDamping	= 0.9 0.9
    AngleZ		= 0.01 0.01
    AngularRateZ	= 0.1 0.1
    AngularDamping	= 0.9 0.99
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    Gravity		= 0.2
    VelocityDamping	= 0.5 0.9
  End
  EmissionVelocity	= OutwardEmissionVelocity
    OtherSpeed		= 0 1.5
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 10
    Length		= 12
    Offset = X:0 Y:0 Z:6
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = Circular
    WindStrength = 0.05
    WindFullStrengthDist = 5
    WindZeroStrengthDist = 100
    WindAngleChangeMin = 0.034907
    WindAngleChangeMax = 0.034907
    WindPingPongStartAngleMin = 1.22173
    WindPingPongStartAngleMax = 1.22173
    WindPingPongEndAngleMin = 1.91986
    WindPingPongEndAngleMax = 1.91986
    TurbulenceAmplitude = 0.05
    TurbulenceFrequency = 0.2
  End
End


Object MoriaBoxC

ReplaceModule ModuleTag_01
    Draw = W3DScriptedModelDraw ModuleTag_01New
      DefaultModelConditionState
        Model = MPMBOXC
		ParticleSysBone = NONE TreasureBoxFX
      End
    End
END

  ArmorSet
    Conditions			= None
    Armor			= TreasureBoxArmor
  End

  DisplayName      = OBJECT:Box

  KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE NOT_AUTOACQUIRABLE

AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeChestLoadsOfTreasure
		CreationList			= OCL_BoxChest
	  End
End

AddModule								; Falls into the ground when "killed"
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_TreasureBoxDebris
		CollapseHeight				= 10
	End
END

AddModule
	Body = ActiveBody ModuleTag_Health
		MaxHealth		= 280
		MaxHealthDamaged	= 100.0
		MaxHealthReallyDamaged  = 50.0
	End
END

  Geometry		= BOX
  GeometryMajorRadius	= 20.0
  GeometryMinorRadius	= 20.0
  GeometryHeight	= 16     
  GeometryIsSmall	= No    
  Shadow          	= SHADOW_VOLUME

End






;------------
; Destructable spiked Wall for Golem Boss
;------------


FXParticleSystem CustomWoodDebris
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = EXWoodChip01.tga
    Lifetime = 5 100
    SystemLifetime = 2
    Size = 0.5 12
    BurstCount = 50 65
  End
  Color = DefaultColor
    Color1 = R:162 G:137 B:100 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.5 0.55
    AngleZ = -7 7
    AngularRateZ = -1 1
    AngularDamping = 0.99 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.95 0.99
    DriftVelocity = X:0 Y:0 Z:-4
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1.5 1.5
    Y = -1.5 1.5
    Z = 6 9
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:32 Z:15
    EndPoint = X:0 Y:-32 Z:15
  End
  Draw = DefaultDraw
  End
End


FXList FX_SpikewallKill
  ParticleSystem
    Name = PCTMediumDust
  End
  ParticleSystem
    Name = CustomWoodDebris
  End
;  ParticleSystem
;    Name = RDTMediumExplosion
;    Offset = X:0.0 Y:0.0 Z:10.0
;  End
End


Object BarricadeSharp_Structure
  KindOf          = PRELOAD IMMOBILE NOT_AUTOACQUIRABLE STRUCTURE ;SELECTABLE

RemoveModule ModuleTag_02

AddModule
	Body = StructureBody ModuleTag_05
		MaxHealth		= ELVEN_STATUE_HEALTH
		MaxHealthDamaged	= ELVEN_STATUE_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ELVEN_STATUE_HEALTH_REALLY_DAMAGED
	End
END

AddModule
  Behavior                  = StructureCollapseUpdate ModuleTag_06
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL  FX_SpikewallKill
;	DestroyObjectWhenDone	= Yes
	CollapseHeight			= 75
  End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay			= 5000
	End
END

;	GeometryMajorRadius		= 0.1
;	GeometryMinorRadius		= 0.1

End


;------------
; Wildmen Stuff
;------------

Weapon NewWildmenWeapon
	ClearNuggets ;;.;;
	LeechRangeWeapon	= Yes
	AttackRange		= 30.0
	MeleeWeapon		= Yes
	DelayBetweenShots	= ISENGARD_WILDMAN_DELAYBETWEENSHOTS            ; time between shots, msec
	PreAttackDelay		= ISENGARD_WILDMAN_PREATTACKDELAY             ; 433 is natural time of the stabbing animation.
	PreAttackType		= PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration		= ISENGARD_WILDMAN_FIRINGDURATION            ; min 600 for anim
	FireFX			= FX_GondorSwordHit
	FireFlankFX		= FX_Flanking

	DamageNugget
		Damage			= 300	; 400 was too much
		Radius			= ISENGARD_WILDMAN_TORCH_RADIUS
		DelayTime		= 0
		DamageType		= FLAME
		DamageFXType		= FLAME
		DeathType		= BURNED
		AcceptDamageAdd		= No
		RequiredUpgradeNames    = Upgrade_IsengardTorches
	End

	DamageNugget
		Damage			= 300	; 400 was too much
		Radius			= ISENGARD_WILDMAN_RADIUS
		DelayTime		= 0
		DamageType		= SLASH
		DamageFXType		= CLUBBING
		DeathType		= NORMAL
		FlankingBonus		= 50%
	End
End


FXParticleSystem Callwyrmfx
  System
    Priority = ALWAYS_RENDER
    ParticleName = exlvlupclutter.tga 	;  ; EXRing01.tga
    Lifetime = 40 40
    SystemLifetime = 70
    SortLevel = 1
    Size = 2 2
    BurstDelay = 9 11
    BurstCount = 5 7
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:140 G:80 B:141 0
    Color2 = R:0 G:0 B:0 18
;    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 6 6
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End


FXList FX_CallWyrm
  ParticleSystem
    Name = Callwyrmfx
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  Sound
    Name = WyrmSummonInitiate
;    InitialDelay = 100 100 UNIFORM
  End
End

FXParticleSystem ShamanIconParticle
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exbarb.tga
    Lifetime		= 80 80
;   SystemLifetime	= 70
    Size		= 4.3 4.3
    BurstDelay		= 15 15
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:0   G:0 B:0  0
    Color2		= R:255  G:225 B:30 5
    Color3		= R:0    G:0  B:0   60
  End
;  Alpha			= DefaultAlpha
;    Alpha1		= 1   1   0
;    Alpha2		= 0.5 0.5 5
;    Alpha3		= 0   0   3
;  End
  Update		= DefaultUpdate
    SizeRate		= 0.17 0.17
    SizeRateDamping	= 1 1
    AngleZ		= -180 180
    AngularRateZ	= 0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.1 0.1
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END

FXList FX_ShamanIcon
	PlayEvenIfShrouded = Yes 

  ParticleSystem
	Name = ShamanIconParticle
	Offset = X:0.0 Y:0.0 Z:0
	AttachToObject	= Yes
  End
End

ModifierList ShamanIconAttributeModifier
	Category			= WEAPON
	Duration			= 0
	FX				= FX_ShamanIcon
END

SpecialPower NewSpellBookAwakenWyrm
	Enum					= SPECIAL_GENERAL_TARGETLESS
	ReloadTime				= 20000
End

SpecialPower NewSpellBookWarChant
	Enum					= SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime				= 10000
End

Weapon ShamanCallWyrm
	ClearNuggets ;;.;;
    IdleAfterFiringDelay = 0
    MinimumAttackRange	= 0.8
    DelayBetweenShots	= 5000
    PreAttackDelay      = 100
    PreAttackType       = PER_ATTACK
    FireFX              = FX_CallWyrm
    FiringDuration      = 1400
End

CommandButton Command_SpellBookWarChant
	Command			= SPECIAL_POWER
	SpecialPower		= NewSpellBookWarChant
	Options			= NONE
	TextLabel		= CONTROLBAR:WarChant
	ButtonBorderType	= ACTION 
	DescriptLabel		= CONTROLBAR:TooltipWarChant
	ButtonImage		= SBEvil_WarChant
;	RadiusCursorType	= WarChantRadiusCursor
	InPalantir		= Yes
End

CommandButton Command_SpellBookAwakenWyrm
	Command			= SPECIAL_POWER
	SpecialPower		= NewSpellBookAwakenWyrm
	Options			= NONE 
	TextLabel		= CONTROLBAR:AwakenWyrm
	ButtonImage		= SBEvil_AwakenWyrm
	ButtonBorderType	= ACTION
	DescriptLabel		= CONTROLBAR:TooltipAwakenWyrm
;	RadiusCursorType	= WyrmRadiusCursor
;	CursorName          	= AttackObj
;	InvalidCursorName   	= GenericInvalid
	InPalantir		= Yes
End


CommandSet WildmanShaman
	1 = Command_ToggleStance
	2 = Command_SpellBookWarChant
	3 = Command_SpellBookAwakenWyrm
	13 = Command_AttackMove
	14 = Command_Stop
END


ModifierList ShamanChant
	Category			= LEADERSHIP
	Modifier			= DAMAGE_MULT 115%
	Duration			= 15000
	ModelCondition			= WAR_CHANT 
	FX				= FX_GenericBuffPersistent20
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
End

Armor NewWildmanArmor
  Armor = DEFAULT		80%     ;this sets the level for all nonspecified damage types
  Armor = MAGIC			100%     ;magic damage; ; 100
End

Armor WildmanShamanArmor
  Armor = DEFAULT		35%     ;this sets the level for all nonspecified damage types
  Armor = MAGIC			0%     ;magic damage; ; 100
End

Object IsengardWildman

	KindOf = PRELOAD SELECTABLE CREEP CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE CAN_USE_SIEGE_TOWER

ReplaceModule ModuleTag_01
  Draw = W3DHordeModelDraw ModuleTag_01New

	OkToChangeModelColor = No	  
	StaticModelLODMode = Yes
	; specify options for static LODs
	LodOptions	= LOW
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_LOW
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_LOW
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_LOW
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_LOW
	End
	
	LodOptions	= MEDIUM
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_MED
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_MED
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_MED
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_MED
	End
	
	LodOptions	= HIGH
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_HIGH
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_HIGH
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_HIGH
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_HIGH
	End
	
    DefaultModelConditionState
      Model = IUWildMan2_SKN				; Viking model
      Skeleton = IUWildMan_SKL
      Model = IUWildMan3_SKN 	ExtraMesh:Yes		; Persian model
      Model = IUWildMan4_SKN 	ExtraMesh:Yes		; Rebel peasant model
    End

		IdleAnimationState
			Animation = IDLB
				AnimationName = IUWildMan_IDLB
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLC
				AnimationName = IUWildMan_IDLC
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLD
				AnimationName = IUWildMan_IDLD
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLE
				AnimationName = IUWildMan_IDLE
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLF
				AnimationName = IUWildMan_IDLF
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLG
				AnimationName = IUWildMan_IDLG
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			StateName = Idle
		End

		AnimationState			= DYING DEATH_2
			Animation
				AnimationName	= IUWildMan_IDLA
				AnimationMode	= LOOP
				AnimationBlendTime = 10
			End
		End

		AnimationState			= DYING BURNINGDEATH
			Animation
				AnimationName	= IUWildMan_DTHA
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= IUWildMan_DTHB
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= IUWildMan_DTHC
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
		End
    AnimationState = DYING
			Animation = DyingA
				AnimationName = IUWildMan_DTHA
				AnimationMode = ONCE
				AnimationPriority = 10
			End
			Animation = DyingB
				AnimationName = IUWildMan_DTHB
				AnimationMode = ONCE
				AnimationPriority = 10
			End				
			Animation = DyingC
				AnimationName = IUWildMan_DTHC
				AnimationMode = ONCE
				AnimationPriority = 10
			End	
    End
    
		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= IUWildMan_MFDA
				AnimationMode	= LOOP
				Distance		= 90
			End
		End

	AnimationState						= PARALYZED
		Animation
			AnimationName				= IUWildMan_IDLB
			AnimationMode				= LOOP
		End
	End

	AnimationState = MOVING BACKING_UP
		Animation = BackingUp
			AnimationName = IUWildMan_BAKA
			AnimationMode = LOOP
		End
		Animation = BackingUpB
			AnimationName = IUWildMan_BAKB
			AnimationMode = LOOP
		End
		Flags = RANDOMSTART
	End
	
	AnimationState = MOVING EMOTION_TERROR
		Animation = Moving
			AnimationName = IUWildMan_RUNC
			AnimationMode = LOOP
		End
		Animation = MovingD
			AnimationName = IUWildMan_RUND
			AnimationMode = LOOP
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
    End
	
    AnimationState = MOVING DAMAGED
			Animation = Moving
				AnimationName = IUWildMan_WLKA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
			ParticleSysBone = None InfantryDustTrails
    End
 
    AnimationState = MOVING
			Animation = Moving
				AnimationName = IUWildMan_RUNA
				AnimationMode = LOOP
			End
			Animation = Moving
				AnimationName = IUWildMan_RUNB
				AnimationMode = LOOP
			End			
			Flags = RANDOMSTART
			ParticleSysBone = None InfantryDustTrails
    End
    
	AnimationState							= RAISING_FLAG
		Animation
			AnimationName					= IUWildMan_CHRA
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Animation
			AnimationName					= IUWildMan_CHRB
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Animation
			AnimationName					= IUWildMan_CHRC
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Flags							= RESTART_ANIM_WHEN_COMPLETE
	End
	
	AnimationState							= EMOTION_UNCONTROLLABLY_AFRAID
		Animation							= FERA
			AnimationName					= IUWildMan_FERA
			AnimationMode					= LOOP
		End
		Flags = RANDOMSTART
	End
	
	AnimationState			= STUNNED_FLAILING
		Animation
			AnimationName   = IUWildMan_FLYA
			AnimationMode   = LOOP
			AnimationSpeedFactorRange	= 0.4 0.6
		End
	End
	AnimationState			= STUNNED_STANDING_UP
		Animation
			AnimationName   = IUWildMan_GTPA
			AnimationMode   = ONCE
		End
	End
	AnimationState			= STUNNED
		Animation
			AnimationName   = IUWildMan_LNDA
			AnimationMode   = ONCE
		End
	End

    AnimationState = ATTACKING
			Animation = Attacking
				AnimationName = IUWildMan_ATKA
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKB
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKC
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKD
				AnimationMode = LOOP
				AnimationPriority = 10
			End						
    End


    AnimationState = WAR_CHANT
		Animation = ChantA
			AnimationName = IUWildMan_TNTA
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = ChantB
			AnimationName = IUWildMan_TNTB
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = ChantC
			AnimationName = IUWildMan_TNTC
			AnimationMode = LOOP
			AnimationPriority = 10
		End		
	End

			
	;-emotions--
	
	AnimationState							= EMOTION_AFRAID
		Animation							= FERA
			AnimationName					= IUWildMan_FERA
			AnimationMode					= LOOP
		End
		Flags = RANDOMSTART
	End

	AnimationState							= EMOTION_TAUNTING
		Animation = TAUNTINGA
			AnimationName = IUWildMan_TNTA
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = TAUNTINGB
			AnimationName = IUWildMan_TNTB
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = TAUNTINGC
			AnimationName = IUWildMan_TNTC
			AnimationMode = LOOP
			AnimationPriority = 10
		End	
	End
	
	AnimationState							= EMOTION_POINTING
		Animation							= Pointing1
			AnimationName					= IUWildMan_PNTA
			AnimationMode					= LOOP
		End
		Animation							= Pointing1
			AnimationName					= IUWildMan_PNTB
			AnimationMode					= LOOP
		End
	End

	AnimationState							= EMOTION_CELEBRATING
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRA
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRB
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRC
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
	End
	
	AnimationState							= EMOTION_ALERT
		Animation							= ALERT
			AnimationName					= IUWildMan_IDLA
			AnimationMode					= LOOP
		End
		Flags								= RESTART_ANIM_WHEN_COMPLETE RANDOMSTART
	End
        
  End
END	;ReplaceModule


	CommandPoints = 0

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth         	= 1800 ; 375
		MaxHealthDamaged  	= 500
		BurningDeathBehavior	= Yes
		BurningDeathFX		= FX_InfantryBurningFlame
	End
END


AddModule
 	Behavior = EmotionTrackerUpdate	Module_EmotionTrackerSingle
 		
 		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS; 350		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf					=	EMOTION_AFRAIDOF_OBJECTFILTER
		AlwaysAfraidOf				=	EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
		PointAt						=	EMOTION_POINTAT_OBJECTFILTER
		HeroScanDistance			=	150
		FearScanDistance			=	INFANTRY_FEAR_SCAN_RADIUS ;250

		AddEmotion	=	Terror_Base
		AddEmotion	=	Doom_Base
		AddEmotion	=   BraceForBeingCrushed_Base
		AddEmotion	=	UncontrollableFear_Base_Evil
		AddEmotion	=	FearIdle_Base
		AddEmotion	=	FearBusy_Base
		AddEmotion	=	Point_Base
		
		AddEmotion	=	OVERRIDE Taunt_Base	
 		;	AttributeModifier		=	GondorFighterTaunt
 		End	
		
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
 		QuarrelProbability		=	0.0002%
 		AddEmotion				=	Quarrel_Base
		AddEmotion	=	Alert_Base
	End
END 

;RemoveModule ModuleTag_HMC

RemoveModule ModuleTag_Test1	; Removes Pillage

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    NewWildmenWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	WeaponSet
		Conditions = PLAYER_UPGRADE 
		Weapon = PRIMARY    NewWildmenWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions      = None
		Armor           = NewWildmanArmor
		DamageFX        = NormalDamageFX
	End

END






;------- WILDMEN SHAMAN --------

ChildObject IsengardWildmanBanner IsengardWildman 

	Scale = 1.22

	KindOf = PRELOAD HERO SELECTABLE CREEP CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE CAN_USE_SIEGE_TOWER

ReplaceModule ModuleTag_01
  Draw = W3DHordeModelDraw ModuleTag_01New

	OkToChangeModelColor = Yes	  
	StaticModelLODMode = Yes
	; specify options for static LODs
	LodOptions	= LOW
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_LOW
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_LOW
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_LOW
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_LOW
	End
	
	LodOptions	= MEDIUM
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_MED
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_MED
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_MED
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_MED
	End
	
	LodOptions	= HIGH
		AllowMultipleModels		=	ALLOW_MULTIPLE_MODELS_HIGH
		MaxRandomTextures		=	MAX_RANDOM_TEXTURES_HIGH
		MaxRandomAnimations		=	MAX_RANDOM_ANIMATIONS_HIGH
		MaxAnimFrameDelta		=	MAX_ANIM_FRAME_DELTA_HIGH
	End
	
    DefaultModelConditionState
      Model = IUWildMan_SKN
      Skeleton = IUWildMan_SKL
    End

		IdleAnimationState
			Animation = IDLB
				AnimationName = IUWildMan_IDLB
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLC
				AnimationName = IUWildMan_IDLC
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLD
				AnimationName = IUWildMan_IDLD
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLE
				AnimationName = IUWildMan_IDLE
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLF
				AnimationName = IUWildMan_IDLF
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			Animation = IDLG
				AnimationName = IUWildMan_IDLG
				AnimationMode = ONCE
				AnimationPriority = 6
			End
			StateName = Idle
		End

		AnimationState			= DYING DEATH_2
			Animation
				AnimationName	= IUWildMan_IDLA
				AnimationMode	= LOOP
				AnimationBlendTime = 10
			End
		End

		AnimationState					= SPECIAL_WEAPON_ONE
			Animation = ChantA
				AnimationName = IUWildMan_TNTA
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		END

		AnimationState					= SPECIAL_WEAPON_TWO
			Animation = ChantB
				AnimationName = IUWildMan_TNTB
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		END

		AnimationState					= SPECIAL_WEAPON_THREE
			Animation = ChantC
				AnimationName = IUWildMan_TNTC
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		End

		AnimationState					= UNPACKING PACKING_TYPE_1
			Animation = ChantA
				AnimationName = IUWildMan_TNTA
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		End

		AnimationState					= UNPACKING PACKING_TYPE_2
			Animation = ChantB
				AnimationName = IUWildMan_TNTB
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		End

		AnimationState					= UNPACKING PACKING_TYPE_3
			Animation = ChantC
				AnimationName = IUWildMan_TNTC
				AnimationMode = LOOP
				AnimationPriority = 10
			End
		End

		AnimationState					= PACKING PACKING_TYPE_1
		Animation = TAUNTINGA
			AnimationName = IUWildMan_TNTA
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		END
		AnimationState					= PACKING PACKING_TYPE_2
		Animation = TAUNTINGB
			AnimationName = IUWildMan_TNTB
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		END
		AnimationState					= PACKING PACKING_TYPE_3
		Animation = TAUNTINGC
			AnimationName = IUWildMan_TNTC
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		END

		AnimationState			= DYING BURNINGDEATH
			Animation
				AnimationName	= IUWildMan_DTHA
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= IUWildMan_DTHB
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= IUWildMan_DTHC
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
		End
    AnimationState = DYING
			Animation = DyingA
				AnimationName = IUWildMan_DTHA
				AnimationMode = ONCE
				AnimationPriority = 10
			End
			Animation = DyingB
				AnimationName = IUWildMan_DTHB
				AnimationMode = ONCE
				AnimationPriority = 10
			End				
			Animation = DyingC
				AnimationName = IUWildMan_DTHC
				AnimationMode = ONCE
				AnimationPriority = 10
			End	
    End
    
		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= IUWildMan_MFDA
				AnimationMode	= LOOP
				Distance		= 90
			End
		End

	AnimationState						= PARALYZED
		Animation
			AnimationName				= IUWildMan_IDLB
			AnimationMode				= LOOP
		End
	End

	AnimationState = MOVING BACKING_UP
		Animation = BackingUp
			AnimationName = IUWildMan_BAKA
			AnimationMode = LOOP
		End
		Animation = BackingUpB
			AnimationName = IUWildMan_BAKB
			AnimationMode = LOOP
		End
		Flags = RANDOMSTART
	End
	
	AnimationState = MOVING EMOTION_TERROR
		Animation = Moving
			AnimationName = IUWildMan_RUNC
			AnimationMode = LOOP
		End
		Animation = MovingD
			AnimationName = IUWildMan_RUND
			AnimationMode = LOOP
		End
		Flags = RANDOMSTART
		ParticleSysBone = None InfantryDustTrails
    End
	
    AnimationState = MOVING DAMAGED
			Animation = Moving
				AnimationName = IUWildMan_WLKA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
			ParticleSysBone = None InfantryDustTrails
    End
 
    AnimationState = MOVING
			Animation = Moving
				AnimationName = IUWildMan_RUNA
				AnimationMode = LOOP
			End
			Animation = Moving
				AnimationName = IUWildMan_RUNB
				AnimationMode = LOOP
			End			
			Flags = RANDOMSTART
			ParticleSysBone = None InfantryDustTrails
    End
    
	AnimationState							= RAISING_FLAG
		Animation
			AnimationName					= IUWildMan_CHRA
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Animation
			AnimationName					= IUWildMan_CHRB
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Animation
			AnimationName					= IUWildMan_CHRC
			AnimationMode					= ONCE
			AnimationSpeedFactorRange		= 0.9 1.1
		End
		Flags							= RESTART_ANIM_WHEN_COMPLETE
	End
	
	AnimationState							= EMOTION_UNCONTROLLABLY_AFRAID
		Animation							= FERA
			AnimationName					= IUWildMan_FERA
			AnimationMode					= LOOP
		End
		Flags = RANDOMSTART
	End
	
	AnimationState			= STUNNED_FLAILING
		Animation
			AnimationName   = IUWildMan_FLYA
			AnimationMode   = LOOP
			AnimationSpeedFactorRange	= 0.4 0.6
		End
	End
	AnimationState			= STUNNED_STANDING_UP
		Animation
			AnimationName   = IUWildMan_GTPA
			AnimationMode   = ONCE
		End
	End
	AnimationState			= STUNNED
		Animation
			AnimationName   = IUWildMan_LNDA
			AnimationMode   = ONCE
		End
	End

    AnimationState = ATTACKING
			Animation = Attacking
				AnimationName = IUWildMan_ATKA
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKB
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKC
				AnimationMode = LOOP
				AnimationPriority = 10
			End
			Animation = Attacking
				AnimationName = IUWildMan_ATKD
				AnimationMode = LOOP
				AnimationPriority = 10
			End						
    End


    AnimationState = WAR_CHANT
		Animation = ChantA
			AnimationName = IUWildMan_TNTA
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = ChantB
			AnimationName = IUWildMan_TNTB
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = ChantC
			AnimationName = IUWildMan_TNTC
			AnimationMode = LOOP
			AnimationPriority = 10
		End		
	End

			
	;-emotions--
	
	AnimationState							= EMOTION_AFRAID
		Animation							= FERA
			AnimationName					= IUWildMan_FERA
			AnimationMode					= LOOP
		End
		Flags = RANDOMSTART
	End

	AnimationState							= EMOTION_TAUNTING
		Animation = TAUNTINGA
			AnimationName = IUWildMan_TNTA
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = TAUNTINGB
			AnimationName = IUWildMan_TNTB
			AnimationMode = LOOP
			AnimationPriority = 10
		End
		Animation = TAUNTINGC
			AnimationName = IUWildMan_TNTC
			AnimationMode = LOOP
			AnimationPriority = 10
		End	
	End
	
	AnimationState							= EMOTION_POINTING
		Animation							= Pointing1
			AnimationName					= IUWildMan_PNTA
			AnimationMode					= LOOP
		End
		Animation							= Pointing1
			AnimationName					= IUWildMan_PNTB
			AnimationMode					= LOOP
		End
	End

	AnimationState							= EMOTION_CELEBRATING
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRA
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRB
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
		Animation                           = CHRA
			AnimationName					= IUWildMan_CHRC
			AnimationMode					= LOOP
			AnimationPriority = 10
		End
	End
	
	AnimationState							= EMOTION_ALERT
		Animation							= ALERT
			AnimationName					= IUWildMan_IDLA
			AnimationMode					= LOOP
		End
		Flags								= RESTART_ANIM_WHEN_COMPLETE RANDOMSTART
	End
        
  End
END	;ReplaceModule


AddModule
	Draw = W3DHordeModelDraw ModuleTag_01bbb
		StaticModelLODMode = Yes ; Will append M or L to the skin name depending on GameLO
		DefaultModelConditionState
			Model			= None
			ParticleSysBone     = None ShamanIconParticle FXTrigger:NONE Persist:SPAWN PersistID:100
		End
	END
END

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_ShamanIconModifier
	TriggeredBy 		= Upgrade_IsengardHeavyArmor
	AttributeModifier 	= ShamanIconAttributeModifier
	End
  END

	CommandPoints = 0

	CommandSet = WildmanShaman

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth         	= 2000 ; 375
		MaxHealthDamaged  	= 500
		BurningDeathBehavior	= Yes
		BurningDeathFX		= FX_InfantryBurningFlame
	End
END

;RemoveModule ModuleTag_HMC

RemoveModule ModuleTag_Test1	; Removes Pillage

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    NewWildmenWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	WeaponSet
		Conditions = PLAYER_UPGRADE 
		Weapon = PRIMARY    NewWildmenWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions      = None
		Armor           = WildmanShamanArmor
		DamageFX        = NormalDamageFX
	End
	
	ArmorSet
		Conditions	= PLAYER_UPGRADE
		Armor		= WildmanShamanArmor
		DamageFX	= NormalDamageFX
	End

	AddModule
	  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
		CreationList			= OCL_BossChest
	  End
	End

;--------- War Chant ----------


AddModule
	Behavior = SpecialPowerModule		ModuleTag_NewSpellBookWarChant
		SpecialPowerTemplate		= NewSpellBookWarChant
		AttributeModifier		= ShamanChant
		AttributeModifierRange		= 160
		AttributeModifierAffects	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
		AttributeModifierAffectsSelf	= No
		TriggerFX			= FX_SpellWarChant
		InitiateSound			= WildMenVoiceSelectBattle
		UpdateModuleStartsAttack	= Yes
	End
END

AddModule	
	Behavior = SpecialAbilityUpdate ModuleTag_NewSpellBookWarChantAnimation
		UnpackTime              = 1000
		UnpackingVariation	= 1
		SpecialPowerTemplate	= NewSpellBookWarChant
 		PreparationTime         = 1  
 		PersistentPrepTime      = 1
 		PackTime                = 1500
 	End
END

;--------- Call Wyrm ----------

AddModule
	Behavior = SpecialPowerModule ModuleTag_AwakenWyrmStarter
		SpecialPowerTemplate		= NewSpellBookAwakenWyrm
		UpdateModuleStartsAttack	= Yes
	End
END

AddModule
  Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WyrmFakeWeaponFire
	SpecialPowerTemplate    = NewSpellBookAwakenWyrm
	SpecialWeapon		= ShamanCallWyrm
	WhichSpecialWeapon	= 3
	StartAbilityRange	= 1.0
	
	SkipContinue		= Yes
	UnpackTime		= 1800
	PackTime		= 1200
	MustFinishAbility	= Yes
  End
END

;AddModule	
;	Behavior = SpecialAbilityUpdate ModuleTag_NewSpellBookWyrmAnimation
;		UnpackTime              = 1
;		UnpackingVariation	= 1
;		SpecialPowerTemplate	= NewSpellBookAwakenWyrm
; 		PreparationTime         = 0  
; 		PersistentPrepTime      = 0
; 		PackTime                = 1
; 	End
;END

END



CommandButton Command_ConstructInnIsengardWildmanHorde
	Command			= UNIT_BUILD
	Object			= IsengardWildman
	Options			= CANCELABLE
	TextLabel		= CONTROLBAR:ConstructIsengardWildmanHorde
	ButtonImage		= BCInn_WildmenofDunland
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildIsengardWildmanHorde
	Radial			= Yes
	InPalantir	   	= No
	ShowProductionCount	= Yes     
End


CommandSet WildmenRecruiter
  1 =  Command_ConstructInnIsengardWildmanHorde
END

Object WildmenBuildingHouse

  CommandSet = WildmenRecruiter

  KindOf              = PRELOAD STRUCTURE SELECTABLE NOT_AUTOACQUIRABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MADE_OF_WOOD

AddModule
	Behavior = QueueProductionExitUpdate ModuleTag_11
		UnitCreatePoint		= X:-10.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:22.0 Y:0.0 Z:0.0
		ExitDelay		= STANDARD_HORDE_EXIT_DELAY
		UseReturnToFormation	= No
	End
END

AddModule
  Behavior = ProductionUpdate ProductionUpdateModuleTag
    GiveNoXP	= Yes
  End
END

END



Object WildmenBuildingHouse2

  CommandSet = WildmenRecruiter

  KindOf = PRELOAD STRUCTURE SELECTABLE NOT_AUTOACQUIRABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MADE_OF_WOOD

AddModule
	Behavior = QueueProductionExitUpdate ModuleTag_11
		UnitCreatePoint		= X:-10.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:49.0 Y:0.0 Z:0.0
		ExitDelay		= STANDARD_HORDE_EXIT_DELAY
		UseReturnToFormation	= No
	End
END

AddModule
  Behavior = ProductionUpdate ProductionUpdateModuleTag
    GiveNoXP	= Yes
  End
END

END


; ------
; Wildmen Wyrm
; ------


Weapon WyrmAttack
	ClearNuggets ;;.;;
	IdleAfterFiringDelay		= 0
	AttackRange			= 80
	WeaponSpeed			= 400										; dist/sec
	RadiusDamageAffects		= ENEMIES NOT_SIMILAR
	DelayBetweenShots		= 1000                ; time between shots, msec
	PreAttackDelay			= 640     ;1800
	PreAttackType			= PER_SHOT
	FiringDuration			= 200    ;3000
	AcceptableAimDelta		= 10

	DamageNugget															; A basic Nugget that just does damage
		Damage			= 1350	; 3500
		Radius			= 0	; 80
		DamageType		= HERO
		DamageFXType		= CLUBBING
;		DeathType		= NORMAL
;		DamageArc		= 0	;110
;		DamageMaxHeight		= 50												; We won't hurt something far above us.  Birds fly at around 100
		DamageSpeed		= 400
	End

End

Armor SwampWormArmor
  Armor = DEFAULT		20%
  Armor = HERO			32%
  Armor = MAGIC			20%
  Armor = HERO_RANGED		32%
End

Weapon NewWyrmAppearWeapon
	ClearNuggets ;;.;;

	RadiusDamageAffects	= ALLIES ENEMIES NOT_SIMILAR
	AttackRange			= 4.0

	DamageNugget
		Damage        = WYRM_APPEAR_DAMAGE
		Radius        = 20
		DelayTime     = 0
		DamageType    = CRUSH
		DamageFXType  = SWORD_SLASH
		DeathType     = NORMAL
		DamageScalar  = 0% NONE +Wyrm
	End

	MetaImpactNugget
		ShockWaveAmount			= 75
		ShockWaveRadius			= 20
		ShockWaveTaperOff		= 0.9
		ShockWaveZMult			= 0.70
		DelayTime			= 0
		ShockWaveClearRadius		= Yes
		ShockWaveClearMult		= 0.75
		ShockWaveClearFlingHeight	= 15
	End

End


Weapon NewWyrmDisappearWeapon
	ClearNuggets ;;.;;

	RadiusDamageAffects	= ALLIES ENEMIES NOT_SIMILAR
	AttackRange           = 4.0

	MetaImpactNugget
		ShockWaveAmount		= 25
		ShockWaveRadius		= 10.0
		ShockWaveTaperOff	= 0.9
		ShockWaveZMult		= 1.20
		DelayTime		= 333
	End
  
End


Object Wyrm

	Scale = 0.4

;	AttackContactPoint = X:-0 Y:-0 Z:10

ReplaceModule ModuleTag_Draw
	Draw = W3DScriptedModelDraw ModuleTag_DrawNew
	
		ExtraPublicBone = B_HEAD
	
		DefaultModelConditionState
			Model = CUWyrm_SKN
			Skeleton = CUWyrm_SKL
		End
		
		
		IdleAnimationState
			Animation
				AnimationName		= CUWyrm_IDLA
				AnimationMode		= ONCE
				AnimationBlendTime	= 5				; mainly to blend from the turns
			End
			
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
;			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			;ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
		End
		
		AnimationState				= JUST_BUILT
			StateName				= State_JustBuilt
			Animation
				AnimationName		= CUWyrm_SMNA
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
			End
			
			ParticleSysBone = NONE WyrmSplashCloudSpawn FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
			
			ParticleSysBone = NONE WyrmDustCloudSpawn FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksSpawn FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
		End
		
		AnimationState				= DYING DEATH_1 SWIMMING	; Killed in deep water
			Animation
				AnimationName		= CUWyrm_DIEB
				AnimationMode		= ONCE
				AnimationBlendTime	= 15
			End

			ParticleSysBone = NONE WyrmSplashCloudDie01 FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashDie01 FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_JAW WyrmSplashCloudDie02		FollowBone:Yes  OnlyIfOnWater:Yes		
		End
		
		AnimationState				= DYING DEATH_1				; Killed
			Animation
				AnimationName		= CUWyrm_DIEA 
				AnimationMode		= ONCE
				AnimationBlendTime	= 15
			End
			ParticleSysBone = NONE WyrmDustCloudDie01 FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksDie01 FollowBone:Yes OnlyIfOnLand:Yes
			
			ParticleSysBone = NONE WyrmSplashCloudDie01 FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashDie01 FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_JAW WyrmSplashCloudDie02		FollowBone:Yes  OnlyIfOnWater:Yes		
		End
		
		AnimationState				= DYING DEATH_2				; Timer runs out
			Animation
				AnimationName		= CUWyrm_SMNA
				AnimationMode		= ONCE_BACKWARDS
				AnimationBlendTime	= 15
			End
			Flags					= START_FRAME_LAST
			ParticleSysBone = NONE WyrmSplashCloudSpawn FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
			
			ParticleSysBone = NONE WyrmDustCloudUnSpawn FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
		End

		AnimationState = UNPACKING
			Animation			= Dive
				AnimationName	= CUWyrm_DIVA
				AnimationMode	= ONCE
			End
			
			ParticleSysBone = B_TAIL01 WyrmDustCloudDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL03 WyrmDustCloudDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL05 WyrmDustCloudDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL07 WyrmDustCloudDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL09 WyrmDustCloudDive FollowBone:Yes OnlyIfOnLand:Yes
			
			ParticleSysBone = B_TAIL01 WyrmSplashCloudDive FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_TAIL03 WyrmSplashCloudDive FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_TAIL05 WyrmSplashCloudDive FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_TAIL07 WyrmSplashCloudDive FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = B_TAIL09 WyrmSplashCloudDive FollowBone:Yes OnlyIfOnWater:Yes
			
			ParticleSysBone = B_TAIL01 WyrmRocksDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL03 WyrmRocksDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL05 WyrmRocksDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL07 WyrmRocksDive FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = B_TAIL09 WyrmRocksDive FollowBone:Yes OnlyIfOnLand:Yes

			
			FXEvent	= Frame:44 FireWhenSkipped Name:FX_WyrmDiveHoleAtBone
			
			ParticleSysBone = NONE WyrmRocksDiveHole FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			
			ParticleSysBone = NONE WyrmSplashDiveHole FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			
		End

		AnimationState = PACKING
			Animation			= Popup
				AnimationName	= CUWyrm_SMNA
				AnimationMode	= ONCE
			End
			ParticleSysBone = NONE WyrmDustCloudSpawn FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksSpawn FollowBone:Yes OnlyIfOnLand:Yes
			
			ParticleSysBone = NONE WyrmSplashCloudSpawn FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
		End

		AnimationState = FIRING_OR_PREATTACK_A
			Animation
				AnimationName		= CUWyrm_ATKB
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
				UseWeaponTiming = Yes
			End
;			ParticleSysBone = B_JAW WyrmFireBreath		FollowBone:Yes
;			ParticleSysBone = B_JAW WyrmBreathSmoke	FollowBone:Yes
;			ParticleSysBone = B_JAW WyrmFireProxy	FollowBone:Yes
			;ParticleSysBone = B_JAW balrogBreathProxy	FollowBone:Yes		
			
;			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
;			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes	 OnlyIfOnLand:Yes
			
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
			
		End
		
		AnimationState = HIT_REACTION
			Animation
				AnimationName		= CUWyrm_HITA
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
			End
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
			

			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
		End
		
		AnimationState = TURN_LEFT
			Animation
				AnimationName		= CUWyrm_TRNL
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
			ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
			ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
			
			ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
			ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
		End
		
		AnimationState = TURN_RIGHT
			Animation
				AnimationName		= CUWyrm_TRNR
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
  		ParticleSysBone = NONE WyrmDustCloudIdle FollowBone:Yes OnlyIfOnLand:Yes
  		ParticleSysBone = NONE WyrmRocksIdle FollowBone:Yes OnlyIfOnLand:Yes
  		
  		ParticleSysBone = NONE WyrmSplashCloudIdle FollowBone:Yes OnlyIfOnWater:Yes
		ParticleSysBone = NONE WyrmSplashIdle FollowBone:Yes OnlyIfOnWater:Yes
  		
		End
	End
END

ReplaceModule ModuleTag_AnimAudioBehavior
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehaviorNew
		MaxUpdateRangeCap = 800
		AnimationSound = Sound: WyrmMove			Animation:CUWyrm_SKL.CUWyrm_ATKA	Frames: 1
		AnimationSound = Sound: WyrmAttackMS			Animation:CUWyrm_SKL.CUWyrm_ATKA	Frames: 15
		AnimationSound = Sound: WyrmMove			Animation:CUWyrm_SKL.CUWyrm_ATKB	Frames: 1 25
		AnimationSound = Sound: WyrmAttackTentacle		Animation:CUWyrm_SKL.CUWyrm_ATKB	Frames: 3
;		AnimationSound = Sound: WyrmVoxDie			Animation:CUWyrm_SKL.CUWyrm_ATKB	Frames: 50
		AnimationSound = Sound: WyrmAttackTentacle		Animation:CUWyrm_SKL.CUWyrm_DIVA	Frames: 10
		AnimationSound = Sound: WyrmDiveMS			Animation:CUWyrm_SKL.CUWyrm_DIVA	Frames: 35
		AnimationSound = Sound: WyrmVoxDie			Animation:CUWyrm_SKL.CUWyrm_DIVA	Frames: 5
		AnimationSound = Sound: WyrmMove			Animation:CUWyrm_SKL.CUWyrm_DIVA	Frames: 15
		AnimationSound = Sound: WyrmVoxHurt			Animation:CUWyrm_SKL.CUWyrm_HITA	Frames: 1
		AnimationSound = Sound: WyrmMove			Animation:CUWyrm_SKL.CUWyrm_HITA	Frames: 2 29 55
		AnimationSound = Sound: WyrmAttackMS			Animation:CUWyrm_SKL.CUWyrm_SMNA	Frames: 5
		AnimationSound = Sound: WyrmDiveMS			Animation:CUWyrm_SKL.CUWyrm_SMNA	Frames: 1
		AnimationSound = Sound: WyrmAttackTentacle		Animation:CUWyrm_SKL.CUWyrm_ATKA	Frames: 10
		AnimationSound = Sound: WyrmAttackTentacle		Animation:CUWyrm_SKL.CUWyrm_ATKB	Frames: 24
		AnimationSound = Sound: WyrmMove			Animation:CUWyrm_SKL.CUWyrm_DIEA	Frames: 2 25 50 121
		AnimationSound = Sound: WyrmVoxDie			Animation:CUWyrm_SKL.CUWyrm_DIEA	Frames: 1 125
		AnimationSound = Sound: WyrmBodyfallHeavy		Animation:CUWyrm_SKL.CUWyrm_DIEA	Frames: 134
		AnimationSound = Sound: WyrmBodyfallLight		Animation:CUWyrm_SKL.CUWyrm_DIEA	Frames: 20 66
	End
END

ReplaceModule ModuleTag_TeleportUpdate
	Behavior = TeleportSpecialAbilityUpdate ModuleTag_TeleportUpdateNew
		SpecialPowerTemplate		= SpecialAbilityWyrmReposition
		UnpackTime			= 3200				; diving underground
		PackTime			= 2100				; errupting out of the ground
		ApproachRequiresLOS		= No
		DestinationWeaponName		= NewWyrmAppearWeapon		; Fires at point of teleport to push people away and down.
		SourceWeaponName		= NewWyrmDisappearWeapon
	End
END

ReplaceModule ModuleTag_AutoAbilityBehavior
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehaviorNew
		SpecialAbility			= SpecialAbilityWyrmReposition	; Use this ability
		StartsActive			= Yes				; Active immediately.
		BaseMaxRangeFromStartPos	= Yes				; Use the starting position rather than the current.
		AdjustAttackMeleePosition	= Yes				; Offset attacking position away from large objects.
		MaxScanRange			= 750				; Target must be within this range.
		MinScanRange			= 30				; Target must be further away than this.
		AllowSelf			= No
		IdleTimeSeconds			= 8; 2						; Must be idle for this long to consider the ability, stops attacks being interrupted.
		Query				= 1 ANY ENEMIES +INFANTRY -HORDE -SWARM_DOZER	; Infantry first please.
		Query				= 1 ALL ENEMIES NOT_FLYING_UNITS -SWARM_DOZER	; Then any other enemy.
	End
END

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY	WyrmAttack
	End

	ArmorSet
		Conditions      = None
		Armor           = SwampWormArmor
	End

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_NewBody
		MaxHealth = 8000 ; 15000
	End
END

RemoveModule ModuleTag_LifetimeUpdate

	HealthBoxHeightOffset	= -30.0

	Geometry		= CYLINDER
	GeometryMajorRadius	= 15
	GeometryHeight		= 25
	GeometryIsSmall = No;Yes
END


;-----------------------------------
; The necropolis stuff
;-----------------------------------

;-----------
; Ghosts
;-----------

Locomotor NewGhostsLocomotor
	Surfaces		= GROUND RUBBLE WATER IMPASSABLE
	TurnTime		= 500
	TurnTimeDamaged		= 500
	FastTurnRadius		= 10		; Can turn in a 10 foot radius circle when moving.
	SlowTurnRadius		= 0		; Turns in place from a standing start.
	Acceleration		= 510		; .5 second to accelerate to full speed.
	FormationPriority	= MELEE1	;MELEE2
	Braking			= 510		; .51 second to brake from full speed.
	MinTurnSpeed		= 0%
	ZAxisBehavior		= FLOATING_Z
	Appearance		= TWO_LEGS
	StickToGround		= Yes		; walking guys aren't allowed to catch huge (or even small) air.
	CanMoveBackwards	= No		; Can move backwards when afraid.

	ChargeAvailable		= Yes		; Locomotor has defined charging attack values to use
	ChargeSpeed		= 400%
	ChargeIgnoresCondition	= Yes		; Will charge no matter what the condition.
End


Weapon GhostSword
	ClearNuggets ;;.;;
  RadiusDamageAffects = ENEMIES NEUTRALS
  LeechRangeWeapon      = Yes
  AttackRange           = 20.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = 300
  PreAttackDelay        = 200
  PreAttackType         = PER_SHOT
  FireFX                = FX_GondorSwordHit
  FiringDuration        = 300

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 70; 300
    DamageScalar  = 10% NONE +GondorAragorn +STRUCTURE
    Radius        = 10.0
    DelayTime     = 0
    DamageType    = MAGIC
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End
End


Armor GhostArmor
  Armor = DEFAULT		10%     ;this sets the level for all nonspecified damage types
  Armor = HERO			10%
  Armor = HERO_RANGED		10%   
  Armor = MAGIC			120%     
End



Object AragornOathbreaker1

ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01New

		DefaultModelConditionState
			Model               = RUOath3A_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End


		AnimationState        = MOVING ATTACKING
			Animation           = RUNA
				AnimationName     = RUOath3_RUNA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.7 0.7
			End
			Flags               = RANDOMSTART
		End		

		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3A_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End

		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.0
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3_ATKA
				AnimationMode     = LOOP
			End
		End


		AnimationState        = MOVING
			Animation           = WLK
				AnimationName     = RUOath3_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End
		
	End
END

	IsTrainable = Yes

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    GhostSword
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	ArmorSet
		Conditions      = None
		Armor           = GhostArmor
		DamageFX        = NormalDamageFX
	End
	LocomotorSet
		Locomotor = NewGhostsLocomotor
		Condition = SET_NORMAL 
		Speed     = 15
	End

ReplaceModule ModuleTag_03
	Behavior = AIUpdateInterface ModuleTag_03New
		AutoAcquireEnemiesWhenIdle	=	Yes ATTACK_BUILDINGS
		MoodAttackCheckRate			=	500
		AttackPriority				= 	AttackPriority_Infantry
	End
END


	VoicePriority		= 40
	
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_OF_DEAD ; ATTACK_NEEDS_LINE_OF_SIGHT 
	
ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth         = 2000	;2700 was too much                
		MaxHealthDamaged  = 1000
		;RecoveryTime      = 15000
	End
END

RemoveModule ModuleTag_LifetimeUpdate	; Removes fade
	
RemoveModule ModuleTag_06			; Removes area damage
	
End


Object AragornOathbreaker2

ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01New

		DefaultModelConditionState
			Model               = RUOath3B_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3B_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End


		AnimationState        = MOVING ATTACKING
			Animation           = RUNA
				AnimationName     = RUOath3B_RUNA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.7 0.7
			End
			Flags               = RANDOMSTART
		End		

		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3AB_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End

		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3B_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3B_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.0
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3B_ATKA
				AnimationMode     = LOOP
			End
		End


		AnimationState        = MOVING
			Animation           = WLK
				AnimationName     = RUOath3B_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End
		
	End
END

	IsTrainable = Yes

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    GhostSword
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	ArmorSet
		Conditions      = None
		Armor           = GhostArmor
		DamageFX        = NormalDamageFX
	End
	LocomotorSet
		Locomotor = NewGhostsLocomotor
		Condition = SET_NORMAL 
		Speed     = 15
	End


	VoicePriority		= 40
	
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CREEP INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ARMY_OF_DEAD
	
ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth         = 2000	;2700 was too much
		MaxHealthDamaged  = 2000
		;RecoveryTime      = 15000
	End
END

RemoveModule ModuleTag_LifetimeUpdate	; Removes fade
	
RemoveModule ModuleTag_06			; Removes area damage
	
End

Object AragornOathbreaker3

ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01New

		DefaultModelConditionState
			Model               = RUOath3C_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3C_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End


		AnimationState        = MOVING ATTACKING
			Animation           = RUNA
				AnimationName     = RUOath3C_RUNA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.7 0.7
			End
			Flags               = RANDOMSTART
		End		

		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3AC_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End

		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3C_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3C_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.0
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3C_ATKA
				AnimationMode     = LOOP
			End
		End


		AnimationState        = MOVING
			Animation           = WLK
				AnimationName     = RUOath3C_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End
		
	End
END

	IsTrainable	= Yes
	CommandPoints	= 0
	BuildCost	= 0
	BuildTime	= 1

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    GhostSword
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	ArmorSet
		Conditions      = None
		Armor           = GhostArmor
		DamageFX        = NormalDamageFX
	End
	LocomotorSet
		Locomotor = NewGhostsLocomotor
		Condition = SET_NORMAL 
		Speed     = 15
	End


	VoicePriority		= 40
	
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CREEP INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ARMY_OF_DEAD
	
ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth         = 2000	;2700 was too much
		MaxHealthDamaged  = 2000
		;RecoveryTime      = 15000
	End
END

RemoveModule ModuleTag_LifetimeUpdate	; Removes fade
	
RemoveModule ModuleTag_06			; Removes area damage

End


;------------------
; Ghost Spawner
;------------------


;CommandButton Command_SpecialAbilityMoveUnseen 
;	Command			= UNIT_BUILD
;	SpecialPower		= NONE
;	Object			= AragornOathbreaker
;	Options			= CANCELABLE
;	TextLabel		= CONTROLBAR:MoveUnseen
;	ButtonImage		= HSThranduilMoveUnseen
;	RadiusCursorType	= MoveUnseenRadiusCursor
;	InvalidCursorName	= GenericInvalid
;	ButtonBorderType	= BUILD
;	DescriptLabel		= CONTROLBAR:ToolTipMoveUnseen
;	ShowProductionCount	= Yes      
;	InPalantir		= Yes
;	Radial			= Yes
;End

CommandSet GhostRecruiter
;	1 = Command_SpecialAbilityMoveUnseen
	6 = Command_Sell
END

FXParticleSystem GreenishGlow
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLnzFlar1.tga
    Lifetime = 100 100
    SortLevel = 1
    BurstDelay = 100 100
    BurstCount = 4 5
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:0 0
    Color2 = R:0 G:120 B:0 25
    Color3 = R:0 G:0 B:0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 2
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:15
    EndPoint = X:0 Y:0 Z:50
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GreenishDeathGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar2.tga
    Lifetime = 40 40
    Size = 5 5
    SystemLifetime = 20
    SortLevel = 1
    BurstDelay = 100 100
    BurstCount = 2 3
;    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:0 0
    Color2 = R:0 G:120 B:0 5
    Color3 = R:0 G:0 B:0 20
  End
  Update = DefaultUpdate
    SizeRate = 10 16
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:0
    EndPoint = X:0 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem GhostSpawnerChunks
  System
    Priority = LOW_OR_ABOVE
    Shader = ALPHA
    Type = DRAWABLE
    ParticleName = exground01.w3d
    Lifetime = 150 150
    SystemLifetime = 2
    Size = 0.3 1
    BurstCount = 8 12
  End
  Color = DefaultColor
    Color2 = R:30 G:30 B:30 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -500 500
    AngularRateZ = -0.5 0.5
    AngularDamping = 1 1
    Rotation = ROTATE_V
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
    Z = 1.5 3
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:20
    EndPoint = X:0 Y:0 Z:0
  End
  Draw = RenderObjectDraw
  End
  Event = TerrainCollision
    HeightOffset = 0 0
;    EventFX = FX_CatapultRockChunks
    OrientFXToTerrain = No
    PerParticle = Yes
    KillAfterEvent = Yes
  End
End


FXList FX_GreenishCollapse
  ParticleSystem
    Name = PCTSmallDust
  End
  ParticleSystem
    Name = GreenishDeathGlow
  End
  ParticleSystem
    Name = GhostSpawnerChunks
;    Offset = X:0.0 Y:0.0 Z:18.0
  End
  ViewShake 
    Type = NORMAL
  End
  Sound
    Name = BuildingSink
  End
End



Object GBGHGenDecB		; Ghost spawner

	CommandSet	= GhostRecruiter
	KindOf		= PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MADE_OF_WOOD
	DisplayName	= OBJECT:Tombstone
	RadarPriority	= STRUCTURE

AddModule						; Greenish effect
	Draw = W3DScriptedModelDraw TheGreenEffect
		ModelConditionState	= NONE
			Model		= None
			ParticleSysBone NONE GreenishGlow
		End
	End
END

ReplaceModule ModuleTag_Draw
	Draw = W3DScriptedModelDraw ModuleTag_DrawNew
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes

		DefaultModelConditionState
			Model = GBGHGenDecA
		End

		ModelConditionState  = RUBBLE
			Model         = GBMarket_D3
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState = RUBBLE
			EnteringStateFX	= FX_StructureMediumCollapse
			Animation	= ReallyDamagedAnimation
			AnimationName	=	GBMarket_D3SK.GBMarket_D3AN
			AnimationMode	=	ONCE	
		End
    End

	End
END

	ArmorSet
		Conditions					= None
		Armor						= StructureArmor
	End

AddModule
	Body = StructureBody ModuleTag_05New
		MaxHealth		= 4000
		MaxHealthDamaged	= 1000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule								; Falls into the ground when "killed"
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_GreenishCollapse
		CollapseHeight				= 10
	End
END

	Flammability
		Fuel						= ELVEN_STATUE_FIRE_FUEL
		MaxBurnRate					= ELVEN_STATUE_FIRE_MAX_BURN_RATE
		Decay						= ELVEN_STATUE_FIRE_DECAY
		Resistance					= ELVEN_STATUE_FIRE_RESISTANCE
	End

AddModule
	Behavior = QueueProductionExitUpdate ModuleTag_11
		UnitCreatePoint		= X:0.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:15.0 Y:0.0 Z:0.0
		ExitDelay		= STANDARD_HORDE_EXIT_DELAY
		UseReturnToFormation	= No
	End
END

AddModule
  Behavior = ProductionUpdate ProductionUpdateModuleTag
    GiveNoXP	= Yes
  End
END

	Geometry		= CYLINDER
	GeometryMajorRadius	= 13.0
	GeometryMinorRadius	= 13.0
	GeometryHeight		= 36
	GeometryOffset		= X:0 Y:0 Z:0
	GeometryIsSmall		= No
	HealthBoxScale		= 3.0

End



Object TombColumn01
  KindOf = PRELOAD STRUCTURE NO_COLLIDE OPTIMIZED_PROP SCORE

AddModule
  Body                = StructureBody ModuleTag_05
    MaxHealth         = 20.0
  End
END

END

;------------
;Treasure Tomb
;------------
; Ghosts are now spawned via OCL


ObjectCreationList SpawnActualGhosts
	CreateObject
		ObjectNames = AragornOathbreaker
		Count					= 6
		UseJustBuiltFlag			= Yes
		IgnoreCommandPointLimit			= Yes
		SpreadFormation				= Yes
		MinDistanceAFormation			= 40.0
		MinDistanceBFormation			= 80.0
		MaxDistanceFormation			= 240.0
		FadeIn					= Yes
		FadeTime				= 1000
		IgnoreCommandPointLimit			= Yes
	End
End

ObjectCreationList SpawnActualGhostsForCementery
	CreateObject
		ObjectNames = AragornOathbreaker
		Count					= 9
		UseJustBuiltFlag			= Yes
		IgnoreCommandPointLimit			= Yes
		SpreadFormation				= Yes
		MinDistanceAFormation			= 60.0
		MinDistanceBFormation			= 140.0
		MaxDistanceFormation			= 240.0
		FadeIn					= Yes
		FadeTime				= 1000
		IgnoreCommandPointLimit			= Yes
	End
End

ObjectCreationList SpawnActualGhostsForVampireBoss
	CreateObject
		ObjectNames = AragornOathbreaker
		Count					= 1
		UseJustBuiltFlag			= Yes
		IgnoreCommandPointLimit			= Yes
		SpreadFormation				= Yes
		MinDistanceAFormation			= 1.0
		MinDistanceBFormation			= 1.0
		MaxDistanceFormation			= 1.0
		FadeIn					= Yes
		FadeTime				= 2000
		IgnoreCommandPointLimit			= Yes
	End
End









FXParticleSystem OathBreakerSmoke4Small
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire01.tga
    Lifetime = 100 100
    SystemLifetime = 45
    Size = 8 8
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:46 G:51 B:38 50
    Color3 = R:0 G:0 B:0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 0.9 0.99
    AngleZ = -1 1

    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.98 0.985
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 2 3
    OtherSpeed = 0.3 0.3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 10
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindStrength = 0.5
    WindFullStrengthDist = 5
    WindZeroStrengthDist = 100
    WindAngleChangeMin = 0.034
    WindAngleChangeMax = 0.034
    WindPingPongStartAngleMin = 1.22
    WindPingPongStartAngleMax = 1.22
    WindPingPongEndAngleMin = 1.99
    WindPingPongEndAngleMax = 1.99
  End
End

FXParticleSystem OathBreakerSmokeGlowSmall
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLnzFlar2.tga
    Lifetime = 120 120
    SystemLifetime = 45
    Size = 1 1
    BurstDelay = 7 9
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:82 G:80 B:63 0
    Color2 = R:0 G:0 B:0 120
  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.9 0.99
    AngleZ = -1 1
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.985 0.99
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 2 2.5
    OtherSpeed = 0.3 0.3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 5
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindStrength = 0.5
    WindFullStrengthDist = 5
    WindZeroStrengthDist = 600
    WindAngleChangeMin = 0.034
    WindAngleChangeMax = 0.034
    WindPingPongStartAngleMin = 1.22
    WindPingPongStartAngleMax = 1.22
    WindPingPongEndAngleMin = 1.99
    WindPingPongEndAngleMax = 1.99
    TurbulenceAmplitude = 0.01
    TurbulenceFrequency = 1
  End
End

FXParticleSystem OathBreakerFlareSmall
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar2.tga
    Lifetime = 100 100
    SystemLifetime = 40
    SortLevel = 1
    Size = 15 15
    BurstDelay = 5 5
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:1 G:1 B:1 0
    Color2 = R:47 G:62 B:45 25
    Color3 = R:0 G:0 B:0 75
  End
  Update = DefaultUpdate
    SizeRate = 3 6
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:0 Z:0.5
    EndPoint = X:0 Y:0 Z:0.5
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem oathBreakerLightShaftSmall
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = W3D_EMISSIVE
    Type = DRAWABLE
    ParticleName = exlight01.w3d
    Lifetime = 90 90
    SystemLifetime = 30
    SortLevel = 1
    Size = 0.1 0.1
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:57 G:67 B:39 0
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.1 0.1 10
    Alpha3 = 0 0 90
  End
  Update = DefaultUpdate
    SizeRate = 0.05 0.05
    SizeRateDamping = 0.95 0.97
    AngleZ = -500 500
    AngularDamping = 1 1
    Rotation = ROTATE_Z
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 15
  End
  Draw = RenderObjectDraw
  End
End



FXList FX_SummonAODSmall
  ParticleSystem
    Name = OathBreakerSmokeGlowSmall
  End
  ParticleSystem
    Name = OathBreakerSmoke4Small
  End
  ParticleSystem
    Name = OathBreakerFlareSmall
  End
  ParticleSystem
    Name = oathBreakerLightShaftSmall
  End
  Sound
    Name = ArmyDeadEnterMono
  End
End

Object DunedainAlliesSummonEgg
ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 4000
		FX = MIDPOINT FX_SummonAOD
		OCL = FINAL SpawnActualGhosts
	End
END
End




Object PhalanxSummonEgg
ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 4000
		FX = INITIAL FX_SummonAOD
		OCL = MIDPOINT SpawnActualGhostsForCementery
	End
END
End



Object ElvenWoodTreeSeed
	KindOf = IMMOBILE UNATTACKABLE
RemoveModule ModuleTag_SpawnRealTree
AddModule
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 4000
		FX = INITIAL FX_SummonAODSmall
		OCL = MIDPOINT SpawnActualGhostsForVampireBoss
	End
END

END



ObjectCreationList OCL_TreasureTombChests
	CreateObject
		ObjectNames				= TreasureChest2
		Count					= 4
		SpreadFormation				= Yes
		MinDistanceAFormation			= 0.0
		MinDistanceBFormation			= 40.0
		MaxDistanceFormation			= 75.0
		FadeIn					= No
		IgnoreAllObjects			= Yes
		InvulnerableTime			= 3000	; This is the amount of time before we can pick this crate up.
	End
	CreateObject
		ObjectNames				= DunedainAlliesSummonEgg
		Count					= 1
;		UseJustBuiltFlag			= Yes
		IgnoreCommandPointLimit			= Yes
		FadeIn					= No
	End
End

Armor TreasureTombArmor
 Armor = DEFAULT		25%
 Armor = PIERCE			1%
 Armor = HERO_RANGED		1%
 Armor = MAGIC			1%
 Armor = FLAME			1%
 Armor = CAVALRY_RANGED		1%
End

Object NecromancerStatue

  ArmorSet
    Conditions			= None
    Armor			= TreasureTombArmor
  End

	DisplayName         = OBJECT:Tombstone
	 
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE MADE_OF_STONE SCARY CHUNK_VENDOR NOT_AUTOACQUIRABLE	


ReplaceModule ModuleTag_05
	Body = ActiveBody ModuleTag_05New
		MaxHealth		= 800
		MaxHealthDamaged	= 400.0
		MaxHealthReallyDamaged  = 150.0
	End
END

AddModule
  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
	CreationList			= OCL_TreasureTombChests
  End
End
  
RemoveModule ModuleTag_SoWeCanUseWeapon
RemoveModule ModuleTag_GateFear
RemoveModule ModuleTag_GateFearUpdate

End

;------------------
; Vampires
;------------------

FXParticleSystem LifeLeechHitParticle
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= EXsparkLight.tga
    Lifetime		= 40 50
    SortLevel		= 1
    SystemLifetime	= 25
    Size		= 8 12
    BurstDelay		= 9 9
    BurstCount		= 4 5
  End
  Color = DefaultColor
    Color1		= R:255 G:0 B:220 0
    Color2		= R:255 G:0 B:0   10
    Color3		= R:0 G:0 B:0 50
  End
  Update = DefaultUpdate
    SizeRate		= 1 1.2
;    SizeRateDamping	= 0.8 0.8
    AngleZ		= -180 180
    AngularRateZ	= -0.05 0.05
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping	= 0.85 0.85
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    Z			= 0 3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 5
    Length		= 5
    Offset		= X:0 Y:0 Z:2
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem LifeLeechEnergyTransfer
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exgandalfstaffflare2.tga
    Lifetime		= 40 40
    SortLevel		= 1
    SystemLifetime	= 68
    Size		= 2 3
    BurstDelay		= 3 3
    BurstCount		= 6 8
    InitialDelay	= 13 13
  End
  Color = DefaultColor
    Color1		= R:255 G:0 B:170 0
    Color2		= R:255 G:0 B:0 5
    Color3		= R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
;    SizeRate		= 0.5 0.5
;    SizeRateDamping	= 0.8 0.8
    AngleZ		= 0 0
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1.15 1.15
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.05 -0.05
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 18
    Length = 15
    Offset = X:0 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End

FXList FX_LifeLeech
  ParticleSystem
    Name = LifeLeechEnergyTransfer
    Offset = X:35.0 Y:0.0 Z:10.0
    OrientToObject = Yes
  End
  ParticleSystem
    Name = LifeLeechHitParticle
    Offset = X:35.0 Y:0.0 Z:15.0
    OrientToObject = Yes
  End
  Sound
	Name = RingOn
  End
End



Armor VampireArmor
  Armor = DEFAULT         15%
  Armor = HERO		  15%
  Armor = HERO_RANGED	  15%
  Armor = MAGIC		  15%
  Armor = FLAME           55%
  Armor = POISON	  0%
End

Weapon VampireLifeLeech
	LeechRangeWeapon	= Yes
	AttackRange		= 17
	MeleeWeapon		= Yes
	DelayBetweenShots	= 1000
	PreAttackDelay		= 0
	PreAttackType   	= PER_SHOT
	FireFX          	= FX_LifeLeech
;	FireFlankFX		= FX_Flanking
	FiringDuration		= 1300 ; 1000

	DamageNugget
		Damage        		= 1800
		Radius        		= 0.0
		DelayTime     		= 0
		DamageType    		= SLASH
		DamageFXType  		= SWORD_SLASH
		DeathType     		= NORMAL
		FlankingBonus 		= 50%
		DrainLife     		= Yes
		DrainLifeMultiplier	= 12
	End
End


Weapon VampireSword
	LeechRangeWeapon	= Yes
	AttackRange		= STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon		= Yes
	DelayBetweenShots	= 1000
	PreAttackDelay		= 500
	PreAttackType   	= PER_SHOT
	FireFX          	= FX_GondorSwordHit
	FireFlankFX		= FX_Flanking
	FiringDuration		= 1000 ; 1000

	DamageNugget
		Damage        		= 550
		Radius        		= 0.0
		DelayTime     		= 0
		DamageType    		= SLASH
		DamageFXType  		= SWORD_SLASH
		DeathType     		= NORMAL
		FlankingBonus 		= 50%
;		DrainLife     		= Yes
;		DrainLifeMultiplier	= 0.5
	End
End




SpecialPower SpecialAbilityVampireTaunt
	Enum						   = SPECIAL_GENERAL_TARGETLESS
	ReloadTime					   = 240000
End

SpecialPower SpecialAbilityVampireAlert
	Enum						   = SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime					   = 240000
End

SpecialPower SpecialAbilityVampireLifeLeech
	Enum						   = SPECIAL_KNIFE_ATTACK
	ReloadTime					   = 60000
End



CommandButton Command_BloodThirstySacrifice			; Life Leech
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityVampireLifeLeech
	Options                 = NEED_TARGET_ENEMY_OBJECT
	TextLabel               = CONTROLBAR:LifeLeech
	ButtonImage             = UCOrc_Bloodthirsty
	CursorName              = EvilAbilityObj
	InvalidCursorName       = StabAttackInvalid
	ButtonBorderType        = ACTION
	DescriptLabel           = CONTROLBAR:TooltipLifeLeech
	InPalantir		= Yes
End

CommandButton Command_VampireTaunt
	Command			= SPECIAL_POWER 
	SpecialPower	   	= SpecialAbilityVampireTaunt
	TextLabel		= CONTROLBAR:CAHWordofPower
	ButtonImage		= Gandolf_radcircle
	ButtonBorderType	= ACTION	
	DescriptLabel		= Taunt
End

CommandButton Command_VampireAlert
	Command			= SPECIAL_POWER 
	SpecialPower	   	= SpecialAbilityVampireAlert
	TextLabel		= CONTROLBAR:CAHWordofPower
	ButtonImage		= Gandolf_radcircle
	ButtonBorderType	= ACTION	
	DescriptLabel		= Taunt
End


CommandSet VampireCommandSet
	1	= Command_ToggleStance
	2	= Command_BloodThirstySacrifice
	13	= Command_AttackMove
	14	= Command_Stop
	15	= Command_VampireTaunt
	16	= Command_VampireAlert
END


ChildObject ElvenLegolas MordorCorsairsOfUmbar

	Scale	= 1.2
	SelectPortrait         = UPMordor_Easterling

	LocomotorSet					; To fix corsair not rotating while moving
		Locomotor     = HumanLocomotor
		Condition     = SET_NORMAL
		Speed         = 50
	End

RemoveModule ModuleTag_LGAU

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GiveAutoBlades
		UpgradeToGrant = Upgrade_MordorForgedBlades
	End 
  End

RemoveModule ModuleTag_01

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01New
		OkToChangeModelColor = Yes	
		StaticModelLODMode = Yes
		WadingParticleSys = WaterRipplesTrail  ; used when the unit is wading in shallow water.

		DefaultModelConditionState
			Model							= MUCorsar4_SKN
			Skeleton						= MUCorsar_SKL
;			Model							= MUCorsar2_SKN  ExtraMesh:Yes
;			Model							= MUCorsai3_SKN  ExtraMesh:Yes
;			Model							= MUCorsar4_SKN  ExtraMesh:Yes
;			Model							= MUCorsar_SKN ExtraMesh:Yes
			WeaponLaunchBone				= PRIMARY B_HANDR
			WeaponLaunchBone				= TERTIARY B_HANDR
		End

	AnimationState						= CLIMBING
		StateName						= STATE_Climbing
		Animation						= Climbing
			AnimationName				= MUCorsar_WALB
			AnimationMode				= LOOP
			AnimationBlendTime			= 10
		End
		BeginScript;script to set transition from moving
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing") return end
		EndScript
	End
	AnimationState						= RAPPELLING

		StateName						= STATE_Rappelling
		Animation						= Rapelling
			AnimationName				= MUCorsar_WALD
			AnimationMode				= LOOP
			AnimationBlendTime			= 10
		End
	End
	TransitionState = Trans_RunningToClimbing
		Animation = Transition
			AnimationName = MUCorsar_WALA
			AnimationMode = ONCE
		End
	End
	TransitionState = Trans_ClimbingToRunning
		Animation = Transition
			AnimationName = MUCorsar_WALC
			AnimationMode = ONCE
		End
	End
	TransitionState = Trans_RappellingToRunning
		Animation = Transition
			AnimationName = MUCorsar_WALE
			AnimationMode = ONCE
		End
	End





;;======= FALLING & FLYING

		AnimationState						= PASSENGER
			Animation						= Grabbed
				AnimationName				= MUCorsar_FLLA
				AnimationMode				= LOOP
			End
		End
		
		AnimationState        				= THROWN_PROJECTILE
			Animation           			= FlyA
				AnimationName      	 		= MUCorsar_FLYA
				AnimationMode       		= LOOP
			End
			Flags               			= RANDOMSTART
		End
		
		AnimationState						= FREEFALL
			Animation						= Falling
				AnimationName				= MUCorsar_FLYA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
			End
		End

		
		
		AnimationState        				= STUNNED_FLAILING 
			Animation           			= FlyA
				AnimationName       		= MUCorsar_FLYA
				AnimationMode       		= LOOP
			End
			Flags               			= RANDOMSTART
		End

		AnimationState			= DYING BURNINGDEATH
			Animation
				AnimationName	= MUCorsar_DIEB
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= MUCorsar_DIEC
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
		End

		AnimationState 						= DYING SPLATTED
			Animation 						= Splatted_On_Ground
				AnimationName 				= MUCorsar_LNDA
				AnimationMode 				= ONCE
			End
			EnteringStateFX					= FX_OrcHitGround
		End

		AnimationState						= DYING AFLAME
			Animation						= MFDA
				AnimationName				= MUCorsar_MFDA
				AnimationMode				= LOOP
			End
		End

		
		AnimationState						= DYING
			;Animation						= DIEA
			
			;	AnimationName				= MUCorsar_DIEA
			;	AnimationMode				= ONCE
			;End
			Animation						= DIEB
				AnimationName				= MUCorsar_DIEB
				AnimationMode				= ONCE
			End
			Animation						= DIEC
				AnimationName				= MUCorsar_DIEC
				AnimationMode				= ONCE
			End
		End

		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= MUCorsar_MFDA
				AnimationMode	= LOOP
				Distance		= 110
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= MUCorsar_IDLB
				AnimationMode				= LOOP
			End
		End

;;======= LANDING & STANDING

		AnimationState						= STUNNED_STANDING_UP
			Animation						= GTPA
				AnimationName				= MUCorsar_GTPA
				AnimationMode				= ONCE
;				AnimationSpeedFactorRange = 1.5 1.5
			End
		End


	
		AnimationState			=	 STUNNED
			Animation			=	 Slatted_On_Ground
			AnimationName 				= MUCorsar_LNDA
				AnimationMode 				= ONCE
			End
			EnteringStateFX					= FX_OrcHitGround

		End 
		
		
		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = RunAndFire
				AnimationName       = MUCorsar_ATRA
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART  
		End
		
;;====== TERROR
		
		AnimationState						= MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
			Animation					= TerrorFromTheSky
				AnimationName			= MUCorsar_RUNE
				AnimationMode			= LOOP
			End
			Flags = RANDOMSTART
		End

		AnimationState						= MOVING EMOTION_TERROR
			Animation						= TerrorFromTheSky
				AnimationName				= MUCorsar_RUNE
				AnimationMode				= ONCE
			End
			Flags							= RESTART_ANIM_WHEN_COMPLETE
		End
		
;;======= BACK UP

		
		AnimationState						= MOVING BACKING_UP
			Animation						= BAKA
				AnimationName				= MUCorsar_BAKA
				AnimationMode				= LOOP
			End
			Animation						= BAKB
				AnimationName				= MUCorsar_BAKB
				AnimationMode				= LOOP
			End
			Flags = RANDOMSTART
		End

		AnimationState						= MOVING PANICKING
			;@@@KM - Add Distance
			Animation						= MFDA
				AnimationName				= MUCorsar_MFDA
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
		End
		
		AnimationState						= MOVING ATTACKING
			ShareAnimation					= Yes;
			Animation						= RUNA
				AnimationName				= MUCorsar_RUNC
				AnimationMode				= LOOP
			End
			Animation						= RUNA
				AnimationName				= MUCorsar_RUND
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
		End
		
		AnimationState						= MOVING
			ShareAnimation					= Yes;
			Animation						= RUNB
				AnimationName				= MUCorsar_RUNB ;A
				AnimationMode				= LOOP
			End
			Animation						= RUNC
				AnimationName				= MUCorsar_RUNB
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
			
			BeginScript;script to set transition into moving
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRunning") return end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

;;======= UNCONTROLLABLY AFRAID
	; This is before Attacking so it overrides it.  Normal fear is below so you don't go to little-fear in between swings.
		AnimationState						= EMOTION_UNCONTROLLABLY_AFRAID
			Animation						= FERA
				AnimationName				= MUCorsar_FERA
				AnimationMode				= LOOP
			End 

		End

;--------------
; SPECIAL MOVE - TAUNT

		AnimationState						= SPECIAL_WEAPON_ONE UNPACKING
			Animation
				AnimationName				= MUCorsar_CINA
				AnimationMode				= ONCE
				;AnimationSpeedFactorRange		= 1 1
			End
		End

		AnimationState						= SPECIAL_WEAPON_ONE PACKING
			Animation
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP
				;AnimationSpeedFactorRange		= 1 1
			End
		End

;-------------
; SPECIAL MOVE - ALERT

		AnimationState						= SPECIAL_WEAPON_THREE
			Animation
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP
				;AnimationSpeedFactorRange		= 1 1
			End
		End

;--------------
; SPECIAL MOVE - LIFE LEECH

		AnimationState						= SPECIAL_WEAPON_TWO UNPACKING
			Animation
				AnimationName				= MUCorsar_ATKA
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
;				AnimationSpeedFactorRange		= 0.8 0.8
			End
		End

		AnimationState						= SPECIAL_WEAPON_TWO PACKING
			Animation
				AnimationName				= MUCorsar_CHRA
				AnimationMode				= ONCE
;				UseWeaponTiming				= Yes
			End
		End



;;---------------------- ATTACKING ----------------------------------------------------------------
		AnimationState						= FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1		; fire bomb attack
			Animation
				AnimationName				= MUCorsar_ATKE
				AnimationMode				= ONCE
				;UseWeaponTiming				= Yes
				AnimationSpeedFactorRange	= 2.4 2.4		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
			End
			FrameForPristineBonePositions	= 41
		End
		
		AnimationState						= FIRING_OR_PREATTACK_C 		; fire bomb attack bombard
			Animation
				AnimationName				= MUCorsar_ATKE
				AnimationMode				= ONCE
				;UseWeaponTiming				= Yes
				AnimationSpeedFactorRange	= 2.4 2.4		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
			End
			FrameForPristineBonePositions	= 41
		End
		
		AnimationState						= FIRING_OR_PREATTACK_A							; knife attack
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKA
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKB
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKC
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKD
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			;ParticleSysBone				= None MeleeDust
		End
		
;;----------------- HIT REACTIONS -------------------------------------------------------------------------

;		AnimationState						= HIT_REACTION
;			Animation						= HITA
;				AnimationName				= MUCorsar_HITA
;				AnimationMode				= ONCE
;			End
;		End

	
;;======= AFRAID

		AnimationState						= EMOTION_AFRAID
			Animation						= FERA
				AnimationName				= MUCorsar_FERA
				AnimationMode				= LOOP
			End 
		End

		AnimationState						= ATTACKING								; attacking after afraid.
			Animation						= ALERT_1
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP
			End
		End

;;======== POINTING

		AnimationState						= EMOTION_POINTING
			Animation						= Pointing1
				AnimationName				= MUCorsar_PNTA
				AnimationMode				= LOOP
			End
			Animation						= Pointing1
				AnimationName				= MUCorsar_PNTB
				AnimationMode				= LOOP
			End
		End

;;======= TAUNTING

		AnimationState						= EMOTION_TAUNTING
			Animation						= Taunting1
				AnimationName				= MUCorsar_TNTA
				AnimationMode				= ONCE
			End
			Animation						= Taunting2
				AnimationName				= MUCorsar_TNTB
				AnimationMode				= ONCE
			End
			Animation						= Taunting3
				AnimationName				= MUCorsar_TNTC
				AnimationMode				= ONCE
			End
			Animation						= Taunting5
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= ONCE
			End
			Flags							= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

;;======= CELEBRATING

		AnimationState						= EMOTION_CELEBRATING
			Animation						= CHRB
				AnimationName				= MUCorsar_CHRA
				AnimationMode				= ONCE
			End
			Animation						= CHRC
				AnimationName				= MUCorsar_CHRB
				AnimationMode				= ONCE
			End
			Animation						= IDLD
				AnimationName				= MUCorsar_CHRC
				AnimationMode				= ONCE
			End
			Flags							=	RESTART_ANIM_WHEN_COMPLETE
		End
		
;;----------------- ALERT STATE ---------------------------------------------------------------------------

		AnimationState						= EMOTION_ALERT
			Animation						= ALERT_1
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP;ONCE
				AnimationPriority			= 10
			End
			Flags							= RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
		End
		
		AnimationState						= RAISING_FLAG
			Animation						= CHRB
				AnimationName				= MUCorsar_CHRA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Animation						= CHRC
				AnimationName				= MUCorsar_CHRB
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Animation						= IDLD
				AnimationName				= MUCorsar_CHRC
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Flags							=	RESTART_ANIM_WHEN_COMPLETE
		End
	

;;----------------- SELECTED STATES -----------------------------------------------------------------------
		AnimationState        = SELECTED
			StateName           = STATE_Selected
			Animation           = ATNB
				AnimationName     = MUCorsar_ATNB
				AnimationMode     = LOOP
			End
			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" 
				then 
					CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") 
				end
				if CurDrawableModelcondition("ATTACKING")
				then
					return "IDLA"
				else
					return "ATNA"
				end
			EndScript
			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
			EndScript
		End
		
;;----------------- IDLE STATES ---------------------------------------------------------------------------
		AnimationState				= WEAPONSET_PLAYER_UPGRADE
			StateName				= STATE_Idle
			Animation				= IDLI
				AnimationName       = MUCorsar_IDLA ;IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= IDLD
				AnimationName       = MUCorsar_IDLA
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= IDLH
				AnimationName       = MUCorsar_IDLA
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= CHRB
				AnimationName       = MUCorsar_IDLA
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Flags					= RESTART_ANIM_WHEN_COMPLETE			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
			EndScript
		End		
		

		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLB
				AnimationName       = MUCorsar_IDLA ;B
				AnimationMode       = ONCE
				AnimationPriority   = 20
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLF
				AnimationName       = MUCorsar_IDLA ;C
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLG
				AnimationName       = MUCorsar_IDLA ;D
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLJ
				AnimationName       = MUCorsar_IDLA ;E
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
			EndScript
		End
;;--------------- TRANSITIONS ---------------------------------------------------------------------------
		TransitionState       = TRANS_TO_USER_1
			Animation
				AnimationName     = MUCorsar_RCTA
				AnimationMode     = ONCE
			End
		End
		TransitionState       = TRANS_IdleToSelected
			Animation           = ATNA
				AnimationName     = MUCorsar_ATNA
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.8 1.0
				
			End
		End
		TransitionState		= TRANS_SelectedToIdle
			Animation			= ATND
				AnimationName	= MUCorsar_ATNC
				AnimationMode	= ONCE
				AnimationSpeedFactorRange = 0.8 1.0
			End
		End
	End
END ;AddModule ends

;----------------------------------- Taunt ability for cool intro --------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_TauntStarters              
		SpecialPowerTemplate		= SpecialAbilityVampireTaunt
		UpdateModuleStartsAttack	= Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_TauntUpdate s  
		SpecialPowerTemplate		= SpecialAbilityVampireTaunt
		WhichSpecialWeapon		= 1
		UnpackTime             		= 6200
;		PreparationTime			= 1
		PackTime			= 3000
		AwardXPForTriggering    	= 0
		StartAbilityRange		= 300
		MustFinishAbility		= Yes
;		FreezeAfterTriggerDuration	= 2500
	End
END

;----------------------------------- Alerted --------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_AlertStarter                 
		SpecialPowerTemplate		= SpecialAbilityVampireAlert
		UpdateModuleStartsAttack	= Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_AlertUpdate   
		SpecialPowerTemplate		= SpecialAbilityVampireAlert
		WhichSpecialWeapon		= 3
		UnpackTime             		= 2900	
;		PreparationTime			= 1
;		PackTime			= 3000
		AwardXPForTriggering    	= 0
		StartAbilityRange		= 800
		MustFinishAbility		= Yes
;		FreezeAfterTriggerDuration	= 2500
	End
END

;----------------------------------- Life Leech --------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_VampireLifeLeechAttack
		SpecialPowerTemplate		= SpecialAbilityVampireLifeLeech
		UpdateModuleStartsAttack	= No
		InitiateSound			= FellBeastVoiceAttack
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_VampireLifeLeechUpdate
		SpecialPowerTemplate		= SpecialAbilityVampireLifeLeech
		WhichSpecialWeapon		= 2
		SkipContinue			= Yes

		UnpackTime			= 1200
		PreparationTime			= 0
;		PersistentPrepTime		= 1 
		PackTime			= 2800

		AwardXPForTriggering		= 0
		StartAbilityRange		= 20.0									; Note: This has to be smaller than the weapon range or it'll never succeed
		ApproachRequiresLOS		= Yes		
		SpecialWeapon			= VampireLifeLeech
	End
END

;-----------------------------------------------------------------------------

	CommandPoints = 0

	;;; ARMOUR SETS ;;;
	ArmorSet
		Conditions      = None
		Armor           = VampireArmor
		DamageFX        = NormalDamageFX
	End
	
	DisplayName = OBJECT:OathBreaker
	
	CommandSet = VampireCommandSet

	VoiceAttack					= FellBeastVoiceMove
	VoiceAttackCharge				= FellBeastVoiceMove
	VoiceAttackMachine				= FellBeastVoiceMove
	VoiceAttackStructure				= FellBeastVoiceMove
	VoiceCreated					= EVA:CorsairsCreated
	VoiceFullyCreated				= EVA:CorsairsCreated
	VoiceGuard					= FellBeastVoiceMove
	VoiceMove					= FellBeastVoiceMove
	VoiceMoveOverWalls				= FellBeastVoiceMove
	VoiceMoveToCamp					= FellBeastVoiceMove
	VoiceMoveWhileAttacking				= FellBeastVoiceMove
	VoicePriority					= 53
	VoiceRetreatToCastle				= FellBeastVoiceMove
	VoiceSelect					= FellBeastVoiceMove
	VoiceSelectBattle 				= FellBeastVoiceMove

	VoiceEnterStateAttack				= FellBeastVoiceMove
	VoiceEnterStateAttackCharge			= FellBeastVoiceMove
	VoiceEnterStateAttackMachine			= FellBeastVoiceMove
	VoiceEnterStateAttackStructure			= FellBeastVoiceMove
	VoiceEnterStateMove				= FellBeastVoiceMove
	VoiceEnterStateMoveOverWalls			= FellBeastVoiceMove
	VoiceEnterStateMoveToCamp			= FellBeastVoiceMove
	VoiceEnterStateMoveWhileAttacking		= FellBeastVoiceMove
	VoiceEnterStateRetreatToCastle			= FellBeastVoiceMove

	SoundImpact					= ImpactHorse

	UnitSpecificSounds
		VoiceCreatedFromInn			= EVA:CorsairsCreated-Inn
		VoiceEnterUnitEvilMenTransportShip	= FellBeastVoiceMove
		VoiceEnterUnitMordorMumakil		= FellBeastVoiceMove
		VoiceEnterUnitSlaughterHouse		= FellBeastVoiceMove
		VoiceFullyCreatedFromInn		= EVA:CorsairsCreated-Inn
		VoiceGarrison				= FellBeastVoiceMove
		VoiceInitiateCaptureBuilding		= FellBeastVoiceMove
	End

	RadarPriority = UNIT

	KindOf = PRELOAD HERO CREEP SELECTABLE INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT NOTIFY_OF_PREATTACK GRAB_AND_DROP CAN_CLIMB_WALLS

	RemoveModule ModuleTag_foo

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 2200
		MaxHealthDamaged  = 900
;		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END
		
	Geometry = CYLINDER
	GeometryMajorRadius = 14.0
	GeometryMinorRadius = 14.0
	GeometryHeight = 24.2
	GeometryIsSmall = No
	HealthBoxScale		= 5.0
	HealthBoxHeightOffset	= 6.0

    Shadow = SHADOW_DECAL
    ShadowSizeX = 19;
    ShadowSizeY = 19;
    ShadowTexture = ShadowI;

    	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY    VampireSword
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

;AddModule	
;	  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
;		CreationList			= OCL_BossChest
;	  End
;End

End



;------------------
; VAMPIRE LORD
;------------------

ExperienceLevel	BlackRiderLevel10
	TargetNames				= EvilMenBlackRider EvilMenBlackRiderMounted
	RequiredExperience		= 1920
	ExperienceAward			= 1200	;200
	AttributeModifiers		= HeroLevelUpDamage9
	Rank					= 10
	LevelUpFx				= FX:GandalfLevelUp1FX
	Upgrades				= Upgrade_BlackRiderNazgulScreech
END



SpecialPower SpecialAbilitySoulPurge
	Enum					= SPECIAL_WORD_OF_POWER
	ReloadTime				= 5000; 160000
End

SpecialPower SpecialAbilityDominatePerson
	Enum					= SPECIAL_KNIFE_ATTACK
	ReloadTime				= 60000
	PublicTimer				= No
	ObjectFilter				= ANY +HERO
End


CommandButton Command_MouthOfSauronDoubt				; Soul Purge
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilitySoulPurge
	Options			= NONE
	TextLabel		= CONTROLBAR:LegendsSoulPurge
	ButtonImage		= HSMouthSauronDoubt
	CursorName		= Bombard
	RadiusCursorType	= DoubtRadiusCursor
	InvalidCursorName	= GenericInvalid
	PresetRange		= 70.0
	ButtonBorderType	= ACTION 
	DescriptLabel		= CONTROLBAR:ToolTipLegendsSoulPurge
	InPalantir		= Yes
	AutoAbility		= Yes
End

CommandButton Command_SpecialAbilityDominateEnemy			; Dominate person
	Command                 = SPECIAL_POWER
	SpecialPower            = SpecialAbilityDominatePerson
	Options                 = NEED_TARGET_ENEMY_OBJECT ;CONTEXTMODE_COMMAND
	TextLabel               = CONTROLBAR:Dominate
	ButtonImage             = HSSarumanDominate
	CursorName		= Bombard
	InvalidCursorName	= GenericInvalid
	RadiusCursorType        = None
	ButtonBorderType        = ACTION
	DescriptLabel           = CONTROLBAR:ToolTipDominate
	InPalantir		= Yes
	;UnitSpecificSound       = SarumanVoiceDominate
End


CommandSet VampireBossCommandSet
	1	= Command_ToggleStance
	2	= Command_SpecialAbilityDominateEnemy
	3	= Command_BloodThirstySacrifice
	4	= Command_MouthOfSauronDoubt
	13	= Command_AttackMove
	14	= Command_Stop
END

Armor VampireBossArmor
  Armor = DEFAULT         5%
  Armor = HERO		  5%
  Armor = HERO_RANGED	  5%
  Armor = MAGIC		  5%
  Armor = FLAME           20%
  Armor = POISON	  0%
End









FXParticleSystem  PreSoulPurgeFloor
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= ExCloudNazgul.tga
    Lifetime		= 300 300
    SystemLifetime	= 10
    SortLevel = 1
    Size		= 220 240
    BurstDelay		= 20 20
    BurstCount		= 2 2
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:180  G:0 B:0  0
    Color2		= R:0  G:0  B:0 190
  End
  Alpha = DefaultAlpha
    Alpha2		= 1 1 5
    Alpha3		= 0.9 0.9 190
    Alpha4		= 0 0 280
  End
  Update		= DefaultUpdate
    AngleZ		= 0 0
    AngularRateZ	= 0 0 ;-500 -500
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 1
    Length		= 5
  End
  Draw			= DefaultDraw
  END
END

FXParticleSystem  PreSoulPurgeCloud
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= ExCloudNazgul.tga
    Lifetime		= 95 95
    SystemLifetime	= 10
    SortLevel = 1
    Size		= 240 270
    BurstDelay		= 20 20
    BurstCount		= 7 7
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:180  G:0 B:0  0
    Color2		= R:0  G:0  B:0 90
  End
  Alpha = DefaultAlpha
    Alpha2		= 0.6 0.7 5
    Alpha3		= -0.2 0 100
  End
  Update		= DefaultUpdate
    SizeRate		= -3 -5
    SizeRateDamping	= 0.99 0.99
    AngleZ		= -180 180
    AngularRateZ	= -0.2 0.2
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 1
    Length		= 5
  End
  Draw			= DefaultDraw
  END
END

FXParticleSystem  PreSoulPurgeSpirits
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= ExCloudNazgul.tga
    Lifetime		= 95 95
    SystemLifetime	= 55
;    SortLevel		= 1
    Size		= 0.5 1
    BurstDelay		= 2 2
    BurstCount		= 12 18
  End
  Color			= DefaultColor
    Color1		= R:250  G:250 B:250  0
    Color2		= R:0  G:0  B:0 80
  End
  Alpha = DefaultAlpha
    Alpha2		= 0.7 0.8 5
    Alpha3		= 0.5 0.6 70
    Alpha3		= 0 0 95
  End
  Update		= DefaultUpdate
    SizeRate		= 0.4 0.5
    SizeRateDamping	= 1 1
    AngleZ		= -180 180
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 0.97 0.97
;    Gravity = -0.1
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.4 2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 140
    Length		= 5
  End
  Draw			= DefaultDraw
  END
END

FXList FX_PreAttackSoulPurge
  ParticleSystem
    Name = PreSoulPurgeFloor
        Offset = X:0.0 Y:0.0 Z:5.0
  END
  ParticleSystem
    Name = PreSoulPurgeCloud
        Offset = X:0.0 Y:0.0 Z:10.0
  END
  ParticleSystem
    Name = PreSoulPurgeSpirits
        Offset = X:0.0 Y:0.0 Z:0
  END
  Sound
    Name = GaladrielTerribleFurySFX
  End
  CameraShakerVolume
    Radius = 600
    Duration_Seconds = 4.5
    Amplitude_Degrees = 0.3
  End
End




FXParticleSystem SoulPurgeHeat
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 100 100
    SystemLifetime = 40
    Size = 80 80
    BurstCount = 5 6
    IsGroundAligned = Yes
;    ShroudEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -0.015 0.015
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
;    IsHollow = Yes
    Radius = 220
    Length = 1
    Offset = X:0 Y:0 Z:1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem  SoulPurgeAttackWaves
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= execlipseblur.tga
    Lifetime		= 50 60
    SystemLifetime	= 35
    Size		= 3 5
;    SortLevel = 1
    BurstDelay		= 15 15
    BurstCount		= 2 2
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:200  G:0 B:255  0
    Color2		= R:0  G:0  B:120 30
    Color3		= R:0  G:0  B:0   60
  End
  Update		= DefaultUpdate
    SizeRate		= 6 8
    SizeRateDamping	= 1 1
    AngleZ		= -180 180
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 1
  End
  Draw			= DefaultDraw
  END
END


FXParticleSystem SoulPurgeParticles
  System
    Priority		= MEDIUM_OR_ABOVE
    Shader		= ALPHA
    ParticleName	= EXCloudNazgul.tga
    Lifetime		= 30 30
    SystemLifetime	= 41
    Size		= 5 18
    BurstDelay		= 5 5
    BurstCount		= 40 68
  End
  Color = DefaultColor
    Color2		= R:193 G:0 B:0 5
    Color3		= R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha2		= 0.5 0.75 5
    Alpha3		= -0.2 0 30
  End
  Update = DefaultUpdate
    SizeRate		= 1 1
    SizeRateDamping	= 1 1
    AngleZ		= -3 3
    AngularRateZ	= -0.01 0.01
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= -0.03
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial		= 4 7
    Normal		= 0.5 1.2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 5
    Length		= 15
  End
  Draw = DefaultDraw
  End
End

FXList FX_AttackSoulPurge
  ParticleSystem
    Name = SoulPurgeHeat
        Offset = X:0.0 Y:0.0 Z:20.0
  END
  ParticleSystem
    Name = SoulPurgeAttackWaves
        Offset = X:0.0 Y:0.0 Z:5.0
  END
  ParticleSystem
    Name = SoulPurgeParticles
        Offset = X:0.0 Y:0.0 Z:5.0
  END
  ViewShake
    Type = CINE_EXTREME
  End
  Sound
    Name = SpellDarkness
  End
  CameraShakerVolume
    Radius = 600
    Duration_Seconds = 4
    Amplitude_Degrees = 0.9
  End
End

Weapon VampireBossLifeLeech
	LeechRangeWeapon	= Yes
	AttackRange		= 17
	MeleeWeapon		= Yes
	DelayBetweenShots	= 1000
	PreAttackDelay		= 0
	PreAttackType   	= PER_SHOT
	FireFX          	= FX_LifeLeech
;	FireFlankFX		= FX_Flanking
	FiringDuration		= 1300 ; 1000

	DamageNugget
		Damage        		= 2800
		Radius        		= 0.0
		DelayTime     		= 0
		DamageType    		= SLASH
		DamageFXType  		= SWORD_SLASH
		DeathType     		= NORMAL
		FlankingBonus 		= 50%
		DrainLife     		= Yes
		DrainLifeMultiplier	= 25
	End
End


Weapon VampireSoulPurge
	IdleAfterFiringDelay	= 0
	AttackRange		= 100
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 60
	MinWeaponSpeed		= 50
	MaxWeaponSpeed		= 80
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots	= 5000
	PreAttackDelay		= 1000
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_PreAttackSoulPurge
	FireFX			= FX_AttackSoulPurge
	FiringDuration		= 1400
	DamageNugget
		Damage		= 1300
		Radius		= 150.0
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 60.0
	End
	MetaImpactNugget
		ShockWaveAmount   = 75.0
		ShockWaveRadius   = 200.0
		ShockWaveTaperOff = 0.4
		ShockWaveZMult    = 1.900
		ShockWaveSpeed	  = 60.0 
	End
End


Weapon VampireSwordBoss
	LeechRangeWeapon	= Yes
	AttackRange		= STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon		= Yes
	FireFX			= FX_GondorSwordHit
	DelayBetweenShots	= 1400
	PreAttackDelay		= 500
	PreAttackType		= PER_SHOT
	FiringDuration		= 1400

	DamageNugget
		Damage        		= 580 ; 1000 was too much as magic is good vs heroes
		Radius        		= 0.0
		DelayTime     		= 0
		DamageType    		= MAGIC
		DamageFXType  		= MAGIC
		DeathType     		= NORMAL
;		DrainLife     		= Yes
;		DrainLifeMultiplier	= 0.2
	End
End


Object EvilMenBlackRider

	ShockwaveResistance	= 999

	HealthBoxScale		= 5

	Scale			= 1.15
	DisplayName		= OBJECT:Oathbreaker

	CommandSet		= VampireBossCommandSet

	ArmorSet
		Conditions      = None
		Armor           = VampireBossArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY    VampireSwordBoss
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	LocomotorSet
		Locomotor = HeroHumanLocomotor
		Condition = SET_NORMAL 
		Speed     = 60
	End

RemoveModule ModuleTag_EowynHealing
RemoveModule HitReactionBehaviorModuleTag
RemoveModule ModuleTag_BlackRiderDreadVisage
RemoveModule ModuleTag_BlackRiderDreadVisageUpdate
RemoveModule ModuleTag_DreadVisage
RemoveModule ModuleTag_DreadVisageModelCondition
RemoveModule ModuleTag_DreadVisageFear
RemoveModule ModuleTag_MorgulBladeAutoAbility
	;;.;; RemoveModule ToggleMountedAI
RemoveModule ModuleTag_HorseToggle
RemoveModule MorgulBladeAI
RemoveModule ScreechAI

ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBodyNew
		CheerRadius = EMOTION_CHEER_RADIUS

		MaxHealth		= 8000
		MaxHealthDamaged	= 2000
		RecoveryTime		= 5
		
		PermanentlyKilledByFilter	= NONE
   		DodgePercent      		= 0
		BurningDeathBehavior		= No
	End
END
 
ReplaceModule ModuleTag_08 
	Behavior = SlowDeathBehavior ModuleTag_08new
		DeathTypes = ALL 
		SinkDelay = 3000
		SinkRate = 0.80     ; in Dist/Sec
		DestructionDelay = 12000
		Sound = INITIAL WormtongueVoiceDie
	End
END

;------------------- LIFE LEECH --------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_VampireLifeLeechAttack
		SpecialPowerTemplate		= SpecialAbilityVampireLifeLeech
		UpdateModuleStartsAttack	= No
		InitiateSound			= FellBeastVoiceAttack
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_VampireLifeLeechUpdate
		SpecialPowerTemplate		= SpecialAbilityVampireLifeLeech
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes

		UnpackTime			= 1200
		PreparationTime			= 0
;		PersistentPrepTime		= 1 
		PackTime			= 800

		AwardXPForTriggering		= 0
		StartAbilityRange		= 20.0									; Note: This has to be smaller than the weapon range or it'll never succeed
		ApproachRequiresLOS		= Yes		
		SpecialWeapon			= VampireBossLifeLeech
	End
END

;----------------------------------------------------


;------------------- DOMINATE PERSON --------------------

;AddModule
;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DominatePersonEnabler
;		SpecialPowerTemplate		= SpecialAbilityDominatePerson
;		TriggeredBy			= Upgrade_ObjectLevel5
;	End
;END

AddModule
	Behavior = SpecialPowerModule ModuleTag_DominatePersonStarter
		SpecialPowerTemplate		= SpecialAbilityDominatePerson
		StartsPaused			= No ;Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= FellBeastVoiceAttack
	END
End

AddModule
	Behavior = DominateEnemySpecialPower ModuleTag_DominatePersonPower
		SpecialPowerTemplate		= SpecialAbilityDominatePerson
		UnpackingVariation		= 2
		StartAbilityRange		= 200
	
		DominateRadius			= 5
		DominatedFX			= FX_SarumanDominateTargets
		TriggerFX			= FX_CreateaHeroConvert
		TriggerSound			= SarumanWormtongue
		PermanentlyConvert		= No
		UnpackTime			= 2500
		PreparationTime			= 1   
		FreezeAfterTriggerDuration	= 500
		AttributeModifierAffects	= ANY +INFANTRY +HERO ENEMIES NEUTRAL
	End
END

;----------------------------------------------------


;------------------- SOUL PURGE --------------------

;AddModule
;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SoulPurgeEnabler
;		SpecialPowerTemplate		= SpecialAbilitySoulPurge
;		TriggeredBy			= Upgrade_ObjectLevel7
;	End
;END

AddModule
	Behavior = SpecialPowerModule ModuleTag_SoulPurgeStarter       
		SpecialPowerTemplate		= SpecialAbilitySoulPurge
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No ;Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WordWeaponFireUpdate   
		SpecialPowerTemplate	  	= SpecialAbilitySoulPurge
		WhichSpecialWeapon		= 3
		SkipContinue			= Yes
		UnpackTime			= 1200
		PreparationTime			= 2000
		PackTime			= 1000	   
		FreezeAfterTriggerDuration	= 4000
		AwardXPForTriggering		= 0	   
		StartAbilityRange		= 100.0
		SpecialWeapon			= VampireSoulPurge
		PlayWeaponPreFireFX		= Yes
	End
END

;----------------------------------------------------



ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01New
		OkToChangeModelColor = Yes

		DefaultModelConditionState
			Model			= MUNazgul_SKN
		End


		ModelConditionState = USER_3
			ParticleSysBone     = None BlackRiderFlare FXTrigger:NONE Persist:SPAWN PersistID:100
		End
				
		IdleAnimationState
			StateName				= Idle
			Animation
				AnimationName       = MUNazgul_SKL.MUNazgul_IDLB
				AnimationPriority	= 4
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Animation
				AnimationName       = MUNazgul_SKL.MUNazgul_IDLC
				AnimationPriority	= 1
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Animation
				AnimationName       = MUNazgul_SKL.MUNazgul_IDLD
				AnimationPriority = 1
				AnimationBlendTime	= 15
				AnimationMode       = ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE		
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_to_Idle") end
			EndScript	
		End

		
		AnimationState					=	DYING BURNINGDEATH
			Animation
				AnimationName			=	MUNazgul_SKL.MUNazgul_DTHA
				AnimationMode			=	ONCE
				AnimationBlendTime		=	10
				AnimationSpeedFactorRange	= 0.7 0.7
			End
		End
		

		AnimationState = DYING
			Animation
				AnimationName       		= MUNazgul_SKL.MUNazgul_DTHA
				AnimationMode       		= ONCE
				AnimationSpeedFactorRange	= 0.7 0.7
			End
		End
		
		AnimationState = FREEFALL
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_FLYA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
		End
		
		AnimationState = STUNNED_FLAILING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_FLYA
				AnimationMode = LOOP
				AnimationSpeedFactorRange	= 0.4 0.6
			End
			Flags = RANDOMSTART
		End
		
		AnimationState = STUNNED_STANDING_UP
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_GTPA
				AnimationMode = ONCE
			End
		End		

		AnimationState = MOVING FIRING_OR_PREATTACK_A
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_RUNB
				AnimationMode = LOOP
			End
			
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End
				
		AnimationState = FIRING_OR_PREATTACK_A
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATKA
				AnimationMode = ONCE
				UseWeaponTiming	= Yes
			End
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATKB
				AnimationMode = ONCE
				UseWeaponTiming	= Yes
			End
		End

		AnimationState = MOVING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_RUNA
				AnimationMode = LOOP
			End
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End


;------------------------------
; LifeLeech

		AnimationState = SPECIAL_WEAPON_ONE
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_CHRA
				AnimationMode = ONCE
			End
		End

;------------------------------
; Dominate Person

		AnimationState = SPECIAL_WEAPON_TWO
			Animation
				AnimationName 			= MUNazgul_SKL.MUNazgul_SPCC
				AnimationMode 			= ONCE
				AnimationSpeedFactorRange	= 0.8 0.8
			End
		End


		AnimationState = PACKING_TYPE_2
			StateName = Attacking
			Animation = LightningSwordStart
				AnimationName 			= MUNazgul_SKL.MUNazgul_SPCC
				AnimationMode 			= ONCE
				AnimationSpeedFactorRange	= 0.8 0.8
			End
;			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
;			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End




;------------------------------
; Soul purge

		AnimationState = SPECIAL_WEAPON_THREE UNPACKING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATNA
				AnimationMode = ONCE
				AnimationSpeedFactorRange	= 0.5 0.5
			End
		End

		AnimationState = SPECIAL_WEAPON_THREE PREPARING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATNB
				AnimationMode = LOOP
			End
		End

		AnimationState = SPECIAL_WEAPON_THREE PACKING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATNC
				AnimationMode = ONCE
				AnimationSpeedFactorRange	= 0.6 0.6
			End
		End

;-------------------------------



		; --------- Click and Hit Reactions ------------
		AnimationState = HIT_REACTION HIT_LEVEL_1
			Animation = Hit_Level_1_a
				AnimationName = MUNazgul_SKL.MUNazgul_HITA
				AnimationMode = ONCE
			End
		End
			
		AnimationState = LEVELED
			Animation = Hit_Level_1_a
				AnimationName = MUNazgul_SKL.MUNazgul_LVLA
				AnimationMode = ONCE
			End
		End			
			
	
		AnimationState = EMOTION_CELEBRATING
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_CHRA
				AnimationMode = LOOP
			End
		End
		
		AnimationState						= EMOTION_TAUNTING
			Animation					= TNTA
				AnimationName				= MUNazgul_SKL.MUNazgul_TNTA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange		= 0.5 0.5
			End
		End

		AnimationState = SELECTED
			Animation
				AnimationName = MUNazgul_SKL.MUNazgul_ATNB
				AnimationMode = LOOP
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
			EndScript			
		End
		
    		TransitionState = TRANS_Idle_to_Selected
			Animation = ATNA
				AnimationName		= MUNazgul_SKL.MUNazgul_ATNA
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
			End
    		End
    
   		 TransitionState = TRANS_Selected_to_Idle
			Animation = ATNF
				AnimationName		= MUNazgul_SKL.MUNazgul_ATNF
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
			End
    		End
    		
	End
END

END




;-----------------------------------------
; EX KAZAG DUM (Removes central platform so we can customize a little)
;-----------------------------------------

Object MoriaModuleKazagDum

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_RemoveSubObject
	TriggeredBy			= Upgrade_GandalfWhite

;	HideSubObjects		   = ARCHITECTUAL04	; Debris
;	HideSubObjects		   = ARCHITECTUAL05	; Floor
;	HideSubObjects		   = ROCK02		; Central Rock formation

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

End



;-------------------------------
; DWARVEN RUINS
;-------------------------------

Object MoriaModuleArchTop				; Ceiling, commented out transparency stuff
ReplaceModule ModuleTag_01
    Draw = W3DScriptedModelDraw ModuleTag_01New
      DefaultModelConditionState
        Model = MMMARCHTOP
      End
	
;	AlphaCameraFadeOuterRadius = 400
;	AlphaCameraFadeInnerRadius = 300
;	AlphaCameraAtInnerRadius = 10%
    End
END

End





;------------------------------
; Fortress Entrance (outside)
;------------------------------



Object DwarfBarracks

	AddModule
		Draw = W3DScriptedModelDraw ModuleTag_01
			OkToChangeModelColor = Yes
			
			StaticModelLODMode = yes
			
			DefaultModelConditionState
				Model = EB_ceiling01
			End
		END
	END
 

	CommandSet	= DwarvenMineShaftCommandSet

	KindOf          = IMMOBILE STRUCTURE GARRISON ECONOMY_STRUCTURE GARRISONABLE_UNTIL_DESTROYED AUTO_RALLYPOINT IGNORE_FOR_VICTORY UNATTACKABLE NOT_AUTOACQUIRABLE ;SELECTABLE FS_CASH_PRODUCER

	DisplayName     = OBJECT:Gate

	VisionRange		= 0
	ShroudClearingRange	= 0

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			= Upgrade_GandalfWhite

	HideSubObjects		   = EUDWARFGUADIAN	; Guardian
	HideSubObjects		   = N_GLOW		; Window glow
	ShowSubObjects		   = N_WINDOW		; Windows
	HideSubObjects		   = SHIELD		; Guardian's Shield
	HideSubObjects		   = AXE		; Guardian's Axe
	HideSubObjects		   = V2			; Defence tower
	HideSubObjects		   = EB_CEILING01	; Added ceiling

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_MakeInvisible
	TriggeredBy			= Upgrade_DwarvenBarracksLevel3

	HideSubObjects		   = EUDWARFGUADIAN	; Guardian
	HideSubObjects		   = N_GLOW		; Window glow
	HideSubObjects		   = N_WINDOW		; Windows
	HideSubObjects		   = SHIELD		; Guardian's Shield
	HideSubObjects		   = AXE		; Guardian's Axe
	HideSubObjects		   = V1			; Big dwarf statue
	HideSubObjects		   = V2			; Defence tower
	HideSubObjects		   = EBBARRAK		; Main Body
	HideSubObjects		   = EBBARRAKFIRE	; Fire pots
	HideSubObjects		   = ROCK		; Rock base
	ShowSubObjects		   = EB_CEILING01	; Added ceiling

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

AddModule
	Behavior = GeometryUpgrade Geom_ModuleTag_SmallGeometry
		TriggeredBy	= Upgrade_DwarvenBarracksLevel3
		ShowGeometry	= Geom_Orig
		HideGeometry	= Geom_V1
	End
END

RemoveModule ModuleTag_DrawFloor
RemoveModule ModuleTag_Draw_HCBanner
RemoveModule ModuleTag_07
RemoveModule ModuleTag_HideAll
RemoveModule ModuleTag_ShowWallsAndFlag
RemoveModule ModuleTag_ShowTowersAndHideFlag
RemoveModule ModuleTag_ThirdLevelBuildingArrows

RemoveModule ModuleTag_05

AddModule ;ModuleTag_05
	Body	= ImmortalBody ModuleTag_05New
	MaxHealth         = 15000.0
	End
END

AddModule
 	Behavior = TunnelContain ModuleTag_ContainNew
 		ObjectStatusOfContained			= UNSELECTABLE ENCLOSED
 		ContainMax              		= 5
 		DamagePercentToUnits    		= 0%
 		PassengerFilter				= ANY +HERO +INFANTRY +BANNER +CAVALRY -MONSTER -SUMMONED -COMBO_HORDE
 		AllowEnemiesInside			= No
		AllowAlliesInside			= Yes
		AllowNeutralInside			= Yes
		AllowOwnPlayerInsideOverride		= Yes
 		NumberOfExitPaths       		= 1
		PassengerBonePrefix     		= PassengerBone:ARROW_ KindOf:INFANTRY
		EntryPosition				= X:-40.0 Y:40.0 Z:0.0
		EntryOffset				= X:-40.0 Y:40.0 Z:0.0
		ExitOffset				= X:0.0 Y:0.0 Z:0.0
		EnterSound				= RuinedTowerEnterSound
		KillPassengersOnDeath			= No
		ShowPips				= No
		ExitDelay				= 0
	End
END

HealthBoxScale = 0.001
HealthBoxHeightOffset = 200
  Geometry		= BOX
  GeometryName		= Geom_Orig
  GeometryMajorRadius   = 102.0
  GeometryMinorRadius   = 8.0
  GeometryHeight        = 302.5
  GeometryOffset	= X:4 Y:-4 Z:0

	AdditionalGeometry	= BOX
	GeometryName		= Geom_V1	; Invisible version
  	GeometryMajorRadius   = 1.0
  	GeometryMinorRadius   = 1.0
  	GeometryHeight        = 46
  	GeometryOffset	= X:4 Y:0 Z:0

END




Object DwarvenStatue				; Remove aura and flag to use statue as a prop
RemoveModule ModuleTag_Draw_HCBanner
RemoveModule ModuleTag_FeelGoodHero
END

Object DwarvenWallSegmentSmall			; Remove floor sprite
RemoveModule ModuleTag_DrawFloor 
END


Object DwarvenWallCatapultSmall			; Remove catapult and floor sprite
RemoveModule ModuleTag_ActLikeAnOldUpgrade
RemoveModule ModuleTag_DrawFloor
END

Object DwarvenBunker				; Remove flag
RemoveModule ModuleTag_Draw_HCBanner
END

Object MoriaModuleDwarvenEntranceA		; Remove rocks to clean entrance up.

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade018979
	TriggeredBy		= Upgrade_GandalfWhite

	HideSubObjects		   = GPCLOUD01		; Rocks
	HideSubObjects		   = MESH01		; Black borders

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

END


;------------------------
; Shadow making mountainside (makes them invisible)
;-----------------------

;Object EreborMountainOpen
;
;ReplaceModule ModuleTag_01
;    Draw = W3DScriptedModelDraw ModuleTag_01New
;      DefaultModelConditionState
;        Model = EB_MtnOpen
;      End
;	
;	AlphaCameraFadeOuterRadius = 2000
;	AlphaCameraFadeInnerRadius = 1500
;	AlphaCameraAtInnerRadius = 0%
;    End
;END

;End


;--------------------
; DRAGONS TREASURE
;--------------------


FXParticleSystem DragonsTreasureGlimmer
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 5 5
    BurstCount = 0.20 1.30
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor

    Color2 = R:236 G:199 B:136 50
    Color3 = R:0 G:0 B:0 100
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.1
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
    Z = 0.25 0.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 12
    Length = 12
    Offset = X:32 Y:-33 Z:0
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem DragonsTreasureGlimmerB
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 5 5
    BurstCount = 0.20 1.50
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor

    Color2 = R:236 G:199 B:136 50
    Color3 = R:0 G:0 B:0 100
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.1
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
    Z = 0.25 0.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 24
    Length = 12
    Offset = X:12 Y:-8 Z:1
  End
  Draw = DefaultDraw
  End
End



FXParticleSystem DragonsTreasureGlimmer02
  System
    Priority = HIGH_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 5 5
    BurstCount = 0.4 1.7
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:236 G:199 B:136 50
    Color3 = R:0 G:0 B:0 100
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.1
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.5 0.5
    Y = -0.5 0.5
    Z = 0.25 0.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 23
    Length = 15
    Offset = X:12 Y:-8 Z:1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem DragonsTreasureRedGlimmer
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 6 7
    BurstDelay = 8 15
    BurstCount = 1 1
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:255 G:0 B:0 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.5 0.5
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 18
    Length = 5
    Offset = X:15 Y:-6 Z:7
  End
  Draw = DefaultDraw
  End
End




FXParticleSystem DragonsTreasureBlueGlimmer1
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 5 6
    BurstDelay = 90 120
    BurstCount = 2 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:255 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.65 0.65
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:31 Y:-45 Z:4
    EndPoint = X:31 Y:-45 Z:4
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem DragonsTreasureBlueGlimmer2
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 90 130
    BurstCount = 2 2
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:255 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.65 0.65
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:32 Y:-14 Z:3
    EndPoint = X:32 Y:-14 Z:3
  End
  Draw = DefaultDraw
  End
End




FXParticleSystem DragonsTreasureBlueGlimmer3
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 4 5
    BurstDelay = 80 100
    BurstCount = 3 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:255 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.7 0.7
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:-1 Y:-23.5 Z:5
    EndPoint = X:-1 Y:-23.5 Z:5
  End
  Draw = DefaultDraw
  End
End




FXParticleSystem DragonsTreasureBlueGlimmer4
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 4 5
    BurstDelay = 90 120
    BurstCount = 3 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:255 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.65 0.65
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:4 Y:14.5 Z:4
    EndPoint = X:4 Y:14.5 Z:4
  End
  Draw = DefaultDraw
  End
End




FXParticleSystem DragonsTreasureGreenGlimmer
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 70 100
    BurstCount = 3 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:255 B:0 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.7 0.7
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:26.5 Y:-34 Z:4
    EndPoint = X:26.5 Y:-34 Z:4
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem DragonsTreasureRedGlimmerSingle
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 20 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 90 130
    BurstCount = 2 2
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:255 G:0 B:0 10
    Color3 = R:0 G:0 B:0 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 0.65 0.65
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.85 0.85
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:47 Y:-24 Z:3
    EndPoint = X:47 Y:-24 Z:3
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem DragonsTreasureAura
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLnzFlar1.tga
    Lifetime = 80 80
    SortLevel = 1
    Size = 120 120
    BurstDelay = 40 40
    BurstCount = 1 1
    IsGroundAligned = Yes
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:246 G:196 B:136 40
    Color3 = R:0 G:0 B:0 80
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.9 0.9 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:10 Y:0 Z:18
    EndPoint = X:10 Y:0 Z:20
  End
  Draw = DefaultDraw
  End
End




FXParticleSystem DragonsTreasurePickupSparkle
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 40 70
    SystemLifetime = 25
    Size = 0.4 0.4
    StartSizeRate = 0 0.16
    BurstCount = 20 25
;    IsParticleUpTowardsEmitter = Yes
;    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:232 G:179 B:98 0
    Color2 = R:0 G:0 B:0 80
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.9 0.9
    AngleZ = 0.01 0.01
    AngularRateZ = 0.1 0.1
    AngularDamping = 0.9 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.18
    VelocityDamping = 0.5 0.9
  End
  EmissionVelocity = OutwardEmissionVelocity
    OtherSpeed = 0 1.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 50
    Length = 6
    Offset = X:0 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = Circular
    WindStrength = 0.04
    WindFullStrengthDist = 15
    WindZeroStrengthDist = 100
    WindAngleChangeMin = 0.034907
    WindAngleChangeMax = 0.034907
    WindPingPongStartAngleMin = 1.22173
    WindPingPongStartAngleMax = 1.22173
    WindPingPongEndAngleMin = 1.91986
    WindPingPongEndAngleMax = 1.91986
    TurbulenceAmplitude = 0.01
    TurbulenceFrequency = 0.1
  End
End

FXParticleSystem DragonsTreasurePickupAura
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLnzFlar1.tga
    Lifetime = 80 80
    SystemLifetime = 12
    SortLevel = 1
    Size = 20 30
    BurstCount = 1 1
    IsGroundAligned = Yes
;    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:246 G:200 B:136 5
    Color3 = R:0 G:0 B:0 50
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    SizeRate = 3 4
    AngleZ = -5 5
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:5
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End



FXList FX_DragonsTreasurePickup
  Sound
    Name = TreasurePickup
  End
 ParticleSystem
    Name = DragonsTreasurePickupSparkle
    Offset = X:34.0 Y:0.0 Z:0.0
  End
; ParticleSystem
;    Name = DragonsTreasurePickupAura
;    Offset = X:0.0 Y:0.0 Z:1.0
;  End
End


Object DragonsTreasure

ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
  OkToChangeModelColor = Yes  
    DefaultModelConditionState
      Model = DrgnTreasure
      ParticleSysBone NONE DragonsTreasureGlimmer
      ParticleSysBone NONE DragonsTreasureGlimmerB
      ParticleSysBone NONE DragonsTreasureGlimmer02
      ParticleSysBone NONE DragonsTreasureGreenGlimmer
      ParticleSysBone NONE DragonsTreasureBlueGlimmer1
      ParticleSysBone NONE DragonsTreasureBlueGlimmer2
      ParticleSysBone NONE DragonsTreasureBlueGlimmer3
      ParticleSysBone NONE DragonsTreasureBlueGlimmer4
      ParticleSysBone NONE DragonsTreasureRedGlimmer
      ParticleSysBone NONE DragonsTreasureRedGlimmerSingle
      ParticleSysBone NONE DragonsTreasureAura
    End
  End
END

  KindOf = SELECTABLE PARACHUTABLE IMMOBILE NOT_AUTOACQUIRABLE UNATTACKABLE CRATE

RemoveModule ModuleTag_02

AddModule
  Body = HighlanderBody ModuleTag_02New
    MaxHealth      = 1.0
  End
END

AddModule
  Behavior = SalvageCrateCollide ModuleTag_02ss
    	ForbiddenKindOf	= PROJECTILE ENVIRONMENT IGNORED_IN_GUI NEUTRALGOLLUM
   	BannerChance	= 0%
    	LevelUpChance	= 0%
    	LevelUpRadius	= 100.0
    	ResourceChance	= 100%
    	MinResource	= 6500
    	MaxResource	= 8000
    	AllowAIPickup	= No
	ExecuteFX	= FX_DragonsTreasurePickup
  End
END

AddModule
  	Behavior = DeletionUpdate ModuleTag_03s
    	MinLifetime = -1
    	MaxLifetime = -1  
  	End   
END

  Geometry              = BOX
  GeometryMajorRadius   = 35.0
  GeometryMinorRadius   = 30.0
  GeometryHeight        = 8.0
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME

End


;----------------
; Sun Rays
;----------------


Object CINE_SunRays

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_01
    DefaultModelConditionState
      Model = LM_Sunrays2
    End
  End
END

  DisplayName = OBJECT:SunRays
  EditorSorting = SYSTEM
  Browser = CINEMATICS SYSTEM

  KindOf = INERT IMMOBILE
  Shadow = NONE

AddModule
  Body = ActiveBody ModuleTag_03
    MaxHealth = 99999.0
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 13.6
  GeometryMinorRadius = 12.0
  GeometryHeight = 72.0
  GeometryIsSmall = No
End



;--------------------
; FX Version of falling rocks
;--------------------

FXParticleSystem CeilingQuakeChunks
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= W3D_ALPHA
    Type		= DRAWABLE
    ParticleName	= exground01.w3d
    Lifetime		= 180 180
    SystemLifetime	= 140
    Size		= 0.15 0.65
    BurstDelay		= 4 6
    BurstCount		= 2 2
  End
  Color			= DefaultColor
    Color1		= R:255 G:170 B:55 0
    Color2		= R:63 G:63 B:63 50
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
    Alpha2		= 0 0 95
  End
  Update		= DefaultUpdate
    SizeRateDamping	= 1 1
    AngleZ		= -500 500
    AngularRateZ	= -0.2 0.2
    AngularDamping	= 1 1
    Rotation		= ROTATE_X
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= -0.2
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    X = -1 1
;    Y = -1 1
    Z			= -0.2 -0.3
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 220
    Length		= 10
    Offset		= X:0 Y:0 Z:0
  End
  Draw = RenderObjectDraw
  End
End


FXParticleSystem CeilingQuakeChunksSmall
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= ALPHA_TEST
    ParticleName	= EXDirt.tga
    Lifetime		= 155 155
    SystemLifetime	= 230
    Size		= 30 45
    BurstDelay		= 3 4
    BurstCount		= 2 3
  End
  Color			= DefaultColor
    Color1		= R:73 G:73 B:63 0
    Color2		= R:0 G:0 B:0 70
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0.6 0.6 0
  End
  Update		= DefaultUpdate
    SizeRate		= 2 3
    SizeRateDamping	= 0.8 0.85
    AngleZ		= -0.1 0.1
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= -0.2
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 200
    Length		= 10
    Offset		= X:0 Y:0 Z:0
  End
  Draw			= DefaultDraw
  End
End


FXList FX_EarthquakeChunks

	ParticleSystem
		Name = CeilingQuakeChunks
        Offset = X:0.0 Y:0.0 Z:145.0					; Emits from the ceiling
;        InitialDelay = 3000 3000 UNIFORM   ;In milliseconds
	End
    ParticleSystem
		Name = CeilingQuakeChunksSmall
        Offset = X:0.0 Y:0.0 Z:135.0			; Emits from the ceiling
        InitialDelay = 5000 5000 UNIFORM   ;In milliseconds
	End
;    CameraShakerVolume				;Done with a script/camera animation
;      Radius = 800
;      Duration_Seconds = 9
;      Amplitude_Degrees = .5
;    End
;    Sound
;	  Name = SpellEarthquakeDebrisDecay	;Done with a script
;    End

End



Object HobbitsSummonEgg

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 1000
		FX = INITIAL FX_EarthquakeChunks
	End
End

END











;---------------------
;Earthquake Generator - 8 seconds
;--------------------

FXList FX_ScreenShaker

  CameraShakerVolume
		Radius = 4000
		Duration_Seconds = 8.0
		Amplitude_Degrees = 0.3
	End
	Sound
		Name = BalrogSummonPart1
	End
End

Object Backdoor1

AddModule
	Draw = W3DScriptedModelDraw Module_Draw
	  DefaultModelConditionState
	    Model = NONE  
	  End
	End
END

RemoveModule ModuleTag_01

AddModule
	Body = ActiveBody ModuleTag_01new
		MaxHealth = 100    
	End
END

	KindOf = NO_COLLIDE UNATTACKABLE IMMOBILE

RemoveModule ThreatFinderUpdateTag

AddModule
	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
		MinLifetime = 0.0
		MaxLifetime = 0.0
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 500
		FX = FINAL FX_ScreenShaker
;		OCL	= INITIAL OCL_KazagDumRocks	; Done with a script for better control
	End
END

End


;---------------------
;Earthquake Generator - 3 seconds
;--------------------

FXList FX_ScreenShaker3Secs

  CameraShakerVolume
		Radius = 4000
		Duration_Seconds = 3.0
		Amplitude_Degrees = 0.5
	End
	Sound
		Name = BalrogSummonPart1
	End
End

Object Backdoor2

AddModule
	Draw = W3DScriptedModelDraw Module_Draw
	  DefaultModelConditionState
	    Model = NONE  
	  End
	End
END

RemoveModule ModuleTag_01

AddModule
	Body = ActiveBody ModuleTag_01new
		MaxHealth = 100    
	End
END

	KindOf = NO_COLLIDE UNATTACKABLE IMMOBILE

RemoveModule ThreatFinderUpdateTag

AddModule
	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
		MinLifetime = 0.0
		MaxLifetime = 0.0
	End
END

AddModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 500
		FX = FINAL FX_ScreenShaker3Secs
;		OCL	= INITIAL OCL_KazagDumRocks	; Done with a script for better control
	End
END

End

;---------------------------
; Unique looking dwarves
;---------------------------

Weapon UselessAxe		; An axe that doesn't deal damage
  LeechRangeWeapon      = Yes
  AttackRange           = 20.0
  MeleeWeapon           = Yes
  WeaponSpeed           = 799999.2        ; dist/sec (huge value == effectively instant)
  DelayBetweenShots     = GIMLI_DELAYBETWEENSHOTS  	; time between shots, msec
  PreAttackDelay        = GIMLI_PREATTACKDELAY  	; 433 is natural time of the stabbing animation.
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  FiringDuration        = GIMLI_FIRINGDURATION  		; min 600 for anim
  FireFX                = FX_GondorSwordHit

  DamageNugget
    Damage        = 1
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = HERO
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End
End

ModifierList FerglirFreeze
	Category = SPELL
	Modifier = SPEED 0%
	Duration = 99999999999999999
END

Object CINERohanDwarvenAxe

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01
	RandomTexture = RUDwarf_B.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_B.tga 0 Dwarf_A.tga

	StaticModelLODMode = no  ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model               = RUAxeDwrf_SKN
			Skeleton            = RUGimli_SKL
		End

		IdleAnimationState
			Animation           = IDLA
				AnimationName     = RUGimli_IDLA
				AnimationMode     = ONCE
			End
		End

; AXE THROW
		AnimationState        =  FIRING_OR_PREATTACK_C
			Animation           = SPCA
				AnimationName     = RUGimli_SPCA
				AnimationMode     = ONCE
;				UseWeaponTiming		= Yes
			End
			FrameForPristineBonePositions = 42;44
			;ParticleSysBone     = None MeleeDust
			BeginScript
				CurDrawableShowSubObject("AXE02")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

		AnimationState        =  FIRING_OR_PREATTACK_B; WEAPONLOCK_SECONDARY
			Animation           = ATKA
				AnimationName     = RUGimli_ATKD
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
	
		AnimationState        =  FIRING_OR_PREATTACK_A
			Animation           = ATKA
				AnimationName     = RUGimli_ATKA
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			Animation           = ATKB
				AnimationName     = RUGimli_ATKB
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End		
			Animation           = ATKC
				AnimationName     = RUGimli_ATKC
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End


		AnimationState				= MOVING
			Animation				= RUNA
				AnimationName		= RUDwrfHmr_RUNA
				AnimationMode		= LOOP
			End
			Flags               = RANDOMSTART
			ParticleSysBone     = None InfantryDustTrails
		End

		AnimationState				= LEVELED 						; This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= RUGimli_CHRB
				AnimationMode		= ONCE
			End
		End

;;====== CELEBRATING
		AnimationState			= EMOTION_CELEBRATING
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = LOOP
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

;;====== TAUNTING
		AnimationState			= EMOTION_TAUNTING
			Animation           = TNTA
				AnimationName   = RUGimli_TNTA
				AnimationMode   = ONCE
			End

			Animation           = TNTB
				AnimationName   = RUGimli_TNTB
				AnimationMode   = ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		AnimationState					= EMOTION_ALERT
			Animation					= Ready
				AnimationName			= RUGimli_IDLA
				AnimationMode			= LOOP
				AnimationBlendTime  =   15
			End
			BeginScript
				CurDrawableHideSubObject("AXE02")
				if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
			EndScript

		End
		
		AnimationState			= RAISING_FLAG
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = LOOP
			End
		End
;------
	
	End
END

AddModule
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:FootstepDirtA			Animation:RUGimli_SKL.RUGimli_RUNA	Frames:3 14
		AnimationSound = Sound:FootstepDirtA			Animation:RUGimli_SKL.RUGimli_RUNB	Frames:3 12

		AnimationSound = Sound:BodyFallSoldier			Animation:RUGimli_SKL.RUGimli_LNDA	Frames:2

		AnimationSound = Sound:BodyFallGenericNoArmor	Animation:RUGimli_SKL.RUGimli_DIEA	Frames:11
		AnimationSound = Sound:BodyFallGenericNoArmor	Animation:RUGimli_SKL.RUGimli_DIEC	Frames:59
	End
END

AddModule
 	Behavior = EmotionTrackerUpdate	Module_EmotionTracker
		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf			=	NONE
		AlwaysAfraidOf			=	NONE
		PointAt				=	EMOTION_POINTAT_OBJECTFILTER
		HeroScanDistance		=	150
		FearScanDistance		=	INFANTRY_FEAR_SCAN_RADIUS

		AddEmotion	=	Terror_Base
		AddEmotion	=	Doom_Base
		//	AddEmotion	=   BraceForBeingCrushed_Base		// Pikemen don't fear getting crushed
		AddEmotion	=	UncontrollableFear_Base_Evil
		AddEmotion	=	FearIdle_Base
		AddEmotion	=	FearBusy_Base
		AddEmotion	=	Point_Base

		AddEmotion	=	Taunt_Base	
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
		AddEmotion	=	Alert_Base
	End
END

	Side = Dwarves
	EditorSorting = UNIT
	Browser = CINEMATICS UNIT
	ThingClass = HORDE_UNIT

	TransportSlotCount = 1

	ArmorSet
		Conditions      = None
		Armor           = RhakidPartyArmor ;;.;; NoArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions				= None 
		Weapon					= PRIMARY  UselessAxe
		AutoChooseSources		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		AutoChooseSources		= TERTIARY NONE
		ShareWeaponReloadTime	= Yes
	End

	VisionRange	= 121
	DisplayName	= OBJECT:DwarvenGuard
	CrushableLevel	= 0

	RadarPriority	= UNIT
        KindOf		= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER NOT_AUTOACQUIRABLE ;CAN_BE_REPULSED 

AddModule	
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 6000 ;;.;; 3000
		MaxHealthDamaged  = 3000 ;;.;; 800
		RecoveryTime      = 5000
	End
END

AddModule
	Behavior = AIUpdateInterface ModuleTag_03
	End
END

	LocomotorSet
		Locomotor = HeroHumanLocomotor
		Condition = SET_NORMAL 
		Speed     = 50
	End

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_FerglirFreezeToPreventBug
	TriggeredBy 		= Upgrade_SarumanFireBall
	AttributeModifier 	= FerglirFreeze
	End
  END

;AddModule
;	Behavior = ObjectCreationUpgrade RemoveTheFreeze
;		TriggeredBy	= Upgrade_GandalfBlast
;		Delay		= 0.0
;		RemoveUpgrade	= Upgrade_SarumanFireBall
;	End
;END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_04
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL -CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_1
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05b
		DeathTypes = NONE +CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_2
		Sound = INITIAL GimliVoiceDie
	End
END
	

AddModule
	Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
		; 
		FirstHeight = 25  ; Height of Bezier control points above highest intervening terrain
		SecondHeight = 25
		FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
		SecondPercentIndent = 70%
		TumbleRandomly = Yes

		CrushStyle = Yes ; I don't detonate, I just hit
		DieOnImpact = Yes
		BounceCount = 1   ; When I hit the ground, I'll arc again
		BounceDistance = 41 ; this far
		BounceFirstHeight = 17  ; Height of Bezier control points above highest intervening terrain
		BounceSecondHeight = 17
		BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
		BounceSecondPercentIndent = 80%

		GroundHitFX       = FX_ThrownRockGroundHit
		GroundBounceFX    = FX_ThrownRockBounceHit
	End
END

	Geometry = CYLINDER
	GeometryMajorRadius = 5.6
	GeometryMinorRadius = 5.6
	GeometryHeight = 16.0
	GeometryIsSmall = Yes
	Shadow = SHADOW_DECAL
	ShadowSizeX = 19;
	ShadowSizeY = 19;
	ShadowTexture = ShadowI;
  
End

;------------------------------------------------------------------------------
; Hammer Dwarf
Object CINERohanDwarvenHammer

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01
	RandomTexture = RUDwarf_D.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_E.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_F.tga 0 Dwarf_A.tga
	
	StaticModelLODMode = no  ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model               = RUDwrfHmr_SKN
			Skeleton            = RUGimli_SKL
		End

		IdleAnimationState
			Animation           = IDLA
				AnimationName     = RUGimli_IDLA
				AnimationMode     = ONCE
			End
		End

; AXE THROW
		AnimationState        =  FIRING_OR_PREATTACK_C
			Animation           = SPCA
				AnimationName     = RUGimli_SPCA
				AnimationMode     = ONCE
;				UseWeaponTiming		= Yes
			End
			FrameForPristineBonePositions = 42;44
			;ParticleSysBone     = None MeleeDust
			BeginScript
				CurDrawableShowSubObject("AXE02")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

		AnimationState        =  FIRING_OR_PREATTACK_B; WEAPONLOCK_SECONDARY
			Animation           = ATKA
				AnimationName     = RUGimli_ATKD
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
	
		AnimationState        =  FIRING_OR_PREATTACK_A
			Animation           = ATKA
				AnimationName     = RUGimli_ATKA
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			Animation           = ATKB
				AnimationName     = RUGimli_ATKB
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End		
			Animation           = ATKC
				AnimationName     = RUGimli_ATKC
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End


		AnimationState				= MOVING
			Animation				= RUNA
				AnimationName		= RUDwrfHmr_RUNA
				AnimationMode		= LOOP
			End
			Flags               = RANDOMSTART
			ParticleSysBone     = None InfantryDustTrails
		End

		AnimationState				= LEVELED 						; This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= RUGimli_CHRB
				AnimationMode		= ONCE
			End
		End

;;====== CELEBRATING
		AnimationState			= EMOTION_CELEBRATING
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

;;====== TAUNTING
		AnimationState			= EMOTION_TAUNTING
			Animation           = TNTA
				AnimationName   = RUGimli_TNTA
				AnimationMode   = ONCE
			End

			Animation           = TNTB
				AnimationName   = RUGimli_TNTB
				AnimationMode   = ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		AnimationState					= EMOTION_ALERT
			Animation					= Ready
				AnimationName			= RUGimli_IDLA
				AnimationMode			= LOOP
				AnimationBlendTime  =   15
			End
			BeginScript
				CurDrawableHideSubObject("AXE02")
				if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
			EndScript

		End
		
		AnimationState			= RAISING_FLAG
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = LOOP
			End
		End
;------
	
	End
END

	Side = Dwarves
	EditorSorting = UNIT
	Browser = CINEMATICS UNIT
	ThingClass = HORDE_UNIT

	TransportSlotCount = 1
	ArmorSet
		Conditions      = None
		Armor           = NoArmor
		DamageFX        = NormalDamageFX
	End
	VisionRange = 121
	DisplayName = OBJECT:DwarvenGuard
	CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles

	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT
        KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED 

AddModule
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 3000
		MaxHealthDamaged  = 800
		RecoveryTime      = 5000
	End
END

AddModule
	Behavior = AIUpdateInterface ModuleTag_03
	End
END	
	LocomotorSet
		Locomotor = HeroHumanLocomotor 
		Condition = SET_NORMAL 
		Speed     = 38
	End

AddModule
	Behavior = SlowDeathBehavior ModuleTag_04
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL -CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_1
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05b
		DeathTypes = NONE +CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_2
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
		; 
		FirstHeight = 25  ; Height of Bezier control points above highest intervening terrain
		SecondHeight = 25
		FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
		SecondPercentIndent = 70%
		TumbleRandomly = Yes

		CrushStyle = Yes ; I don't detonate, I just hit
		DieOnImpact = Yes
		BounceCount = 1   ; When I hit the ground, I'll arc again
		BounceDistance = 41 ; this far
		BounceFirstHeight = 17  ; Height of Bezier control points above highest intervening terrain
		BounceSecondHeight = 17
		BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
		BounceSecondPercentIndent = 80%

		GroundHitFX       = FX_ThrownRockGroundHit
		GroundBounceFX    = FX_ThrownRockBounceHit
	End
END

	WeaponSet
		Conditions				= None 
		Weapon					= PRIMARY  UselessAxe
		AutoChooseSources		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		AutoChooseSources		= TERTIARY NONE
		ShareWeaponReloadTime	= Yes
	End

	HealthBoxHeightOffset = 550

	Geometry = CYLINDER
	GeometryMajorRadius = 5.6
	GeometryMinorRadius = 5.6
	GeometryHeight = 16.0
	GeometryIsSmall = Yes
	Shadow = SHADOW_DECAL
	ShadowSizeX = 19;
	ShadowSizeY = 19;
	ShadowTexture = ShadowI;
  
End

Object CINERohanDwarvenAxeTorch

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01
	RandomTexture = RUDwarf_B.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_B.tga 0 Dwarf_A.tga

		
;	StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
	StaticModelLODMode = no  ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model               = RUBatlDwrf_SKN
			Skeleton            = RUBatlDwrf_SKL
		End

		IdleAnimationState
			Animation           = IDLA
				AnimationName     = RUGimli_IDLA
				AnimationMode     = LOOP				
			End
			ParticleSysBone     = Torch FireTorch FollowBone:Yes
			ParticleSysBone     = Torch OrcTorchFlare FollowBone:Yes
		End

		AnimationState				= MOVING
			Animation			= RUNB
				AnimationName		= RUAxeDwrf_RUNB
				AnimationMode		= LOOP
			End
			Flags               = RANDOMSTART
;			ParticleSysBone     = None InfantryDustTrails
			ParticleSysBone     = Torch FireTorch FollowBone:Yes
			ParticleSysBone     = Torch OrcTorchFlare FollowBone:Yes
		End
	End
END	

AddModule
Draw = W3DLightDraw ModuleTag_W3DLightDraw
    Ambient = R:0 G:0 B:0        ;; Ambient Color...
    Diffuse = R:240 G:200 B:0    ;; Diffusive Color...
    Radius = 50            ;; Radius of Light.
    Intensity = 1.5            ;; Intensity of light.
    FlickerAmplitude = 0.5        ;; How strong it "flickers".
    FlickerFrequency = 3        ;; How often it "flickers".    
    AttachToBoneInAnotherModule = Torch
End
END

	; ***DESIGN parameters ***
	Side = Dwarves
	EditorSorting = UNIT
	Browser = CINEMATICS UNIT
	ThingClass = HORDE_UNIT

	TransportSlotCount = 1

	ArmorSet
		Conditions      = None
		Armor           = NoArmor
		DamageFX        = NormalDamageFX
	End

	VisionRange	= 121
	DisplayName	= OBJECT:DwarvenGuard
	CrushableLevel	= 0


	; *** AUDIO Parameters ***;

	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT
        KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED 
	
AddModule
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 3000
		MaxHealthDamaged  = 1000
		RecoveryTime      = 5000
	End
END

AddModule
	Behavior = AIUpdateInterface ModuleTag_03
	End
END

	LocomotorSet
		Locomotor = RohanGimliLocomotor
		Condition = SET_NORMAL 
		Speed     = 50
	End

AddModule
	Behavior = SlowDeathBehavior ModuleTag_04
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL GimliVoiceDie
	End
END	

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL -CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_1
		Sound = INITIAL GimliVoiceDie
	End
END
	
AddModule
	Behavior = SlowDeathBehavior ModuleTag_05b
		DeathTypes = NONE +CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_2
		Sound = INITIAL GimliVoiceDie
	End
END

	Geometry = CYLINDER
	GeometryMajorRadius = 5.6
	GeometryMinorRadius = 5.6
	GeometryHeight = 16.0
	GeometryIsSmall = Yes
	Shadow = SHADOW_DECAL
	ShadowSizeX = 19;
	ShadowSizeY = 19;
	ShadowTexture = ShadowI;
  
End


Object CINERohanDwarvenHalberd

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01
	RandomTexture = Dwarf_A.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_B.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_C.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_D.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_E.tga 0 Dwarf_A.tga
	RandomTexture = RUDwarf_F.tga 0 Dwarf_A.tga
	
	StaticModelLODMode = no  ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model               = RUDwrfHlbd_SKN
			Skeleton            = RUDwrfHlbd_SKL
		End

		IdleAnimationState
			Animation           = IDLA
				AnimationName     = RUDwrfHlbd_IDLA
				AnimationMode     = ONCE
			End
		End

		AnimationState				= MOVING
			Animation				= RUNA
				AnimationName		= RUDwrfHlbd_RUNA
				AnimationMode		= LOOP
			End
			Flags               = RANDOMSTART
			ParticleSysBone     = None InfantryDustTrails
		End		
	End
END

	Side = Dwarves
	EditorSorting = UNIT
	Browser = CINEMATICS UNIT
	ThingClass = HORDE_UNIT

	TransportSlotCount = 1

	ArmorSet
		Conditions      = None
		Armor           = NoArmor
		DamageFX        = NormalDamageFX
	End

	VisionRange	= 121
	DisplayName	= OBJECT:DwarvenGuard
	CrushableLevel	= 0

	RadarPriority	= UNIT
        KindOf		= PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED 

AddModule	
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 3000
		MaxHealthDamaged  = 800
		RecoveryTime      = 5000
	End
END

AddModule
	Behavior = AIUpdateInterface ModuleTag_03
	End
END
  	
	LocomotorSet
		Locomotor = HeroHumanLocomotor 
		Condition = SET_NORMAL 
		Speed     = 0	; Has no walking anim, apparently
	End

AddModule
	Behavior = SlowDeathBehavior ModuleTag_04
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL GimliVoiceDie
	End
END
	
AddModule
	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL -CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_1
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_05b
		DeathTypes = NONE +CRUSHED
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		DeathFlags = DEATH_2
		Sound = INITIAL GimliVoiceDie
	End
END

AddModule
	Behavior = BezierProjectileBehavior ModuleTag_08 ; Module starts asleep, and wakes up when thrown.
		; 
		FirstHeight = 25  ; Height of Bezier control points above highest intervening terrain
		SecondHeight = 25
		FirstPercentIndent = 30% ; Percentage of shot distance control points are placed
		SecondPercentIndent = 70%
		TumbleRandomly = Yes

		CrushStyle = Yes ; I don't detonate, I just hit
		DieOnImpact = Yes
		BounceCount = 1   ; When I hit the ground, I'll arc again
		BounceDistance = 41 ; this far
		BounceFirstHeight = 17  ; Height of Bezier control points above highest intervening terrain
		BounceSecondHeight = 17
		BounceFirstPercentIndent = 20% ; Percentage of shot distance control points are placed
		BounceSecondPercentIndent = 80%

		GroundHitFX       = FX_ThrownRockGroundHit
		GroundBounceFX    = FX_ThrownRockBounceHit
	End
END

	Geometry = CYLINDER
	GeometryMajorRadius = 5.6
	GeometryMinorRadius = 5.6
	GeometryHeight = 16.0
	GeometryIsSmall = Yes
	Shadow = SHADOW_DECAL
	ShadowSizeX = 19;
	ShadowSizeY = 19;
	ShadowTexture = ShadowI;
  
End

;---------------------
; Mini Drake
;---------------------

Armor MiniDrakeArmor
  Armor = DEFAULT		100%
  Armor = STRUCTURAL		50%
  Armor = HERO			100%
  Armor = MAGIC			70%
  Armor = HERO_RANGED		95%
  Armor = FLAME			0%
  Armor = LOGICAL_FIRE		0%
  Armor = SPECIALIST    	100%
  Armor = POISON		100%
End


ExperienceLevel	DamrodLevel5
	TargetNames			=	GondorDamrod WildFireDrake FireDrake_Slaved
;	RequiredExperience		=	200 ; Changing this makes game crash
	ExperienceAward			=	1	
	LevelUpFx			=	FX:GandalfLevelUp1FX
	Rank				=	5 ; 5
	AttributeModifiers		=	HeroLevelUpDamage4
End

ExperienceLevel	DamrodLevel10
	TargetNames			=	GondorDamrod WildFireDrake FireDrake_Slaved WildFortressFireDrake
;	RequiredExperience		=	1500  ; Changing this makes game crash
	ExperienceAward			=	2	
	LevelUpFx			=	FX:GandalfLevelUp1FX
	Rank				=	10
	AttributeModifiers		=	EvilMonsterBonusRank9
	Upgrades			=	Upgrade_FireDrakeInferno
End

FXList FX_DrakeMelee
  Sound
    Name = FireDrakeFireInhale
  End
  ParticleSystem
    Name = GondorSwordHitFlash
    Offset = X:17.0 Y:0.0 Z:8.0

    OrientToObject = Yes
  End
End

Weapon FiredrakeMelee
  LeechRangeWeapon      = Yes
  AttackRange           = 30.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = 1000
  PreAttackDelay        = 18
  PreAttackType         = PER_SHOT
  FireFX                = FX_DrakeMelee
  FiringDuration        = 1000

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 2000

  DamageNugget
    Damage        = 500
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = SLASH
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End
END


Object FireDrake_Slaved

ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01new
		OkToChangeModelColor = Yes

		StaticModelLODMode = Yes
		
		ParticlesAttachedToAnimatedBones = yes

		DefaultModelConditionState
			Model			= WUFireDrk_SKN
			Skeleton		= WUFireDrk_SKL
			WeaponLaunchBone	= PRIMARY B_JAW
		End
		
		IdleAnimationState
			Animation			= IDLA
				AnimationName		= WUFireDrk_IDLA
				AnimationMode		= ONCE
				AnimationPriority	= 1
			End
			Flags				= RESTART_ANIM_WHEN_COMPLETE
		End

		AnimationState          = DYING DEATH_2
			Animation
				AnimationName   = WUFireDrk_IDLA
				AnimationMode   = LOOP
			End
		End
		
		AnimationState						= DYING
			Animation						= DIEA
				AnimationName				= WUFireDrk_DIEA
				AnimationMode				= ONCE
			End
		End



;;-------- FALLING & FLYING

		AnimationState						= STUNNED_FLAILING
			Animation						= Falling
				AnimationName				= WUFireDrk_FLYA
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
		End
		
		AnimationState						= PASSENGER
			Animation						= Grabbed
				AnimationName				= WUFireDrk_FLYA
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
		End
		
		AnimationState        				= THROWN_PROJECTILE
			Animation           			= FlyA
				AnimationName      	 		= WUFireDrk_FLYA
				AnimationMode       		= LOOP
			End
			Flags               			= RANDOMSTART
		End
		
		AnimationState						= FREEFALL
			Animation						= Falling
				AnimationName				= WUFireDrk_FLYA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
			End
		End
						
		AnimationState						= STUNNED_STANDING_UP 
			Animation						= StandUp
				AnimationName				= WUFireDrk_GTPA
				AnimationMode				= ONCE
			End
		End
		
		AnimationState						= STUNNED
			Animation						= LNDA
				AnimationName				= WUFireDrk_LNDA
				AnimationMode				= ONCE
			End
		End		

		AnimationState						= SPECIAL_WEAPON_ONE
			Animation						= ATKA
				AnimationName				= WUFireDrk_ATKA
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
		End
		
				
		AnimationState						= MOVING ATTACKING
			Animation					= ATA1
				AnimationName				= WUFireDrk_ATRA
				AnimationMode				= LOOP
				UseWeaponTiming				= Yes
				AnimationSpeedFactorRange	= 1.4 1.4
			End
		End

		AnimationState						= ATTACKING
			Animation					= ATKB
				AnimationName				= WUFireDrk_ATKB
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
		End

		AnimationState = MOVING TURN_LEFT_HIGH_SPEED
			Animation = Moving
				AnimationName				= WUFireDrk_RUNA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
				AnimationSpeedFactorRange = 1.9 1.9
			End
		End

		AnimationState = MOVING TURN_RIGHT_HIGH_SPEED
			Animation = Moving
				AnimationName				= WUFireDrk_RUNA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
				AnimationSpeedFactorRange = 2 2
			End
		End

		AnimationState = TURN_LEFT
			Animation = Moving
				AnimationName				= WUFireDrk_TRNL
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
				AnimationSpeedFactorRange = 2.9 2.9
			End
		End

		AnimationState = TURN_RIGHT
			Animation = Moving
				AnimationName				= WUFireDrk_TRNR
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
				AnimationSpeedFactorRange = 2.9 2.9
			End
		End
				

		AnimationState = MOVING ACCELERATE
			Animation = Moving
				AnimationName = WUFireDrk_ACCL
				AnimationMode = LOOP
				AnimationSpeedFactorRange	=  1.4 1.4
				AnimationBlendTime		= 10
			End
			;Flags = RANDOMSTART
			;ParticleSysBone = None InfantryDustTrails
			FXEvent	= Frame:17 FireWhenSkipped Name:FX_DrakeRightFootStep
			FXEvent	= Frame:6 FireWhenSkipped Name:FX_DrakeLeftFootStep
		End
					
		AnimationState = MOVING
			Animation = Moving
				AnimationName = WUFireDrk_RUNA
				AnimationMode = LOOP
				AnimationSpeedFactorRange	= 1.4 1.4
			End
			;Flags = RANDOMSTART
			;ParticleSysBone = None InfantryDustTrails
			FXEvent	= Frame:17 FireWhenSkipped Name:FX_DrakeRightFootStep
			FXEvent	= Frame:6 FireWhenSkipped Name:FX_DrakeLeftFootStep
		End
	End
END

ReplaceModule ModuleTag_AnimAudioBehavior	; I removed the exhale sound
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehaviorNew
		MaxUpdateRangeCap = 800
		AnimationSound = Sound: TrollBodyfall			Animation: WUFireDrk_SKL.WUFireDrk_DIEA		Frames: 20
		AnimationSound = Sound: TrollBodyfall			Animation: WUFireDrk_SKL.WUFireDrk_LNDA		Frames: 1
		AnimationSound = Sound: FireDrakeFootstep		Animation: WUFireDrk_SKL.WUFireDrk_GTPA		Frames: 9 16
		AnimationSound = Sound: FireDrakeFootstep		Animation: WUFireDrk_SKL.WUFireDrk_ACCL		Frames: 12

		AnimationSound = Sound: FireDrakeFootstep	Animation:WUFIREDRK_SKL.WUFIREDRK_ATRA	Frames:8 11 18 20
		AnimationSound = Sound: FireDrakeFootstep	Animation:WUFIREDRK_SKL.WUFIREDRK_RUNA	Frames:8 11 18 20
		AnimationSound = Sound: FireDrakeFootstep	Animation:WUFIREDRK_SKL.WUFIREDRK_TRNL	Frames:14 29
		AnimationSound = Sound: FireDrakeFootstep	Animation:WUFIREDRK_SKL.WUFIREDRK_TRNR	Frames:14 29 
	End
END

	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MONSTER CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT SCORE CREEP
	DisplayName = OBJECT:GenericFireDrake

	Scale = 0.5

RemoveModule ModuleTag_Slave

	CommandSet = GenericCommandSet

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02new
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 3000
		RecoveryTime      = FIREDRAKE_HEALTH_RECOVERY_TIME
	End
END

	WeaponSet
		Conditions	= None 
		Weapon		= PRIMARY    FiredrakeMelee
	End

	ArmorSet
		Conditions	= None
		Armor		= MiniDrakeArmor
	END

	LocomotorSet
		Locomotor = FiredrakeLocomotor
		Condition = SET_NORMAL
		Speed     = 80
	End

	Geometry = CYLINDER
	GeometryMajorRadius = 6.0
	GeometryMinorRadius = 6.0
	GeometryHeight = 6.0
	GeometryIsSmall = Yes
End









;---------------------
; Medium Fire Drake
;---------------------

Armor MediumDrakeArmor
  Armor = DEFAULT		100%
  Armor = STRUCTURAL		50%
  Armor = HERO			100%
  Armor = MAGIC			20%
  Armor = HERO_RANGED		95%
  Armor = FLAME			0%
  Armor = LOGICAL_FIRE		0%
  Armor = SPECIALIST    	100%
  Armor = POISON		100%
End


FXParticleSystem FireDrakeSmallFlame
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFireScroll3.tga
    Lifetime = 20 30
    SystemLifetime = 70
    SortLevel = 1
    Size = 5 12
    BurstCount = 3 4
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:97 G:69 B:51 3
    Color3 = R:97 G:43 B:15 15
    Color4 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 0.15 0.20
;    SizeRateDamping = 0.99 0.99
    AngularRateZ = -0.08 0.08
    AngularDamping = 1 1
;    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0.2 Y:0 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 1 3
    Y = -0.1 0.1
    Z = -0.1 -0.2
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End


FXList FX_MediumDrakeFlame
  Sound
    Name = FireStartWoosh
  End
 ParticleSystem
    Name = FireDrakeSmallFlame
    Offset = X:24.0 Y:0.0 Z:15.0
  End
End


Weapon FireDrakeMediumFlame			; NOT USED
	AttackRange		= 10
	WeaponSpeed		= FIREDRAKE_FLAME_SPEED
	MinWeaponSpeed		= FIREDRAKE_FLAME_MINSPEED
	MaxWeaponSpeed		= FIREDRAKE_FLAME_MAXSPEED
	FireFX			= FX_MediumDrakeFlame
	ScaleWeaponSpeed	= No
	HitPercentage		= 100
	ScatterRadius		= 0

	AcceptableAimDelta	= 0	; prevent twitchy reaiming in horde on horde
	DelayBetweenShots	= 1000      ;FIREDRAKE_FLAME_DELAYBETWEENSHOTS
	PreAttackDelay		= FIREDRAKE_FLAME_PREATTACKDELAY
	PreAttackRandomAmount	= 0
	PreAttackType		= PER_SHOT
	FiringDuration		= 500
	MeleeWeapon		= Yes

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 2000

	AntiAirborneVehicle	= No
	AntiAirborneMonster	= No
	CanBeDodged		= No ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 1000
    Radius        = 50.0
    DamageArc	  = 30
    DelayTime     = 0
    DamageType    = FLAME
    DamageFXType  = FLAME
    DeathType     = NORMAL
  End
		
End

Object WildFortressFireDrake	; Medium Firedrake

	Scale = 0.9

	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MONSTER CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT SCORE CREEP
	DisplayName = OBJECT:GenericFireDrake

	CommandSet = GenericCommandSet

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02new
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 5700
		RecoveryTime      = FIREDRAKE_HEALTH_RECOVERY_TIME
	End
END

	WeaponSet
		Conditions	= None 
		Weapon		= PRIMARY    FireDrakeFlame
	End

	ArmorSet
		Conditions	= None
		Armor		= MediumDrakeArmor
	END

	LocomotorSet
		Locomotor = FiredrakeLocomotor
		Condition = SET_NORMAL
		Speed     = 70
	End

End



;-------------------------
; TeleportEffect
;-------------------------









;------------------------
; DRAGON
;------------------------

ExperienceLevel	SummonedDragon
	TargetNames				= SummonedDragon SummonedDragonJH1
	RequiredExperience			= 1	
; ;	ExperienceAward				= 500
	Rank					= 10
	ExperienceAwardOwnGuysDie		= 0 ; 1000 ; originally 0, used this because I give experience through a script now
	SelectionDecal
		Texture				= HC_decal_Hero_Evil	
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 50
		MaxRadius			= 50
		MaxSelectedUnits		= 1
	End		
End

Armor DragonArmor
  Armor = DEFAULT		25%
  Armor = HERO			25%
  Armor = MAGIC			25%
  Armor = HERO_RANGED		25%
  Armor = FLAME			0%
  Armor = LOGICAL_FIRE		0%
End

Locomotor DragonLocomotor
	Surfaces			= GROUND
	SlowTurnRadius			= 2.0
	FastTurnRadius			= 50.0
	TurnTime			= 7000
	TurnTimeDamaged			= 5000
	Acceleration			= 1500  ; 1.5 second to accelerate to full speed.
	FormationPriority		= MELEE1

	Braking				= 500
	MinTurnSpeed			= 100%
	TurnPivotOffset			= 1.0
	ZAxisBehavior			= NO_Z_MOTIVE_FORCE
	Appearance			= FOUR_WHEELS
                                  
	AccelerationPitchLimit		= 0
	BounceAmount			= 12
	PitchStiffness			= 0.5
	RollStiffness			= 0.5
	PitchDamping			= 1.0
	RollDamping			= 1.0
	ForwardAccelerationPitchFactor	= 0.0
	LateralAccelerationRollFactor	= 0.0
	; UniformAxialDamping		= 0.1
	UseTerrainSmoothing		= Yes
                                  
	HasSuspension			= Yes
	CanMoveBackwards		= No
	MaximumWheelExtension		= -2.3
	MaximumWheelCompression		= 1.4
	FrontWheelTurnAngle		= 0
End




FXParticleSystem DragonMegaLand
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    Lifetime = 120 120
    SystemLifetime = 2
    SortLevel = 1
    Size = 7 15
    BurstCount = 80 80
    InitialDelay = 50 50	; Original dust delays 45
  End
  Color = DefaultColor
    Color1 = R:85 G:85 B:90 0
    Color2 = R:85 G:85 B:90 80
    ColorScale = -20 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.6 0.9 0
    Alpha2 = -0.2 -0.2 120
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 0.8 0.95
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:0.1
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial = 10 19
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End





FXParticleSystem DragonSmokeRoar
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    Lifetime = 30 30
    SystemLifetime = 75
    SortLevel = 1
    Size = 3 8
    BurstCount = 1 3
    InitialDelay = 45 45
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:247 G:150 B:62 15
    Color2 = R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.5 0.5 0
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 2 3
    SizeRateDamping = 0.9 0.99
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.93 0.95
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 12 12
    Z = 0.024 0.04
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319

    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
End


FXParticleSystem DragonFireRoar
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXFireScroll3.tga
    Lifetime = 40 40
    SystemLifetime = 80
    SortLevel = 1
    Size = 14 14
    BurstCount = 3 3
    InitialDelay = 38 38
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:1 G:34 B:148 0
    Color2 = R:79 G:55 B:40 6
    Color3 = R:70 G:50 B:36 15
    Color4 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 3
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.93 0.95
    DriftVelocity = X:0 Y:0 Z:0.05
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 10 11
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:5 Y:-5 Z:0
    EndPoint = X:5 Y:-5 Z:0
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
End


FXParticleSystem SummonedDragonFireBreath2Redone
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXFireScroll3.tga
    Lifetime = 28 28
    SystemLifetime = 150
    SortLevel = 1
    Size = 10 20
    BurstCount = 4 5
    InitialDelay = 58 58
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:1 G:34 B:148 0
    Color2 = R:79 G:55 B:40 6
    Color3 = R:70 G:50 B:36 15
    Color4 = R:0 G:0 B:0 28
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 3
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.93 0.95
    DriftVelocity = X:0 Y:0 Z:0.05
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 12 12
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:5 Y:-5 Z:0
    EndPoint = X:5 Y:-5 Z:0
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
END

FXParticleSystem SummonedDragonHeatRedone
  System
    Priority = HIGH_OR_ABOVE
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 30 30
    SystemLifetime = 205
    BurstCount = 1 1
    InitialDelay = 85 85
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 0.9 0.9
    AngleZ = 0.008 0.008
    AngularRateZ = 0.005 0.005
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 9 9
    Z = 0.25 0.25
  End
  EmissionVolume = BoxEmissionVolume
  End
  Draw = DefaultDraw
  End
END

FXParticleSystem SummonedDragonEmbersRedone
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXEmbersLight.tga
    Lifetime = 20 40
    SystemLifetime = 165
    Size = 10 10
    BurstCount = 1 3
    InitialDelay = 70 70
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:250 G:216 B:114 0
    Color2 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = -1 1
    SizeRateDamping = 0.99 0.99
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.9
    DriftVelocity = X:0 Y:0 Z:0.4
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 10 10
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
END

FXParticleSystem SummonedDragonSmokeRedone
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    Lifetime = 30 30
    SystemLifetime = 155
    SortLevel = 1
    Size = 1 5
    BurstCount = 1 3
    InitialDelay = 90 90
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:247 G:150 B:62 15
    Color2 = R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.5 0.5 0
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 2 3
    SizeRateDamping = 0.9 0.99
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.93 0.95
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 10 10
    Z = 0.024 0.04
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319

    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
END

FXParticleSystem SummonedDragonFireProxy2Redone
  System
    Priority = MEDIUM_OR_ABOVE
    ParticleName = EXFireScroll3.tga
    Lifetime = 28 28
    SystemLifetime = 155
    SortLevel = 1
    Size = 1 1
    BurstDelay = 2 2
    BurstCount = 1 1
    InitialDelay = 58 58
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:0 G:2 B:9 0
    Color2 = R:16 G:11 B:7 6
    Color3 = R:14 G:10 B:7 15
    Color4 = R:0 G:0 B:0 28
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 3
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.6
    VelocityDamping = 0.93 0.95
    DriftVelocity = X:0 Y:0 Z:0.05
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 12 12
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:5 Y:-5 Z:0
    EndPoint = X:5 Y:-5 Z:0
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
  Event = TerrainCollision
    HeightOffset = 0 0
    EventFX = FX_SummonDragonImpact
    OrientFXToTerrain = No
    PerParticle = Yes
    KillAfterEvent = Yes
  End
END






FXParticleSystem SummonedDragonWingHeat
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 50 50
    SystemLifetime = 70
    Size = 20 20
    BurstCount = 2 3
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = 0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = CylindricalEmissionVelocity
    Radial = 2 3
    Normal = 1 1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 32
    Length = 50
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem SummonedDragonWingDust
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
;    PerParticleAttachedSystem = GandalfBlastDustCore
    Lifetime = 32 32
    SystemLifetime = 15
    SortLevel = 1
    Size = 1 2
    BurstCount = 25 50
    InitialDelay = 5 5
  End
  Color = DefaultColor
    Color1 = R:181 G:190 B:196 0
    Color2 = R:0   G:0   B:0   35
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.2 0.3 0
    Alpha2 = -2  0   40
  End
  Update = DefaultUpdate
    SizeRate = 2 15
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.1 -0.2
    AngularDamping = 0.92 0.94
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.94
    DriftVelocity = X:0.032 Y:0.064 Z:0.15
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 12 12
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 18
  End
  Draw = DefaultDraw
  End
  Event = TerrainCollision
    HeightOffset = 0 0
    OrientFXToTerrain = Yes
    PerParticle = Yes
    KillAfterEvent = Yes
  End
End

FXList FX_DragonWingAttack
  ParticleSystem
    Name = SummonedDragonWingHeat
  End
  ParticleSystem
    Name = SummonedDragonWingDust
  End
  Sound
    Name = GandalfWizardBlast
  END
End





SpecialPower SpecialAbilityDragonsFireBreath
	Enum						   = SPECIAL_WIZARD_BLAST
	ReloadTime					   = 60000
End

SpecialPower SpecialAbilityDragonsWingAttack
	Enum						   = SPECIAL_KNIFE_ATTACK
	ReloadTime					   = 60000
End

SpecialPower SpecialAbilityDragonsHellfire
	Enum						   = SPECIAL_SARUMAN_FIRE_BALL
	ReloadTime					   = 240000
End

SpecialPower SpecialAbilityDragonsTaunt
	Enum						   = SPECIAL_WORD_OF_POWER
	ReloadTime					   = 30000
End

CommandButton Command_SpecialAbilityBalrogBreath			; Dragon's Fire Breath
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityDragonsFireBreath
	Options			= NEED_TARGET_ENEMY_OBJECT
	TextLabel		= CONTROLBAR:SpecialAbilityDragonsFireBreath
	ButtonImage		= HSBalrogBreathFire
	ButtonBorderType	= ACTION 
	CursorName		= EvilAbilityObj
	InvalidCursorName       = GenericInvalid
	RadiusCursorType        = FireBreathRadiusCursor 
	DescriptLabel		= CONTROLBAR:TooltipSpecialAbilityDragonsFireBreath
	InPalantir		= Yes
End

CommandButton Command_DrogothWingBlast					; Dragon's Wing Attack
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityDragonsWingAttack
	Options			= NEED_TARGET_ENEMY_OBJECT
	TextLabel		= CONTROLBAR:SpecialAbilityDragonsWingAttack
	ButtonImage		= HSBalrogWings
	ButtonBorderType	= ACTION 
	CursorName		= EvilAbilityObj  
	InvalidCursorName       = GenericInvalid
	DescriptLabel		= CONTROLBAR:TooltipSpecialAbilityDragonsWingAttack
	InPalantir		= Yes
End

CommandButton Command_DrogothIncinerate					; Dragon's Hellfire
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityDragonsHellfire
	Options                 = NEED_TARGET_ENEMY_OBJECT; NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel               = CONTROLBAR:SpecialAbilityDragonsHellfire
	ButtonImage             = HSDrogothIncinerate
	ButtonBorderType        = ACTION
	CursorName		= EvilAbilityObj  
	InvalidCursorName       = GenericInvalid
	RadiusCursorType        = FireBreathRadiusCursor
	DescriptLabel           = CONTROLBAR:ToolTipSpecialAbilityDragonsHellfire
	InPalantir		= Yes
End

CommandButton Command_DragonTaunt
	Command			= SPECIAL_POWER 
	SpecialPower	   	= SpecialAbilityDragonsTaunt
	TextLabel		= CONTROLBAR:CAHWordofPower
	ButtonImage		= Gandolf_radcircle
	ButtonBorderType	= ACTION	
	DescriptLabel		= Taunt
End


CommandSet DragonCommandSet
	1 = Command_ToggleStance
	2 = Command_SpecialAbilitySummonedDragonReposition
	3 = Command_DrogothWingBlast
	4 = Command_SpecialAbilityBalrogBreath
	5 = Command_DrogothIncinerate
	12 = Command_DragonTaunt
End



FXParticleSystem TuskHitDust
  System
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 30 30
    SystemLifetime = 3
    SortLevel = 1
    Size = 2 5
    BurstCount = 4 6
  End
  Color = DefaultColor
    Color1 = R:199 G:183 B:154 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.75 0.75 0
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 4 15
    SizeRateDamping = 0.95 0.8
    AngleZ = -0.5 0.5
    AngularRateZ = -0.1 0.1
    AngularDamping = 0.98 0.98
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.9 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 2 4
    Y = 0 1
    Z = 0 1
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:-37 Z:0
    EndPoint = X:0 Y:37 Z:0
  End
  Draw = DefaultDraw
  End
End


FXList FX_DragonTuskDuster
  Sound
    Name = ImpactCatapultRock
  End
  ParticleSystem
    Name = TuskHitDust
    Offset = X:75.0 Y:0.0 Z:25.0
    OrientToObject = Yes
  End
  ViewShake 
    Type = CINE_EXTREME
  End
End

Weapon DragonTuskAttack
	LeechRangeWeapon		= Yes
	RadiusDamageAffects		= ENEMIES								; Turning off friendly fire for all allies, but ya know, this could say NotSimilar and then he could hit friendlies except for trolls
	ClearNuggets ;;.;;
	MeleeWeapon			= Yes
	AttackRange			= 40									; this was tuned with the Damage and shock wave nugget so it looks good with club
	FireFX				= FX_DragonTuskDuster
	ClipSize			= INFINITE_CLIP_SIZE					; how many shots in a Clip (0 == infinite)
	AutoReloadsClip			= No									; We need a rock explicitly picked up.
	DelayBetweenShots		= 3000
	FiringDuration			= 2500
	PreAttackDelay			= 1800
	PreAttackType			= PER_SHOT								; Do the delay each time we attack a new target
	PreAttackFX			= FX_TrollTreeSwing
	DamageDealtAtSelfPosition	= Yes									; A melee based AoE.  Arc radiates from me, not them
	AcceptableAimDelta		= 45.0 

	DamageNugget									
		Damage			= 900
		Radius			= 120.0
		DamageArc		= 90
		DamageType		= SIEGE
		DamageFXType		= CLUBBING
		DeathType		= NORMAL
	End

	MetaImpactNugget	
		ShockWaveAmount   = 80.0
		ShockWaveRadius   = 120.0
		ShockWaveTaperOff = 0.75
		ShockWaveArc      = 70
		ShockWaveZMult    = 1.20
		HeroResist	  = 0.70
	End
End

Weapon DragonsFirebreath
	IdleAfterFiringDelay		= 0
	AttackRange			= 100
	WeaponSpeed			= 401												; dist/sec 
	RadiusDamageAffects		= ALLIES ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots		= 5000												; time between shots, msec
	PreAttackDelay			= 2000
	PreAttackType			= PER_SHOT
	;FireFX				= FX_DragonFireBreath
	FiringDuration			= 3000
	;DamageDealtAtSelfPosition	= Yes 
	MeleeWeapon			= Yes

	DamageNugget
		Damage			= 1200 ; 1000 (each)
		Radius			= 215
		DelayTime		= 3500
		DamageType		= FLAME
		DamageFXType		= FLAME
		DeathType		= BURNED
		DamageArc		= 110
		DamageMaxHeight		= 50
		DamageSpeed		= 400
	End

	DamageNugget
		Damage			= 950 ; 1000
		Radius			= 215
		DelayTime		= 3800
		DamageType		= FLAME
		DamageFXType		= FLAME
		DeathType		= BURNED
		DamageArc		= 110
		DamageMaxHeight		= 50
		DamageSpeed		= 400
	End

	DamageNugget
		Damage			= 850 ; 1000
		Radius			= 215
		DelayTime		= 4100
		DamageType		= FLAME
		DamageFXType		= FLAME
		DeathType		= BURNED
		DamageArc		= 110
		DamageMaxHeight		= 50
		DamageSpeed		= 400
	End

	DamageNugget
		Damage			= 850 ; 1000
		Radius			= 215
		DelayTime		= 4400
		DamageType		= FLAME
		DamageFXType		= FLAME
		DeathType		= BURNED
		DamageArc		= 110
		DamageMaxHeight		= 50
		DamageSpeed		= 400
	End
	
	DamageNugget
		Damage			= 850	; 2000
		Radius			= 215
		DelayTime		= 3650
		DamageType		= MAGIC
		DamageArc		= 110
		DamageMaxHeight		= 300	; So he kills Spike the white Hawk. Annoying little bird!
		DamageSpeed		= 400
	End

;	FireLogicNugget
;		LogicType		= INCREASE_BURN_RATE
;		Radius			= 60
;		Damage			= 150
;	End

End


Weapon DragonsWingAttack
	RadiusDamageAffects		= ALLIES ENEMIES NOT_SIMILAR
	AttackRange			= 100
	WeaponSpeed			= 251
	ScaleWeaponSpeed		= Yes
	FireFX				= FX_DragonWingAttack
;	AutoReloadsClip			= No
	DelayBetweenShots		= 5000
	FiringDuration			= 3000
	PreAttackDelay			= 1000
	PreAttackType			= PER_SHOT
;	PreAttackFX			= FX_TrollTreeSwing
	DamageDealtAtSelfPosition	= Yes			; A melee based AoE.  Arc radiates from me, not them
	AcceptableAimDelta		= 180.0 		; Doesn't need to face its target
	RadiusDamageAffects		= ENEMIES ALLIES
	ClearNuggets ;;.;;

	DamageNugget
		Damage			= 1350
		DelayTime		= 600		; when heroes hit the wall or ground
		Radius			= 205.0
		DamageArc		= 170		; All around
		DamageType		= SIEGE
		DeathType		= CRUSHED
	End

	MetaImpactNugget
		ShockWaveAmount		= 80.0
;		DelayTime		= 300
		ShockWaveArc		= 180
		ShockWaveRadius		= 175.0
		ShockWaveTaperOff	= 3.0
		ShockWaveZMult		= 0.4
	End
END

Weapon HellFireWarhead
	FireFX= FX_RainOfFirePhaseOne
	RadiusDamageAffects = ENEMIES
	ClearNuggets ;;.;;
	
	DamageNugget
		Damage         = 6000
		Radius         = 200.0
		DelayTime      = 0
		DamageType     = HERO
		DamageFXType   = BIG_ROCK
		DeathType      = EXPLODED
		DamageScalar   = 0% ANY ALLIES +STRUCTURE			; No damage to allied structures.
		DamageScalar   = 0% ANY +SHIP ; ;
	End
	
	MetaImpactNugget                    ; A Nugget that throws things back with force 
;		HeroResist			= .75
		ShockWaveAmount   = 75.0
		ShockWaveRadius   = 200.0
		ShockWaveTaperOff = 1.2
	End
End


Object GondorTrebuchetRockProjectile		; Hellfire ball

	Scale = 2

ReplaceModule ModuleTag_Draw
  Draw = W3DScriptedModelDraw ModuleTag_DrawNew
   DefaultModelConditionState  
      Model	= MUCatapult_FP01
      ParticleSysBone	= None FlamingRockStart
      ParticleSysBone	= None FlamingRockTrailLenzflare
      ParticleSysBone	= None FlamingRockTrailLenzflare
      ParticleSysBone	= None EvilShipBombardFire
      ParticleSysBone	= None DrogothFireballFire
      ParticleSysBone	= None DrogothFireballFire
      ParticleSysBone	= None DrogothFireballSmoke
    End
    AnimationState        = NONE
      Animation           = MUCatapult_FP01
        AnimationName     = MUCatapult_FP01.MUCatapult_FP01
        AnimationMode     = LOOP
      End
    End
  End
END

AddModule
  Draw = W3DLightDraw ModuleTag_02
    Ambient = R:0 G:0 B:0
    Diffuse = R:255 G:180 B:0
    Radius = 50
    Intensity = 12
    AttachToBoneInAnotherModule = GEOSPHERE01
  End
END

  SoundAmbient = CatapultProjectileFlying

ReplaceModule ModuleTag_05
  Behavior = BezierProjectileBehavior ModuleTag_05New
    FirstHeight				= 0
    SecondHeight			= 0
    FirstPercentIndent			= 20% ; Percentage of shot distance control points are placed
    SecondPercentIndent			= 100%
    FlightPathAdjustDistPerSecond	= 50 ; Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
    DetonateCallsKill			= Yes
    CurveFlattenMinDist			= 50.0
  End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_HellfireWarHead
    StartsActive = Yes
    DeathWeapon = HellFireWarhead
  End
END

ReplaceModule ModuleTag_08
  Behavior = FXListDie ModuleTag_08Fx
    DeathTypes = ALL -CRUSHED -SPLATTED
    DeathFX = FX_CatapultFlamingProjectileExplosion
  End
End

  Geometry = Sphere
  GeometryIsSmall = Yes
  GeometryMajorRadius = 0.8
End


Weapon GondorTrebuchetRock  ; BALANCE Trebuchet Weapon
	ScatterRadiusVsInfantry	= 0.0
	AttackRange		= 400
	MinimumAttackRange	= 10
  
	WeaponSpeed		= 110         ; dist/sec 
	MinWeaponSpeed		= 75
	FireFX			= FX_DrogothFireball_01
	HitPercentage		= 100
	ScatterRadius		= 0.0
	DelayBetweenShots	= 5000
	PreAttackDelay      	= 0
	PreAttackType       	= PER_SHOT
	FiringDuration      	= 1000
	NoVictimNeeded		= Yes ; Need no target
	LeechRangeWeapon      	= Yes

;  ProjectileNugget
;    ProjectileTemplateName	= GondorTrebuchetRockProjectile
;    WarheadTemplateName	= GondorTrebuchetRockWarhead
;  End  
End












Weapon DragonCrush
  LeechRangeWeapon      = Yes
  AttackRange           = 9999999.0
  MeleeWeapon           = No
  DelayBetweenShots     = 0
  PreAttackDelay        = 0
  PreAttackType         = PER_SHOT 
  FiringDuration        = 0 
  FireFX		= FX_GenericCrushImpactSound

  DamageNugget
    Damage        = 20
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = CRUSH
    DeathType     = CRUSHED
    FlankingBonus = 100%
  End

  MetaImpactNugget          ; A Nugget that throws things back with force
    ShockWaveAmount   		= 80.0
    ShockWaveRadius   		= 0.0
    ShockWaveTaperOff 		= 0.1
;    ShockWaveArc      		= 0
    ShockWaveZMult    		= 0.2
  End
End



Object SummonedDragon
	
	SelectPortrait = HPSummonedDragon
	ButtonImage = HISummonedDragon
	
ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01New
		StaticModelLODMode = Yes
		
		RandomTextureFixedRandomIndex	= Yes
		RandomTexture					= SumnDragon_C.tga		0 SumnDragon_C.tga
		RandomTexture					= SumnDragon2_C.tga		0 SumnDragon2_C.tga
	
		DefaultModelConditionState
			Model = SumnDrag_SKN
			Skeleton = SumnDrag_SKL
			WeaponLaunchBone	= TERTIARY BAT_TAIL01;BAT_JAW
			WeaponLaunchBone	= PRIMARY BAT_TAIL01;BAT_JAW
			WeaponLaunchBone	= SECONDARY BAT_TAIL01;BAT_JAW
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
		End	
		
		IdleAnimationState
			StateName = STATE_Idle
			Animation = Breathe
				AnimationName = SumnDrag_IDLA
				AnimationMode = ONCE
				AnimationSpeedFactorRange	=	0.7 0.7		; Make slower anims according to size
				AnimationPriority = 5
				AnimationBlendTime		=	15
			End
			ParticleSysBone = BAT_HEAD SummonedDragonFireSnort	FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonSnortEmbers	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes

			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected"	then 
				CurDrawableSetTransitionAnimState("TRANS_Selected_to_Idle") return end
			EndScript
		End

		AnimationState			= USER_2
			StateName = State_JustBuilt
			Animation
				AnimationName = SumnDrag_LNDB
				AnimationMode = ONCE
				AnimationBlendTime = 0
				AnimationSpeedFactorRange	=	0.5 0.5
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End
	
		AnimationState					=	DYING DEATH_1
			Animation					=	Dying 
				AnimationName			=	SumnDrag_DIEA
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange	=	0.3 0.3 	; Die nice and slow for my cinematic :)
				AnimationBlendTime		=	15
			End
			ParticleSysBone = BAT_HEAD SummonedDragonDeathEmbers		FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonDeathSmoke			FollowBone:Yes
			ParticleSysBone = NONE SummonedDragonDeathDust		FollowBone:Yes
			
		End

		AnimationState					=	DYING DEATH_2
			Animation					=	JumpingAwayAtTimeUp 
				AnimationName			=	SumnDrag_JMPB
				AnimationMode			=	ONCE
				AnimationBlendTime		=	15
			End
			ParticleSysBone = BAT_HEAD SummonedDragonDeathEmbers		FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonDeathSmoke			FollowBone:Yes
		End

		AnimationState = FIRING_OR_PREATTACK_A MOVING	; Need this, otherwise we slide between attacks.
			Animation
				AnimationName				= SumnDrag_WLKA
				AnimationMode				= LOOP
				AnimationSpeedFactorRange	= 0.8 0.8
			End
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
		End


;--------------------------
; Attacking anims

		AnimationState = FIRING_OR_PREATTACK_A			; Normal Tusk Attack
			Animation = Burninate
				AnimationName		= SumnDrag_ATKA
				AnimationMode		= ONCE
;				UseWeaponTiming		= Yes
				AnimationSpeedFactorRange	= 1.2 1.2
				AnimationBlendTime	=   10
			End
		End

;		AnimationState	= BETWEEN_FIRING_SHOTS_A
;			Animation =	Breathe
;				AnimationName		= SumnDrag_IDLA
;				AnimationMode		= LOOP
;				AnimationBlendTime	= 3
;			End
;		End

;		AnimationState	=	ATTACKING
;			Animation ;=	Breathe
;				AnimationName		= SumnDrag_IDLA
;				AnimationMode		= LOOP
;				AnimationSpeedFactorRange	= 1.0 1.0
;			End
;		End
;---------------------------
; Fire Breath anims

		AnimationState		  = SPECIAL_WEAPON_ONE		; Fire Breath Attack
			Animation			= Burninate
				AnimationName	= SumnDrag_ATKA
				AnimationMode	= ONCE
				AnimationSpeedFactorRange	=	0.5 0.5		; Make slower anims according to size
			End
			ParticleSysBone = BAT_HEAD SummonedDragonFireBreath2Redone	FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonHeatRedone		FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonEmbersRedone		FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonSmokeRedone		FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonFireProxy2Redone	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonWaves		FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves		FollowBone:Yes
		End

;------------------------------
; WING ATTACK (coooooool! XD)

		AnimationState        = UNPACKING SPECIAL_WEAPON_TWO
			Animation           
				AnimationName     = SumnDrag_JMPA
				AnimationMode     = ONCE
				AnimationBlendTime	=	12
			End
		End

		AnimationState        = PREPARING SPECIAL_WEAPON_TWO
			Animation           
				AnimationName     = SumnDrag_FLYA
				AnimationMode     = ONCE
				AnimationBlendTime	=	12
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

		AnimationState        = PACKING SPECIAL_WEAPON_TWO
			Animation           
				AnimationName     = SumnDrag_LNDA
				AnimationMode     = ONCE
				AnimationBlendTime	=	12
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End



;		AnimationState        = SPECIAL_WEAPON_TWO
;			Animation           
;				AnimationName     = GUBoromir_SKL.GUBoromir_HRNB
;				AnimationMode     = LOOP
;			End
;		End


;-------------------------------
; HELLFIRE

		AnimationState = UNPACKING SPECIAL_WEAPON_THREE
			StateName			= STATE_TakeOff
			Animation
				AnimationName	= SumnDrag_JMPB
				AnimationMode	= ONCE
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

		AnimationState = PREPARING SPECIAL_WEAPON_THREE
			Animation
				AnimationName		= SumnDrag_JMPB
				AnimationMode		= ONCE
				AnimationSpeedFactorRange = 0.0001 0.00001		; Make it freeze in the air while launching the Hellfire
			End
;	        Flags = START_FRAME_LAST
		End


		AnimationState = PACKING SPECIAL_WEAPON_THREE
			StateName			= STATE_Land
			Animation
				AnimationName		= SumnDrag_LNDB
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
				AnimationSpeedFactorRange = 0.5 0.5
			End
			ParticleSysBone = NONE DragonMegaLand		FollowBone:Yes
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

;----------------------------
; ROAR

		AnimationState					= UNPACKING SPECIAL_WEAPON_FOUR
			Animation
				AnimationName			= SumnDrag_RORA
				AnimationMode			= ONCE
				AnimationSpeedFactorRange	= 0.5 0.5
			End
				ParticleSysBone = BAT_HEAD DragonFireRoar	FollowBone:Yes
				ParticleSysBone = BAT_HEAD DragonSmokeRoar	FollowBone:Yes
				ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
				ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
		End

;----------------------------

		AnimationState = HIT_REACTION HIT_LEVEL_1
			Animation
				AnimationName	= SumnDrag_HITA
				AnimationMode	= ONCE
			End
		End

		AnimationState = MOVING TURN_RIGHT_HIGH_SPEED
			Animation
				AnimationName	= SumnDrag_TRNR ;SumnDrag_WLKA <<<<<<<<< WOW THIS LOOKS A LOT BETTER THAN THE ORIGINAL!
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 0.7 0.7
				AnimationBlendTime		=	15
			End
		End
		
		AnimationState = MOVING TURN_LEFT_HIGH_SPEED
			Animation
				AnimationName	= SumnDrag_TRNL ;SumnDrag_WLKA <<<<<<<<< WOW THIS LOOKS A LOT BETTER THAN THE ORIGINAL!
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 0.7 0.7
				AnimationBlendTime		=	15
			End
		End
		
		AnimationState = TURN_LEFT
			Animation			= Left
				AnimationName	= SumnDrag_TRNL
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 0.65 0.65
				AnimationBlendTime		=	15
			End
		End

		AnimationState = TURN_RIGHT
			Animation			= YourOtherLeft
				AnimationName	= SumnDrag_TRNR
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 0.85 0.85
				AnimationBlendTime		=	15
			End
		End

		AnimationState = MOVING ACCELERATE
			Animation
				AnimationName	= SumnDrag_ACCL
				AnimationMode	= ONCE
				AnimationSpeedFactorRange = 1.2 1.2
				AnimationBlendTime		=	15
			End
		End

		AnimationState = MOVING DECELERATE
			Animation
				AnimationName	= SumnDrag_DECL
				AnimationMode	= ONCE
				AnimationSpeedFactorRange = 0.7 0.7
			End

		End
		
		AnimationState = UNPACKING
			StateName			= STATE_TakeOff
			Animation
				AnimationName	= SumnDrag_JMPB
				AnimationMode	= ONCE
			End
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

		;// There is one frame between the unpacking and packing in which neither are set and
		;// the IDLA is played. It causes all sorts of badness with the animation. Use PREPARING
		;// to intercept and preempt IDLA.
		AnimationState = PREPARING
			Animation
				AnimationName		= SumnDrag_JMPB
				AnimationMode		= ONCE
			End
	        Flags = START_FRAME_LAST
		End


		AnimationState = PACKING
			StateName				= STATE_Land
			Animation
				AnimationName		= SumnDrag_LNDB
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
				AnimationSpeedFactorRange = 0.52 0.52
			End
			ParticleSysBone = NONE DragonMegaLand		FollowBone:Yes
			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End

		AnimationState = MOVING
			Animation
				AnimationName	= SumnDrag_WLKA
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 0.7 0.7
			End
		End

		AnimationState = SELECTED
			Animation
				AnimationName	= SumnDrag_IDLA
				AnimationMode	= LOOP
				AnimationSpeedFactorRange = 1.0 1.0
			End
			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle"	then 
					CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") 
					return 
				end
			EndScript
		End


	AnimationState					= EMOTION_CELEBRATING
		Animation
			AnimationName			= SumnDrag_RORA
			AnimationMode			= ONCE
			AnimationSpeedFactorRange	= 0.5 0.5
		End
			ParticleSysBone = BAT_HEAD SummonedDragonFireRoar	FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
	End


	AnimationState					= EMOTION_TAUNTING
		Animation
			AnimationName			= SumnDrag_RORA
			AnimationMode			= ONCE
			AnimationSpeedFactorRange	= 0.5 0.5
		End
			ParticleSysBone = BAT_HEAD SummonedDragonFireRoar	FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
	End

		TransitionState = TRANS_Idle_to_Selected
			Animation			= Salute
				AnimationName	= SumnDrag_RORA
				AnimationMode	= ONCE
			End
			ParticleSysBone = BAT_HEAD SummonedDragonFireRoar	FollowBone:Yes
			ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonWaves	FollowBone:Yes
			ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes		
		End
		
		TransitionState = TRANS_Selected_to_Idle
			Animation			= ATNC
				AnimationName	= SumnDrag_IDLA
				AnimationMode	= ONCE
			End		
		End		

	    TransitionState = TRANS_JustBuilt_To_Idle
			Animation = BeingSummoned
				AnimationName = SumnDrag_LNDA 
				AnimationMode = ONCE
			End
		End
		
	End
END

;------ end animations ------	



ReplaceModule ModuleTag_AnimAudioBehavior
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehaviorNew
		MaxUpdateRangeCap = 800
		AnimationSound = Sound: BalrogFootstep			Animation:SumnDrag_SKL.SumnDrag_WLKA 	Frames: 19 40
		AnimationSound = Sound: BalrogLand			Animation:SumnDrag_SKL.SumnDrag_LNDA 	Frames: 27
		AnimationSound = Sound: FellBeastWingFlaps		Animation:SumnDrag_SKL.SumnDrag_LNDA 	Frames: 27
		AnimationSound = Sound: FellBeastWingFlaps		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 24 51 83
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 10
		AnimationSound = Sound: DragonAllyVoxRoar		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 28
		AnimationSound = Sound: DragonAllyVoxHurt		Animation:SumnDrag_SKL.SumnDrag_HITA 	Frames: 14
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_TRNL 	Frames: 11 22 33 44
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_TRNR 	Frames: 11 22 33 44
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_ACCL 	Frames: 18 23
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_DECL 	Frames: 17 25
		AnimationSound = Sound: DragonAllyFootstep		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 11 21
		AnimationSound = Sound: FellBeastWingFlaps		Animation:SumnDrag_SKL.SumnDrag_JMPA 	Frames: 19
		AnimationSound = Sound: FellBeastWingFlaps		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 19 55 85
		AnimationSound = Sound: DragonAllyVoxRoar		Animation:SumnDrag_SKL.SumnDrag_JMPB 	Frames: 31
		AnimationSound = Sound: FellBeastWingFlaps		Animation:SumnDrag_SKL.SumnDrag_LNDB 	Frames: 1
		AnimationSound = Sound: BalrogLand			Animation:SumnDrag_SKL.SumnDrag_LNDB 	Frames: 25
		AnimationSound = Sound: IceTowerToppleImpact		Animation:SumnDrag_SKL.SumnDrag_LNDB 	Frames: 27
		AnimationSound = Sound: DragonAllyVoxRoarBig		Animation:SumnDrag_SKL.SumnDrag_RORA 	Frames: 16
	End
END


;------------------- FIREBREATH ---------------------

;AddModule
; 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FirebreathEnabler
;		SpecialPowerTemplate	= SpecialAbilityDragonsFireBreath
;		TriggeredBy		= Upgrade_DragonsFireBreath
;	End
;END

AddModule
	Behavior = SpecialPowerModule ModuleTag_FirebreathStarter                      
		SpecialPowerTemplate		= SpecialAbilityDragonsFireBreath
		UpdateModuleStartsAttack	= Yes
;		StartsPaused			= No
		InitiateSound			= DragonAllyFirebreathMS
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FirebreathUpdate   
		SpecialPowerTemplate		= SpecialAbilityDragonsFireBreath
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes

		UnpackTime             		= 100
		PreparationTime			= 1   
		PersistentPrepTime		= 6500 
		PackTime			= 1
		
		AwardXPForTriggering		= 0
		
		StartAbilityRange		= 70
		MustFinishAbility		= Yes
		SpecialWeapon			= DragonsFirebreath
	End
END

;-----------------------------------------------------

;------------------- WING ATTACK ---------------------

;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingAttackEnabler
;		SpecialPowerTemplate		= SpecialAbilityDragonsWingAttack
;		TriggeredBy			= Upgrade_DragonsWingAttack
;	End

AddModule
	Behavior = SpecialPowerModule ModuleTag_WingAttack
		SpecialPowerTemplate		= SpecialAbilityDragonsWingAttack
		UpdateModuleStartsAttack	= Yes
;		StartsPaused			= No
		InitiateSound			= DragonAllyVoxTeleport
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingAttackUpdate
		SpecialPowerTemplate		= SpecialAbilityDragonsWingAttack
		WhichSpecialWeapon		= 2
		SkipContinue			= Yes

		UnpackTime			= 1600
;		PreparationTime			= 0
;		PersistentPrepTime		= 6500 
		PackTime			= 2000

		AwardXPForTriggering		= 0
		StartAbilityRange		= 70.0									; Note: This has to be smaller than the weapon range or it'll never succeed
		ApproachRequiresLOS		= Yes		
		SpecialWeapon			= DragonsWingAttack
	End
END

;AddModule
;	Behavior = AutoAbilityBehavior ModuleTag_WingAttackAutoAbility
;		SpecialAbility			= SpecialAbilityThornVengeance
;		MaxScanRange			= 300
;		Query				= 2 ANY ENEMIES +HERO +MONSTER
;		Query				= 2 ALL ENEMIES
;	End
;END

;-----------------------------------------------------


;------------------- Hellfire ------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_HellfireStarter                     
		SpecialPowerTemplate		= SpecialAbilityDragonsHellfire
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= DragonAllyVoxTeleport
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_HellfireBallUpdate   
		SpecialPowerTemplate		= SpecialAbilityDragonsHellfire
		WhichSpecialWeapon		= 3										; sets SPECIAL_WEAPON_ONE
		UnpackTime             		= 3800									; leaning back
		PreparationTime			= 2000									; just a small amount
		PackTime			= 3200									; returning to flap
		AwardXPForTriggering    	= 0
		StartAbilityRange		= 300
		MustFinishAbility		= Yes
		FreezeAfterTriggerDuration	= 2500
		SpecialWeapon			= GondorTrebuchetRock
	End
END

;-----------------------------------------------------

;------------------- Taunter ------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_TauntStarter                 
		SpecialPowerTemplate		= SpecialAbilityDragonsTaunt
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= DragonAllyVoxTeleport
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_TauntUpdate   
		SpecialPowerTemplate		= SpecialAbilityDragonsTaunt
		WhichSpecialWeapon		= 4										; sets SPECIAL_WEAPON_ONE
		UnpackTime             		= 5800									; leaning back
		PreparationTime			= 0									; just a small amount
		PackTime			= 0									; returning to flap
		AwardXPForTriggering    	= 0
		StartAbilityRange		= 300
		MustFinishAbility		= Yes
;		FreezeAfterTriggerDuration	= 2500
;		SpecialWeapon			= GondorTrebuchetRock
	End
END

;-----------------------------------------------------


;---------------- Reposition redone ----------------------

ReplaceModule ModuleTag_TeleportStarter                      
	Behavior = SpecialPowerModule ModuleTag_TeleportStarterNew                      
		SpecialPowerTemplate		= SpecialAbilitySummonedDragonReposition
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= DragonAllyVoxTeleport
	End
END

ReplaceModule ModuleTag_TeleportUpdate   
	Behavior = TeleportSpecialAbilityUpdate ModuleTag_TeleportUpdateNew   
		SpecialPowerTemplate    = SpecialAbilitySummonedDragonReposition
		UnpackTime              = 3800
		PreparationTime		= 1
		PackTime                = 3966
		ApproachRequiresLOS	= No
		BusyForDuration		= 5000				; don't accept any AI for this long... ai commands will be queued (should be at least PackTime)
		DestinationWeaponName	= SummonDragonBlowBack		; Fires at point of teleport to push people away and down.
	End
END

;---------------------------------------------------------


	CommandSet			= DragonCommandSet
	KindOf				= SELECTABLE MONSTER CAN_ATTACK SCARY HERO SCORE ; SUMMONED
	
;	CrusherLevel        		= 3
;	CrushWeapon			= DragonCrush
;	MinCrushVelocityPercent		= 57
;	CrushDecelerationPercent	= 0.5

	DisplayName  =  OBJECT:SummonedDragon

	Scale = 1.8
	
	WeaponSet
		Conditions = None 
		Weapon = PRIMARY	DragonTuskAttack
	End

	ArmorSet
		Conditions      = None
		Armor           = DragonArmor
		DamageFX        = FellBeastDamageFX
	End

	LocomotorSet
		Locomotor     = DragonLocomotor
		Condition     = SET_NORMAL
		Speed         = 60
	End

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyNew
		MaxHealth = 130000
	End
END

AddModule 
	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_fooNew
		ModelCondition = Required:SPECIAL_WEAPON_ONE		Excluded:DYING	Sound:DragonAllyFirebreathMS
	End
END

ReplaceModule HitReactionBehaviorModuleTag
  	Behavior = HitReactionBehavior HitReactionBehaviorModuleTagNew
		HitReactionLifeTimer1 = 2000
		HitReactionThreshold1 = 200
	End
END

	RemoveModule ModuleTag_LifetimeUpdate

ReplaceModule ModuleTag_NormalDeath
  	Behavior = SlowDeathBehavior ModuleTag_NormalDeathNew
		DeathTypes			= ALL -FADED
		DestructionDelay	= 135000
		DecayBeginTime		= 110000
		SinkDelay		= 110000
		SinkRate		= 2.0
		DeathFlags		= DEATH_1
		Sound			= INITIAL DragonAllyVoxDie
		OCL			= INITIAL OCL_SummonedDragonDeathCrush
	End
END
	


	LocomotorSet
		Locomotor     = SummonedDragonLocomotor
		Condition     = SET_NORMAL
		Speed         = 65
	End

;	HealthBoxHeightOffset	= 50
	HealthBoxScale		= 200.0

	Geometry		= CYLINDER
	GeometryMajorRadius	= 105
	GeometryHeight		= 50.0
	GeometryOffset		= X:-22 Y:0 Z:0
	GeometryIsSmall		= No	
	Shadow			= SHADOW_VOLUME
End









;-----------------------------------
;(013) WEAPON DAMAGE MODIFICATIONS
;-----------------------------------

Object IsengardFighterHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContainMew
		FrontAngle = 270
		FlankedDelay = 2000
		ObjectStatusOfContained = 
		InitialPayload = IsengardFighter 8
		Slots = 8
		PassengerFilter	= NONE +INFANTRY
		ShowPips = No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset=X:3 Y:3
		MeleeBehavior = Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= IsengardFighter										; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:IsengardFighter	Pos:X:70.0 Y:0.0		; (DEFAULT) position of banner carrier
		
		RankInfo = RankNumber:1 UnitType:IsengardFighter Position:X:69 Y:0		Position:X:85 Y:25		Position:X:54 Y:-30;				Position:X:50 Y:40				Position:X:50 Y:-40 
		RankInfo = RankNumber:2 UnitType:IsengardFighter Position:X:28 Y:0 Leader 1 0	Position:X:30 Y:20 Leader 1 1	Position:X:15 Y:-20 Leader 1 2	;Position:X:30 Y:40 Leader 1 3	Position:X:30 Y:-40 Leader 1 4
		RankInfo = RankNumber:3 UnitType:IsengardFighter Position:X:0 Y:0 Leader 2 0	;Position:X:-15 Y:20 Leader 2 1	Position:X:-25 Y:-20 Leader 2 2	;Position:X:10 Y:40 Leader 2 3	Position:X:10 Y:-40 Leader 2 4
		RankInfo = RankNumber:4 UnitType:IsengardUrukCrossbow Position:X:-40 Y:0 Leader 2 0	Position:X:-60 Y:20 Leader 2 1	Position:X:-45 Y:-40 Leader 2 2	;Position:X:10 Y:40 Leader 2 3	Position:X:10 Y:-40 Leader 2 4
		
		RanksToReleaseWhenAttacking = 1 

		AlternateFormation		= IsengardFighterHordeBlock
		MeleeAttackLeashDistance = 1; How far the hordes can move from the center of the horde when melee attacking.				
		BackUpMinDelayTime		= 1		; The minimum amount of time to delay before backing up
		BackUpMaxDelayTime		= 3000		; The maximum amount of time to delay before backing up
		BackUpMinDistance		= 1			; The minimum number of cells to backup
		BackUpMaxDistance		= 3			; The maximum number of cells to backup
		BackupPercentage		= 80%		; The amount of chance that a unit will back up.
	End
END

ReplaceModule Module_EmotionTracker
 	Behavior = EmotionTrackerUpdate	Module_EmotionTrackersNew
 		
 		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS; 350		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf					=	NONE
		AlwaysAfraidOf				=	NONE
		PointAt						=	NONE
		HeroScanDistance			=	150
		FearScanDistance			=	5

		AddEmotion	=	UncontrollableFear_Base_Evil
		
		AddEmotion	=	OVERRIDE Taunt_Base	
 		;	AttributeModifier		=	GondorFighterTaunt
 		End	
		
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
 		QuarrelProbability		=	0.0002%
 		AddEmotion				=	Quarrel_Base
		AddEmotion	=	Alert_Base
	End
END

END

Object MordorFighterHorde

ReplaceModule Module_EmotionTracker
 	Behavior = EmotionTrackerUpdate	Module_EmotionTrackersNew
 		
 		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS; 350		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf					=	NONE
		AlwaysAfraidOf				=	NONE
		PointAt						=	NONE
		HeroScanDistance			=	150
		FearScanDistance			=	5

		AddEmotion	=	UncontrollableFear_Base_Evil
		
		AddEmotion	=	OVERRIDE Taunt_Base	
 		;	AttributeModifier		=	GondorFighterTaunt
 		End	
		
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
 		QuarrelProbability		=	0.0002%
 		AddEmotion				=	Quarrel_Base
		AddEmotion	=	Alert_Base
	End
END

END


Object MordorFighter
ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 1900
		MaxHealthDamaged  = MORDOR_FIGHTER_HEALTH_DAMAGED
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END

AddModule
 	Behavior = EmotionTrackerUpdate	Module_EmotionTrackerSingle
 		
 		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS; 350		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf					=	EMOTION_AFRAIDOF_OBJECTFILTER
		AlwaysAfraidOf				=	EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
		PointAt						=	EMOTION_POINTAT_OBJECTFILTER
		HeroScanDistance			=	150
		FearScanDistance			=	INFANTRY_FEAR_SCAN_RADIUS ;250

		AddEmotion	=	Terror_Base
		AddEmotion	=	Doom_Base
		AddEmotion	=   BraceForBeingCrushed_Base
		AddEmotion	=	UncontrollableFear_Base_Evil
		AddEmotion	=	FearIdle_Base
		AddEmotion	=	FearBusy_Base
		AddEmotion	=	Point_Base
		
		AddEmotion	=	OVERRIDE Taunt_Base	
 		;	AttributeModifier		=	GondorFighterTaunt
 		End	
		
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
 		QuarrelProbability		=	0.0002%
 		AddEmotion				=	Quarrel_Base
		AddEmotion	=	Alert_Base
	End
END

END

Object IsengardWildmanHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContainNew
		FrontAngle = 270
		FlankedDelay = 2000
		ObjectStatusOfContained = 
		InitialPayload			= IsengardWildman 7
		PassengerFilter			= NONE +INFANTRY
		Slots					= 7
		ShowPips				= No

		ThisFormationIsTheMainFormation = Yes	;//Used to determine which armorset to use (and anything else we want!)
		
		MeleeBehavior = Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= IsengardWildman								; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:WildMarauder	Pos:X:60.0 Y:6.5	; (DEFAULT) position of banner carrier for fighter horde		
		
		RankInfo = RankNumber:1 UnitType:IsengardWildman Position:X:60 Y:0		Position:X:75 Y:20		Position:X:50 Y:-20		;Position:X:50 Y:40		Position:X:50 Y:-40 
		RankInfo = RankNumber:2 UnitType:IsengardWildman Position:X:35 Y:0 Leader 1 0	Position:X:30 Y:20 Leader 1 1	Position:X:25 Y:-20 Leader 1 2	;Position:X:30 Y:40 Leader 1 3	;Position:X:30 Y:-40 Leader 1 4
		RankInfo = RankNumber:3 UnitType:IsengardWildman Position:X:-10 Y:-35 Leader 2 0	Position:X:-35 Y:20 Leader 2 1	Position:X:10 Y:40 Leader 2 2	;Position:X:10 Y:40 Leader 2 3	Position:X:10 Y:-40 Leader 2 4
		RankInfo = RankNumber:4 UnitType:IsengardWildman Position:X:-20 Y:0 Leader 3 0	Position:X:-5 Y:20 Leader 3 1	Position:X:-40 Y:-20 Leader 3 2	;Position:X:-10 Y:40 Leader 3 3	Position:X:-10 Y:-40 Leader 3 4
		
		RanksToReleaseWhenAttacking = 1 2 3
		
		UseSlowHordeMovement = Yes
		MeleeAttackLeashDistance = 1 ;// How far the hordes can move from the center of the horde when melee attacking.
	End
END
END


Object WildSpiderlingHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContainNew
		FrontAngle = 270
		FlankedDelay = 2000
		ObjectStatusOfContained = 
		InitialPayload			= WildSpiderling 15
		PassengerFilter			= NONE +INFANTRY
		Slots					= 15
		ShowPips				= No

		ThisFormationIsTheMainFormation = Yes	;//Used to determine which armorset to use (and anything else we want!)
		
		MeleeBehavior = Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= WildSpiderling								; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:WildSpiderling	Pos:X:60.0 Y:6.5	; (DEFAULT) position of banner carrier for fighter horde		
		
		RankInfo = RankNumber:1 UnitType:WildSpiderling Position:X:80 Y:0		Position:X:55 Y:20		Position:X:45 Y:-20		;Position:X:65 Y:40		Position:X:50 Y:-40 
		RankInfo = RankNumber:2 UnitType:WildSpiderling Position:X:35 Y:0 Leader 1 0	Position:X:40 Y:20 Leader 1 1	Position:X:20 Y:-20 Leader 1 2	Position:X:30 Y:40 Position:X:20 Y:-40
		RankInfo = RankNumber:3 UnitType:WildSpiderling Position:X:-20 Y:0 Leader 2 0	Position:X:-30 Y:20 Leader 2 1	Position:X:10 Y:-20 Leader 2 2	Position:X:10 Y:40 Position:X:10 Y:-40
		RankInfo = RankNumber:4 UnitType:WildSpiderling Position:X:-60 Y:0 Leader 3 0	Position:X:-50 Y:20 Leader 3 1	Position:X:-75 Y:-20 Leader 3 2	;Position:X:-10 Y:40 Leader 3 3	Position:X:-10 Y:-40 Leader 3 4
		
		RanksToReleaseWhenAttacking = 1 2 3
		
		UseSlowHordeMovement = Yes
		MeleeAttackLeashDistance = 1 ;// How far the hordes can move from the center of the horde when melee attacking.

		AlternateFormation = WildMarauderHordePorcupine
	End
END

	Geometry		= BOX
	GeometryMajorRadius	= 5
	GeometryMinorRadius	= 5
	GeometryHeight		= 8.0
	GeometryIsSmall		= No

END


Object WildMarauderHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContainNew
		FrontAngle = 270
		FlankedDelay = 2000
		ObjectStatusOfContained = 
		InitialPayload			= WildMarauder 8
		PassengerFilter			= NONE +INFANTRY
		Slots					= 8
		ShowPips				= No

		ThisFormationIsTheMainFormation = Yes	;//Used to determine which armorset to use (and anything else we want!)
		
		MeleeBehavior = Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= WildMarauder								; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:WildMarauder	Pos:X:60.0 Y:6.5	; (DEFAULT) position of banner carrier for fighter horde		
		
		RankInfo = RankNumber:1 UnitType:WildMarauder Position:X:55 Y:0		Position:X:63 Y:30		Position:X:47 Y:-25		;Position:X:50 Y:40		Position:X:50 Y:-40 
		RankInfo = RankNumber:2 UnitType:WildMarauder Position:X:30 Y:0 Leader 1 0	Position:X:40 Y:35 Leader 1 1	Position:X:27 Y:-30 Leader 1 2	Position:X:28 Y:50 Position:X:30 Y:-40
		RankInfo = RankNumber:3 UnitType:WildMarauder Position:X:0 Y:0 Leader 2 0	Position:X:0 Y:25 Leader 2 1	Position:X:-10 Y:-25 Leader 2 2	;Position:X:10 Y:50 Leader 2 3	Position:X:10 Y:-40 Leader 2 4
		RankInfo = RankNumber:4 UnitType:WildMarauder Position:X:-10 Y:0 Leader 3 0	Position:X:-10 Y:20 Leader 3 1	Position:X:-10 Y:-20 Leader 3 2	;Position:X:-10 Y:40 Leader 3 3	Position:X:-10 Y:-40 Leader 3 4
		
		RanksToReleaseWhenAttacking = 1
		
		UseSlowHordeMovement = Yes
		MeleeAttackLeashDistance = 1 ;// How far the hordes can move from the center of the horde when melee attacking.

		AlternateFormation = WildMarauderHordePorcupine
	End
END

ReplaceModule Module_EmotionTracker
 	Behavior = EmotionTrackerUpdate	Module_EmotionTrackerNew
		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf				=	NONE
		AlwaysAfraidOf				=	NONE
		PointAt						=	EMOTION_POINTAT_OBJECTFILTER
		HeroScanDistance			=	150
		FearScanDistance			=	INFANTRY_FEAR_SCAN_RADIUS

		AddEmotion	=	UncontrollableFear_Base_Evil

		AddEmotion	=	Taunt_Base	
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
		AddEmotion	=	Alert_Base
	End
END

End


;----------------------
;FIREWALL
;To limit the players' movement in Raselas' Fortress waves
;----------------------

Weapon UnlimitedFireWeapon

	ProjectileCollidesWith	= MONSTERS STRUCTURES
	RadiusDamageAffects	= ENEMIES ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;

	FireLogicNugget
		LogicType	= INCREASE_FUEL
		Radius		= 35
		Damage		= 9600
		MinMaxBurnRate	= 20
		MaxResistance	= 1
	End

	FireLogicNugget
		LogicType	= INCREASE_BURN_RATE
		Radius		= 35
		Damage		= 1
	End

END


Object CINE_CS22_FC_206_1

	KindOf = INERT IMMOBILE UNATTACKABLE

AddModule
	Body = ActiveBody ModuleTag_MakesKillWork
		MaxHealth = 1
	End
END

AddModule
	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
		MinLifetime = 0
		MaxLifetime = 0
	End
END

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_DrawNew
   DefaultModelConditionState  
      Model	= NONE
   End
  End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_UnlimitedFireSpawn
    StartsActive = Yes
    DeathWeapon = UnlimitedFireWeapon
  End
END

AddModule
	Behavior = SlowDeathBehavior ModuleTag_HatchProcess
	End
END

END


;----------------
; Raselas Mighty Rocks effect
;----------------------------


FXParticleSystem MightyRocksBig
  System
    Priority = LOW_OR_ABOVE
    Shader = W3D_ALPHA
    Type = DRAWABLE
    ParticleName = exground01.w3d
    Lifetime = 165 165
    SystemLifetime = 800
    Size = 0.5 2
    BurstDelay = 1 3
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:255 G:170 B:55 0
    Color2 = R:63 G:63 B:63 50
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
    Alpha2 = 0 0 75
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -500 500
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    Rotation = ROTATE_X
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.02
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.3 0.3
    Y = -0.3 0.3
    Z = 0.2 0.8
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 90
    IsHollow = Yes
  End
  Draw = RenderObjectDraw
  End
  Wind = DefaultWind
    WindStrength = 1
    WindAngleChangeMin = 0.05
    WindAngleChangeMax = 0.05
    TurbulenceAmplitude = 1
    TurbulenceFrequency = 0.1
  End
End

FXParticleSystem MightyRocksSmall
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = EXDirt.tga
    Lifetime = 155 155
    SystemLifetime = 800
    Size = 50 50
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:63 G:63 B:63 0
    Color2 = R:0 G:0 B:0 50
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 2 4
    SizeRateDamping = 0.8 0.85
    AngleZ = -0.1 0.1
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.01
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0.1 0.2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 160
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
  End
End




FXList FX_MightyRocks
	PlayEvenIfShrouded = Yes 
	ParticleSystem 
		Name = MightyRocksBig
		Offset = X:0.0 Y:0.0 Z:-140
	End
	ParticleSystem 
		Name = MightyRocksSmall
		Offset = X:0.0 Y:0.0 Z:-100
	End
       CameraShakerVolume
          Radius = 500
          Duration_Seconds = 9
          Amplitude_Degrees = 0.1
       End
;  Sound
;    Name = GandalfBlastWeapon
;  End
END





Object TomBombadilSummonEgg

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 0
		FX	= INITIAL FX_MightyRocks
	End
End


END






;-------------------------



Weapon WildMarauderPike ; GOBLIN HALF TROLL MARAUDER
   DamageNugget
		Damage				= 210
		ForbiddenUpgradeNames		= Upgrade_WildForgedBlades
   END
   DamageNugget
		Damage				= 450
		RequiredUpgradeNames		= Upgrade_WildForgedBlades
   END
END

Object WildMarauder
ReplaceModule ModuleTag_porcupineFormation
	Body = PorcupineFormationBodyModule ModuleTag_porcupineFormationSS
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth			= 1800
		MaxHealthDamaged		= WILD_MARAUDER_HEALTH_DAMAGED		
		;RecoveryTime			= WILD_MARAUDER_HEALTH_RECOVERY_TIME	
		DamageWeaponTemplate		= PikemenPorcupineDamage
		CrushDamageWeaponTemplate	= PikemenPorcupineCrushDamage
		CrusherLevelResisted		= 1;	;What crusher level can I resist?: 1 = infantry, 2 = trees, 3 = vehicles
		BurningDeathBehavior 		= Yes
		BurningDeathFX       		= FX_InfantryBurningFlame
	End
END

	KindOf		= PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CREEP INFANTRY SCORE THROWN_OBJECT GRAB_AND_DROP ATTACK_NEEDS_LINE_OF_SIGHT ; PATH_THROUGH_EACH_OTHER 
END

Object ElvenLorienArcher
	CommandSet = GondorKnightHordeCommandSet_Summoned
END
;Weapon LorienBowWarhead ; LORIEN BOW (INITIAL TROOPS)
;  DamageNugget
;	Damage = 120
;  END
;END

Weapon MordorGoblinSword ; MORDOR GOBLIN (Lake Battle and Lairs)
  DamageNugget
	Damage = 165
  END
END


Weapon MordorEasterlingPike ; MORDOR EASTERLING PIKEMEN
  DamageNugget
	Damage = 600
END
END

Weapon MordorWarriorAxe ; MORDOR FIGHTER
  DamageNugget
	Damage = 270
END
END


;Weapon GoblinArcherBowWarhead ; GOBLIN ARCHER BOWS
;  DamageNugget
;	Damage = 450
;  END
;END

;Weapon GoblinArcherBowFireWarhead ; GOBLIN ARCHER FIRE BOWS
;  DamageNugget
;	Damage = 1000
;  END
;END

Object GoblinFighter
KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT GRAB_AND_DROP CAN_CLIMB_WALLS; PATH_THROUGH_EACH_OTHER 
END


Weapon GoblinFighterSword ; GOBLIN SWORDS
  DamageNugget
	Damage = 140
  END
END

Weapon GoblinFighterSwordUpgraded ; GOBLIN SWORDS UPGRADED
  DamageNugget
	Damage = 350
  END
END

Weapon IsengardWildmanCudgel ; ISENGARD WILDMEN OF DUNLAND MELEE
  DamageNugget
	Damage = 800
  END
END

;Weapon IsengardArcherBowWarhead ; ISENGARD CROSSBOWMEN
;  DamageNugget
;	Damage        = 1000
;  End
;END

;Weapon IsengardArcherBowFireWarhead ; ISENGARD CROSSBOWMEN FIRE ARROWS (ARCHERS CANT BE MODDED WITH MAP.INI, SO I USE ATTRIBUTE MODIFIERS TO INCREASE THE DAMAGE)
;	DamageNugget                        ; A basic Nugget that just does damage
;		Damage        = 1800
;End

ModifierList CrossbowmenDamageIncrease
  	Category	= WEAPON
  	Modifier	= DAMAGE_MULT 1100%	; This good?
END

Object IsengardUrukCrossbow
  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_14
		UpgradeToGrant = Upgrade_GandalfWhite ; Upgrade I give it automatically to easily give other initial stuff to the unit
	End 
  End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_UrukCrossbowDamageIncrease 	; Gives Uruk Crossbowmen an attribute modifier that increases their damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	CrossbowmenDamageIncrease
	End
  END
END

;Weapon FireDrakeWarhead ; FIREDRAKE FIREBREATH
;  DamageNugget
;	Damage        = 1800
;  End
;END


Weapon IsengardBannerSword  ; ISENGARD BANNER FIGHTER (NORMAL)
  DamageNugget
    Damage        = 1700
  End
End

Weapon IsengardBannerSwordUpgrade  ; ISENGARD BANNER FIGHTER (UPGRADED)
  DamageNugget
    Damage        = 2100
  End
End


Weapon IsengardBerserkerSword   ; ISENGARD BERSERKER
  DamageNugget
    Damage        = 550 ;900 was too much
  End	
End

Weapon IsengardPikemanPike  ; ISENGARD PIKEMAN
  DamageNugget
    Damage        = 1650
  End	
End

Object IsengardFighter
ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02Mew
		CheerRadius 	= EMOTION_CHEER_RADIUS
		MaxHealth         	= 2500
		MaxHealthDamaged  	= ISENGARD_URUKFIGHTER_HEALTH_DAMAGED		
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
		CheerRadius = EMOTION_CHEER_RADIUS
	End
END
END

Weapon IsengardFighterSword  ; ISENGARD SWORDSMAN
  DamageNugget
    Damage        = 900
  End	
End


Weapon MineLauncherWarHead ; ISENGARD MINELAUNCHER
  DamageNugget
	Damage        = 850
  End
End

Weapon WargRiderWeapon ; ISENGARD WARG RIDER
  DamageNugget
	Damage = 650
  END
END

Weapon MordorMumakilKnockback ; MORDOR MUMAKILL
  DamageNugget
	Damage = 1500
  END
END

Weapon MordorCaveTrollClubSwing ; MORDOR CAVE TROLL WITH TREE
  DamageNugget
	Damage = 1400
  END
END

Weapon TrollRockThrow ; MORDOR CAVE TROLL ROCK THROW
  DamageNugget
	Damage = 800
END
END

Weapon MordorAttackTrollClubSwing ; ATTACK TROLL
  DamageNugget
	Damage = 2200
END
END


Locomotor SpiderClimberLocomotor
	ScalesWalls			= Yes
	Surfaces			= GROUND RUBBLE OBSTACLE CLIFF
	TurnTime			= 2000 
	TurnTimeDamaged		= 2000
	FastTurnRadius		= 33 ; Can turn in a 40 foot radius circle when moving.
	SlowTurnRadius		= 33 ; 
	FormationPriority	= MELEE1 ;MELEE2
	WaitForFormation	= Yes ; When moving into formations, these guys stop & wait for others.
	Acceleration = 500  ; 1 second to accelerate to full speed.

	Braking  = 500  ; 1 second to brake from full speed.
	MinTurnSpeed          = 100% ; Must be going full speed to be able to turn if 100%.  Low end is 25%, as in must move quarter speed to turn (for locos that care).

	CanMoveBackwards		= No
	ZAxisBehavior           = SCALING_WALLS
	Appearance              = HORDE

	MaxTurnWithoutReform	= 45	; Try to turn beyond this angle, and we will reform instead of wheel
	StickToGround           = Yes       ; walking guys aren't allowed to catch huge (or even small) air.
End

Object MinorSpider

	LocomotorSet
		Locomotor     = SpiderClimberLocomotor
		Condition     = SET_NORMAL
		Speed         = 50
	End

END

Object WildSpiderling

	KindOf			= PRELOAD INFANTRY SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT ENVIRONMENT SELECTABLE CAN_CLIMB_WALLS

	LocomotorSet
		Locomotor     = SpiderClimberLocomotor
		Condition     = SET_NORMAL
		Speed         = NORMAL_WILD_CAVALRY_FAST_HORDE_SPEED
	End

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyNew
		MaxHealth 		= 900 ;1000 ;300
		MaxHealthDamaged 	= 500 ;150
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END

END


Weapon MinorSpiderMandibles ; NEUTRAL MINOR SPIDER
  DamageNugget
	Damage = 450
END
END

Weapon WildSpiderlingMandibles ; GOBLIN SPIDERLING
  DamageNugget
	Damage = 290
END
END

Weapon WildSpiderlingVenomMandibles				; SPIDERLING VENOM
  LeechRangeWeapon      = Yes
  AttackRange           = 25.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = 1666				; time between shots, msec
  PreAttackDelay        = 900				; 300 is mace swing delay time before contact with target.
  PreAttackType         = PER_SHOT 			; Do the delay each time we attack
  FireFX                = FX_SpiderStabHit
  FiringDuration        = 766				; Duration of the mace swing 
  RequireFollowThru	= Yes
  
DOTNugget                        ; A basic Nugget that just does damage
	Damage        = 40
	AcceptDamageAdd = No
	Radius        = 0.0
	DelayTime     = 0
	DamageType    = POISON
	DamageFXType  = POISON
	DeathType     = NORMAL
	DamageInterval = 1000
	DamageDuration = 10000
	SpecialObjectFilter = AFFECTED_BY_POISON_OBJECTFILTER 
End
  
  DamageNugget						; A basic Nugget that just does damage
    Damage        = 250
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = CAVALRY
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
    FlankingBonus = 50%
  End
End


Object GiantSpider	;Spider miniboss

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyNew
		MaxHealth = 5000
	End
END

END

Weapon ShelobMandibles     ; SHELOB/GIANT SPIDER 
  DamageNugget
    Damage        = 1350
  End
	MetaImpactNugget                    ; A Nugget that throws things back with force
		HeroResist			= .80
		ShockWaveAmount   = 30.0
		ShockWaveRadius   = 30.0
		ShockWaveTaperOff = 0.75
	End  
End




;Weapon WildSpiderRiderBowWarhead ; GOBLIN SPIDER RIDER NORMAL BOW (BOWS DONT SEEM TO BE ABLE TO BE CHANGED)
;  DamageNugget
;	Damage = 999000
;END
;END

;Weapon WildSpiderRiderBowFireWarhead ; GOBLIN SPIDER RIDER FIREBOW
;  DamageNugget
;	Damage = 999000
;END
;END



Object WildStructureHole 
	RemoveModule ModuleTag_RebuildHole ;SO THAT THE RUBBLE STAYS RUBBLE
END



ObjectCreationList OCL_QueensHatchlings
	CreateObject
		ObjectNames				= WildSpiderling
		Count					= 1
		FadeIn					= Yes
		FadeTime				= 500
		IgnoreCommandPointLimit = Yes
	End
End

FXList FX_SpiderlingsSound
  Sound
    Name = WildSpiderlingVoxCreated
  End
END

Object SpiderlingsSummonEgg

ReplaceModule ModuleTag_MakesKillWork
	Body = ActiveBody ModuleTag_MakesKillWorkNew
		MaxHealth = 150000
	End
END

RemoveModule ModuleTag_HatchTrigger
;	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
;		MinLifetime = 0.0
;		MaxLifetime = 0.0
;	End

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 3000
;		FX = INITIAL FX_SpiderlingsSummonStart			; Web Decal on ground
;		FX = INITIAL FX_SpiderlingsSound
		FX = FINAL FX_SpiderlingsSummonFinish			; Spider web bits
		OCL	= FINAL OCL_QueensHatchlings
	End
END

HealthBoxHeightOffset = 999

End




;------------------
; SCORPION
;------------------

Armor ScorpionArmor
  Armor = DEFAULT         30%
  Armor = FLAME           50%
  Armor = MAGIC           40%
End

Weapon ScorpionHit
  LeechRangeWeapon      = Yes
  AttackRange           = 20.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = WILD_GOBLIN_KING_DELAYBETWEENSHOTS
  PreAttackDelay        = WILD_GOBLIN_KING_PREATTACKDELAY
  PreAttackType         = PER_SHOT
  FireFX                = FX_GondorSwordHit
  FiringDuration        = WILD_GOBLIN_KING_FIRINGDURATION 

  DamageNugget
    Damage        = 500
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = SLASH
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End
End

Weapon BigScorpionHit
  LeechRangeWeapon      = Yes
  AttackRange           = 20.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = WILD_GOBLIN_KING_DELAYBETWEENSHOTS
  PreAttackDelay        = WILD_GOBLIN_KING_PREATTACKDELAY
  PreAttackType         = PER_SHOT
  FireFX                = FX_GondorSwordHit
  FiringDuration        = WILD_GOBLIN_KING_FIRINGDURATION 

  DamageNugget
    Damage        = 1250
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = SLASH
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End
End

Weapon ScorpionStinger
	LeechRangeWeapon	= Yes
	AttackRange           = STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon           = Yes
	FireFX                = FX_GoblinKingPoisonedStingerHit
	DelayBetweenShots         = WILD_GOBLIN_KING_STINGER_DELAYBETWEENSHOTS
	PreAttackDelay            = WILD_GOBLIN_KING_STINGER_PREATTACKDELAY   ; 1467 is the prep time for archer.
	PreAttackType             = PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration            = WILD_GOBLIN_KING_STINGER_FIRINGDURATION    ; Duration of the archer firing shot is 500ms.

	DamageNugget
		Damage        = 1000 ; 20
		Radius        = 0.0
		DelayTime     = 0
		DamageType    = SLASH
		DamageFXType  = SWORD_SLASH
		DeathType     = NORMAL
	End

	DOTNugget
		Damage			= 65 ; 100
		AcceptDamageAdd		= No
		Radius			= 0.0
		DelayTime		= 0
		DamageType		= POISON
		DamageFXType		= POISON
		DeathType		= NORMAL
		DamageInterval		= 750		; 1000
		DamageDuration		= 20000		; 30000
		SpecialObjectFilter	= AFFECTED_BY_POISON_OBJECTFILTER
	End

;	ParalyzeNugget
;		Radius			= 0.0
;		Duration		= POISONED_STINGER_DURATION
;		SpecialObjectFilter	= CRIPPLE_STRIKE_OBJECT_FILTER
;		ParalyzeFX		= FX_PoisonedStunEffect
;	End
End

CommandSet ScorpionCommandSet
	1  = Command_ToggleStance
	2  = Command_GoblinKingPoisonedStinger
	13 = Command_AttackMove
	14 = Command_Stop
End

Object GoblinSpiderRider					; Uber cool Scorpion

	SelectPortrait          = UPWild_Spiderlings
	ButtonImage		= WOR_Spiderling

RemoveModule ModuleTag_01

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_DRAWScorpion

		WadingParticleSys = EntRipples

;    StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD	; < Commented because low detail models had the gorkil on them
	
		OkToChangeModelColor = Yes

		DefaultModelConditionState
			Model					= WUGbkMnt_SKN
			Skeleton				= WUGbkMnt_SKL
		End


		AnimationState			= STUNNED_FLAILING
			Animation
				AnimationName   = WUGbkMnt_FLYA
				AnimationMode   = LOOP
				AnimationSpeedFactorRange	= 0.2 0.3
			End
		End

		AnimationState				=	DYING
			Animation
				AnimationName		=	WUGbkMnt_DIEA
				AnimationMode		=	ONCE
			End
		End

		AnimationState			= BURNINGDEATH
			Animation
				AnimationMode	= LOOP
				;Distance		= 120
			End
		End
				
		AnimationState        = STUNNED
			Animation

				AnimationName     = WUGbkMnt_LNDA
				AnimationMode     = ONCE
			End
		End

		AnimationState        = STUNNED_STANDING_UP
			Animation
				AnimationName     = WUGbkMnt_GTPA
				AnimationMode     = ONCE
			End
		End	

		AnimationState		= PARALYZED
			Animation
				AnimationName	= WUGbkMnt_IDLB
				AnimationMode	= LOOP
			End
		End


		; battle frenzy anim
		AnimationState				= USER_1
			Animation
				AnimationName		= WUGbkMnt_SPCA
				AnimationMode		= ONCE
			End
		End

		; call from deep anim
		AnimationState				= USER_2
			Animation
				AnimationName		= WUGbkMnt_SPCB
				AnimationMode		= ONCE
			End
		End

		AnimationState				=	FIRING_OR_PREATTACK_B
			Animation
				AnimationName		=	WUGbkMnt_ATKC
				AnimationMode		=	LOOP
				UseWeaponTiming		=	Yes
			End
		End
		
		AnimationState				=	FIRING_OR_PREATTACK_A
			Animation
				AnimationName		=	WUGbkMnt_ATKA
				AnimationMode		=	LOOP
				UseWeaponTiming		=	Yes
			End
		End
		
		; --- Poisoned Stinger Weapon anim
		AnimationState				= SPECIAL_WEAPON_ONE
			Animation
				AnimationName		= WUGbkMnt_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			ParticleSysBone B_S_TAIL06 GoblinKingPoison FollowBone:Yes
			ParticleSysBone B_S_TAIL06 GoblinKingPoison2 FollowBone:Yes
		End

		AnimationState				= PACKING_TYPE_1
			StateName				= STATE_PlantingTotem
			Animation
				AnimationName		= WUGbkMnt_SPCC
				AnimationMode		= ONCE
			End
			;FXEvent	= Frame:20 FireWhenSkipped Name:FX_GoblinKingTotem
		End
    
		AnimationState				=	MOVING
			StateName				=	STATE_MountedMoving
			Animation
				AnimationName		=	WUGbkMnt_RUNA
				AnimationMode		=	LOOP
			End
		End
		
		AnimationState				=	RAISING_FLAG
			Animation
				AnimationName		=	WUGbkMnt_CHRA
				AnimationMode		=	LOOP
			End
		End
		
		AnimationState				=	SELECTED
			StateName				=	AtAttentionIdle
			Animation
				AnimationName		=	WUGbkMnt_ATNB
				AnimationMode		=	LOOP
				AnimationBlendTime	=	0
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_PlantingTotem" then
					CurDrawableSetTransitionAnimState("TRANS_SelectFromSkullTotemMounted")
				elseif Prev == "STATE_MountedMoving" then
					CurDrawableSetTransitionAnimState("TRANS_SelectFromMovingMounted")
				elseif Prev ~= "AtAttentionIdle" and Prev ~= "TRANS_SelectFromIdleMounted" then
					CurDrawableSetTransitionAnimState("TRANS_SelectFromIdleMounted")
				end
			EndScript
		End


		AnimationState = ATTACKING
			Animation
				AnimationName = WuGbkMnt_IDLA
				AnimationMode = LOOP
			End
		End

		AnimationState				= HIT_REACTION
			Animation				= LevelUp
				AnimationName		= WUGbkMnt_HITA
				AnimationMode		= ONCE
			End
		End
		
		AnimationState				= LEVELED
			Animation				= LevelUp
				AnimationName		= WUGbkMnt_LVLA
				AnimationMode		= ONCE
			End
		End
		
		IdleAnimationState
;			StateName = Idle
			Animation
				AnimationName		=	WUGbkMnt_IDLB
				AnimationMode		=	LOOP
				AnimationBlendTime	=	30
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_PlantingTotem" then
					CurDrawableSetTransitionAnimState("TRANS_IdleFromSelectMountedNoBlend")
				elseif Prev ~= "Idle" and Prev ~= "TRANS_IdleFromSelectMounted" and Prev ~= "TRANS_IdleFromSelectMountedNoBlend" then
					CurDrawableSetTransitionAnimState("TRANS_IdleFromSelectMounted") 
				end
			EndScript
		End
		
		
		TransitionState				=	TRANS_SelectFromIdle
			Animation
				AnimationName		=	WUGbkMnt_ATNA
				AnimationMode		=	ONCE
			End
		End
		TransitionState				=	TRANS_SelectFromSkullTotem
			Animation
				AnimationName		=	WUGbkMnt_ATNB
				AnimationMode		=	ONCE
				AnimationBlendTime	=	0
			End
		End
		TransitionState				=	TRANS_SelectFromMoving
			Animation
				AnimationName		=	WUGbkMnt_ATNB
				AnimationMode		=	ONCE
			End
		End


		TransitionState				=	TRANS_IdleFromSelectNoBlend
			Animation
				AnimationName		=	WUGbkMnt_ATNC
				AnimationMode		=	ONCE
				AnimationBlendTime	=	0
			End
		End
		TransitionState				=	TRANS_IdleFromSelect
			Animation
				AnimationName		=	WUGbkMnt_ATNC
				AnimationMode		=	ONCE
			End
		End
	
	End
END

AddModule
	Draw = W3DScriptedModelDraw DustEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    IdleAnimationState
	    End
	    AnimationState = MOVING WADING
			ParticleSysBone = None FootstepSlash
	    End
	    AnimationState = MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = DISGUISED MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = DISGUISED MOVING DECELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOVING
	    End
            AnimationState = DISGUISED MOVING
            End
	End
END

	VisionRange = VISION_STANDARD_HORSE				
	ShroudClearingRange = SHROUD_CLEAR_HERO	

	DisplayName = CONTROLBAR:Crebain

	ThingClass = CHARACTER_UNIT
	CommandSet = ScorpionCommandSet
	CommandPoints = 40

	VoiceAttack				= GoblinKingVoiceDismountMS
	VoiceAttackCharge			= GoblinKingVoiceDismountMS
	VoiceAttackMachine			= GoblinKingVoiceDismountMS
	VoiceAttackStructure			= GoblinKingVoiceDismountMS
	VoiceCreated				= GoblinKingVoiceDismountMS
	VoiceFullyCreated			= GoblinKingVoiceDismountMS
	VoiceGuard				= GoblinKingVoiceDismountMS
	VoiceMove				= GoblinKingVoiceDismountMS
	VoiceMoveOverWalls			= GoblinKingVoiceDismountMS
	VoiceMoveToCamp				= GoblinKingVoiceDismountMS
	VoiceMoveToHigherGround			= GoblinKingVoiceDismountMS
	VoiceMoveWhileAttacking			= GoblinKingVoiceDismountMS
	VoicePriority				= 45
	VoiceRetreatToCastle			= GoblinKingVoiceDismountMS
	VoiceSelect				= GoblinKingVoiceDismountMS
	VoiceSelectBattle 			= GoblinKingVoiceDismountMS

	VoiceEnterStateAttack			= GoblinKingVoiceDismountMS
	VoiceEnterStateAttackCharge		= GoblinKingVoiceDismountMS
	VoiceEnterStateAttackMachine		= GoblinKingVoiceDismountMS
	VoiceEnterStateAttackStructure		= GoblinKingVoiceDismountMS
	VoiceEnterStateMove			= GoblinKingVoiceDismountMS
	VoiceEnterStateMoveOverWalls		= GoblinKingVoiceDismountMS
	VoiceEnterStateMoveToCamp		= GoblinKingVoiceDismountMS
	VoiceEnterStateMoveToHigherGround	= GoblinKingVoiceDismountMS
	VoiceEnterStateMoveWhileAttacking	= GoblinKingVoiceDismountMS
	VoiceEnterStateRetreatToCastle		= GoblinKingVoiceDismountMS



	SoundMoveLoop				= ScorpionMoveLoop

	SoundImpact				= ImpactHorse

ReplaceModule ModuleTag_AnimAudioBehavior
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehaviorNew
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:GoblinKingPoisonStingerStrike	Animation:WUGbkMnt_SKL.WUGbkMnt_ATKB	Frames:4
		AnimationSound = Sound:BodyFallOrc			Animation:WUGOBKNG_SKL.WUGOBKNG_DTHA	Frames:73
		AnimationSound = Sound:BodyFallOrc			Animation:WUGOBKNG_SKL.WUGOBKNG_LNDA	Frames:5

		AnimationSound = Sound:BodyFallOrc			Animation:WUGBKMNT_SKL.WUGBKMNT_DIEA	Frames:24 30
		AnimationSound = Sound:BodyFallOrc			Animation:WUGBKMNT_SKL.WUGBKMNT_LNDA	Frames:8 21
	End
END


	PathfindDiameter = 20.0

;----------------------  Poisoned Stinger  --------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_GoblinKingPoisonedStingerStarter
		SpecialPowerTemplate      = SpecialAbilityGoblinKingPoisonedStinger
		UpdateModuleStartsAttack  = Yes
;		StartsPaused = No
;		InitiateSound = GoblinKingVoiceAttackStinger
	End
END
AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_GoblinKingPoisonedStingerUpdate
		SpecialPowerTemplate    = SpecialAbilityGoblinKingPoisonedStinger
		SkipContinue		= Yes

		UnpackTime		= 250
		PreparationTime		= 1
		PersistentPrepTime	= 500
		PackTime		= 100
		MustFinishAbility	= Yes
		
		AwardXPForTriggering	= 0		
		StartAbilityRange	= 15.0
		
		SpecialWeapon		= ScorpionStinger
		WhichSpecialWeapon	= 1	
	End
END


;---------------------------------------------------------


  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1111
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			= Upgrade_GandalfWhite

	HideSubObjects		   = RIDER

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

	LocomotorSet
		Locomotor = GoblinKingLocomotor
		Condition = SET_NORMAL
		Speed     = 81
	End

	ArmorSet
		Conditions      = None
		Armor           = ScorpionArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY ScorpionHit
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	WeaponSet
		Conditions	= PLAYER_UPGRADE 
		Weapon = PRIMARY BigScorpionHit
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth		= 420
		MaxHealthDamaged	= 200
		BurningDeathBehavior	= Yes
		BurningDeathFX		= FX_CavalryBurningFlame
		DodgePercent		= 30
	End
END

RemoveModule Weapon_Upgrade1
RemoveModule Weapon_UpgradeSwap1
RemoveModule ForgedBlades_Upgrade


AddModule
	Behavior = GeometryUpgrade Geom_ModuleTag_SmallGeometry
		TriggeredBy	= Upgrade_GandalfWhite
		ShowGeometry	= Geom_Orig
		HideGeometry	= Geom_V1
	End
END
AddModule
	Behavior = GeometryUpgrade Geom_ModuleTag_BigGeometry 
		TriggeredBy	= Upgrade_WildForgedBlades
		ShowGeometry	= Geom_V1
		HideGeometry	= Geom_Orig 
	End
END

	Geometry		= CYLINDER
	GeometryName		= Geom_Orig
	GeometryMajorRadius	= 6.0
	GeometryMinorRadius	= 6.0
	GeometryHeight		= 2.0
	GeometryIsSmall		= Yes

	AdditionalGeometry	= CYLINDER
	GeometryName		= Geom_V1
	GeometryMajorRadius	= 18.0
	GeometryMinorRadius	= 18.0
	GeometryHeight		= 14.0
	GeometryOffset		= X:0 Y:0 Z:0
	HealthBoxScale		= 2.7

END

;--------------------------
; Destructable Webs (Spider ambush)
;--------------------------

FXParticleSystem WebDamagedParticles
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCocoonBits.tga
    Lifetime = 60 60
    SystemLifetime = 2
    SortLevel = 1
    Size = 5 10
    BurstCount = 2 3
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:255 G:255 B:255 38
    Color3 = R:214 G:214 B:214 60
    ColorScale = -20 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.4 0.8 1
    Alpha2 = 0.4 0.8 38
    Alpha3 = 0 0 60
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.2
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 4
    AngularRateZ = -0.02 0.02
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.4
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -2 2
    Y = -2 2
    Z = 6 8
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:10 Y:7 Z:5
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXParticleSystem WebWallBits
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCocoonBits.tga
    Lifetime = 60 60
    SystemLifetime = 2
    SortLevel = 1
    Size = 28 45
    BurstCount = 9 9
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:255 G:255 B:255 38
    Color3 = R:214 G:214 B:214 60
    ColorScale = -20 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 1
    Alpha2 = 1 1 38
    Alpha3 = 0 0 60
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.2
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 4
    AngularRateZ = -0.02 0.02
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.4
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -2 2
    Y = -2 2
    Z = 6 8
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:55 Y:10 Z:30
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXList FX_WebWallCollapse
  ParticleSystem
    Name = PCTMediumDust
    Offset = X:0.0 Y:0.0 Z:50		; because i use the web sunk into the ground
  End
  ParticleSystem
    Name = WebWallBits
    Offset = X:0.0 Y:0.0 Z:55		; because i use the web sunk into the ground
  End
  ViewShake 
    Type = STRONG
  End
  Sound
    Name = BuildingRubbleSink2 ;BuildingDestroyStone
  End
End

FXList FX_Webdamaged
	ParticleSystem
		Name = WebDamagedParticles
	End
End

DamageFX WebDamageFX
  ThrottleTime = DEFAULT 50

  AmountForMajorFX  = DEFAULT 0.0
  MajorFX           = DEFAULT FX_Webdamaged

End



Object DarkRockGrey19		; Destructable, Invisible, web wall Killable object



RemoveModule ModuleTag_01

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = GUSiegTreb_SKN
    End
  End
END

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			= Upgrade_GandalfWhite

	HideSubObjects		   = SIEGTREB
	HideSubObjects		   = FIREPLANE

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCARY NOT_AUTOACQUIRABLE ; OPTIMIZED_PROP

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX        = WebDamageFX
	End

RemoveModule ModuleTag_02

AddModule
	Body = ActiveBody ModuleTag_05New ; StructureBody ModuleTag_05New
		MaxHealth		= 22000
		MaxHealthDamaged	= 5000
		MaxHealthReallyDamaged	= 2000
	End
END

  HealthBoxScale	= 3.0
  Geometry		= Box
  GeometryIsSmall	= No
  GeometryMajorRadius	= 60
  GeometryMinorRadius	= 30
  GeometryHeight	= 55

End




Object ThickWebs01				; Destructable web main wall

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCARY ; OPTIMIZED_PROP

AddModule
	Body = ActiveBody ModuleTag_05New ; StructureBody ModuleTag_05New
		MaxHealth		= 14000
		MaxHealthDamaged	= 5000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_WebWallCollapse
		CollapseHeight				= 10
	End
END

End





FXParticleSystem WebWallBitsSmall
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCocoonBits.tga
    Lifetime = 60 60
    SystemLifetime = 2
    SortLevel = 1
    Size = 25 40
    BurstCount = 3 4
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:255 G:255 B:255 38
    Color3 = R:214 G:214 B:214 60
    ColorScale = -20 20
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.7 0.7 1
    Alpha2 = 0.7 0.7 38
    Alpha3 = 0 0 60
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.2
    SizeRateDamping = 0.99 0.99
    AngleZ = -3 4
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.5
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -3 3
    Y = -3 3
    Z = 2 4
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:14 Y:8 Z:15
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXParticleSystem WebDust
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCloud10.tga
    Lifetime = 50 50
    Size = 1 3
    SystemLifetime = 50
    SortLevel = 1
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:236 G:236 B:233 0
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.3 0.3 10
    Alpha3 = 0 0 50
  End
  Update = DefaultUpdate
    SizeRate = 30 35
    SizeRateDamping = 0.6 0.65
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.6 0.65
    DriftVelocity = X:0 Y:0 Z:0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = BoxEmissionVolume
    IsHollow = Yes
    HalfSize = X:25 Y:25 Z:15
  End
  Draw = DefaultDraw
  End
End

FXList FX_WebWallCollapseSmall
  ParticleSystem
    Name = WebDust
    Offset = X:0.0 Y:0.0 Z:5
  End
  ParticleSystem
    Name = WebWallBitsSmall
    Offset = X:0.0 Y:0.0 Z:5
  End
  ViewShake 
    Type = NORMAL
  End
  Sound
    Name = GondorForgeSizzle ;BuildingDestroyStone
  End
End


Object SpiderWebs07				; Destructable web wall smaller component

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCARY ; OPTIMIZED_PROP

;	ArmorSet
;		Conditions					= None
;		Armor						= StructureArmor
;	End

AddModule
	Body = StructureBody ModuleTag_05New
		MaxHealth		= 30000
		MaxHealthDamaged	= 5000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_WebWallCollapseSmall
		CollapseHeight				= 10
	End
END

End

Object SpiderWebs11				; Destructable web wall smaller component

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCARY ; OPTIMIZED_PROP

;	ArmorSet
;		Conditions					= None
;		Armor						= StructureArmor
;	End

AddModule
	Body = StructureBody ModuleTag_05New
		MaxHealth		= 30000
		MaxHealthDamaged	= 5000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_WebWallCollapseSmall
		CollapseHeight				= 10
	End
END

End

Object SpiderWebs06				; Destructable web wall smaller component

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCARY ; OPTIMIZED_PROP

;	ArmorSet
;		Conditions					= None
;		Armor						= StructureArmor
;	End

AddModule
	Body = StructureBody ModuleTag_05New
		MaxHealth		= 30000
		MaxHealthDamaged	= 5000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_WebWallCollapseSmall
		CollapseHeight				= 10
	End
END

End


;-------------------------
; Destructable rock	(scorpion gate)
;-------------------------

FXParticleSystem RockWallKill
  System
    Priority = LOW_OR_ABOVE
    Shader = ALPHA
    Type = DRAWABLE
    ParticleName = exground01.w3d
    Lifetime = 150 150
    SystemLifetime = 2
    Size = 0.5 1.8
    BurstCount = 14 22
  End
  Color = DefaultColor
    Color2 = R:30 G:30 B:30 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -500 500
    AngularRateZ = -0.5 0.5
    AngularDamping = 1 1
    Rotation = ROTATE_V
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.2
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
    Z = 2 3.8
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:15 Y:42 Z:16
  End
  Draw = RenderObjectDraw
  End
  Event = TerrainCollision
    HeightOffset = 0 0
;    EventFX = FX_CatapultRockChunks
    OrientFXToTerrain = No
    PerParticle = Yes
    KillAfterEvent = Yes
  End
End

FXList FX_RockWallCollapse
  ParticleSystem
    Name = PCTMediumDust
  End
  ParticleSystem
    Name = RockWallKill
    Offset = X:0.0 Y:0.0 Z:18.0
  End
  ViewShake 
    Type = NORMAL
  End
  Sound
    Name = BuildingSink
  End
End

FXParticleSystem GolemAttackDebris
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = EXTaint.tga ;EXFlake01.tga ;EXWoodChip01.tga
    Lifetime = 15 50
    SystemLifetime = 5
    Size = 0.6 2
    BurstCount = 8 15
  End
  Color = DefaultColor
    Color1 = R:200 G:200 B:200 0
    ColorScale = -5 5
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.5 0.55
    AngleZ = -7 7
    AngularRateZ = -0.9 0.9
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.25
    VelocityDamping = 0.95 0.95
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.5 2.2
    Y = -2 2
    Z = 1 4
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:-6 Y:-6 Z:0
    EndPoint = X:6 Y:6 Z:0
  End
  Draw = DefaultDraw
  End
End

FXList FX_GolemHit
  ParticleSystem
    Name = GolemAttackDebris
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  Sound
    Name = InfantryCrush
  END
End

DamageFX MudGolemDamageFX
  ThrottleTime = DEFAULT 50

  AmountForMajorFX  = CLUBBING 0.0
  MajorFX           = CLUBBING FX_GolemHit

End

Object EdorasRock09

ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
	DefaultModelConditionState
		Model = PRMordor12
	End
  End
END

	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE MADE_OF_STONE SCARY CHUNK_VENDOR NOT_AUTOACQUIRABLE

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX        = MudGolemDamageFX
	End

AddModule
	Body = StructureBody ModuleTag_05New
		MaxHealth		= 8000
		MaxHealthDamaged	= 4000
		MaxHealthReallyDamaged	= 2000
	End
END

AddModule								; Falls into the ground when "killed"
	Behavior = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay			= 000
		MaxCollapseDelay			= 000
		CollapseDamping				= 0.5
		MaxShudder				= 0.6
		MinBurstDelay				= 250
		MaxBurstDelay				= 800
		BigBurstFrequency			= 4
		FXList					= INITIAL FX_RockWallCollapse
		CollapseHeight				= 10
	End
END


  HealthBoxScale	= 2.0
  Geometry		= Box
  GeometryIsSmall	= No
  GeometryMajorRadius	= 40
  GeometryMinorRadius	= 16
  GeometryHeight	= 30

End


Object MordorRockClump07
  KindOf = ROCK_VENDOR IMMOBILE STRUCTURE IGNORED_IN_GUI CAN_SEE_THROUGH_STRUCTURE INERT INERT_SHROUD_REVEALER CAN_CAST_REFLECTIONS
END





Object RockArch01			;Removes transparency

ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
      Model = SLRockArch01
    End

;	AlphaCameraFadeOuterRadius = 400
;	AlphaCameraFadeInnerRadius = 300
;	AlphaCameraAtInnerRadius = 10%
  End
END

End


Object DoGoldurWallCatapultSmall
RemoveModule ModuleTag_DwarfTreb
RemoveModule ModuleTag_WildTreb
RemoveModule ModuleTag_IsengardTreb
RemoveModule ModuleTag_ElvenTreb
RemoveModule ModuleTag_MenTreb
RemoveModule ModuleTag_MordorTreb
RemoveModule MakeTheFreeTreb
RemoveModule ModuleTag_ActLikeAnOldUpgrade
END

Object DolGoldurWallTowerSmall
	DisplayName	= OBJECT:DwarvenFortress
END

Object DolGoldurCatwalk

	DisplayName	= OBJECT:DwarvenFortress

  Geometry              = BOX
  GeometryMajorRadius   = 13.0
  GeometryMinorRadius   = 69.0
  GeometryHeight        = 12.0
  GeometryOffset	= X:0 Y:-4 Z:78 
  
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 1.0
  GeometryMinorRadius   = 1.0
  GeometryHeight        = 1.0
  GeometryOffset	= X:0 Y:0 Z:78 
  GeometryIsSmall       = Yes
END

Object DolGoldurPrison
	DisplayName	= OBJECT:DwarvenFortress
END

Object DolGoldurMainGate
	DisplayName     = OBJECT:Gate
END

Object MordorCirithUngolGateDoor				; To prevent soldiers from not pathing through

	DisplayName     = OBJECT:Gate

ReplaceModule ModuleTag_GATE
	Behavior = GateOpenAndCloseBehavior ModuleTag_GATENew
		ResetTimeInMilliseconds = 12200
		OpenByDefault = Yes
		PercentOpenForPathing = 20
		SoundOpeningGateLoop = GateOpenStart
		SoundClosingGateLoop = GateCloseStart
		SoundFinishedOpeningGate = GateOpenEnd
		SoundFinishedClosingGate = GateCloseEnd
		TimeBeforePlayingOpenSound = 9500
		TimeBeforePlayingClosedSound = 9500
	End
END
END

Armor InvincibleArmor
  Armor = DEFAULT         1%
End

Object MordorFighterHorde_Summoned
RemoveModule ModuleTag_LifetimeUpdate
End






Object MordorFighter_Summoned		; Make them unselectable and un-autoacquireable for Fortress battle
RemoveModule ModuleTag_LifetimeUpdate
RemoveModule ModuleTag_FadeDeath

	ArmorSet
		Conditions      = None
		Armor           = InvincibleArmor
	End

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 999999999
		MaxHealthDamaged  = 500
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END

  KindOf = PRELOAD NOT_AUTOACQUIRABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER CAN_USE_SIEGE_TOWER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ORC GRAB_AND_DROP ;SELECTABLE 

End





Object MordorArcherForBlackGate		; Make them unselectable and un-autoacquireable for Fortress battle
  KindOf = PRELOAD NOT_AUTOACQUIRABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER CAN_USE_SIEGE_TOWER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ORC GRAB_AND_DROP ;SELECTABLE 
	LocomotorSet
		Locomotor   = HumanLocomotor
		Condition   = SET_NORMAL
		Speed       = 60
	End

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 999999999
		MaxHealthDamaged  = 500
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END

	ArmorSet
		Conditions      = None
		Armor           = InvincibleArmor
	End
End




Weapon GondorArcherBombard
	ScatterRadius       = 220
END



Object GondorArcher	; Make him unselectable and unautoacquireable
	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_NORMAL 
		Speed     = 52
	End
;	KindOf = PRELOAD CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ARCHER GRAB_AND_DROP SELECTABLE
END





Object GondorFighterHorde
	LocomotorSet
		Locomotor     = NormalMeleeHordeLocomotor
		Condition     = SET_NORMAL
		Speed         = 61
	End
END

Object GondorArcherHorde
	LocomotorSet
		Locomotor     = NormalRangedHordeLocomotor
		Condition     = SET_NORMAL
		Speed         = 50
	End
END

ModifierList TeleportEffect
	Category	= SPELL
	Duration	= 90
	FX		= FX_CAHBlink
End


Object GondorFighter
	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_NORMAL 
		Speed     = 62
	End

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 999999999
		MaxHealthDamaged  = 500
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END


  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_TeleportEffect
	TriggeredBy 		= Upgrade_GandalfWhite
	AttributeModifier 	= TeleportEffect
	End
  END


	ArmorSet
		Conditions      = None
		Armor           = InvincibleArmor
	End

	HealthBoxHeightOffset	= 999

;	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT NOTIFY_OF_PREATTACK GRAB_AND_DROP

END



CommandButton Zarangonga
	Command		   = SPECIAL_POWER
	SpecialPower	   = SpecialAbilityATeleportToCaster
	Options		   = NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel	   = CONTROLBAR:TeleportLevel1
	ButtonImage	   = HSKingDainSummonRoyalGuard
	RadiusCursorType   = DominateRadiusCursor
	ButtonBorderType   = ACTION
	DescriptLabel	   = CONTROLBAR:ToolTipTeleportLevel1
	InPalantir	   = Yes
End




CommandSet RohanGamlingCommandSet
	1	= Command_ToggleStance
	2	= Zarangonga
	13	= Command_AttackMove
	14	= Command_Stop
End


Object RohanGamling ; Gerarde

	CommandSet = NewRohanGamlingCommandSet 

AddModule
  Behavior = SpecialPowerModule ModuleTag_TeleportToCasterModule
	SpecialPowerTemplate	 = SpecialAbilityATeleportToCaster
	UpdateModuleStartsAttack = Yes
	InitiateSound = CaH_TeleportPart1
  End
END

AddModule
  Behavior = TeleportToCasterSpecialPower ModuleTag_TeleportToCaster
	SpecialPowerTemplate	   = SpecialAbilityATeleportToCaster//SpecialAbilityTeleportToCaster	HACK! See special power
	UnpackingVariation	   = 1
	StartAbilityRange	   = 1000000.0 // i.e. pretty large
	ApproachRequiresLOS	   = No		   // can do this without seeing the target	units.
	Radius			   = 140	   // the radius that will capture units
	TargetFX		   = FX_CAHBlink
	TriggerFX		   = FX_CAHTeleport
	MinDestinationRadius	   = 15		   // the inner	radius of the ring where units will	teleport to
	MaxDestinationRadius	   = 80	   // the outer	radius of the ring where units will	teleport to
	
	UnpackTime				   = 1000
	PreparationTime			   = 1	 
	FreezeAfterTriggerDuration = 2500	   // Hold AI for this long	after we fire.	
  END
END

	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE HERO ARMY_SUMMARY NOT_AUTOACQUIRABLE

	PathfindDiameter = 15.0
	DisplayName = OBJECT:GondorFighter
	GeometryMajorRadius = 1.0
	GeometryMinorRadius = 1.0
	GeometryHeight = 19.2

END

;---------------
;(014) Bosses
;---------------

Object WildShelob
	DisplayName = OBJECT:GiantSpider
END

;--------------------------------------------------
;-------------------NIGHTMARE----------------------
;--------------------------------------------------

FXParticleSystem NightmareChips			; Not used in the end.
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = exleadership2.tga
    Lifetime = 5 100
    SystemLifetime = 2
    Size = 3 9
    BurstCount = 50 65
  End
  Color = DefaultColor
    Color1 = R:162 G:137 B:100 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.5 0.55
    AngleZ = -7 7
    AngularRateZ = -1 1
    AngularDamping = 0.99 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.95 0.99
    DriftVelocity = X:0 Y:0 Z:-4
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1.5 1.5
    Y = -1.5 1.5
    Z = 15 25
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:20 Y:8 Z:15
    EndPoint = X:-20 Y:-8 Z:22
  End
  Draw = DefaultDraw
  End
End

























FXList FX_NightmareDeath

    DynamicDecal
		DecalName		= SCCcracks
		Size			= 130			;Balrog was 175
		Color			= R:255 G:109 B:45

		OpacityStart		= 0
		OpacityFadeTimeOne	= 4000
		OpacityPeak		= 255
		OpacityPeakTime		= 255
		OpacityFadeTimeTwo	= 50000
		OpacityEnd		= 0

		StartingDelay		= 0
		Lifetime		= 60000
	End
;    ParticleSystem
;		Name = BalrogDeathFinalAsh
;        OrientToObject = Yes
;	End    
 
;    ParticleSystem
;		Name = BalrogDeathFinalLight
;        OrientToObject = Yes
;	End    
    
    ParticleSystem
		Name = BalrogDeathFinalFlakes
        OrientToObject = Yes
	End 

    ParticleSystem
		Name = BalrogDeathFinalFire
        OrientToObject = Yes
        Offset = X:0.0 Y:0.0 Z:0.0
	End

    ParticleSystem
		Name = BalrogDeathFinalHeatWave
        OrientToObject = Yes
        Offset = X:0.0 Y:5.0 Z:0.0
	End
      
    ParticleSystem
		Name = BalrogDeathFinalShafts
        InitialDelay = 3500 3500 UNIFORM   ;In milliseconds
        OrientToObject = Yes
        Offset = X:0.0 Y:0.0 Z:0.0
    End

	Sound
		Name = BalrogDecay
	End
End




FXParticleSystem NightmarePowerFireRingCastParticle
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exhpicember.tga
    Lifetime		= 80 80
    SystemLifetime	= 70
    Size		= 3 3
    BurstDelay		= 10 10
    BurstCount		= 4 4
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:20   G:20 B:20  0
    Color2		= R:255  G:255 B:255 5
    Color3		= R:0    G:0  B:0   40
  End
;  Alpha			= DefaultAlpha
;    Alpha1		= 1   1   0
;    Alpha2		= 0.5 0.5 5
;    Alpha3		= 0   0   3
;  End
  Update		= DefaultUpdate
    SizeRate		= 1 1.3
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -1 1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0.03 0.03
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0 0
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END

FXList FX_NightmarePowerFireRingCast
  ParticleSystem
	Name = NightmarePowerFireRingCastParticle
	Offset = X:0.0 Y:0.0 Z:0
	AttachToObject	= Yes
  End
       Sound
          Name = SpellDragonAlly_LurtzCrippleEffect
       End
       Sound
          Name = BalrogIgnite
       End
End


FXParticleSystem NightmarePowerFireRingParticleHitRing
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exhpicember.tga
    Lifetime		= 80 80
    SystemLifetime	= 20
    Size		= 2 2.5
    BurstDelay		= 10 10
    BurstCount		= 2 2
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:20   G:20 B:20  0
    Color2		= R:255  G:255 B:255 5
    Color3		= R:0    G:0  B:0   40
  End
;  Alpha			= DefaultAlpha
;    Alpha1		= 1   1   0
;    Alpha2		= 0.5 0.5 5
;    Alpha3		= 0   0   3
;  End
  Update		= DefaultUpdate
    SizeRate		= 1 1.5
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -1 1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0.05 0.05
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0 0
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END

FXParticleSystem NightmarePowerFireRingParticle
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exhpicember.tga
    Lifetime		= 40 50
    SystemLifetime	= 500
    Size		= 2 3.5
    BurstDelay		= 15 20
    BurstCount		= 1 2
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:255   G:0 B:0  0
    Color2		= R:255  G:255 B:255 70
  End
;  Alpha		= DefaultAlpha
;    Alpha1		= 1   1   0
;    Alpha2		= 0.5 0.5 30
;    Alpha3		= 0   0   750
;  End
  Update		= DefaultUpdate
    SizeRate		= 0.1 0.2
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= 0 1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0.3 0.3
    ParticlesAttachToBone = Yes
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.2 0.3
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END



FXList FX_NightmarePowerFireRing
  ParticleSystem
	Name = NightmarePowerFireRingParticleHitRing
	Offset = X:0.0 Y:0.0 Z:0
  End
  ParticleSystem
    Name = CatapultExplosionSmoke
  End
  ParticleSystem
    Name = EvilShipBomExplosion
  End
  ParticleSystem
    Name = FWDragonExplosionGlow
  End
  CameraShakerVolume
    Radius = 200
    Duration_Seconds = 1
    Amplitude_Degrees = 0.5
  End
       Sound
          Name = SpellSunflareMS
       End
;       Sound
;          Name = GloinSlam		; Commented out because only one sound works at a time
;       End
End

FXList FX_NightmarePowerFireRingDebuffRing
  ParticleSystem
	Name = NightmarePowerFireRingParticle
	Offset = X:0.0 Y:0.0 Z:14
	AttachToObject	= Yes
  End
  ParticleSystem
	Name = NightmarePowerFireRingParticle
	Offset = X:0.0 Y:0.0 Z:10
	AttachToObject	= Yes
  End
  ParticleSystem
	Name = NightmarePowerFireRingParticle
	Offset = X:0.0 Y:0.0 Z:6
	AttachToObject	= Yes
  End
  ParticleSystem
	Name = NightmarePowerFireRingParticle
	Offset = X:0.0 Y:0.0 Z:2
	AttachToObject	= Yes
  End
  ParticleSystem
	AttachToObject	= Yes
	Name = NightmarePowerFireRingParticle
	Offset = X:0.0 Y:0.0 Z:-2
  End
       Sound
          Name = GloinSlam
       End
END








FXParticleSystem NightmareSummonLightShafts
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = W3D_EMISSIVE
    Type = DRAWABLE
    ParticleName = exlight01.w3d
    Lifetime = 85 85
    SystemLifetime = 150
    SortLevel = 1
    Size = 0.1 0.1
    BurstDelay = 1 1
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:255 G:139 B:62 0
    Color2 = R:254 G:48 B:18 85
  End
  Alpha = DefaultAlpha
    Alpha2 = 1 1 20
    Alpha3 = 0 0 85
  End
  Update = DefaultUpdate
    SizeRate = 0.025 0.055
    SizeRateDamping = 0.99 0.99
    AngleZ = -500 500
    AngularDamping = 1 1
    Rotation = ROTATE_Z
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 40
  End
  Draw = RenderObjectDraw
  End
End

FXParticleSystem NightmareSummonChunks
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = W3D_ALPHA
    Type = DRAWABLE
    ParticleName = exground01.w3d
    Lifetime = 75 75
    SystemLifetime = 100
    Size = 0.1 0.8
    BurstDelay = 0 3
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:255 G:170 B:55 0
    Color2 = R:63 G:63 B:63 50
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
    Alpha2 = 0 0 75
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = -500 500
    AngularRateZ = -0.5 0.5
    AngularDamping = 1 1
    Rotation = ROTATE_X
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 50
  End
  Draw = RenderObjectDraw
  End
  Wind = DefaultWind
    WindStrength = 1
    WindAngleChangeMin = 0.05
    WindAngleChangeMax = 0.05
    TurbulenceAmplitude = 1
    TurbulenceFrequency = 0.1
  End
End

FXParticleSystem NightmareSummonChunksSmall
  System
    Priority = VERY_LOW_OR_ABOVE
    Shader = ALPHA_TEST
    ParticleName = EXDirt.tga
    Lifetime = 75 75
    SystemLifetime = 100
    Size = 50 50
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:63 G:63 B:63 0
    Color2 = R:0 G:0 B:0 50
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 2 4
    SizeRateDamping = 0.8 0.85
    AngleZ = -0.1 0.1
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 50
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
  End
End

FXList FX_NightmareSummoningStart
    DynamicDecal
		DecalName		= SCCcracks
		Size			= 130			;Balrog was 175
		Color			= R:255 G:109 B:45

		OpacityStart		= 0
		OpacityFadeTimeOne	= 4000
		OpacityPeak		= 255
		OpacityPeakTime		= 255
		OpacityFadeTimeTwo	= 50000
		OpacityEnd		= 0

		StartingDelay		= 0
		Lifetime		= 60000
	End
    ParticleSystem
		Name = NightmareSummonLightShafts
        InitialDelay = 4000 4000 UNIFORM   ;In milliseconds
	End
    ParticleSystem
		Name = BalrogSummonCracks
        InitialDelay = 2000 2000 UNIFORM   ;In milliseconds
	End
	ParticleSystem
		Name = NightmareSummonChunks
        Offset = X:0.0 Y:0.0 Z:-5.0
        InitialDelay = 10000 10000 UNIFORM   ;In milliseconds
	End
    ParticleSystem
		Name = NightmareSummonChunksSmall
        Offset = X:0.0 Y:0.0 Z:-5.0
        InitialDelay = 5000 5000 UNIFORM   ;In milliseconds
	End
    ParticleSystem
		Name = BalrogSummonHeatWave
        Offset = X:0.0 Y:0.0 Z:-5.0
        InitialDelay = 3000 3000 UNIFORM   ;In milliseconds
	End
    CameraShakerVolume
      Radius = 800
      Duration_Seconds = 6.2
      Amplitude_Degrees = .4
    End
    Sound
	  Name = BalrogSummonPart1
    End
End

FXList FX_NightmareSummoningFinish
  CameraShakerVolume
    Radius = 500
    Duration_Seconds = .5
    Amplitude_Degrees = 3
  End
;  ParticleSystem
;    Name = BalrogSummonExplosionWave
;    Offset = X:0.0 Y:0.0 Z:2.0
;  End
;  ParticleSystem
;    Name = BalrogSummonExplosionSphere
;    Offset = X:0.0 Y:0.0 Z:2.0
;  End
;  ParticleSystem
;    Name = BalrogSummonExplosionChunks
;    Offset = X:0.0 Y:0.0 Z:2.0
;  End
;  ParticleSystem
;    Name = BalrogSummonExplosionChunks2
;    Offset = X:0.0 Y:0.0 Z:2.0
;  End
  ParticleSystem
    Name = BalrogSummonExplosionChunksSmall
    Offset = X:0.0 Y:0.0 Z:2.0
  End
  ParticleSystem
    Name = BalrogSummonScatterFire
    Offset = X:0.0 Y:0.0 Z:2.0
    InitialDelay = 25000 25000 UNIFORM   ;In milliseconds
  End
;    Sound
;	  Name = BalrogSummonPart2
;    End
;    Sound
;	  Name = BalrogSummonRoar
;    End
    Sound
	Name = SpellSunflare4
    END
End


ObjectCreationList OCL_NightmareSummon		; Actually I don't need this OCL since I'm spawning the eggs via script.
	CreateObject
		ObjectNames = MordorBalrogEgg	; Nightmare Egg for FX
		Count = 1
		Disposition = LIKE_EXISTING
	End
End

ObjectCreationList OCL_NightmareSummonFinish	; (NOT) I NO LONGER USE THIS OCL, SINCE IT'S MORE PRECISE TO SPAWN THE NIGHTMARES WITH A SCRIPT, DIRECTLY. BESIDES FADE DOESN'T WORK ON MY TEXTURE ANYWAY
	CreateObject
		ObjectNames = MordorBalrog	; The Nightmare object
		Count = 1
		Disposition = ABSOLUTE_ANGLE
		DispositionAngle = -30			; "0" looks East
;		UseJustBuiltFlag = Yes
;		StartingBusyTime = 2300
		FadeIn = No	; it won't work on the modified lava skin
		FadeTime = 0	; 6000
		Offset			= X:-9 Y:-7 Z:0
		IgnoreCommandPointLimit = Yes
	End
End

Object MordorBalrogEgg					; Nightmare Egg for FX
;	KindOf = INERT IMMOBILE UNATTACKABLE
	
;	Body = ActiveBody ModuleTag_MakesKillWork
;		MaxHealth = 1
;	End
;	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
;		MinLifetime = 0.0
;		MaxLifetime = 0.0
;	End

  ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay	= 7000
		FX			= INITIAL FX_NightmareSummoningStart
		FX			= MIDPOINT FX_NightmareSummoningFinish			; Midpoint as we need to have a delay between the summon and explosion.
		OCL			= MIDPOINT OCL_NightmareSummonFinish
;		Weapon			= MIDPOINT BalrogSummoning
	End
  END

End



FXParticleSystem NightmareEmbers
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXEmbersLight.tga
    Lifetime = 70 70
    Size = 12 16
    BurstDelay = 1 1
    BurstCount = 3 3
  End
  Color = DefaultColor
    Color1 = R:255 G:185 B:79 0
    Color2 = R:0 G:0 B:0 70
    ColorScale = -5 0
  End
  Update = DefaultUpdate
    SizeRate = 3 6
    SizeRateDamping = 0.8 0.85
    AngleZ = -0.3 0.3
    AngularRateZ = -0.03 0.03
    AngularDamping = 0.99 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.008
    VelocityDamping = 0.9 0.9
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = SphereEmissionVolume
  End
;  EmissionVolume = BoxEmissionVolume
;    HalfSize = X:15 Y:7 Z:0
;  End
  Draw = DefaultDraw
  End
End

FXParticleSystem NightmareHeat
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = SMUDGE.tga
    Lifetime = 50 50
    Size = 2 3
    BurstCount = 2 3
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = 1 4
    SizeRateDamping = 0.9 0.9
    AngleZ = 0.0051 0.005
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.97
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0.25 0.25
  End
  EmissionVolume = BoxEmissionVolume
    HalfSize = X:30 Y:10 Z:0
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem NightmareFireFront
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 40 40
    Size = 14 18
    BurstCount = 2 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:98 G:69 B:51 5
    Color3 = R:90 G:56 B:37 18
    Color4 = R:0 G:0 B:0 28
    ColorScale = 5 5
  End
  Update = DefaultUpdate
    SizeRate = -0.4 0
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    DriftVelocity = X:0 Y:0 Z:2
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.2 0.2
    Y = -0.2 0.2
    Z = 1.2 0.3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 15
    Length = 10
    Offset = X:16 Y:0 Z:10
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    DetailTexture = EXCloudRS07.tga
    SpeedMultiplier = 1
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXParticleSystem NightmareFireRear
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 40 40
    Size = 14 18
    BurstCount = 2 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:98 G:69 B:51 2
    Color3 = R:90 G:56 B:37 18
    Color4 = R:0 G:0 B:0 28
    ColorScale = 5 5
  End
  Update = DefaultUpdate
    SizeRate = -0.4 0
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    DriftVelocity = X:0 Y:0 Z:2
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.2 0.2
    Y = -0.2 0.2
    Z = 1.2 0.3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 15
    Length = 10
    Offset = X:-8 Y:0 Z:10
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    DetailTexture = EXCloudRS07.tga
    SpeedMultiplier = 1
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXParticleSystem NightmareFireHead
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 40 40
    Size = 7 8
    BurstCount = 2 3
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color2 = R:98 G:69 B:51 2
    Color3 = R:90 G:56 B:37 13
    Color4 = R:0 G:0 B:0 30
    ColorScale = 5 5
  End
  Update = DefaultUpdate
    SizeRate = -0.1 0
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    DriftVelocity = X:0 Y:0 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.2 0.2
    Y = -0.2 0.2
    Z = 0.3 0.2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 15
    Length = 10
    Offset = X:27 Y:0 Z:23
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    DetailTexture = EXCloudRS07.tga
    SpeedMultiplier = 1
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End

FXList FX_NightmareFire
	PlayEvenIfShrouded = Yes 
	ParticleSystem
		Name		= NightmareHeat			; Heatwave effect
		Offset 		= X:0.0 Y:0.0 Z:35.0
		AttachToObject	= Yes
	End
	ParticleSystem
		Name		   = NightmareEmbers		; Embers/Sparks
		Offset 		= X:0.0 Y:0.0 Z:11.0
		AttachToObject = Yes
	End
	ParticleSystem
		Name = NightmareFireFront			; Frontal fire
		AttachToObject	= Yes
		Offset = X:0.0 Y:0 Z:1.0
	End
	ParticleSystem
		Name = NightmareFireRear			; Frontal fire
		AttachToObject	= Yes
		Offset = X:0.0 Y:0 Z:1.0
	End
	ParticleSystem
		Name = NightmareFireHead			; Frontal fire
		AttachToObject	= Yes
		Offset = X:0.0 Y:0 Z:23.0
	End
End

ModifierList NightmareFX
	Category = WEAPON
	Duration = 9999999 			; Permanent
	FX = FX_NightmareFire
End


FXParticleSystem NightmareSpearFire1
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire03.tga
    Lifetime = 25 25
    SortLevel = 1
    Size = 4 8
    BurstCount = 3 3
    InitialDelay = 5 5
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:185 G:106 B:40 5
    Color3 = R:255 G:106 B:40 40
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.8 0.3 5 ;10
    Alpha3 = 0 0 25
  End
  Update = DefaultUpdate
    SizeRate = -0.25 -0.25
    SizeRateDamping = 1 1
    AngleZ = -7 7
    AngularDamping = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.005
    VelocityDamping = 1 1
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:10 Y:0 Z:0
    EndPoint = X:-35 Y:0 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.1 0.1
    Y = -0.1 0.1
    Z = -0.1 0.1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem NightmareSpearFire2
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire01.tga  ;EXSplatHaze.tga
    Lifetime = 30 30
    SortLevel = 1
    Size = 2 6
    BurstCount = 2 2
    InitialDelay = 5 5
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:210 G:100 B:40 5
    Color3 = R:255 G:100 B:40 20
  End
  Update = DefaultUpdate
    SizeRate = -0.15 -0.15
    SizeRateDamping = 1 1
    AngleZ = -7 7
    AngularDamping = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = -0.01
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:15 Y:0 Z:0
    EndPoint = X:-35 Y:0 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  Draw = DefaultDraw
  End
End


SpecialPower SpecialAbilityRingOfFire
	Enum		= SPECIAL_SARUMAN_FIRE_BALL
	ReloadTime	= 60000
End

ModifierList BurnBabyBurn		; Used for FX only
	Category = SPELL
	Modifier = SPEED 90%
	FX	= FX_NightmarePowerFireRingDebuffRing
	Duration = 12500
END

Weapon NightmareFireRingWarhead
  RadiusDamageAffects = ENEMIES NOT_SIMILAR
	FireFX			= FX_NightmarePowerFireRing
	ClearNuggets ;;.;;
	
	FireLogicNugget
		LogicType	=	INCREASE_BURN_RATE
		Radius		=	115
		Damage		=	10
	End	

	DamageNugget
         Damage        = 750
         Radius        = 100
         DelayTime     = 0
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 750
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 1500
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 2250
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 3000
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 3750
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 4500
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 5250
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 6000
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 200
         Radius        = 100
         DelayTime     = 6750
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 7500
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 8250
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 9000
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 9750
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

	DamageNugget
         Damage        = 100
         Radius        = 100
         DelayTime     = 10500
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
	End

;	AttributeModifierNugget
;		AttributeModifier	= BurnBabyBurn
;		Radius			= 100
;		AntiCategories		= LEADERSHIP BUFF
;		SpecialObjectFilter = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
;	End
End


Object HobbitRockProjectile

ReplaceModule ModuleTag_Draw
  Draw = W3DScriptedModelDraw ModuleTag_DrawNew
    DefaultModelConditionState
      Model = FIRELOCATOR
      ParticleSysBone ROOTTRANSFORM SarumonFireballFire FollowBone:yes
      ParticleSysBone ROOTTRANSFORM SarumonFireballSmoke FollowBone:yes
    End
  End
END

ReplaceModule ModuleTag_Draw2
    Draw = W3DStreakDraw ModuleTag_Draw2New
	    Length	= 20
	    Width	= 20
	    NumSegments	= 6
	    Color	= R:255 G:255 B:255
	    Texture	= EXHPRing_Narrow.tga
    End
END

AddModule
    Draw = W3DStreakDraw ModuleTag_Draw3
	    Length	= 30
	    Width	= 13
	    NumSegments	= 6
	    Color	= R:255 G:255 B:255
	    Texture	= EXHPRing_Narrow.tga
    End
END

AddModule
    Draw = W3DStreakDraw ModuleTag_Draw4
	    Length	= 60
	    Width	= 7
	    NumSegments	= 6
	    Color	= R:255 G:255 B:255
	    Texture	= EXHPRing_Narrow.tga
    End
END
    
ReplaceModule ModuleTag_04
  Behavior = BezierProjectileBehavior ModuleTag_04New
	FirstHeight = 4  ; Height of Bezier control points above highest intervening terrain
	SecondHeight = 4
	FirstPercentIndent = 20% ; Percentage of shot distance control points are placed
	SecondPercentIndent = 100%
	FlightPathAdjustDistPerSecond = 50 ; Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
	DetonateCallsKill = Yes
	CurveFlattenMinDist = 50.0
  End
END

 AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_NightmareFireringActivate
    StartsActive = Yes
    DeathWeapon = NightmareFireRingWarhead
  End
 END

End












;Weapon NightmareFireRing
Weapon FrodoRockThrow
	HitPercentage		= 100
	AttackRange		= 600
	DelayBetweenShots	= 5000
	PreAttackDelay		= 450
	ScaleWeaponSpeed	= Yes
	LeechRangeWeapon	= Yes
	WeaponSpeed		= 230
	MinWeaponSpeed		= 280
	MaxWeaponSpeed		= 450
	PreAttackType		= PER_SHOT
	ScatterRadius		= 0.0
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	FiringDuration		= 1
  	IsAimingWeapon		= Yes
	FireFX			= FX_NightmarePowerFireRingCast
	DamageType		= FLAME
	CanFireWhileMoving	= No

	ProjectileNugget
		ProjectileTemplateName = HobbitRockProjectile
		WarheadTemplateName = HobbitRockThrowWarhead
	End

End




CommandButton Command_SpecialAbilityFireWhip
  Command                 = SPECIAL_POWER
  SpecialPower		= SpecialAbilityRingOfFire
;  WeaponSlot              = WEAPON_2
  Options                 = NEED_TARGET_ENEMY_OBJECT
  TextLabel               = CONTROLBAR:SpecialAbilityFireWhip
  ButtonImage             = HSBalrogFireWhip
  ButtonBorderType        = ACTION 
  DescriptLabel           = CONTROLBAR:ToolTipSpecialAbilityFireWhip
  CursorName              = EvilAbilityObj
  InvalidCursorName       = GenericInvalid
  InPalantir		  = Yes
End

CommandSet NightmareCommandset
	1  = Command_ToggleStance
	2  = Command_SpecialAbilityFireWhip
	3  = Command_SpecialAbilityMurderOfCrows
	13 = Command_AttackMove
	14 = Command_Stop
End






Armor NightmareArmor
  Armor = DEFAULT         25%
  Armor = FLAME           0%
  Armor = MAGIC           50%
  Armor = HERO            30%
  Armor = LOGICAL_FIRE	  0%	; Otherwise his own fire pwnd him
  Armor = HERO_RANGED     30%
End

Weapon NightmareSword
	LeechRangeWeapon	= Yes
	AttackRange		= STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon		= Yes
	FireFX			= FX_GondorSwordHit
	DelayBetweenShots	= 1000
	PreAttackDelay		= 700
	PreAttackType		= PER_SHOT
	FiringDuration		= 1000
	AcceptableAimDelta	= 15

	DamageNugget
		Damage					= 800
		Radius					= 10
;		DelayTime				= 0
		DamageType				= CAVALRY
		DamageFXType				= MAGIC
		DeathType				= NORMAL
	End

End


Locomotor NightmareLocomotor
	Surfaces		= GROUND RUBBLE
	TurnTime		= 1800
	TurnTimeDamaged		= 2000
	;TurnThreshold		= 0.5
	Acceleration		= 600
	Braking			= 1500
	SlowTurnRadius		= 0.0
	FastTurnRadius		= 48.0
	FormationPriority	= MELEE1 ;CAVALRY2
  
	TurnPivotOffset		= 1
	;Appearance		= FOUR_LEGS_HUGE
  
	MinTurnSpeed		= 10%
	ZAxisBehavior		= NO_Z_MOTIVE_FORCE
	AccDecTrigger		= 0.5       ; ratio of max speed where we trigger acc and dec model states
	;WalkDistance		= 80         ; in unit distance
	Appearance		= FOUR_WHEELS     ; Shouldn't this be FOUR_LEGS?
	StickToGround		= Yes
	CanMoveBackwards	= No

	CloseEnoughDist		= 2.0         ; How close we must get to the end of a goal path before declaring success
End

ExperienceLevel	MordorBalrog_Summoned
	TargetNames			=	MordorBalrog
	RequiredExperience		=	1
	ExperienceAward			=	1100
;	ExperienceAwardOwnGuysDie	= 	700
	Rank				=	10
	SelectionDecal
		Texture			=	decal_hero_good
		Style			=	SHADOW_ALPHA_DECAL
		OpacityMin		=	80%
		OpacityMax		=	100%
		MinRadius		=	70
		MaxRadius		=	200	
		MaxSelectedUnits	=	40
	End	
END

ChildObject MordorBalrog RohanRohirrim ; When he was a mortal, he used to be a Rohirrim, but dark powers have corrupted the spirit of this once noble warrior and turned it into an avatar of darkness.
	DisplayName		= Nightmare
	SelectPortrait		= HPBalrog
	CommandSet		= NightmareCommandset
	Scale			= 1.7
	VisionRange		= VISION_HERO_RANGED
	ShroudClearingRange	= SHROUD_CLEAR_RANGED_HERO
	KindOf			= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CAVALRY SCORE ;GRAB_AND_DROP
	ShockwaveResistance = 160

	LocomotorSet
		Locomotor = NightmareLocomotor
		Condition = SET_NORMAL 
		Speed     = 100 ;100
	End

ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01New
	
	  OkToChangeModelColor = Yes
		GlowEnabled = Yes
		GlowEmissive = Yes
		StaticModelLODMode = Yes
		
		; specify options for static LODs
;		LodOptions							= LOW
;			AllowMultipleModels				= ALLOW_MULTIPLE_MODELS_LOW
;			MaxRandomTextures				= MAX_RANDOM_TEXTURES_LOW
;			MaxRandomAnimations				= MAX_RANDOM_ANIMATIONS_LOW
;			MaxAnimFrameDelta				= MAX_ANIM_FRAME_DELTA_LOW
;		End
;		
;		LodOptions							= MEDIUM
;			AllowMultipleModels				= ALLOW_MULTIPLE_MODELS_MED
;			MaxRandomTextures				= MAX_RANDOM_TEXTURES_MED
;			MaxRandomAnimations				= MAX_RANDOM_ANIMATIONS_MED
;			MaxAnimFrameDelta				= MAX_ANIM_FRAME_DELTA_MED
;		End
;		
;		LodOptions							= HIGH
;			AllowMultipleModels				= ALLOW_MULTIPLE_MODELS_HIGH
;			MaxRandomTextures				= MAX_RANDOM_TEXTURES_HIGH
;			MaxRandomAnimations				= MAX_RANDOM_ANIMATIONS_HIGH
;			MaxAnimFrameDelta				= MAX_ANIM_FRAME_DELTA_HIGH
;		End

		WadingParticleSys = WaterRipplesTrail  ; used when the unit is wading in shallow water.
		;--------------------------------------------------
		; new method
		RandomTexture = RUHorse01.tga 0 s3_lava.tga
		RandomTexture = RUHorse02.tga 0 s3_lava.tga
		RandomTexture = RUHorse03.tga 0 s3_lava.tga
		RandomTexture = RUHorse04.tga 0 s3_lava.tga
		
		;--------------------------------------------------
		;Random Rohirrim Riders textures - new method
		RandomTexture = RURohrm01.tga 0 guporter_coals.tga
		RandomTexture = RURohrm02.tga 0 guporter_coals.tga
		RandomTexture = RURohrm03.tga 0 guporter_coals.tga
		RandomTexture = RURohrm04.tga 0 guporter_coals.tga


;		ParticlesAttachedToAnimatedBones = yes
		
;;====================== MODELS ================================================================
		;-----Spear-----
		DefaultModelConditionState
			Model			= RURohrm_SKN
			WeaponLaunchBone	= PRIMARY FORGED_BLADE
			ParticleSysBone		= FORGED_BLADE NightmareSpearFire1 FollowBone:Yes
			ParticleSysBone		= FORGED_BLADE NightmareSpearFire2 FollowBone:Yes
		End
		ModelConditionState		= SWAPPING_TO_WEAPONSET_1	; swapping to bow
			Model				= RURohrm_SKN

		End

		;-----Flaming arrows + bow-----
		ModelConditionState		= WEAPONSET_PLAYER_UPGRADE USER_2 SWAPPING_TO_WEAPONSET_2	; swapping to spear
			Model				= RURhrmArch_SKN
			WeaponLaunchBone    = SECONDARY FIREAROWTIP
			ParticleSysBone		= FireArowTip arrowFire FollowBone:Yes
		End
		ModelConditionState		= WEAPONSET_PLAYER_UPGRADE USER_2 WEAPONSET_TOGGLE_1
			Model				= RURhrmArch_SKN
			WeaponLaunchBone    = SECONDARY FIREAROWTIP
			ParticleSysBone		= FireArowTip arrowFire FollowBone:Yes
		End

		;-----Bow-----
		ModelConditionState		= SWAPPING_TO_WEAPONSET_2		; swapping to spear
			Model				= RURhrmArch_SKN
			WeaponLaunchBone    = SECONDARY FIREAROWTIP
		End
		ModelConditionState		= WEAPONSET_TOGGLE_1
			Model				= RURhrmArch_SKN
			WeaponLaunchBone    = SECONDARY FIREAROWTIP
		End


;;================== ANIMATIONS =================================================================
		
		;---------------------------------------------
		;-----------------Spear Anims-----------------
		;---------------------------------------------
		IdleAnimationState
			StateName				=	Idle
			Animation				=	IdleB
				AnimationName		=	RURohrm_SKL.RURohrm_IDLB
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "State_Selected" then
					CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle")
				elseif Prev == "State_PuttingBowAway" then
					CurDrawableSetTransitionAnimState("TRANS_BowAway_To_Idle")
				end
			EndScript
		End
						
		AnimationState				=	PASSENGER
			Animation				=	grabbed
				AnimationName		=	RURohrm_SKL.RURohrm_GBDA
				AnimationMode		=	LOOP
			End
		End
		
		; --- stunned anims
		AnimationState				=	FREEFALL 
			Animation				=	free fall
				AnimationName		=	RURohrm_SKL.RURohrm_FLYB
				AnimationMode		=	LOOP
				AnimationBlendTime	=	10
			End
		End
		
		AnimationState				=	STUNNED_FLAILING 
			Animation				=	JustDie
				AnimationName		=	RURohrm_SKL.RURohrm_FLYC
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End

		; This is the no-spawn-horse type of death
		AnimationState				=	DYING DEATH_1 SPLATTED
			Animation				=	splatted
				AnimationName		=	RURohrm_SKL.RURohrm_LNDA
				AnimationMode		=	ONCE
				AnimationBlendTime  =   2
			End
			FXEvent	= Frame:2 Name:FX_SplatDust
		End
		
		

		AnimationState				=	DYING DEATH_1 
			Animation				=	JustDie
				AnimationName		=	RURohrm_SKL.RURohrm_DIEA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.25 0.25
			End
		End
		
		AnimationState				=	DYING DEATH_2 
			Animation				=	FadeOut
				AnimationName		=	RURohrm_SKL.RURohrm_IDLB
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.2 0.2
			End
		End
		
		AnimationState				=	STUNNED_STANDING_UP
			Animation				=	StandUp
				AnimationName		=	RURohrm_SKL.RURohrm_GTPA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End
		
		AnimationState				=	STUNNED
			Animation				=	Land
				AnimationName		=	RURohrm_SKL.RURohrm_LNDA
				AnimationMode		=	ONCE
			End
		End
		
		
				
		AnimationState						= BURNINGDEATH
			Animation			=	JustDie
				AnimationName		=	RURohrm_SKL.RURohrm_DIEA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.2 0.2
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= RURohrm_SKL.RURohrm_IDLB
				AnimationMode				= LOOP
			End
		End



		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = TrotAndFire
				AnimationName       = RURohrm_SKL.RURohrm_ATRB
				AnimationMode       = LOOP
				Distance			= 70; 35
			End
			Flags               = RANDOMSTART
		End

;;======= BACKING UP
		
		AnimationState					= MOVING BACKING_UP
			Animation					= BACKING UP
				AnimationName			= RURohrm_SKL.RURohrm_BAKA
				AnimationMode			= LOOP
			End
		End
		
		AnimationState					=	TURN_LEFT_HIGH_SPEED
			Animation					=	TurnLeft
				AnimationName			=	RURohrm_SKL.RURohrm_TNL1
				AnimationMode			=	LOOP
				AnimationBlendTime		=	20
			End
		End
		
		AnimationState					=	TURN_RIGHT_HIGH_SPEED
			Animation					=	TurnRight
				AnimationName			=	RURohrm_SKL.RURohrm_TNR1
				AnimationMode			=	LOOP
				AnimationBlendTime		=	20
			End
		End
		
		AnimationState					= MOVING WANDER
			Animation					= WLKA
				AnimationName			= RURohrm_SKL.RURohrm_WLKA
				AnimationMode			= LOOP
			End
		End

		AnimationState					=	MOVING TURN_LEFT 
			Animation					=	TurnLeft
				AnimationName			=	RURohrm_SKL.RURohrm_TRNL
				AnimationMode			=	LOOP
			End
		End

		AnimationState					=	MOVING TURN_RIGHT 
			Animation					=	TurnRight
				AnimationName			=	RURohrm_SKL.RURohrm_TRNR
				AnimationMode			=	LOOP
			End
		End

		AnimationState					= MOVING ENGAGED
			Animation					= Moving_Engaged
				AnimationName			= RURohrm_SKL.RURohrm_RUNC
				AnimationMode			= LOOP
				AnimationSpeedFactorRange	= 0.8 0.8
			End
			Flags						= RANDOMSTART
		End
		
;		AnimationState					= MOVING WALKING
;			Animation					= Walk1
;				AnimationName			= RURohrm_SKL.RURohrm_WLKB
;				AnimationMode			= LOOP
;				Distance				= 25
;			End
;		End

		AnimationState					= MOVING ACCELERATE
			Animation					= Accelerate
				AnimationName			= RURohrm_SKL.RURohrm_ACCL
				AnimationMode			= ONCE ; was LOOP
				AnimationSpeedFactorRange	= 0.8 0.8
			End
		End

		AnimationState					= DECELERATE
			Animation					= Decelerate
				AnimationName			= RURohrm_SKL.RURohrm_DECL
				AnimationMode			= ONCE
				AnimationSpeedFactorRange	= 0.55 0.55
			End
		End
			
		AnimationState					=	MOVING
			Animation					=	RunA
				AnimationName			=	RURohrm_SKL.RURohrm_RUNA
				AnimationMode			=	LOOP
				Distance			=   40
				AnimationSpeedFactorRange	= 0.8 0.8
			End
			Flags						=	RANDOMSTART
		End


		;---------------------------------------------------------------------------------------------------------

		; Standard attack with spear.
		AnimationState					=	FIRING_OR_PREATTACK_A
			Animation					=	AttackA1
				AnimationName			=	RURohrm_SKL.RURohrm_ATKA
				AnimationMode			=	ONCE
			End
		End
		;---------------------------------------------------------------------------------------------------------
		

;;--------------------- EMOTIONS ----------------------------------------------------------------------------------
;;===== TERROR		
		AnimationState					= MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
			Animation					= TerrorFromTheSky
				AnimationName			= RURohrm_SKL.RURohrm_RUNB
				AnimationMode			= LOOP
			End
		End
		
		AnimationState					= MOVING EMOTION_TERROR
			Animation					= TerrorFromTheSky
				AnimationName			= RURohrm_SKL.RURohrm_RUNB
				AnimationMode			= LOOP
			End
		End
		
;;======= APPREHENSIVE

		AnimationState					=	EMOTION_ALERT EMOTION_AFRAID
			Animation					=	Apprehensive
				AnimationName			=	RURohrm_SKL.RURohrm_APPA
				AnimationMode			=	LOOP	;Change this to ONCE if adding additional anims
			End
		End

;;======= AFRAID

		AnimationState					= EMOTION_AFRAID
			Animation					= FERA
				AnimationName			= RURohrm_SKL.RURohrm_FERA
				AnimationMode			= LOOP
			End
			;Animation					= FERB
			;	AnimationName			= RURohrm_SKL.RURohrm_FERB
			;	AnimationMode			= LOOP
			;End
		End

;;======= CELEBRATING
		
		AnimationState					=	EMOTION_CELEBRATING
			Animation					=	CheerA
				AnimationName			=	RURohrm_SKL.RURohrm_CHRA
				AnimationMode			=	ONCE
			End
			Animation					=	CheerB
				AnimationName			=	RURohrm_SKL.RURohrm_CHRB
				AnimationMode			=	ONCE
			End
			Animation					=	CheerC
				AnimationName			=	RURohrm_SKL.RURohrm_CHRC
				AnimationMode			=	ONCE
			End
			Animation					=	CheerD
				AnimationName			=	RURohrm_SKL.RURohrm_CHRD
				AnimationMode			=	ONCE
			End
			Animation					=	Salute
				AnimationName			=	RURohrm_SKL.RURohrm_SLTA
				AnimationMode			=	ONCE
			End
			Flags						= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

;;======= TAUNTING
			
		AnimationState					= EMOTION_TAUNTING
			Animation					= Taunting
				AnimationName			= RURohrm_SKL.RURohrm_TNTA
				AnimationMode			= ONCE
			End
			Animation					= Taunting2
				AnimationName			= RURohrm_SKL.RURohrm_TNTB
				AnimationMode			= ONCE
			End
			Flags						= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

;;======= POINTING

		AnimationState					= EMOTION_POINTING
			Animation				= Pointing1
				AnimationName			= RURohrm_SKL.RURohrm_PNTA
				AnimationMode			= LOOP
			End
		End
			
		AnimationState					= SPECIAL_WEAPON_ONE
			Animation				= Pointing1
				AnimationName			= RURohrm_SKL.RURohrm_PNTA
				AnimationMode			= ONCE
				UseWeaponTiming			= Yes
			End
		End
		
;;======== ALERT

		AnimationState					= EMOTION_ALERT
			Animation					= IDLA
				AnimationName			= RURohrm_SKL.RURohrm_IDLA
				AnimationMode			= LOOP
			End
		End
		
		AnimationState					=	RAISING_FLAG
			Animation					=	CheerA
				AnimationName			=	RURohrm_SKL.RURohrm_CHRA
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation					=	CheerB
				AnimationName			=	RURohrm_SKL.RURohrm_CHRB
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation					=	CheerC
				AnimationName			=	RURohrm_SKL.RURohrm_CHRC
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation					=	CheerD
				AnimationName			=	RURohrm_SKL.RURohrm_CHRD
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation					=	Salute
				AnimationName			=	RURohrm_SKL.RURohrm_SLTA
				AnimationMode			=	ONCE
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
		End


;;-------------------- SELECTED ---------------------------------------------------------------
				
		AnimationState					= SELECTED
			StateName					= State_Selected
;			SimilarRestart				= Yes
			Animation					= AtAttention
				AnimationName			= RURohrm_SKL.RURohrm_IDLA
				AnimationMode			= LOOP
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle" then
					CurDrawableSetTransitionAnimState("TRANS_Idle_To_Selected")
				elseif Prev == "State_PuttingBowAway" then
					CurDrawableSetTransitionAnimState("TRANS_BowAway_To_Selected")
				end
			EndScript
		End
		
		
		TransitionState					=	TRANS_Idle_to_Selected
			Animation					=	ATNA
				AnimationName			=	RURohrm_SKL.RURohrm_ATNA
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 1.0 1.0
			End
		End
		
		TransitionState					=	TRANS_Selected_to_Idle
			Animation					=	ATNC
				AnimationName			=	RURohrm_SKL.RURohrm_ATNA
				AnimationMode			=	ONCE_BACKWARDS
				AnimationSpeedFactorRange = 0.6 1.0
			End
			Flags						= START_FRAME_LAST
		End
		
	End
END ;ReplaceModule


;----------------------------------- RING OF FIRE ------------------------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_FireballStarter                      
		SpecialPowerTemplate	= SpecialAbilityRingOfFire
		UpdateModuleStartsAttack = Yes
;		StartsPaused		= No
;		InitiateSound		= BalrogIgnite		; Plays with FX
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate   
		SpecialPowerTemplate    = SpecialAbilityRingOfFire
		WhichSpecialWeapon	= 1
		SkipContinue		= Yes

		UnpackTime             	= 800
		PreparationTime		= 1   
		PersistentPrepTime	= 1000 
		PackTime		= 500
		
		AwardXPForTriggering    = 0
		
		StartAbilityRange	= 600 ; 300
		MustFinishAbility	= Yes
		SpecialWeapon		= FrodoRockThrow
	End
END

AddModule
	Behavior = AutoAbilityBehavior ModuleTag_FirBallAutoAbility
		SpecialAbility		= SpecialAbilityRingOfFire
		MaxScanRange		= 500
		Query			= 1 ALL ENEMIES -STRUCTURE
	End
END

;------------------------------------------------------------------------------------

	VoiceAttack		= BalrogInjuredB_Part1
	VoiceAttackCharge	= BalrogInjuredB_Part1
	VoiceAttackMachine	= FellBeastVoiceAttack
	VoiceAttackStructure	= FellBeastVoiceAttack
	VoiceMove		= BalrogInjuredB_Part1
	VoiceMoveToCamp		= FellBeastVoiceMove
	VoiceMoveWhileAttacking	= FellBeastVoiceMove
	VoicePriority		= 90
	VoiceRetreatToCastle	= BalrogInjuredB_Part1
	VoiceSelect		= BalrogInjuredB_Part1
	VoiceSelectBattle 	= BalrogInjuredA_Part1
	VoiceGuard		= BalrogInjuredA_Part1

	VoiceEnterStateAttack			= BalrogInjuredB_Part1
	VoiceEnterStateAttackCharge		= BalrogInjuredB_Part1
	VoiceEnterStateAttackStructure 		= BalrogInjuredA_Part1
 	VoiceEnterStateAttackMachine		= FellBeastVoiceAttack
	VoiceEnterStateMove			= BalrogInjuredA_Part1
	VoiceEnterStateMoveToCamp 		= FellBeastVoiceMove
	VoiceEnterStateMoveWhileAttacking	= BalrogInjuredA_Part1
	VoiceEnterStateRetreatToCastle 		= FellBeastVoiceSelect
	
	UnitSpecificSounds
		VoiceEnterUnitElvenTransportShip	= FellBeastVoiceMove
		VoiceInitiateCaptureBuilding		= FellBeastVoiceMove
	End


	CrowdResponseKey = None

  ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 		= EMOTION_CHEER_RADIUS
		MaxHealth		= 20000
		MaxHealthDamaged	= 5000
		DodgePercent      	= 40
	End
  END

  ReplaceModule ModuleTag_08
	Behavior = SlowDeathBehavior ModuleTag_08New
		DeathTypes = ALL
		SinkDelay = 3000
		SinkRate = 2     ; in Dist/Sec
		DestructionDelay = 12000
;		FadeDelay = 4000			; TEXTURE WASN'T FADEABLE
;		FadeTime = 7000
        	FX = INITIAL FX_NightmareDeath
		Sound = INITIAL BalrogSummonRoar
	        DeathFlags = DEATH_1
	End
  END

;  AddModule
;	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhite
;		UpgradeToGrant = Upgrade_RohanForgedBladesForRohirrim ;Upgrade_GandalfWhite ; Upgrade given at start to easily give other initial stuff to the unit
;	End 
;  End

;STARTUPGRADE
  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhite
		UpgradeToGrant = Upgrade_TrebuchetTurret ;Upgrade_GandalfWhite ; Upgrade given at start to easily give other initial stuff to the unit
	End 
  End

;RESKIN
  AddModule
	Behavior = SubObjectsUpgrade Body_ReskinNightmare
		TriggeredBy		= Upgrade_TrebuchetTurret
		UpgradeTexture		= ruhorse01.tga		0 s3_lava.tga
		UpgradeTexture		= ruhorse02.tga		0 s3_lava.tga
		UpgradeTexture		= ruhorse03.tga		0 s3_lava.tga
		UpgradeTexture		= ruhorse04.tga		0 s3_lava.tga
		UpgradeTexture		= rurohrm01.tga		0 guporter_coals.tga
		UpgradeTexture		= rurohrm02.tga		0 guporter_coals.tga
		UpgradeTexture		= rurohrm03.tga		0 guporter_coals.tga
		UpgradeTexture		= rurohrm04.tga		0 guporter_coals.tga
		RecolorHouse		= No
	End
  End

;DELAYED UPGRADE FOR CRAPPY FIRE ATTRIBUTEMODIFIER
AddModule
	Behavior = ObjectCreationUpgrade MakeTheFreeTreb
		TriggeredBy		= Upgrade_TrebuchetTurret
		Delay			= 0.5
		GrantUpgrade	= Upgrade_RohanForgedBladesForRohirrim
	End
END

AddModule
	Behavior = StancesBehavior ModuleTag_StancesBehavior			; Allow stances
 	       StanceTemplate = Hero
	End
END

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_NightmareLightsUp
	TriggeredBy 		= Upgrade_RohanForgedBladesForRohirrim ;Upgrade_GandalfWhite
	AttributeModifier 	= NightmareFX
	End
  END

	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY NightmareSword
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions      = None
		Armor           = NightmareArmor
		DamageFX        = NormalDamageFX
	End

	GeometryMajorRadius = 180.0
	GeometryMinorRadius = 70.0

	HealthBoxScale		= 140.0
;	HealthBoxHeightOffset	= 30 ; 30.0 (old rohirrim object)
END














;-------------------------------------------------
; RHAKID's PARTY
;-------------------------------------------------

ModifierList RhakidPartyDamageBonus
  	Category	= WEAPON
  	Modifier	= DAMAGE_MULT 130%	; This good?
End

; CaH armor attribute 1 = 55%
; CaH armor attribute 17 = 15%

Armor RhakidPartyArmor
  Armor = DEFAULT         10%   
  Armor = MAGIC          15%   
  Armor = HERO            13%   
  Armor = HERO_RANGED     13%   
  Armor = POISON	  50%
End

; -------------------------------- Orc/Troll warrior -----------------------------------

FXParticleSystem RhakidWarriorBuffRed
  System
    Priority = ALWAYS_RENDER
    ParticleName = ExSpearHead.tga ; EXRing01.tga
    Lifetime = 15 15
    SystemLifetime = 900
    SortLevel = 1
    Size = 20 29
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color2 = R:91 G:30 B:30 5
    Color3 = R:0 G:0 B:0 15
    Color4 = R:32 G:32 B:32 0
  End
  Update = DefaultUpdate
    SizeRate = -0.8 -0.8
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 0 0.7
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 2
    Offset = X:0 Y:0 Z:15
  End
  Draw = DefaultDraw
  End
End

FXList FX_RhakidWarriorBuff
	ParticleSystem
		Name			= RhakidWarriorBuffRed
		AttachToObject		= Yes
	End
End

ModifierList RhakidWarriorBladeMaster
	Category			= SPELL
	Modifier			= ARMOR	-25%
	Modifier			= DAMAGE_MULT 200%
	Duration			= 30000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
	FX				= FX_RhakidWarriorBuff
End

CommandSet RhakidPartyWarrior1CommandSet
	1	= Command_ToggleStance
	2	= Command_SpecialAbilityBladeMaster
	13 	= Command_AttackMove
	14 	= Command_Stop
End

Object MordorMoranOrc

	KindOf	= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY

	VoicePriority				= 80

	ShockwaveResistance = 65

	SelectPortrait	= UPMordor_MountainTroll

	CommandSet = RhakidPartyWarrior1CommandSet

	ArmorSet
		Conditions      = None
		Armor           = RhakidPartyArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    CreateAHeroBasicMeleeWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhite
		UpgradeToGrant = Upgrade_GandalfWhite	; So he has the damage improvement right away
	End 
  End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_UrukCrossbowDamageIncrease 	; Gives Uruk Crossbowmen an attribute modifier that increases their damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	RhakidPartyDamageBonus
	End
  END

AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = MUOrcMorA.tga		0 mudrmtroll.tga
		RecolorHouse		   = No
	End
End

AddModule
	;;.;; 	Behavior = SpecialPowerModule ModuleTag_BladeMasterStarter
	;;.;;		SpecialPowerTemplate    = SpecialAbilityAragornBladeMaster
	;;.;;;		StartsPaused		= No; Yes
	;;.;;	End
	;;.;;
	;;.;;	Behavior = HeroModeSpecialAbilityUpdate ModuleTag_BladeMasterUpdate
	;;.;;		SpecialPowerTemplate    = SpecialAbilityAragornBladeMaster
	;;.;;		HeroAttributeModifier	= RhakidWarriorBladeMaster
	;;.;;		HeroEffectDuration	= 30000
	;;.;;		UnpackTime              = 1
	;;.;;		TriggerSound		= AragornBladeMaster
	;;.;;	End

	Behavior = SpecialPowerModule ModuleTag_BladeMasterStarter
		SpecialPowerTemplate = SpecialAbilityAragornBladeMaster
		UpdateModuleStartsAttack		= Yes ;;-;;
	End
	Behavior = ActivateModuleSpecialPower ModuleTag_BladeMasterUpdate  ;;-;;
		SpecialPowerTemplate			= SpecialAbilityAragornBladeMaster
		TriggerSpecialPower				= ModuleTag_TriggerMode4
		UnpackTime              		= 800
		PackTime                		= 500
		UnpackingVariation				= 2 ;; sets PACKING_TYPE_2
		TriggerSound					= AragornBladeMaster
	End
	Behavior = SpecialPowerModule ModuleTag_TriggerMode4 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyFour
		UpdateModuleStartsAttack		= No
		StartsPaused					= No
	End
	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_BladeMasterUpdat4 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyFour
		Duration						= 30000
		AttributeModifier				= AragornBladeMaster
		WeaponSetFlags					= WEAPONSET_HERO_MODE
		StartsPaused					= No
	End
END

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_NewHealth
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 4500
		MaxHealthDamaged  = 500
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END

END



; --------------------------- Haradrim Archer ----------------------------

Weapon RhakidArcherWarhead
  ProjectileCollidesWith = ALLIES ENEMIES NEUTRAL STRUCTURES WALLS 
  RadiusDamageAffects	 = ENEMIES NEUTRALS ALLIES NOT_SIMILAR
  HitStoredTarget		 = Yes	; Always hits initial target.
  HitPercentage		     = 100	
	ClearNuggets ;;.;;

;  DamageNugget
;	Damage			= 50
;	Radius			= 0.0
;	DelayTime		= 0
;	DamageType		= HERO
;	DamageFXType		= GOOD_ARROW_PIERCE
;	DeathType		= NORMAL
;  End
 
  DamageNugget                       
	Damage        		= 1200		
	DamageType    		= MAGIC
	DamageFXType  		= MAGIC
	DeathType     		= BURNED
	Radius			= 35
	DelayTime		= 200  
  End

  
  MetaImpactNugget
	HeroResist			= .25
	ShockWaveAmount   = 70.0
	ShockWaveRadius   = 15.0
	ShockWaveTaperOff = 0.5
	ShockWaveZMult    = 1.20
  End
  
End



Object BarbedArrowProjectile

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_Draw3
		DefaultModelConditionState		 
			Model = RULegolas_AROW
			ParticleSysBone NONE ThranArrowTrail FOLLOWBONE:YES
		End

		IdleAnimationState
			Animation							= RULegolas_AROW
				AnimationName				= RULegolas_AROW.RULegolas_AROW
				AnimationMode				= LOOP
			End
		End
	End
END

RemoveModule ModuleTag_Draw2

ReplaceModule ModuleTag_04
  Behavior = BezierProjectileBehavior ModuleTag_04New
	DetonateCallsKill		= Yes
	FirstHeight			= 9
	SecondHeight			= 9
	FirstPercentIndent		= 20%
	SecondPercentIndent		= 90%
	FlightPathAdjustDistPerSecond	= 50 
	GroundHitFX			= FX_WoundingArrowHit
	CurveFlattenMinDist		= 100.0
  End
END

 AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_TriggerDeathWeapon
    StartsActive = Yes
    DeathWeapon = RhakidArcherWarhead
  End
 END

End


Weapon HaradrimBarbedArrow // BALANCE Archer Weapon ;orc archer
	AttackRange			= FARAMIR_WOUNDING_ARROW_RANGE
	LeechRangeWeapon		= Yes
	WeaponSpeed			= 321				 ; dist/sec 
	MinWeaponSpeed			= 241
	MaxWeaponSpeed			= 481			; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX				= FX_ThranduilThornOfVengeance	;FX_FaramirWoundingArrow
	ScaleWeaponSpeed		= Yes ; Used for lob weapons, scales speed proportional to range
	HitStoredTarget			= Yes	; Always hits initial target.
	HitPercentage			= 100		 
	ScatterRadius			= 0.0		 ;When this weapon misses it can randomly miss by as much as this distance.
	DelayBetweenShots		= 15000									; time between shots, msec
	PreAttackDelay			= 1										; we want isntant
	PreAttackType			= PER_POSITION
	FiringDuration			= 1										; Duration of the archer firing shot is 500ms.
	ClipSize			= 1
	AutoReloadsClip			= Yes
	AutoReloadWhenIdle		= 1	
	ClipReloadTime			= Min:THRANDUIL_THORN_RELOADTIME_MIN Max:THRANDUIL_THORN_RELOADTIME_MAX
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	PreferredTargetBone		= B_LLLID ; Likes to shoot things in their left eye. 

;Commented out because the nugget is already there when overriding an existing weapon. Otherwise the nugget would fire twice.
;  ProjectileNugget
;    ProjectileTemplateName    = BarbedArrowProjectile
;    WarheadTemplateName       = HaradrimBarbedArrowWarhead
;  End

End



CommandSet RhakidPartyArcherCommandSet
	1	= Command_ToggleStance
	2	= Command_HaradrimArcherBarbedArrowAbility
	12	= Command_CaptureBuilding
	13	= Command_AttackMove
	14	= Command_Stop
End

ModifierList RhakidPartyArcherAttackBonus
  	Category	= WEAPON
  	Modifier	= DAMAGE_MULT 1400%	; This good?
END

Object MordorHaradrimArcher

	KindOf	= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY

	ShockwaveResistance = 65

	VoicePriority				= 80

	CommandSet = RhakidPartyArcherCommandSet

	ArmorSet
		Conditions      = None
		Armor           = RhakidPartyArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    HaradrimBow
		Weapon = TERTIARY   HaradrimBowBombard
		Weapon = QUINARY	HaradrimBarbedArrow
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT				; Not AI.
		AutoChooseSources = QUINARY FROM_PLAYER FROM_SCRIPT				; Not AI.
	End
	  
	WeaponSet
		Conditions = CLOSE_RANGE CONTESTING_BUILDING
		Weapon = PRIMARY    HaradrimBow
		Weapon = SECONDARY   HaradrimBow
		Weapon = TERTIARY   HaradrimBowBombard
		Weapon = QUINARY	HaradrimBarbedArrow
 		OnlyAgainst = PRIMARY STRUCTURE
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT				; Not AI.
		AutoChooseSources = QUINARY	FROM_PLAYER FROM_SCRIPT				; Not AI.
	End

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhite
		UpgradeToGrant = Upgrade_MordorBarbedArrows	; So he can use the ability right away
	End 
  End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_UrukCrossbowDamageIncrease 	; Gives Uruk Crossbowmen an attribute modifier that increases their damage
		TriggeredBy	  	=	Upgrade_MordorBarbedArrows
		AttributeModifier 	=	RhakidPartyArcherAttackBonus
	End
  END


;Thorn of Vengeance special arrow
  AddModule
	Behavior = SpecialPowerModule ModuleTag_WoundArrow
		SpecialPowerTemplate		= SpecialAbilityHaradrimArcherBarbedArrow
		UpdateModuleStartsAttack	= Yes
;    		InitiateSound			= FaramirRangerVoiceWoundingArrow
;    		StartsPaused			= No ;Yes
	End
  END

  AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WoundArrowUpdate
		SpecialPowerTemplate		= SpecialAbilityHaradrimArcherBarbedArrow
		SkipContinue			= Yes
		UnpackTime			= 1000 
		PreparationTime			= 1   
		PersistentPrepTime		= 1000 
		PackTime			= 1
		AwardXPForTriggering		= 0
		StartAbilityRange		= #SUBTRACT( FARAMIR_WOUNDING_ARROW_RANGE 25 )
		ApproachRequiresLOS		= Yes
		SpecialWeapon			= HaradrimBarbedArrow 		; ThranduilThornofVengeance
		WhichSpecialWeapon		= 1
	End
  END

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_NewHealth
		MaxHealth         	= 2100
		MaxHealthDamaged  	= 500
		BurningDeathBehavior	= Yes
		BurningDeathFX		= FX_InfantryBurningFlame
;   		DodgePercent      	= 50%
	End
END

END



; ------------------------------------- Dwarven Warrior ------------------------------------

CommandSet RhakidPartyDwarfCommandSet
	1	= Command_ToggleStance
	2	= Command_CreateAHero_EarthShaker_Level3
	3	= Command_RohanGimliLeap
	12	= Command_CaptureBuilding
	13	= Command_AttackMove
	14	= Command_Stop
END

ModifierList RhakidPartyDamageBonusDwarf
  	Category	= WEAPON
  	Modifier	= DAMAGE_MULT 110%	; Because his earthshaker was way too powerful
End

Object DwarvenGimli

ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01New
	RandomTexture = RUDwarf_C.tga 0 Dwarf_A.tga


	StaticModelLODMode = no  ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model               = RUAxeDwrf_SKN
			Skeleton            = RUGimli_SKL
		End		

	;;======= DYING

		AnimationState        = STUNNED_FLAILING
			Animation           = FLYA
				AnimationName     = RUGimli_FLYA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange	= 0.3 0.5
			End
			Flags               = RANDOMSTART
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
		
		AnimationState        = DYING SPLATTED
			Animation           = LNDB
				AnimationName     = RUGimli_LNDA
				AnimationMode     = ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

		AnimationState        = DYING
			Animation           = DIEA
				AnimationName     = RUGimli_DIEA
				AnimationMode     = ONCE
			End
			Animation           = DIEC
				AnimationName     = RUGimli_DIEC
				AnimationMode     = ONCE
			End
	
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
		
		AnimationState        = STUNNED_STANDING_UP
			Animation           = GTPA
				AnimationName     = RUGimli_GTPA
				AnimationMode     = ONCE
			End
		End
	
		AnimationState        = STUNNED
			Animation           = LNDA
				AnimationName     = RUGimli_LNDA
				AnimationMode     = ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= RUGimli_IDLA
				AnimationMode				= LOOP
			End
		End

			
	;;======= MOVING
	
	
	AnimationState        = MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = RunAndFire
				AnimationName       = RUGimli_ATRA
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART 
		End

		AnimationState				=	MOVING ATTACKING
			Animation				=	RUNB
				AnimationName		=	RUGimli_RUNB
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
			;ParticleSysBone		=	None InfantryDustTrails
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
	
		AnimationState				=	MOVING
			Animation				=	RUNA
				AnimationName		=	RUGimli_RUNA
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
			;ParticleSysBone		=	None InfantryDustTrails
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End


;;------------------ ATTACKING  -------------------------------

; AXE THROW
		AnimationState        =  FIRING_OR_PREATTACK_C
			Animation           = SPCA
				AnimationName     = RUGimli_SPCA
				AnimationMode     = ONCE
;				UseWeaponTiming		= Yes
			End
			FrameForPristineBonePositions = 42;44
			;ParticleSysBone     = None MeleeDust
			BeginScript
				CurDrawableShowSubObject("AXE02")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

		AnimationState        =  FIRING_OR_PREATTACK_B; WEAPONLOCK_SECONDARY
			Animation           = ATKA
				AnimationName     = RUGimli_ATKD
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End
	
		AnimationState        =  FIRING_OR_PREATTACK_A
			Animation           = ATKA
				AnimationName     = RUGimli_ATKA
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			Animation           = ATKB
				AnimationName     = RUGimli_ATKB
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End		
			Animation           = ATKC
				AnimationName     = RUGimli_ATKC
				AnimationMode     = ONCE
				UseWeaponTiming		= Yes
			End
			
			;ParticleSysBone None MeleeDust
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
			EndScript
		End

	;leap animations 		
		AnimationState			= SPECIAL_WEAPON_TWO UNPACKING
			Animation			= GettingReadyToLeap
				AnimationName	= RUGimli_LEPA
				AnimationMode   = ONCE
			End
		End

		AnimationState        =  ABOUT_TO_HIT		;using Gimli Leap
		StateName			= State_AboutToHitGround
			Animation           = Leap
				AnimationName     = RUGimli_LEPC  
				AnimationMode     = ONCE
			;	UseWeaponTiming		= Yes
			End
		End


		AnimationState        = THROWN_PROJECTILE
			Animation           = LEPB
				AnimationName     = RUGimli_LEPB
				AnimationMode     = LOOP
				AnimationBlendTime = 20
			End
		End


;;-------------------- HIT REACTIONS --------------------------

		AnimationState = HIT_REACTION
			Animation = Hit_Level_1_a
				AnimationName = RUGimli_HITA
				AnimationMode = ONCE
			End
		End
		
;;------------ EMOTIONS ---------------------------------------

;;====== LEVELED
		AnimationState				= LEVELED 						; This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= RUGimli_CHRB
				AnimationMode		= ONCE
			End
		End

;;====== CELEBRATING
		AnimationState			= EMOTION_CELEBRATING
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End

;;====== TAUNTING
		AnimationState			= EMOTION_TAUNTING
			Animation           = TNTA
				AnimationName   = RUGimli_TNTA
				AnimationMode   = ONCE
			End

			Animation           = TNTB
				AnimationName   = RUGimli_TNTB
				AnimationMode   = ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		AnimationState					= EMOTION_ALERT
			Animation					= Ready
				AnimationName			= RUGimli_IDLA
				AnimationMode			= LOOP
				AnimationBlendTime  =   15
			End
			BeginScript
				CurDrawableHideSubObject("AXE02")
;				Prev = CurDrawablePrevAnimationState()
;				if Prev == "BORED"		then CurDrawableSetTransitionAnimState("Transition_BoredToReady") end
;				if Prev == "SELECTED"	then CurDrawableSetTransitionAnimState("Transition_SelectedToReady") end
				if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
			EndScript

		End
		
		AnimationState			= RAISING_FLAG
			Animation           = CHRA
				AnimationName   = RUGimli_CHRA
				AnimationMode   = LOOP
			End
		End

;;------------------- SELECTED STATES -------------------------
		
		AnimationState				=	SELECTED
			StateName				=	AtAttentionIdle
			SimilarRestart			=   Yes			
			Animation				=	ATNB
				AnimationName		=	 RUGimli_ATNB
				AnimationMode		=	LOOP
			End
			BeginScript
				CurDrawableHideSubObject("AXE02")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
				if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
				if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
			EndScript
		End
							
;;--------------- IDLE STATES ---------------------------------

		IdleAnimationState
			StateName				= STATE_Idle
			Animation           = IDLB
				AnimationName     = RUGimli_IDLB
				AnimationMode     = ONCE
				AnimationPriority = 30
			End
			Animation           = IDLF
				AnimationName     = RUGimli_IDLF
				AnimationMode     = ONCE
				AnimationPriority = 5
			End		
			Animation           = IDLD
				AnimationName     = RUGimli_IDLD
				AnimationMode     = ONCE
				AnimationPriority = 4
			End
			Animation           = IDLG
				AnimationName     = RUGimli_IDLG
				AnimationMode     = ONCE
				AnimationPriority = 2
			End
			Animation           = IDLH
				AnimationName     = RUGimli_IDLH
				AnimationMode     = ONCE
				AnimationPriority = 1
			End		
			Animation           = IDLC
				AnimationName     = RUGimli_IDLC
				AnimationMode     = ONCE
				AnimationPriority = 1
			End
			Animation           = IDLE
				AnimationName     = RUGimli_IDLE
				AnimationMode     = ONCE
				AnimationPriority = 1
			End
			
			BeginScript
				CurDrawableHideSubObject("AXE02")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
				if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
				if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
			EndScript
		End

		
;---Transitions-------------------------------------

		TransitionState       = TRANS_EndDwarfToss
			Animation           = TOS4
				AnimationName     = RUGimli_TOS4
				AnimationMode     = ONCE
			End
		End	

		TransitionState       = TRANS_SelectedToIdle	
			Animation           = ATNC
				AnimationName     = RUGimli_ATNC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.7 1.3
			End
		End
		
		TransitionState				=	TRANS_Select
			Animation				=	ATNA
				AnimationName		=	 RUGimli_ATNA
				AnimationMode		=	ONCE
			End
		End
	
		TransitionState = TRANS_AboutToHitGround_To_Idle
			Animation = SplashAtEndOfJump
				AnimationName = RUGimli_LEPC
				AnimationMode = ONCE
				;AnimationBlendTime = 0
			End
			Flags = MAINTAIN_FRAME_ACROSS_STATES
		End
		
	End
END

	KindOf	= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY

	ShockwaveResistance = 65

	Scale = 0.75

	SelectPortrait	= UPDwarvenGuardian
	DisplayName	= OBJECT:DwarvenGuardian

	CommandSet = RhakidPartyDwarfCommandSet

	VoicePriority				= 80

	ArmorSet
		Conditions      = None
		Armor           = RhakidPartyArmor
		DamageFX        = NormalDamageFX
	End

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    CreateAHeroBasicMeleeWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBodyNew
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= 3600   ;3600
		PermanentlyKilledByFilter	= NONE
   		DodgePercent      		= 80%	
	End
END


ReplaceModule ModuleTag_05
	Behavior = SlowDeathBehavior ModuleTag_05New
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL DwarfAxeThrowerVoiceDie
	End
END

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhite
		UpgradeToGrant = Upgrade_GandalfWhite	; So he has the damage improvement right away
	End 
  End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_UrukCrossbowDamageIncrease 	; Gives Uruk Crossbowmen an attribute modifier that increases their damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	RhakidPartyDamageBonusDwarf
	End
  END

; ------------------------- Earthshaker -----------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroEarthShakerStarter_Level3
		SpecialPowerTemplate      = SpecialAbilityCreateAHeroEarthShaker_Level3
		UpdateModuleStartsAttack  = Yes
;		StartsPaused		  = No ;Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroEarthShakerUpdate_Level3
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroEarthShaker_Level3
		SpecialWeapon			= CreateAHeroEarthShaker_Level3
		WhichSpecialWeapon		= 3
		StartAbilityRange		= 1.0
	
		SkipContinue			= Yes
		UnpackTime			= 200
		PackTime			= 1333
		MustFinishAbility		= Yes
	End
END

;------------------------------------------------------------------

RemoveModule ModuleTag_GimliLeadership

RemoveModule ModuleTag_GimliLeadershipUpdate

RemoveModule ModuleTag_GimliHealing

RemoveModule ModuleTag_Leadership

RemoveModule Icon

END




; --------------------------------- Wizard ---------------------------------

FXParticleSystem RhakidWizardDebuffParticle			; Debuff particle affecting enemies
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= execlipseblur.tga
    Lifetime		= 60 60
    SystemLifetime	= 390
    Size		= 13 13 
    BurstDelay		= 15 15
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:20   G:20 B:20  0
    Color2		= R:60  G:0 B:240 5
    Color3		= R:10  G:0 B:40 50
    Color4		= R:0    G:0  B:0 60
  End
  Update		= DefaultUpdate
    SizeRate		= 0.01 0.01
;    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= 0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.15 0.15
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END

FXList FX_RhakidWizardDebuff
  ParticleSystem
	Name = RhakidWizardDebuffParticle
	Offset = X:0.0 Y:0.0 Z:10
	AttachToObject	= Yes
  End
End

FXParticleSystem RhakidWizardCastDebuffLightParticleHeat	; Heat on the ground of target area
  System
    Priority		= ALWAYS_RENDER
    Shader		= ALPHA
    ParticleName	= SMUDGE.tga
    Lifetime		= 50 50
    SystemLifetime	= 70
    Size		= 13 13
    BurstCount		= 2 3
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
  End
  Alpha			= DefaultAlpha
    Alpha1		= 1 1 0
  End
  Update		= DefaultUpdate
    SizeRate		= 1 4
    SizeRateDamping	= 0.9 0.9
    AngleZ		= 0.0051 0.005
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 0.96 0.97
    DriftVelocity	= X:0 Y:0 Z:1
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.25 0.25
  End
  EmissionVolume	= BoxEmissionVolume
    HalfSize		= X:30 Y:10 Z:0
  End
  Draw			= DefaultDraw
  End
End


FXParticleSystem RhakidWizardCastDebuffLightParticle		; On the ground of target area
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exblast2.tga
    Lifetime		= 100 100
    SystemLifetime	= 70
    Size		= 5 5
    BurstDelay		= 10 10
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:20 G:20 B:20  0
    Color2		= R:60 G:1  B:240 10
    Color3		= R:0  G:0  B:0   100
  End
  Update		= DefaultUpdate
    SizeRate		= 0.7 0.7
    SizeRateDamping	= 1 1
    AngleZ		= -180 180
;    AngularRateZ	= 0 0
;    AngularDamping	= 1 1
;    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
;    VelocityDamping	= 1 1
;    Gravity		= 0 0
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    Z = 0 0
  End
  EmissionVolume	= BoxEmissionVolume
    HalfSize = X:30 Y:30 Z:0
  End
  Draw			= DefaultDraw
  END
END

FXList FX_RhakidWizardCastDebuff
  ParticleSystem
    Name = RhakidWizardCastDebuffLightParticle
    Offset = X:0.0 Y:0.0 Z:3
  End
  ParticleSystem
    Name = RhakidWizardCastDebuffLightParticleHeat
    Offset = X:0.0 Y:0.0 Z:3
  End
       Sound
          Name = SpellEnshroudingMist
       End
END


FXParticleSystem RhakidWizardSpellcasting				; FX on caster
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exblast2.tga
    Lifetime		= 100 100
    SystemLifetime	= 70
    Size		= 1 1
    BurstDelay		= 10 10
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:20 G:20 B:20  0
    Color2		= R:60 G:1  B:240 10
    Color3		= R:0  G:0  B:0   100
  End
  Update		= DefaultUpdate
    SizeRate		= 0.7 0.7
    SizeRateDamping	= 1 1
    AngleZ		= -180 180
;    AngularRateZ	= 0 0
;    AngularDamping	= 1 1
;    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
;    VelocityDamping	= 1 1
;    Gravity		= 0 0
  End
  EmissionVelocity	= OrthoEmissionVelocity
;    Z = 0 0
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END

FXList FX_SlowPaceCastingAnim
  ParticleSystem
    Name = RhakidWizardSpellcasting
    Offset = X:0.0 Y:0.0 Z:3
  End
       Sound
          Name = SpellDragonAlly_LurtzCrippleEffect
       End
END





Weapon  SlowPaceFakeWeapon
	IdleAfterFiringDelay = 0
	AttackRange = 999
	MinimumAttackRange = 0.1
	WeaponSpeed = 401
	MinWeaponSpeed = 241
	MaxWeaponSpeed = 601
	DelayBetweenShots = 5000
	PreAttackDelay        = 1
	PreAttackType         = PER_ATTACK
;	PreAttackFX           = FX_SlowPaceCastingAnimPre
	FireFX                = FX_SlowPaceCastingAnim
	FiringDuration      = 1
End


ModifierList RhakidWizardDebuff
	Category	= SPELL
	Modifier	= SPEED	35%
	FX		= FX_RhakidWizardDebuff
	Duration	= 13000
;	ReplaceInCategoryIfLongest	= Yes
;	IgnoreIfAnticategoryActive	= Yes	
End

SpecialPower SpecialAbilitySlowDebuff
	Enum			= SPECIAL_SPELL_BOOK_RALLYING_CALL
	ReloadTime		= 60000
	Flags			= WATER_OK
	RadiusCursorRadius	= 200.0
End

CommandButton Command_ConstructElvenEntMoot
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilitySlowDebuff
	Object			= NO
	Options                 = NEED_TARGET_POS
	TextLabel               = CONTROLBAR:LegendsSlowPace
	ButtonImage             = UCEnt_Grab
	RadiusCursorType	= DevastationRadiusCursor
	PresetRange		= 110.0
	CursorName		= AttackObj
	InvalidCursorName	= GenericInvalid
	ButtonBorderType	= ACTION
	DescriptLabel           = CONTROLBAR:ToolTipSlowPace
	InPalantir		= Yes
	Radial			= No
End



CommandSet RhakidWizardCommandSet
	1	= Command_ToggleStance
	2	= Command_CreateAHero_Fireball_Level3
	3	= Command_CreateAHero_BallLightning_L2
	4	= Command_ConstructElvenEntMoot
	5	= Command_CreateAHero_SpecialAbilityAthelas
	12	= Command_CaptureBuilding
	13	= Command_AttackMove
	14	= Command_Stop
	15	= Command_SpecialAbilityElfCloakThranduil
END



ChildObject  RohanMerry	DwarvenGloin
           
	Scale = 0.85

	SelectPortrait	= CPHermit
	ButtonImage	= HICAHHermit
	DisplayName	= Wizard
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
	CommandPoints	= 0
	Side		= Mordor

	RemoveModule Icon

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

; ---------------------- Slow Pace -----------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_CreateAHeroHowlOfRageStarter_Level3
		SpecialPowerTemplate		= SpecialAbilitySlowDebuff
		AttributeModifier		= RhakidWizardDebuff
		AttributeModifierRange		= 300	
		AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MONSTER +HERO
		TriggerFX			= FX_RhakidWizardCastDebuff
		UpdateModuleStartsAttack	= No
;		StartsPaused			= No
		TargetEnemy			= Yes
	End
END

; Fake Weapon for spellcasting animation


AddModule
Behavior = SpecialPowerModule ModuleTag_SlowPaceFakeCastStarter
	SpecialPowerTemplate	 = SpecialAbilityElfCloak
	UpdateModuleStartsAttack = Yes
End
END

AddModule
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SlowPaceFakeCast
	SpecialPowerTemplate = SpecialAbilityElfCloak
	WhichSpecialWeapon	 = 1
	SkipContinue		 = Yes

	UnpackTime		 = 500
	PreparationTime		 = 1   
	PersistentPrepTime	 = 10	
	PackTime		 = 10
	
	AwardXPForTriggering = 0
	
	StartAbilityRange	 = 9999
	MustFinishAbility	 = Yes
	SpecialWeapon		 = SlowPaceFakeWeapon
End
End

;---------------------------------------------------

; ------------------------- HEAL ----------------------

AddModule
	Behavior = PlayerHealSpecialPower ModuleTag_CreateAHeroHealingPower
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroAthelas
		UpdateModuleStartsAttack	= Yes
		HealAffects			= INFANTRY CAVALRY MONSTER
		HealAmount			= 0.6
		HealRadius			= CREATE_A_HERO_HEALING_RADIUS_L2
		HealFX				= FX_ElrondHealSpecialPower; FX_SpellHealUnitHealBuff
	End
END

AddModule
	Behavior = SpecialAbilityUpdate ModuleTag_CreateAHeroHealingUpdate
		SpecialPowerTemplate		= SpecialAbilityCreateAHeroAthelas
		UnpackTime			= 1
		PreparationTime			= 1
		PackTime			= 1
		UnpackingVariation		= 2; 5
	End
END

;-----------------------------------

;------------------- Fireball ------------------

AddModule
Behavior = SpecialPowerModule ModuleTag_FireballStarter_L3
	SpecialPowerTemplate	 = SpecialAbilityHeroFireball_Level3
	UpdateModuleStartsAttack = Yes
End
END

AddModule
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate_L3
	SpecialPowerTemplate = SpecialAbilityHeroFireball_Level3
	WhichSpecialWeapon	 = 1
	SkipContinue		 = Yes

	UnpackTime		 = 800
	PreparationTime		 = 1   
	PersistentPrepTime	 = 1000	
	PackTime		 = 100
	
	AwardXPForTriggering = 0
	
	StartAbilityRange	 = CREATE_A_HERO_FIREBALL_RANGE
	MustFinishAbility	 = Yes
	SpecialWeapon		 = WizardFireballL3
End
End

;--------------------------------------------------


;------------------- Ball Lightning ------------------

AddModule
Behavior = SpecialPowerModule ModuleTag_SpecialAbilityBallLightning_L2
	SpecialPowerTemplate		= SpecialAbilityBallLightning_L2
	UpdateModuleStartsAttack	= Yes
;	StartsPaused			= No
;	InitiateSound			= HeroWizardVoiceAttack
End
END

AddModule
Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BallLightningUpdate_L2
	SpecialPowerTemplate = SpecialAbilityBallLightning_L2
	SkipContinue		= Yes
	UnpackTime		= 1000
	PreparationTime		= 1  
	PersistentPrepTime	= 1000
	PackTime		= 500
	AwardXPForTriggering	= 0
	StartAbilityRange	= CREATE_A_HERO_BALL_LIGHTNING_START_RANGE //	Note: This has to be smaller than the weapon range or it'll	never succeed
	ApproachRequiresLOS	= Yes		 
	SpecialWeapon		= CreateAHerBallLightningWeapon_L2
	MustFinishAbility	= Yes
	WhichSpecialWeapon	= 3
	BusyForDuration		= 2500
End
END

;--------------------------------------------------


AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			= Upgrade_GandalfWhite

;	HideSubObjects		   = AVATAR_HEAD	; Don't lose your head (or uncomment this line)
	HideSubObjects		   = AVEYES		; Eyes effect

	HideSubObjects		   = HLMT_01		; Wizard Hat
;	HideSubObjects		   = HLMT_02		; Hair
	HideSubObjects		   = HLMT_03		; Wizard Hat + Hair
	HideSubObjects		   = HLMT_04		; Headband/Good crown
	HideSubObjects		   = HLMT_05		; Evil Crown
	HideSubObjects		   = HLMT_06		; Mask
	HideSubObjects		   = HLMT_07		; Headband/Good crown + Hair


;	HideSubObjects		   = WIZARDSTAFF01	; Fancy staff black
	HideSubObjects		   = WIZARDSTAFF02	; Druid staff
;	HideSubObjects		   = WIZARDSTAFF03	; Fancy staff shorter, wood
;	HideSubObjects		   = WIZARDSTAFF04	; Macelike staff
;	HideSubObjects		   = WIZARDSTAFF05	; staff

	HideSubObjects		   = SLDR_01		; Rohan Shoulders
	HideSubObjects		   = SLDR_02		; Plate Shoulders

	HideSubObjects		   = WIZSTAFF01_FX01	; Purple Aura 1
	HideSubObjects		   = WIZSTAFF01_FX2	; Purple Aura 2
	HideSubObjects		   = WIZSTAFF01_FX3	; Purple Aura 3
	HideSubObjects		   = WIZSTAFF01_FX4	; Round effect

	HideSubObjects		   = WIZSTAFF02_FX1	; Green Aura

	HideSubObjects		   = WIZSTAFF03_FX01	; Blood Border
	HideSubObjects		   = WIZSTAFF03_FX02	; Blood tip

	HideSubObjects		   = WIZSTAFF04_FX01	; Spiral part 1
	HideSubObjects		   = WIZSTAFF04_FX02	; Spiral part 2
	HideSubObjects		   = WIZSTAFF04_FX03	; Spiral part 3
	HideSubObjects		   = WIZSTAFF04_FX04	; Spiral Tip
	HideSubObjects		   = WIZSTAFF04_FX05	; Spiral Tip
	HideSubObjects		   = WIZSTAFF04_FX06	; Spiral Tip
	HideSubObjects		   = WIZSTAFF04_FX07	; Spiral Tip

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End


	AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = chwz_wd.tga		0 chwz_wd.tga	; Dark costume.
		RecolorHouse		   = No
	End
	End

//================== ANIMATIONS =================================================================

	ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

		DefaultModelConditionState
			Model			= CHWZ_AV_U_SKN
			Skeleton		= CHWZ_YW_U_SKL
;			WeaponLaunchBone	= PRIMARY Bat_HandL
		End

TransitionState = Trans_ExamineWeapon
	Animation = Transition
		AnimationName = CHWZ_YW_C_WPNA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End
TransitionState = Trans_ExamineSelf
	Animation = Transition
		AnimationName = CHWZ_YW_C_CLRA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End
TransitionState = Trans_SelectedCheer
	Animation = Transition
		AnimationName = CHWZ_YW_C_SLCA
		AnimationMode = ONCE
		AnimationBlendTime = 20
	End
End

TransitionState = Trans_SwapModels
	StateName = STATE_Unselected
	Animation = Transition
		AnimationName = CHWZ_YW_C_ATNB CHWZ_YW_C_ATND
		AnimationMode = ONCE
		AnimationBlendTime = 0
	End
End


// --------- UNMOUNTED  ------------

//------------------  DYING -------------------------------------------------------------

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHWZ_YW_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims


AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End


AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHWZ_YW_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------


// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= CHWZ_YW_U_LVLA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= CHWZ_YW_U_SPCA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

//--------------------- Wound Arrow anim
AnimationState        =  SPECIAL_WEAPON_TWO
	StateName = STATE_Bow
	Animation
		AnimationName       = CHWZ_YW_U_SPCL CHWZ_YW_U_ATKC
		AnimationMode       = ONCE
	End
	FrameForPristineBonePositions = 59
	BeginScript
		CurDrawableShowSubObject("arrow")
	EndScript
End
		

//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHWZ_YW_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End


		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHWZ_YW_U_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End



		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHWZ_YW_U_ATKA1 CHWZ_YW_U_ATKA CHWZ_YW_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------


		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHWZ_YW_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHWZ_YW_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= CHWZ_YW_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End

		//	WIZARD BLAST ANIMS MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_TWO MOUNTED
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPLD CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End
	
		//	WIZARD BLAST ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_TWO
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End

		//	ISTARI LIGHT STAFF WEAPON MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_THREE MOUNTED	// FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_SPCD CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		//	ISTARI LIGHT STAFF WEAPON ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_THREE // FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_SPCE CHWZ_YW_U_ATKA//	isitari's light?
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End
		
		; Throwing and cripple strike
		AnimationState		  =	SPECIAL_WEAPON_FOUR
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCD
				AnimationMode =	ONCE
			End
			FrameForPristineBonePositions	= 44
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCE
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCF
				AnimationMode =	ONCE
			End
		End

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHWZ_YW_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHWZ_YW_U_SPCE CHWZ_YW_U_SPCA CHWZ_YW_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 5

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHWZ_YW_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		
		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCB
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 6

		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCD
				AnimationMode =	ONCE
			End
		End


//---------------------- EMOTIONS ---------------------------------------------------------------




		AnimationState				=	EMOTION_CELEBRATING
			Animation CHRA
				AnimationName		=	CHWZ_YW_U_CHRA CHWZ_YW_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHWZ_YW_U_CHRB CHWZ_YW_U_CHRA CHWZ_YW_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation CHRA
				AnimationName		=	CHWZ_YW_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHWZ_YW_U_TNTB CHWZ_YW_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		


//ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHWZ_YW_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
//IDLE
		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHWZ_YW_U_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
			Animation = Foot_IDLC // Bored Fidget
				AnimationName       = CHWZ_YW_U_IBFA
				AnimationMode       = ONCE
				AnimationPriority   = 2
			End
			//Animation = Foot_IDLD // Bored Fidget
			//	AnimationName       = CHWZ_YW_U_IBFB
			//	AnimationMode       = ONCE
			//	AnimationPriority   = 1
			//End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		

	//---transitions--------------------------------------------

		TransitionState = TRANS_BoredToSelectedSword
		// Once we have proper animations for enter -> idle -> exit, fix this properly.
			Animation = ANTD
				AnimationName	= CHWZ_YW_U_ATNA CHWZ_YW_U_ATND CHWZ_YW_U_IDLA
				AnimationMode	= ONCE
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= CHWZ_YW_U_ATNC CHWZ_YW_U_ATNF CHWZ_YW_U_ATNE
				AnimationMode	= ONCE
			End		
		End			

	End		; Draw Module
END			; Replace Module








	WeaponSet
		Conditions					= None
		Weapon						= PRIMARY    CreateAHeroBasicMeleeWeapon
		AutoChooseSources				= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions					= None
		Armor						= RhakidPartyArmor
		DamageFX					= NormalDamageFX
	End
	

	ThreatBreakdown GoblinFighterHorde_DetailedThreat
		AIKindOf = CAVALRY
	End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Voice
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
			VoiceAttack 					= HeroWizardVoiceAttack
			VoiceAttackAir					= HeroWizardVoiceAttack
			VoiceAttackCharge 				= HeroWizardVoiceAttack
			VoiceAttackMachine 				= HeroWizardVoiceAttack
			VoiceAttackStructure 				= HeroWizardVoiceAttack
			VoiceCreated					= HeroWizardVoiceAvatarSalute
			VoiceFear					= HeroWizardVoiceHelpMe
			VoiceFullyCreated				= HeroWizardVoiceAvatarSalute
			VoiceGuard					= HeroWizardVoiceMove
			VoiceMove 					= HeroWizardVoiceMove
			VoiceMoveToCamp 				= HeroWizardVoiceMove
			VoiceMoveWhileAttacking 			= HeroWizardVoiceMove
			VoicePriority					= 95
			VoiceRetreatToCastle 				= HeroWizardVoiceMove
			VoiceSelect 					= HeroWizardVoiceSelectMS
			VoiceSelectBattle  				= HeroWizardVoiceSelectBattle
		
			SoundImpact					= ImpactHorse
		
			UnitSpecificSounds
				VoiceAttackFireball			= HeroWizardVoiceAttack
				VoiceEnterUnitElvenTransportShip	= HeroWizardVoiceMove
				VoiceEnterUnitMordorMumakil		= HeroWizardVoiceMove
				VoiceEnterUnitSlaughterHouse		= HeroWizardVoiceMove
				VoiceEnterUnitTransportShip		= HeroWizardVoiceMove
				VoiceGarrison				= HeroWizardVoiceMove
				VoiceInitiateCaptureBuilding		= HeroWizardVoiceCaptureBuilding
			End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

	KindOf	= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ;ATTACK_NEEDS_LINE_OF_SIGHT CAN_CLIMB_WALLS

	CommandSet  = RhakidWizardCommandSet
	CommandPoints = 0

	LocomotorSet
		Locomotor					= HeroHumanScalingLocomotor
		Condition					= SET_NORMAL
		Speed						= 50
	End

	ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= 4200 
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= 60%	
	End
	End

RemoveModule ModuleTag_GloinHealing

RemoveModule	ModuleTag_SlamStarter

RemoveModule	ModuleTag_ShakeFoundationStarter

RemoveModule	ModuleTag_SmashStarter

	Geometry		= CYLINDER
	GeometryMajorRadius	= 12.0
	GeometryMinorRadius	= 4.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	Shadow			= SHADOW_DECAL
	ShadowSizeX		= 20
	ShadowSizeY		= 20
	ShadowTexture		= ShadowI

;	HealthBoxScale		= 3.0
;	HealthBoxHeightOffset	= 21.0

End



;-----------------------------------------------
; CAPTAIN JARED
;-----------------------------------------------


CommandButton JaredWham
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityWordOfPower
	TextLabel               = CONTROLBAR:WordofPower
	ButtonImage             = Gandolf_radcircle;HSGandalfWordOfPower
	ButtonBorderType        = ACTION 
	DescriptLabel           = CONTROLBAR:ToolTipWordofPower
	AutoAbility		= Yes
	PresetRange		= 120.0
	InPalantir		= Yes
End

CommandSet JaredCommandSet
	1	= Command_ToggleStance
	2	= JaredWham
	12	= Command_CaptureBuilding
	13	= Command_AttackMove
	14	= Command_Stop
End

Armor NewCorsairArmor
  Armor = DEFAULT       15%
  FlankedPenalty =	25%    
End


FXParticleSystem JBigWhamHit
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGimliAxeSpecial.tga
    Lifetime = 25 25
    SystemLifetime = 1
    Size = 13 17
    BurstCount = 3 3
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:243 G:143 B:52 0
    Color2 = R:0 G:0 B:0 25
  End
  Update = DefaultUpdate
    SizeRate = 1.6 1.6
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularDamping = 1 1

    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:8
    EndPoint = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem JBigWhamFlash
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLdrshpLvl2b.tga
    Lifetime = 5 5
    SystemLifetime = 1
    Size = 95 120
    BurstCount = 3 3
  End
  Color = DefaultColor
    Color1 = R:243 G:143 B:52 0
    Color2 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = -2 -2
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:10
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem JBigWhamExplosion
  System
    Priority = VERY_LOW_OR_ABOVE
    IsOneShot = Yes
    Shader = ALPHA
    ParticleName = EXfireballF.tga
    Lifetime = 80 80
    SystemLifetime = 2
    Size = 20 28
    StartSizeRate = 0.1 0.1
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:255 G:255 B:255 10
    Color3 = R:255 G:255 B:255 15
    Color4 = R:0 G:0 B:0 55
    Color5 = R:0 G:0 B:0 60
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.4 0.6 5
    Alpha3 = 0.1 0.3 40
    Alpha4 = 0 0 80
  End
  Update = DefaultUpdate
    SizeRate = 3 7
    SizeRateDamping = 0.8 0.8
    AngleZ = -3 1.5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 0.75 0.75
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0 5
  End
  EmissionVolume = CylinderEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem JBigWhamExplosionGlow
  System
    Priority = VERY_LOW_OR_ABOVE
    IsOneShot = Yes
    ParticleName = EXexplo03.tga
    Lifetime = 50 50
    SystemLifetime = 2
    Size = 15 17
    StartSizeRate = 0.1 0.1
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:215 G:211 B:204 0
    Color2 = R:143 G:134 B:112 20
    Color3 = R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.75 1 5
    Alpha3 = -0.5 0 10
  End
  Update = DefaultUpdate
    SizeRate = 3 6
    SizeRateDamping = 0.8 0.8
    AngleZ = -7 7
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 0.75 0.75
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0 5
  End
  EmissionVolume = CylinderEmissionVolume
  End
  Draw = DefaultDraw
  End
End


FXList FX_JaredBigWham
	ParticleSystem
		Name = JBigWhamHit
	End
	ParticleSystem
		Name = JBigWhamFlash
	End
	ParticleSystem
		Name = JBigWhamExplosion
	End
	ParticleSystem
		Name = JBigWhamExplosionGlow
	End
	TerrainScorch
		Type		= RANDOM
		Weather		= NORMAL
		RandomRange	= X:0 Y:0
		Radius		= 25
	End
	Sound
		Name = DrogothFireballImpactMS
	END
End

Weapon JaredPowerThrust
	IdleAfterFiringDelay	= 0
	AttackRange		= 20
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 501         ; dist/sec 
	MinWeaponSpeed		= 441
	MaxWeaponSpeed		= 601
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	DelayBetweenShots	= 5000
	PreAttackDelay		= 300
	PreAttackType		= PER_ATTACK
	FireFX			= FX_JaredBigWham
	FiringDuration		= 1400
	ClearNuggets ;;.;;

	DamageNugget
		Damage		= 1600
		Radius		= 50.0
		DamageType	= HERO
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 ; must match the ShockWaveSpeed below
	End
	MetaImpactNugget
;		HeroResist	= .75
		ShockWaveAmount   = 125.0
		ShockWaveRadius   = 50.0
		ShockWaveTaperOff = 0.1
		ShockWaveZMult    = 0.5
		ShockWaveSpeed	  = 700.0 
	End
End

Weapon JaredSword; CORSAIR SWORD > CAPTAIN JARED
  LeechRangeWeapon      = Yes
  AttackRange           = STANDARD_MELEE_ATTACK_RANGE
  MeleeWeapon           = Yes
  DelayBetweenShots     = ELROND_DELAYBETWEENSHOTS
  PreAttackDelay        = ELROND_PREATTACKDELAY
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  FireFX                = FX_GondorSwordHit
  FiringDuration        = ELROND_FIRINGDURATION

  DamageNugget
    Damage        = 450	; 900 was a lot, now it's been reduced because he has improved armor now (should take about half damage as before)
    Radius        = 20.0
    DelayTime     = 0
    DamageType    = HERO
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End

  MetaImpactNugget
    HeroResist			= .80
    ShockWaveAmount		= 25.0
    ShockWaveRadius		= 8
    ShockWaveArc		= 120
    ShockWaveTaperOff = 1
  End

End

ChildObject RohanEomer MordorCorsairsOfUmbar					; JARED
	SelectPortrait         = UPMordor_Corsair

	LocomotorSet					; To fix corsair not rotating while moving
		Locomotor     = HumanLocomotor
		Condition     = SET_NORMAL
		Speed         = NORMAL_MORDOR_FAST_MEMBER_SPEED
	End

RemoveModule ModuleTag_01

AddModule
	Behavior = SpecialPowerModule ModuleTag_WordStarter       
		SpecialPowerTemplate      	= SpecialAbilityWordOfPower
		UpdateModuleStartsAttack  	= Yes
	End
END
AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WordWeaponFireUpdate   
		SpecialPowerTemplate    	= SpecialAbilityWordOfPower
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes

		UnpackTime              	= 1
		PreparationTime			= 1000
		PersistentPrepTime		= 600
		PackTime                	= 4500
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
		
		AwardXPForTriggering    	= 0		
		StartAbilityRange		= 80.0
		
		SpecialWeapon			= JaredPowerThrust
	End
END

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_01New
		OkToChangeModelColor = Yes	
		StaticModelLODMode = Yes
		WadingParticleSys = WaterRipplesTrail  ; used when the unit is wading in shallow water.

		DefaultModelConditionState
			Model							= MUCorsar_SKN
			Skeleton						= MUCorsar_SKL
;			Model							= MUCorsar2_SKN  ExtraMesh:Yes
;			Model							= MUCorsai3_SKN  ExtraMesh:Yes
;			Model							= MUCorsar4_SKN  ExtraMesh:Yes
;			Model							= MUCorsar_SKN ExtraMesh:Yes
			WeaponLaunchBone				= PRIMARY B_HANDR
			WeaponLaunchBone				= TERTIARY B_HANDR
		End

;		ModelConditionState = USER_4		; This state is used in cinematics to get the old style armor
;			Model							= GUNumnrean_SKN	
;			Skeleton						= MUCorsar_SKL
;		End

;;=============== ANIMATIONS ===============================================================


//========== WALL CLIMBING =====================

	AnimationState						= CLIMBING
		StateName						= STATE_Climbing
		Animation						= Climbing
			AnimationName				= MUCorsar_WALB
			AnimationMode				= LOOP
			AnimationBlendTime			= 10
		End
		BeginScript;script to set transition from moving
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing") return end
		EndScript
	End
	AnimationState						= RAPPELLING

		StateName						= STATE_Rappelling
		Animation						= Rapelling
			AnimationName				= MUCorsar_WALD
			AnimationMode				= LOOP
			AnimationBlendTime			= 10
		End
	End
	TransitionState = Trans_RunningToClimbing
		Animation = Transition
			AnimationName = MUCorsar_WALA
			AnimationMode = ONCE
		End
	End
	TransitionState = Trans_ClimbingToRunning
		Animation = Transition
			AnimationName = MUCorsar_WALC
			AnimationMode = ONCE
		End
	End
	TransitionState = Trans_RappellingToRunning
		Animation = Transition
			AnimationName = MUCorsar_WALE
			AnimationMode = ONCE
		End
	End





;;======= FALLING & FLYING

		AnimationState						= PASSENGER
			Animation						= Grabbed
				AnimationName				= MUCorsar_FLLA
				AnimationMode				= LOOP
			End
		End
		
		AnimationState        				= THROWN_PROJECTILE
			Animation           			= FlyA
				AnimationName      	 		= MUCorsar_FLYA
				AnimationMode       		= LOOP
			End
			Flags               			= RANDOMSTART
		End
		
		AnimationState						= FREEFALL
			Animation						= Falling
				AnimationName				= MUCorsar_FLYA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
			End
		End

		
		
		AnimationState        				= STUNNED_FLAILING 
			Animation           			= FlyA
				AnimationName       		= MUCorsar_FLYA
				AnimationMode       		= LOOP
			End
			Flags               			= RANDOMSTART
		End

		AnimationState			= DYING BURNINGDEATH
			Animation
				AnimationName	= MUCorsar_DIEB
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
			Animation
				AnimationName	= MUCorsar_DIEC
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
		End

		AnimationState 						= DYING SPLATTED
			Animation 						= Splatted_On_Ground
				AnimationName 				= MUCorsar_LNDA
				AnimationMode 				= ONCE
			End
			EnteringStateFX					= FX_OrcHitGround
		End

		AnimationState						= DYING AFLAME
			Animation						= MFDA
				AnimationName				= MUCorsar_MFDA
				AnimationMode				= LOOP
			End
		End

		
		AnimationState						= DYING
			;Animation						= DIEA
			
			;	AnimationName				= MUCorsar_DIEA
			;	AnimationMode				= ONCE
			;End
			Animation						= DIEB
				AnimationName				= MUCorsar_DIEB
				AnimationMode				= ONCE
			End
			Animation						= DIEC
				AnimationName				= MUCorsar_DIEC
				AnimationMode				= ONCE
			End
		End

		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= MUCorsar_MFDA
				AnimationMode	= LOOP
				Distance		= 110
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= MUCorsar_IDLB
				AnimationMode				= LOOP
			End
		End

;;======= LANDING & STANDING

		AnimationState						= STUNNED_STANDING_UP
			Animation						= GTPA
				AnimationName				= MUCorsar_GTPA
				AnimationMode				= ONCE
;				AnimationSpeedFactorRange = 1.5 1.5
			End
		End


	
		AnimationState			=	 STUNNED
			Animation			=	 Slatted_On_Ground
			AnimationName 				= MUCorsar_LNDA
				AnimationMode 				= ONCE
			End
			EnteringStateFX					= FX_OrcHitGround

		End 
		
		
		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = RunAndFire
				AnimationName       = MUCorsar_ATRA
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART  
		End
		
;;====== TERROR
		
		AnimationState						= MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
			Animation					= TerrorFromTheSky
				AnimationName			= MUCorsar_RUNE
				AnimationMode			= LOOP
			End
			Flags = RANDOMSTART
		End

		AnimationState						= MOVING EMOTION_TERROR
			Animation						= TerrorFromTheSky
				AnimationName				= MUCorsar_RUNE
				AnimationMode				= ONCE
			End
			Flags							= RESTART_ANIM_WHEN_COMPLETE
		End
		
;;======= BACK UP

		
		AnimationState						= MOVING BACKING_UP
			Animation						= BAKA
				AnimationName				= MUCorsar_BAKA
				AnimationMode				= LOOP
			End
			Animation						= BAKB
				AnimationName				= MUCorsar_BAKB
				AnimationMode				= LOOP
			End
			Flags = RANDOMSTART
		End

		AnimationState						= MOVING PANICKING
			;@@@KM - Add Distance
			Animation						= MFDA
				AnimationName				= MUCorsar_MFDA
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
		End
		
		AnimationState						= MOVING ATTACKING
			ShareAnimation					= Yes;
			Animation						= RUNA
				AnimationName				= MUCorsar_RUNC
				AnimationMode				= LOOP
			End
			Animation						= RUNA
				AnimationName				= MUCorsar_RUND
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
		End
		
		AnimationState						= MOVING
			ShareAnimation					= Yes;
			Animation						= RUNB
				AnimationName				= MUCorsar_RUNA
				AnimationMode				= LOOP
			End
			Animation						= RUNC
				AnimationName				= MUCorsar_RUNB
				AnimationMode				= LOOP
			End
			Flags							= RANDOMSTART
			;ParticleSysBone				= None InfantryDustTrails
			
			BeginScript;script to set transition into moving
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRunning") return end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

;;======= UNCONTROLLABLY AFRAID
	; This is before Attacking so it overrides it.  Normal fear is below so you don't go to little-fear in between swings.
		AnimationState						= EMOTION_UNCONTROLLABLY_AFRAID
			Animation						= FERA
				AnimationName				= MUCorsar_FERA
				AnimationMode				= LOOP
			End 
		End
; ------------- JARED WHAM ----------

		AnimationState						= SPECIAL_WEAPON_ONE UNPACKING
			Animation
				AnimationName = MUCorsar_CHRA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationSpeedFactorRange	=	1 1
			End
		End

		AnimationState						= SPECIAL_WEAPON_ONE PREPARING
			Animation
				AnimationName = MUCorsar_CHRA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationSpeedFactorRange	=	1 1
			End
		End

		AnimationState						= SPECIAL_WEAPON_ONE PACKING
			Animation
				AnimationName = MUCorsar_CHRC
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange	=	1 1
			End
		End


;;---------------------- ATTACKING ----------------------------------------------------------------
		AnimationState						= FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1		; fire bomb attack
			Animation
				AnimationName				= MUCorsar_ATKE
				AnimationMode				= ONCE
				;UseWeaponTiming				= Yes
				AnimationSpeedFactorRange	= 2.4 2.4		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
			End
			FrameForPristineBonePositions	= 41
		End
		
		AnimationState						= FIRING_OR_PREATTACK_C 		; fire bomb attack bombard
			Animation
				AnimationName				= MUCorsar_ATKE
				AnimationMode				= ONCE
				;UseWeaponTiming				= Yes
				AnimationSpeedFactorRange	= 2.4 2.4		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
			End
			FrameForPristineBonePositions	= 41
		End
		
		AnimationState						= FIRING_OR_PREATTACK_A							; knife attack
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKA
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKB
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKC
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			Animation						= ATA1
				AnimationName				= MUCorsar_ATKD
				AnimationMode				= ONCE
				UseWeaponTiming				= Yes
			End
			;ParticleSysBone				= None MeleeDust
		End
		
;;----------------- HIT REACTIONS -------------------------------------------------------------------------

;		AnimationState						= HIT_REACTION
;			Animation						= HITA
;				AnimationName				= MUCorsar_HITA
;				AnimationMode				= ONCE
;			End
;		End

;;----------------- EMOTIONS ----------------------------------------------------------------
;;======= APPREHENSIVE

;		AnimationState						= EMOTION_ALERT EMOTION_AFRAID
;			Animation						= APPA
;				AnimationName				= MUCorsar_APPA
;				AnimationMode				= ONCE
;			End
;			Animation						= APPB
;				AnimationName				= MUCorsar_APPB
;				AnimationMode				= ONCE
;			End
;			Flags							= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
;		End
		
;;======= AFRAID

		AnimationState						= EMOTION_AFRAID
			Animation						= FERA
				AnimationName				= MUCorsar_FERA
				AnimationMode				= LOOP
			End 
		End

		AnimationState						= ATTACKING								; attacking after afraid.
			Animation						= ALERT_1
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP
			End
		End

;;======== POINTING

		AnimationState						= EMOTION_POINTING
			Animation						= Pointing1
				AnimationName				= MUCorsar_PNTA
				AnimationMode				= LOOP
			End
			Animation						= Pointing1
				AnimationName				= MUCorsar_PNTB
				AnimationMode				= LOOP
			End
		End

;;======= TAUNTING

		AnimationState						= EMOTION_TAUNTING
			Animation						= Taunting1
				AnimationName				= MUCorsar_TNTA
				AnimationMode				= ONCE
			End
			Animation						= Taunting2
				AnimationName				= MUCorsar_TNTB
				AnimationMode				= ONCE
			End
			Animation						= Taunting3
				AnimationName				= MUCorsar_TNTC
				AnimationMode				= ONCE
			End
			Animation						= Taunting5
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= ONCE
			End
			Flags							= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

;;======= CELEBRATING

		AnimationState						= EMOTION_CELEBRATING
			Animation						= CHRB
				AnimationName				= MUCorsar_CHRA
				AnimationMode				= ONCE
			End
			Animation						= CHRC
				AnimationName				= MUCorsar_CHRB
				AnimationMode				= ONCE
			End
			Animation						= IDLD
				AnimationName				= MUCorsar_CHRC
				AnimationMode				= ONCE
			End
			Flags							=	RESTART_ANIM_WHEN_COMPLETE
		End
		
;;----------------- ALERT STATE ---------------------------------------------------------------------------

		AnimationState						= EMOTION_ALERT
			Animation						= ALERT_1
				AnimationName				= MUCorsar_IDLA
				AnimationMode				= LOOP;ONCE
				AnimationPriority			= 10
			End
			Flags							= RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
		End
		
		AnimationState						= RAISING_FLAG
			Animation						= CHRB
				AnimationName				= MUCorsar_CHRA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Animation						= CHRC
				AnimationName				= MUCorsar_CHRB
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Animation						= IDLD
				AnimationName				= MUCorsar_CHRC
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.9 1.1
			End
			Flags							=	RESTART_ANIM_WHEN_COMPLETE
		End
	

;;----------------- SELECTED STATES -----------------------------------------------------------------------
		AnimationState        = SELECTED
			StateName           = STATE_Selected
			Animation           = ATNB
				AnimationName     = MUCorsar_ATNB
				AnimationMode     = LOOP
			End
			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" 
				then 
					CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") 
				end
				if CurDrawableModelcondition("ATTACKING")
				then
					return "IDLA"
				else
					return "ATNA"
				end
			EndScript
			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
			EndScript
		End
		
;;----------------- IDLE STATES ---------------------------------------------------------------------------
		AnimationState				= WEAPONSET_PLAYER_UPGRADE
			StateName				= STATE_Idle
			Animation				= IDLI
				AnimationName       = MUCorsar_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= IDLD
				AnimationName       = MUCorsar_IDLC
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= IDLH
				AnimationName       = MUCorsar_IDLD
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Animation				= CHRB
				AnimationName       = MUCorsar_IDLE
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
			End
			Flags					= RESTART_ANIM_WHEN_COMPLETE			
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
			EndScript
		End		
		
;		AnimationState				= USER_3
;			StateName				= STATE_User_3
;			Animation				= GUARD_STANCE
;				AnimationName		= MUCorsar_IDLA
;				AnimationMode		= LOOP
;			End
;		End

		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLB
				AnimationName       = MUCorsar_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLF
				AnimationName       = MUCorsar_IDLC
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLG
				AnimationName       = MUCorsar_IDLD
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLJ
				AnimationName       = MUCorsar_IDLE
				AnimationMode       = ONCE
				AnimationPriority   = 3
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
			EndScript
		End
;;--------------- TRANSITIONS ---------------------------------------------------------------------------
		TransitionState       = TRANS_TO_USER_1
			Animation
				AnimationName     = MUCorsar_RCTA
				AnimationMode     = ONCE
			End
		End
		TransitionState       = TRANS_IdleToSelected
			Animation           = ATNA
				AnimationName     = MUCorsar_ATNA
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.8 1.0
				
			End
		End
		TransitionState		= TRANS_SelectedToIdle
			Animation			= ATND
				AnimationName	= MUCorsar_ATNC
				AnimationMode	= ONCE
				AnimationSpeedFactorRange = 0.8 1.0
			End
		End
	End
END ;AddModule ends
	
	Side = Mordor
	EditorSorting = UNIT
	ThreatLevel = 1.0
	ThingClass = HORDE_UNIT
	CommandPoints = 4
	BountyValue = GONDOR_SOLDIER_BOUNTY_VALUE

	TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
	
	;;; ARMOUR SETS ;;;
	ArmorSet
		Conditions      = None
		Armor           = NewCorsairArmor
		DamageFX        = NormalDamageFX
	End
	
	VisionRange = 320 ; ; VISION_STANDARD_MELEE
	ShroudClearingRange = 250 ; ; SHROUD_CLEAR_STANDARD
		
	VisionSide = 50%
	VisionRear = 25%
	VisionBonusPercentPerFoot = 1.0%			

	DisplayName = OBJECT:OathBreaker
	CrushableLevel = 0  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CrushRevengeWeapon = BasicInfantryCrushRevenge
	
	CommandSet = JaredCommandSet


	; *** AUDIO Parameters ***;

	VoiceAttack								= CorsairVoiceAttack
	VoiceAttackCharge						= CorsairVoiceAttackCharge
	VoiceAttackMachine						= CorsairVoiceAttack
	VoiceAttackStructure					= CorsairVoiceAttackBuilding
	VoiceCreated							= EVA:CorsairsCreated
	VoiceFullyCreated						= EVA:CorsairsCreated
	VoiceGuard								= CorsairVoiceMove
	VoiceMove								= CorsairVoiceMove
	VoiceMoveOverWalls						= CorsairVoiceMoveWalls
	VoiceMoveToCamp							= CorsairVoiceMoveCamp
	VoiceMoveWhileAttacking					= CorsairVoiceDisengage
	VoicePriority							= 53
	VoiceRetreatToCastle					= CorsairVoiceRetreat
	VoiceSelect								= CorsairVoiceSelectMS
	VoiceSelectBattle 						= CorsairVoiceSelectBattle

	VoiceEnterStateAttack					= CorsairVoiceEnterStateAttack
	VoiceEnterStateAttackCharge				= CorsairVoiceEnterStateAttackCharge
	VoiceEnterStateAttackMachine			= CorsairVoiceEnterStateAttack
	VoiceEnterStateAttackStructure			= CorsairVoiceEnterStateAttackBuilding
	VoiceEnterStateMove						= CorsairVoiceEnterStateMove
	VoiceEnterStateMoveOverWalls			= CorsairVoiceEnterStateMoveWalls
	VoiceEnterStateMoveToCamp				= CorsairVoiceEnterStateMoveCamp
	VoiceEnterStateMoveWhileAttacking		= CorsairVoiceEnterStateDisengage
	VoiceEnterStateRetreatToCastle			= CorsairVoiceEnterStateRetreat

	SoundImpact								= ImpactHorse

	UnitSpecificSounds
		VoiceCreatedFromInn					= EVA:CorsairsCreated-Inn
		VoiceEnterUnitEvilMenTransportShip	= CorsairVoiceMoveShip
		VoiceEnterUnitMordorMumakil			= CorsairVoiceMoveGarrison
		VoiceEnterUnitSlaughterHouse		= CorsairVoiceMoveGarrison
		VoiceFullyCreatedFromInn			= EVA:CorsairsCreated-Inn
		VoiceGarrison						= CorsairVoiceMoveGarrison
		VoiceInitiateCaptureBuilding		= CorsairVoiceCaptureBuilding
	End
	CrowdResponseKey = EvilMen1

	RadarPriority = UNIT

	KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT NOTIFY_OF_PREATTACK GRAB_AND_DROP CAN_CLIMB_WALLS

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 10000
		MaxHealthDamaged  = 5000
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
END
		
	Geometry = CYLINDER
	GeometryMajorRadius = 8.0
	GeometryMinorRadius = 8.0
	GeometryHeight = 19.2
	GeometryIsSmall = No
	HealthBoxScale		= 5.0
	HealthBoxHeightOffset	= 3.0

    Shadow = SHADOW_DECAL
    ShadowSizeX = 19;
    ShadowSizeY = 19;
    ShadowTexture = ShadowI;

    	WeaponSet
		Conditions			= None 
		Weapon			= PRIMARY    JaredSword
		AutoChooseSources		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

    AddModule ModuleTag_MakeBossLoadsOfTreasure 	
	  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
		CreationList			= OCL_BossChest
	  End
    End

End


;------------------------------------

Weapon WildMountainGiantPunch1 ; GOBLIN MOUNTAIN GIANT (GOLEM) PUNCH 1
  DamageNugget
	Damage = 1800
END
END

Weapon WildMountainGiantPunch2 ; GOBLIN MOUNTAIN GIANT (GOLEM) PUNCH 2
  DamageNugget
	Damage = 1700
END
END
 
Weapon WildMountainGiantPunch3 ; GOBLIN MOUNTAIN GIANT (GOLEM) PUNCH 3 (Kick?)
  DamageNugget
	Damage = 2200
END
END

Weapon GiantRockThrow ; MOUNTAIN GIANT (GOLEM) ROCK THROW
  DamageNugget
	Damage = 2000
END
END

Weapon WildMountainGiantStompNew
	IdleAfterFiringDelay = 0
	AttackRange = WILD_MOUNTAIN_GIANT_STOMP_RADIUS
	MinimumAttackRange = 0.8
	WeaponSpeed = 401         ; dist/sec 
	MinWeaponSpeed = 241
	MaxWeaponSpeed = 601      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	ScaleWeaponSpeed = Yes ; Used for lob weapons, scales speed proportional to range
	RadiusDamageAffects = ENEMIES NOT_SIMILAR
	DelayBetweenShots = 5000               ; time between shots, msec
	PreAttackDelay        = 2600
	PreAttackType         = PER_ATTACK ; Do the delay each time we attack a new target
	PreAttackFX           = FX_GandalfPreAttackBlast
	FireFX                = FX_GiantStomp
	FiringDuration      = 1400
	ClearNuggets ;;.;;
	DamageNugget                        ; A basic Nugget that just does damage
		Damage			= 400 ; 1000
		Radius			= WILD_MOUNTAIN_GIANT_STOMP_RADIUS
		DamageType		= FORCE
		DeathType		= NORMAL
		DamageSpeed		= 200.0 ; must match the ShockWaveSpeed below
	End
	MetaImpactNugget                    ; A Nugget that throws things back with force
;		HeroResist			= .75
		ShockWaveAmount   = 67.0 ; CreateAHero has resistance of 65
		ShockWaveRadius   = WILD_MOUNTAIN_GIANT_STOMP_RADIUS
		ShockWaveTaperOff = 0.5
        	ShockWaveZMult	  = 0.2
		ShockWaveSpeed	  = 200.0 
	End
End

Armor GolemGuardianArmor
	Armor = DEFAULT		18%
	Armor = HERO		18%
	Armor = FLAME		5%
	Armor = HERO_RANGED	18% 
	Armor = MAGIC		75%   ; Weakness to magic
End



FXParticleSystem MudDrop
  System
    Priority		= MEDIUM_OR_ABOVE
    Shader		= ALPHA_TEST
    ParticleName	= EXTaint.tga ;EXFlake01.tga ;EXWoodChip01.tga
    Lifetime		= 20 50
;    SystemLifetime	= 3
    Size		= 0.6 2
    BurstDelay		= 4 4
    BurstCount		= 3 6
  End
  Color = DefaultColor
    Color1 = R:200 G:200 B:200 0
    ColorScale = -5 5
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    AngleZ = -7 7
;    AngularRateZ = -0.9 0.9
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.1
    VelocityDamping = 0.99 0.99
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.6 0.6
;    Y = -1.7 1.7
;    Z = 1 4
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:-14 Z:40
    EndPoint = X:0 Y:14 Z:40
  End
  Draw = DefaultDraw
  End
End

FXList MudDropFX
	PlayEvenIfShrouded = Yes 
	ParticleSystem
		Name = MudDrop
		AttachToObject	= Yes
		Offset = X:0.0 Y:0 Z:30.0
	End
;	ParticleSystem
;		Name = MudDrop
;		AttachToObject	= Yes
;		Offset = X:0.0 Y:0 Z:30.0
;	End
End

ModifierList MudDropFXAttributeModifier
	Category = WEAPON
;	Duration = 999999999 			; Permanent
;	FX = MudDropFX
End




Object WildMountainGiant					;GOLEM GUARDIAN

	SelectPortrait	= NONE
	DisplayName = OBJECT:DwarvenGuardian ; Guardian
	ShockwaveResistance = 99 ; Enough to resist Wizardblast's shockwave and the Whirlwind

	ArmorSet
		Conditions      = None
		Armor           = GolemGuardianArmor
		DamageFX        = MudGolemDamageFX
	End

	VoiceAttack			= EntVoiceSelect
	VoiceAttackCharge		= EntVoiceSelect
	VoiceAttackMachine		= EntVoiceSelect
	VoiceAttackStructure		= EntVoiceSelect
	VoiceCreated			= EntVoiceSelect
	VoiceFullyCreated		= EntVoiceSelect
	;VoiceFear			= EntPanic
	VoiceGuard			= EntVoiceSelect
	VoiceMove			= EntVoiceSelect
	VoicePriority			= 35
	VoiceSelect			= EntVoiceSelect
	VoiceSelectBattle		= EntVoiceSelect

;AddModule
;	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
;		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
;	End 
;End

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_MudDropper
	TriggeredBy 		= Upgrade_GandalfWhite
	AttributeModifier 	= MudDropFXAttributeModifier
	End
  END

ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_BodyNew
		CheerRadius 		= EMOTION_CHEER_RADIUS
    		MaxHealth		= 1650                   
    		MaxHealthDamaged	= 1000
    		MaxHealthReallyDamaged	= 500
  	End
END

ReplaceModule ModuleTag_50
	Behavior = SlowDeathBehavior ModuleTag_50New
		DeathTypes		= ALL -FADED
		DestructionDelay	= 13000
;		DecayBeginTime		= 10000			; Commented out, so there's no skeleton
		SinkDelay		= 3000
		SinkRate		= 0.50							; in Dist/Sec
		Sound			= INITIAL EntVoiceSelect
		DeathFlags		= DEATH_1						; Controls animation and weapon choice. Sets BOTH model condition and object status bits.
	End
END

ReplaceModule ModuleTag_StompWeaponFireUpdate   
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_StompWeaponFireUpdateNew 
		SpecialPowerTemplate    = SpecialAbilityWildMountainGiantStomp
		WhichSpecialWeapon		= 2		; SPECIAL_WEAPON_TWO
		SkipContinue			= Yes

		UnpackTime              = 1367		//Frames 1-41 (of 97)
		PackTime                = 1867		//Remaining frames 41-97
		;FreezeAfterTriggerDuration = 2500 ; Hold AI for this long after we fire.
		
		AwardXPForTriggering    = 0		
		StartAbilityRange		= 80.0
		
		SpecialWeapon			= WildMountainGiantStompNew
	End
END

ReplaceModule ModuleTag_04
	Behavior = PhysicsBehavior ModuleTag_04New
		GravityMult = 2.0
		ShockStandingTime =	3600	; tuned to mountain giant's GTPA anim
	End
END

	GeometryMajorRadius	= 13.0	; 15
;	GeometryMinorRadius	= 10.0
	GeometryHeight		= 20	; 56.0
;	PathfindDiameter	= 30.0

	HealthBoxScale		= 40.0
	HealthBoxHeightOffset	= 18.0

END



;-------------------------------------------------

Armor GolemBossArmor
	Armor = DEFAULT       	18%
	Armor = MAGIC         	100% 		; Magic is their weakness! (balance this value)
	Armor = HERO          	18%
	Armor = HERO_RANGED   	18%   
	FlankedPenalty	= 50%      
End

Weapon StoneGolemPunch ; Stone Golem Boss Punch
	ClearNuggets ;;.;;
  LeechRangeWeapon	= Yes
  RadiusDamageAffects	= ENEMIES 
  AttackRange           = 8.5 ;11.5 - Changed because there was a bug of the Golem Boss hitting but not doing damage.
  MeleeWeapon           = Yes
  DelayBetweenShots     = MORDOR_TROLL_PUNCH_DELAYBETWEENSHOTS
  FiringDuration        = MORDOR_TROLL_PUNCH_FIRINGDURATION
  PreAttackDelay        = MORDOR_TROLL_PUNCH_PREATTACKDELAY
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  PreAttackFX          	= FX_TrollTreeSwing
  FireFX               	= FX_TrollPunchGeneric
  DamageDealtAtSelfPosition = Yes ; A melee based AoE.  Arc radiates from me, not them
  AcceptableAimDelta	= 15.0 
  DamageNugget                        ; A basic Nugget that just does damage
    Damage		= 700 ; 1100 was too strong, added some HP to compensate
    Radius		= 50.0
    DamageArc		= 45
    DamageType		= SIEGE
    DamageFXType	= CLUBBING
    DeathType		= NORMAL
  End
  MetaImpactNugget                    ; A Nugget that throws things back with force
    ShockWaveAmount	= 75.0
    ShockWaveRadius	= 40.0
    ShockWaveTaperOff	= 0.9
    ShockWaveArc	= 45
    ShockWaveZMult	= 1
    HeroResist		= 0.90		; Heroes resist the meta-impact 90% of the time
  End
End

Object MordorMountainTroll					; GOLEM BOSS

	KindOf			= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT NO_FREEWILL_ENTER PATH_THROUGH_INFANTRY SCARY CAN_ATTACK_WALLS HEAVY_MELEE_HITTER ARMY_SUMMARY ; TROLL_BUFF_NUGGET MONSTER 

	ShockwaveResistance	= 999 ; Enough to resist Whirlwind
	DisplayName		= OBJECT:DwarvenGuardian ; Golem
	Scale			= 1.28

	ArmorSet
		Conditions      = None
		Armor           = GolemBossArmor
		DamageFX        = MudGolemDamageFX
	End

	WeaponSet
		Conditions      = None
		Weapon          = PRIMARY	StoneGolemPunch 
		Weapon          = SECONDARY	MordorCaveTrollBash
		OnlyAgainst     = SECONDARY	STRUCTURE BLOCKING_GATE
		Weapon		= TERTIARY	StoneGolemPunch
		OnlyInCondition	= TERTIARY	MOVING
	End

;AddModule 									;Removed for aesthetical reasons
;	  Behavior = CreateObjectDie ModuleTag_MakeBossLoadsOfTreasure
;		CreationList			= OCL_BossChest
;	  End
;End

RemoveModule ModuleTag_TrollHealing

ReplaceModule ModuleTag_02
	Body = DelayedDeathBody ModuleTag_02New
		CheerRadius 		= EMOTION_CHEER_RADIUS
    		MaxHealth		= 18500 ; 1500                   
    		MaxHealthDamaged	= 10000
    		MaxHealthReallyDamaged	= 2000
		DoHealthCheck		= No			; Don't want to get the delayed death behaviour when we die normally.
		DelayedDeathTime	= 5000
		CanRespawn		= No			; Unit can't get revived.
  	End
END


ReplaceModule ModuleTag_50
	Behavior = SlowDeathBehavior ModuleTag_50New
		DeathTypes		= ALL -FADED
		DestructionDelay	= 3000				; So that it dissappears before the Aegion-talk cinematic
;		DecayBeginTime		= 0
		SinkDelay		= 2000
		SinkRate		= 2.90				; in Dist/Sec
		Sound			= INITIAL TrollDie
		ProbabilityModifier	= 50 ;50
		DeathFlags		= DEATH_1			; Tell model which death animation to play. Sets BOTH model condition and object status bits.
	End
END

RemoveModule ModuleTag_MordorMtTrollBoredAbility
RemoveModule ModuleTag_MordorMtTrollBored

	GeometryMajorRadius = 18.0
	GeometryMinorRadius = 12.0
	PathfindDiameter = 12.0

	HealthBoxScale		= 150.0
;	HealthBoxHeightOffset	= -15.0

END





;----------------
;Evil Hero Party
;----------------

Object IsengardLurtz
	DisplayName = OBJECT:MordorFighter
END

Object IsengardWormTongue
	DisplayName = OBJECT:MordorFighter
END

Object GondorDamrod
	DisplayName = OBJECT:MordorFighter
END

Weapon FaramirSword
	DamageNugget
	Damage = 2000
	END
END

Object IsengardGrima
	DisplayName = OBJECT:MordorFighter
END

Weapon BoromirSword
	DamageNugget
	Damage = 2000
	END
END



;-------------------------------------------------------------------------------
;SPELLS MODDED
;-------------------------------------------------------------------------------

SpecialPower SpellBookHeal
	InitiateAtLocationSound 	= SpellHeal
	Enum                		= SPECIAL_SPELL_BOOK_HEAL
	Flags				= WATER_OK RESPECT_RECHARGE_TIME_DISCOUNT
	ReloadTime         		= 1
	RequiredSciences     		= SCIENCE_Heal
	RadiusCursorRadius  		= 300	
End

;-------------------------------------------------------------------------------
;(015) NEW HERO SKILLS AND BALANCING
;-------------------------------------------------------------------------------

;-------
;CAPTAIN OF GONDOR
;-------

SpecialPower SpecialAbilityCreateAHeroStarlight
	Enum									  =	SPECIAL_GENERAL_TARGETLESS_THREE
	ReloadTime								  =	180000 ; From 180000
End

SpecialPower SpecialAbilityCreateAHeroAthelas
	Enum  			=	SPECIAL_ATHELAS
	ReloadTime 	 	=	100000 ;Changed from 90000 (since 1.06 has much stronger athelas)
	PublicTimer		=	No
	RadiusCursorRadius	=	350.0
End


SpecialPower SpecialAbilityCreateAHeroShieldCrush_Level1
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	40000 ;Changed from 180000
End

SpecialPower SpecialAbilityCreateAHeroShieldCrush_Level2
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	50000
End

SpecialPower SpecialAbilityCreateAHeroShieldCrush_Level3
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	50000
End

SpecialPower SpecialAbilityCreateAHeroHotWCrippleStrikeMelee_Level1
	Enum		=	SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	=	45000
	PublicTimer	=	No
	ObjectFilter	= ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End


SpecialPower SpecialAbilityCreateAHeroHotWCrippleStrikeMelee_Level2
	Enum		=	SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	=	45000
	PublicTimer	=	No
	ObjectFilter	= ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroAThrowSpear_Level1
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 70000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroThrowSpear_Level2
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 70000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroThrowSpear_Level3
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 70000
	PublicTimer		= No
End

;-------
;ELVES
;-------

SpecialPower SpecialAbilityCreateAHeroHealing_Level1
	Enum		= SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime	= 130000 ;Changed from 60000
	PublicTimer	= No
End

SpecialPower SpecialAbilityCreateAHeroHealing_Level2
	Enum		= SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime	= 130000
	PublicTimer	= No
End

SpecialPower SpecialAbilityCreateAHeroRainOfArrows_Level1
	Enum			= SPECIAL_ARROW_STORM
	ReloadTime		= 120000
	PublicTimer		= No
	RadiusCursorRadius	= 120.0
	ViewObjectDuration	= 5000
	ViewObjectRange		= 120
	Flags			= WATER_OK
End

SpecialPower SpecialAbilityCreateAHeroRainOfArrows_Level2
	Enum			= SPECIAL_ARROW_STORM
	ReloadTime		= 120000
	PublicTimer		= No
	RadiusCursorRadius	= 120.0
	ViewObjectDuration	= 5000
	ViewObjectRange		= 120
	Flags			= WATER_OK
End

SpecialPower SpecialAbilityCreateAHeroRainOfArrows_Level3
	Enum			= SPECIAL_ARROW_STORM
	ReloadTime		= 120000
	PublicTimer		= No
	RadiusCursorRadius	= 120.0
	ViewObjectDuration	= 5000
	ViewObjectRange		= 120
	Flags			= WATER_OK
End



SpecialPower SpecialAbilityCreateAHeroCrippleStrikeRanged_Level1
	Enum		 = SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	 = 45000
	PublicTimer	 = No
	ObjectFilter = ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroCrippleStrikeRanged_Level2
	Enum		 = SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	 = 45000
	PublicTimer	 = No
	ObjectFilter = ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroCrippleStrikeRanged_Level3
	Enum		 = SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	 = 45000
	PublicTimer	 = No
	ObjectFilter = ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroCrippleStrikeRanged_Level4
	Enum		 = SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	 = 45000
	PublicTimer	 = No
	ObjectFilter = ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialPowerCreateAHeroSpawnTornado_Level1
	Enum			= SPECIAL_SPAWN_TORNADO
	ReloadTime		= 120000 ; Changed from 240000
	PublicTimer		= No
	RadiusCursorRadius	= 70.0
	ViewObjectRange		= 200 ; how far from hero the spell can be cast
	Flags			= WATER_OK
End

SpecialPower SpecialPowerCreateAHeroSpawnTornado_Level2
	Enum			= SPECIAL_SPAWN_TORNADO
	ReloadTime		= 130000 ; in milliseconds
	PublicTimer		= No
	RadiusCursorRadius	= 70.0
	ViewObjectRange		= 200
	Flags			= WATER_OK
End

SpecialPower SpecialPowerCreateAHeroSpawnTornado_Level3
	Enum			= SPECIAL_SPAWN_TORNADO
	ReloadTime		= 130000 ; in milliseconds
	PublicTimer		= No
	RadiusCursorRadius	= 70.0
	ViewObjectRange		= 200
	Flags			= WATER_OK
End

Weapon LegendsWhirlwindWeapon
	RadiusDamageAffects = ENEMIES
	ClearNuggets ;;.;;
  
  	DelayBetweenShots	= 0	; time between shots, msec
	ClipSize 		= 0	; how many shots in a Clip (0 == infinite)
	DamageNugget                    ; A basic Nugget that just does damage
		Damage        = 250
		Radius        = 20.0
		DelayTime     = 0
		DamageType    = HERO

		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
		DamageMaxHeight	= 50
	End
	DamageNugget                     ; A basic Nugget that just does damage
		Damage        = 95
		Radius        = 50.0
		DelayTime     = 0
		DamageType    = HERO
		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
		DamageMaxHeight	= 50
	End

	MetaImpactNugget
		KillObjectFilter	= ANY INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
		ShockWaveAmount		= 120.0	; From 150
		ShockWaveRadius		= 50
		ShockWaveTaperOff	= 1.0 
		ShockWaveZMult		= 1.8	; From 1.6  
		InvertShockWave		= Yes
		CyclonicFactor		= 0.66
		ShockWaveClearRadius	= Yes
		ShockWaveClearMult	= 0.75
		ShockWaveClearFlingHeight = 50
	End

End

Weapon WhirlwindWindWeapon
	RadiusDamageAffects = ENEMIES
	ClearNuggets ;;.;;
  
  	DelayBetweenShots	= 0
	ClipSize 		= 0

	//////////FireFX				= FX_GimliLeap // CHANGE
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 90
		Radius        = 20.0
		DelayTime     = 0
		DamageType            = HERO

		DamageFXType          = TORNADO	;GIMLI_LEAP
		DeathType             = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 25
		Radius        = 50.0
		DelayTime     = 0
		DamageType            = HERO
		DamageFXType          = TORNADO	;GIMLI_LEAP
		DeathType             = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End

	MetaImpactNugget                    ; A Nugget that throws things back with force
		KillObjectFilter  = ANY +INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
		ShockWaveAmount   = 150
		ShockWaveRadius   = 50
		ShockWaveTaperOff = 1.0 
		ShockWaveZMult    = 1.6  
		InvertShockWave   = Yes		// makes it "suck"
		
		CyclonicFactor	  = 0.66
	End
	DamageNugget
		Damage        = 85
		Radius        = 20.0
		DelayTime     = 0
		DamageType    = HERO

		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
		DamageMaxHeight	= 50
	End
	DamageNugget
		Damage        = 40
		Radius        = 50.0
		DelayTime     = 0
		DamageType    = HERO
		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
		DamageMaxHeight	= 50
	End

;	MetaImpactNugget               ; A Nugget that throws things back with force
;		KillObjectFilter  = ANY INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
;		ShockWaveAmount   = 90.0 ; From 150
;		ShockWaveRadius   = 35.0
;		ShockWaveTaperOff = 1.0 
;		ShockWaveZMult    = 1.6  
;		InvertShockWave   = Yes
;		DamageMaxHeight	= 50
;		
;		CyclonicFactor	  = 0.40 ;0.66
;	End

End

Weapon TornadoWindWeapon
	RadiusDamageAffects = ENEMIES
	ClearNuggets ;;.;;
  
  	DelayBetweenShots	= 0	; time between shots, msec
	ClipSize               	= 0	; how many shots in a Clip (0 == infinite)

	//////////FireFX				= FX_GimliLeap // CHANGE
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 170
		Radius        = 20.0
		DelayTime     = 0
		DamageType            = HERO
		DamageFXType          = TORNADO	;GIMLI_LEAP
		DeathType             = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 30
		Radius        = 50.0
		DelayTime     = 0
		DamageType            = HERO
		DamageFXType          = TORNADO	;GIMLI_LEAP
		DeathType             = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End

	MetaImpactNugget                    ; A Nugget that throws things back with force
		KillObjectFilter  = ANY +INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
		ShockWaveAmount   = 170
		ShockWaveRadius   = 80
		ShockWaveTaperOff = 1.0 
		ShockWaveZMult    = 1.6  
		InvertShockWave   = Yes		// makes it "suck"
		
		CyclonicFactor	  = 0.66
	End
	DamageNugget                    ; A basic Nugget that just does damage
		Damage        = 85	;From 120
		Radius        = 20.0
		DelayTime     = 0
		DamageType    = HERO
		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End
	DamageNugget                    ; A basic Nugget that just does damage
		Damage        = 40
		Radius        = 50.0
		DelayTime     = 0
		DamageType    = HERO
		DamageFXType  = TORNADO
		DeathType     = NORMAL
		DamageScalar  = 35% NONE +STRUCTURE
		CylinderAOE   = Yes
	End

;	MetaImpactNugget                ; A Nugget that throws things back with force
;		KillObjectFilter  = ANY INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
;		ShockWaveAmount   = 80.0 ;From 170
;		ShockWaveRadius   = 35.0 ;From 80
;		ShockWaveTaperOff = 1.0 
;		ShockWaveZMult    = 1.6  
;		InvertShockWave   = Yes
;		
;		CyclonicFactor	  = 0.40 ;0.66
;	End

End

Object CreateAHeroTornado_Level1
ReplaceModule ModuleTag_LifetimeUpdate
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdateNew
		MinLifetime	=	8000	;10000
		MaxLifetime	=	8000	;10000
	END
END

ReplaceModule ModuleTag_WINDY
	Behavior = FireWeaponUpdate ModuleTag_WINDYNew
		FireWeaponNugget
			WeaponName = LegendsWhirlwindWeapon ;TornadoWindWeapon
			FireDelay = 0
			OneShot = No
		End
	End
END
END

Object CreateAHeroTornado_Level2
ReplaceModule ModuleTag_LifetimeUpdate
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdateNew
		MinLifetime	=	12000	;20000
		MaxLifetime	=	12000	;20000
	END
END

ReplaceModule ModuleTag_WINDY
	Behavior = FireWeaponUpdate ModuleTag_WINDYNew
		FireWeaponNugget
			WeaponName = LegendsWhirlwindWeapon ;TornadoWindWeapon
			FireDelay = 0
			OneShot = No
		End
	End
END
END

Object CreateAHeroTornado_Level3
ReplaceModule ModuleTag_LifetimeUpdate
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdateNew
		MinLifetime	=	19000	;30000
		MaxLifetime	=	19000	;30000
	END
END

ReplaceModule ModuleTag_WINDY
	Behavior = FireWeaponUpdate ModuleTag_WINDYNew
		FireWeaponNugget
			WeaponName = LegendsWhirlwindWeapon ;TornadoWindWeapon
			FireDelay = 0
			OneShot = No
		End
	End
END
END


Weapon LegendsCreateAHeroRainOfArrowsWarhead
;	ProjectileCollidesWith	= STRUCTURES WALLS  
	RadiusDamageAffects	= ENEMIES NEUTRALS NOT_SIMILAR
	ClearNuggets ;;.;;
	HitStoredTarget		= Yes
	DamageNugget
		Damage		= 190 ; 50		< This damage seems to be added to all levels no matter the upgrade requirements. Map.ini bug,..
		Radius		= 1.0
		DelayTime	= 0
		DamageType	= HERO_RANGED
		DamageFXType	= GOOD_ARROW_PIERCE
		DeathType	= NORMAL
;		AcceptDamageAdd = No
;		RequiredUpgradeNames		= Upgrade_CreateAHeroRainOfArrows_Level1
;		ForbiddenUpgradeNames		= Upgrade_CreateAHeroRainOfArrows_Level2 Upgrade_CreateAHeroRainOfArrows_Level3
	End
;	DamageNugget
;		Damage		= 150 ; 100
;		Radius		= 1.0
;		DelayTime	= 0
;		DamageType	= HERO_RANGED
;		DamageFXType	= GOOD_ARROW_PIERCE
;		DeathType	= NORMAL
;		AcceptDamageAdd = No
;		RequiredUpgradeNames		= Upgrade_CreateAHeroRainOfArrows_Level2
;		ForbiddenUpgradeNames		= Upgrade_CreateAHeroRainOfArrows_Level3
;	End
;	DamageNugget
;		Damage		= 200 ; 150
;		Radius		= 1.0
;		DelayTime	= 0
;		DamageType	= HERO_RANGED
;		DamageFXType	= GOOD_ARROW_PIERCE
;		DeathType	= NORMAL
;		AcceptDamageAdd = No
;		RequiredUpgradeNames		= Upgrade_CreateAHeroRainOfArrows_Level3
;	End
End


Object LegolasBowArrowStormProjectile

ReplaceModule ModuleTag_04
	Behavior = BezierProjectileBehavior ModuleTag_04New
		; To tweak a Bezier path
		DetonateCallsKill = Yes
		FirstHeight = 36  ; Height of Bezier control points above highest intervening terrain
		SecondHeight = 36
		FirstPercentIndent = 20% ; Percentage of shot distance control points are placed
		SecondPercentIndent = 90%
		FlightPathAdjustDistPerSecond = 50 ; Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
		;GroundHitFX = FX_HawkStrikeHit
		CurveFlattenMinDist = 50.0
	End
END

RemoveModule ModuleTag_06
;	Behavior = CreateObjectDie ModuleTag_06
;		DeathTypes = ALL
;		CreationList = OCL_GoodFactionShatteredArrowBits
;	End

 AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_LegendsRainOfArrowsDeathWeaponModule
    StartsActive = Yes
    DeathWeapon = LegendsCreateAHeroRainOfArrowsWarhead
  End
 END

End

;Weapon CreateAHeroRainOfArrows_Level1
;	AttackRange		= CREATE_A_HERO_RAIN_OF_ARROWS_RANGE	//LEGOLAS_ARROWSTORM_RANGE
;	WeaponSpeed		= 561
;	MinWeaponSpeed		= 481
;	MaxWeaponSpeed		= 641
;	FireFX			= FX_RohanArcherBowWeapon
;	HitPercentage		= 100
;
;	ProjectileNugget
;		ProjectileTemplateName = LegolasBowArrowStormProjectile
;		WarheadTemplateName = CreateAHeroRainOfArrowsWarhead_Level1
;	End
;End

;-------
;DWARVES
;-------

Weapon CreateAHeroSapper_Level1
	LeechRangeWeapon		= Yes
	CanFireWhileMoving		= No
	AttackRange			= CREATE_A_HERO_SAPPER_RANGE	//30.0
	MeleeWeapon			= Yes
	WeaponSpeed           = 799999.2        // dist/sec (huge value == effectively instant)
	FireFX				= FX_DwarvenSapper
	DelayBetweenShots     = GLOIN_DELAYBETWEENSHOTS 	// time between shots, msec
	PreAttackDelay        = GLOIN_PREATTACKDELAY 	// 433 is natural time of the stabbing animation.
	PreAttackType         = PER_SHOT // Do the delay each time we attack a new target
	FiringDuration        = GLOIN_FIRINGDURATION 		// min 600 for anim

	// Crush damage.
	DamageNugget								// A basic Nugget that just does damage
		Damage			= 800
		DamageTaperOff	= #MULTIPLY( 800 0.66 )
		Radius			= 50 ;;=Ecthelion=;;
		DelayTime		= 0
		DamageType		= CRUSH
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	// Structural damage.
	DamageNugget								// A basic Nugget that just does damage
		Damage			= 1200
		DamageTaperOff	= #MULTIPLY( 1200 0.66 )
		Radius			= 50 ;;=Ecthelion=;;
		DelayTime		= 0

		DamageType		= SIEGE
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	// Push back
	MetaImpactNugget							// A Nugget that throws things back with force
//		HeroResist			= .75
		ShockWaveAmount		= 60
		ShockWaveRadius		= 80
		ShockWaveArc		= 75				// Should generally be equal to damage arc
		ShockWaveTaperOff	= 1.0
		ShockWaveSpeed		= 0.0
		ShockWaveZMult		= 1.6
	End
End

Weapon CreateAHeroSapper_Level2
	LeechRangeWeapon		= Yes
	CanFireWhileMoving		= No
	AttackRange			= CREATE_A_HERO_SAPPER_RANGE	//30.0
	MeleeWeapon			= Yes
	WeaponSpeed           = 799999.2        // dist/sec (huge value == effectively instant)
	FireFX				= FX_DwarvenSapper
	DelayBetweenShots     = GLOIN_DELAYBETWEENSHOTS 	// time between shots, msec
	PreAttackDelay        = GLOIN_PREATTACKDELAY 	// 433 is natural time of the stabbing animation.
	PreAttackType         = PER_SHOT // Do the delay each time we attack a new target
	FiringDuration        = GLOIN_FIRINGDURATION 		// min 600 for anim

	DamageNugget								// A basic Nugget that just does damage
		Damage			= 1200
		DamageTaperOff	= #MULTIPLY( 1200 0.66 )
		Radius			= 100
		DelayTime		= 0
		DamageType		= CRUSH
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	DamageNugget								// A basic Nugget that just does damage
		Damage			= 1300
		DamageTaperOff	= #MULTIPLY( 1300 0.66 )
		Radius			= 100
		DelayTime		= 0
		DamageType		= SIEGE
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	MetaImpactNugget							// A Nugget that throws things back with force
//		HeroResist			= .75
		ShockWaveAmount		= 60
		ShockWaveRadius		= 80
		ShockWaveArc		= 75				// Should generally be equal to damage arc
		ShockWaveTaperOff	= 1.0
		ShockWaveSpeed		= 0.0
		ShockWaveZMult		= 1.6
	End
End

Weapon CreateAHeroSapper_Level3
	LeechRangeWeapon		= Yes
	CanFireWhileMoving		= No
	AttackRange			= CREATE_A_HERO_SAPPER_RANGE	//30.0
	MeleeWeapon			= Yes
	WeaponSpeed           = 799999.2        // dist/sec (huge value == effectively instant)
	FireFX				= FX_DwarvenSapper
	DelayBetweenShots     = GLOIN_DELAYBETWEENSHOTS 	// time between shots, msec
	PreAttackDelay        = GLOIN_PREATTACKDELAY 	// 433 is natural time of the stabbing animation.
	PreAttackType         = PER_SHOT // Do the delay each time we attack a new target
	FiringDuration        = GLOIN_FIRINGDURATION 		// min 600 for anim

	// Crush damage.
	DamageNugget								// A basic Nugget that just does damage
		Damage			= 1500
		DamageTaperOff	= #MULTIPLY( 1500 0.66 )
		Radius			= 200
		DelayTime		= 0
		DamageType		= CRUSH
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	DamageNugget								// A basic Nugget that just does damage
		Damage			= 2000
		DamageTaperOff	= #MULTIPLY( 2000 0.66 )
		Radius			= 200
		DelayTime		= 0
		DamageType		= SIEGE
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End

	MetaImpactNugget							// A Nugget that throws things back with force
		ShockWaveAmount		= 60
		ShockWaveRadius		= 80
		ShockWaveArc		= 75				// Should generally be equal to damage arc
		ShockWaveTaperOff	= 1.0
		ShockWaveSpeed		= 0.0
		ShockWaveZMult		= 1.6
	End
End


SpecialPower SpecialAbilityCreateAHeroAxeThrow_Level1
	Enum										= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime									= 40000 ;Changed from 60000
	PublicTimer									= No
End

SpecialPower SpecialAbilityCreateAHeroAxeThrow_Level2
	Enum										= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime									= 40000
	PublicTimer									= No
End

SpecialPower SpecialAbilityCreateAHeroAxeThrow_Level3
	Enum										= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime									= 40000
	PublicTimer									= No
End


//--------------------Ecthelions Sapper Fix---------------------------
SpecialPower SpecialAbilityCreateAHeroSapper_Level1
	Enum									  =	SPECIAL_CHARGE_ATTACK
	ReloadTime								  =	120000
	;;ObjectFilter							  = NONE +STRUCTURE
End

SpecialPower SpecialAbilityCreateAHeroSapper_Level2
	Enum									  =	SPECIAL_CHARGE_ATTACK
	ReloadTime								  =	120000
	;;ObjectFilter							  = NONE +STRUCTURE
End

SpecialPower SpecialAbilityCreateAHeroSapper_Level3
	Enum									  =	SPECIAL_CHARGE_ATTACK
	ReloadTime								  =	120000
	;;ObjectFilter							  = NONE +STRUCTURE
End

//------------------------------------------------------------------------------


Weapon LegendsCreateAHeroAxeThrowWarhead
;	ProjectileCollidesWith		= ENEMIES NEUTRAL STRUCTURES WALLS 		; Maybe this line screwed things up?
	RadiusDamageAffects		= ENEMIES NOT_SIMILAR ; NEUTRALS
	ClearNuggets ;;.;;
	FireFX				= FX_GondorSwordHit
;	HitStoredTarget			= Yes	// Always hits initial target.

	DamageNugget
		Damage        			= 700 ;400
		Radius        			= 15.0	// HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DamageScalar  = 10% NONE +STRUCTURE +MordorCatapult +IsengardBallista +GondorTrebuchet +GondorTrebuchetWall 
		DelayTime     			= 0
		DamageType    			= HERO
		DamageFXType  			= SWORD_SLASH
		DeathType     			= NORMAL
	End

	DamageNugget
		Damage        			= 1200 ;400
		Radius        			= 15.0	// HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DamageScalar  = 10% NONE +STRUCTURE +MordorCatapult +IsengardBallista +GondorTrebuchet +GondorTrebuchetWall 
		DelayTime     			= 0
		DamageType    			= HERO
		DamageFXType  			= SWORD_SLASH
		DeathType     			= NORMAL
		RequiredUpgradeNames		= Upgrade_CreateAHeroAxeThrow_Level1
		ForbiddenUpgradeNames		= Upgrade_CreateAHeroAxeThrow_Level2 Upgrade_CreateAHeroAxeThrow_Level3
	End

	DamageNugget
		Damage      			= 1800 ; 800
		Radius        			= 15.0
		DamageScalar  = 10% NONE +STRUCTURE +MordorCatapult +IsengardBallista +GondorTrebuchet +GondorTrebuchetWall 
		DelayTime     			= 0
		DamageType    			= HERO
		DamageFXType  			= SWORD_SLASH
		DeathType     			= NORMAL
		RequiredUpgradeNames		= Upgrade_CreateAHeroAxeThrow_Level2
		ForbiddenUpgradeNames		= Upgrade_CreateAHeroAxeThrow_Level3
	End

	DamageNugget
		Damage				= 2800; 1200
		Radius				= 15.0
		DamageScalar  = 10% NONE +STRUCTURE +MordorCatapult +IsengardBallista +GondorTrebuchet +GondorTrebuchetWall 
		DelayTime			= 0
		DamageType			= HERO
		DamageFXType			= SWORD_SLASH
		DeathType			= NORMAL
		RequiredUpgradeNames		= Upgrade_CreateAHeroAxeThrow_Level3
	End
End


Object GimliAxeProjectile

	KindOf = PROJECTILE NO_COLLIDE

AddModule
    Draw = W3DStreakDraw ModuleTag_Draw3New	; Makes a fire effect
		Length = 110
		Width = 20
		NumSegments = 10				; number of segements in the streak, increase for smoother line
		Color		= R:255 G:157 B:60
		Texture = Exmorgulblade.tga ; EXExplo01.tga
	End
END

 AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_LegendsDeathWeaponModule
    StartsActive = Yes
    DeathWeapon = LegendsCreateAHeroAxeThrowWarhead
  End
 END
	Geometry = Sphere
	GeometryIsSmall = Yes
	GeometryMajorRadius = 0.8
End


Weapon CreateAHeroAxeThrow
	AttackRange		= CREATE_A_HERO_AXE_THROW_RANGE
	WeaponSpeed		= 161         		// dist/sec 
	MinWeaponSpeed		= 201
	MaxWeaponSpeed		= 241      		// dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX			= FX_GimliAxeThrow
	ScaleWeaponSpeed	= Yes			// Used for lob weapons, scales speed proportional to range
	HitPercentage		= 100
	ScatterRadius		= 0.0      		//When this weapon misses it can randomly miss by as much as this distance.
	DelayBetweenShots	= 0        		// time between shots, msec
  	
    AntiAirborneVehicle		= Yes 			// added so he can attack fellbeast and birds
    AntiAirborneMonster		= Yes 			// added so he can attack fellbeast and birds
  	
  	ClipSize		= 1			// how many shots in a Clip (0 == infinite)
	ClipReloadTime		= 10000     		// how long to reload a Clip, msec
	AutoReloadsClip		= Yes
    InstantLoadClipOnActivate	= Yes

	PreAttackDelay		= 1500			// 1467             // 1467 is the prep time for archer.
	PreAttackType		= PER_SHOT 		// Do the delay each time we attack a new target
	FiringDuration		= 1600// 1567  		// Duration of the archer firing shot is 500ms.

	ProjectileNugget
		ProjectileTemplateName = GimliAxeProjectile
		WarheadTemplateName = CreateAHeroAxeThrowWarhead
	End
End











SpecialPower SpecialAbilityCreateAHeroEarthShaker_Level1
	Enum		= SPECIAL_GENERAL_TARGETLESS
	ReloadTime	= 75000 ; Changed from 60000, damn these overpowered dwarfies...
	PublicTimer	= No
End

SpecialPower SpecialAbilityCreateAHeroEarthShaker_Level2
	Enum		= SPECIAL_GENERAL_TARGETLESS
	ReloadTime	= 70000
	PublicTimer	= No
End

SpecialPower SpecialAbilityCreateAHeroEarthShaker_Level3
	Enum		= SPECIAL_GENERAL_TARGETLESS
	ReloadTime	= 70000
	PublicTimer	= No
End

Weapon CreateAHeroEarthShaker_Level1
	ClearNuggets ;;.;;
	IdleAfterFiringDelay = 0
	RadiusDamageAffects = ENEMIES NOT_SIMILAR
	DelayBetweenShots	= 5000
	PreAttackDelay		= 2600
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_GloinShatterPre
	FireFX			= FX_GloinShatterhammer
	FiringDuration		= 1400
	DamageNugget                        // A basic Nugget that just does damage
		Damage			= CREATE_A_HERO_EARTH_SHAKER_DAMAGE_L1
		Radius			= CREATE_A_HERO_EARTH_SHAKER_RADIUS_L1	//250.0
		DamageType		= MAGIC
		DamageFXType	= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 700.0 // must match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist			= .75
		ShockWaveAmount   = CREATE_A_HERO_EARTH_SHAKER_META_AMOUNT_L1	//70.0
		ShockWaveRadius   = CREATE_A_HERO_EARTH_SHAKER_META_RADIUS_L1	//500.0
		ShockWaveTaperOff = 1.0
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 700.0 
	End
	DamageNugget
		Damage		= 750 ;from 150
		Radius		= 120
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 // must match the ShockWaveSpeed below
	End
End

Weapon CreateAHeroEarthShaker_Level2
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	DelayBetweenShots	= 5000
	PreAttackDelay		= 2600
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_GloinShatterPre
	FireFX			= FX_GloinShatterhammer
	FiringDuration		= 1400
	DamageNugget                        // A basic Nugget that just does damage
		Damage			= CREATE_A_HERO_EARTH_SHAKER_DAMAGE_L2
		Radius			= CREATE_A_HERO_EARTH_SHAKER_RADIUS_L2	//250.0
		DamageType		= MAGIC
		DamageFXType	= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 700.0 // must match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist			= .75
		ShockWaveAmount   = CREATE_A_HERO_EARTH_SHAKER_META_AMOUNT_L2	//70.0
		ShockWaveRadius   = CREATE_A_HERO_EARTH_SHAKER_META_RADIUS_L2	//500.0
		ShockWaveTaperOff = 1.0
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 700.0 
	End
	DamageNugget
		Damage		= 1250; from 300
		Radius		= 150; from 200
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 // must match the ShockWaveSpeed below
	End
End


Weapon CreateAHeroEarthShaker_Level3
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	DelayBetweenShots	= 5000
	PreAttackDelay		= 2600
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_GloinShatterPre
	FireFX			= FX_GloinShatterhammer
	FiringDuration		= 1400
	DamageNugget
		Damage		= 1650; from 450
		Radius		= 150; from 250
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 // must match the ShockWaveSpeed below
	End
	DamageNugget                        // A basic Nugget that just does damage
		Damage			= CREATE_A_HERO_EARTH_SHAKER_DAMAGE_L3
		Radius			= CREATE_A_HERO_EARTH_SHAKER_RADIUS_L3	//250.0
		DamageType		= MAGIC
		DamageFXType	= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 700.0 // must match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist			= .75
		ShockWaveAmount   = CREATE_A_HERO_EARTH_SHAKER_META_AMOUNT_L3	//70.0
		ShockWaveRadius   = CREATE_A_HERO_EARTH_SHAKER_META_RADIUS_L3	//500.0
		ShockWaveTaperOff = 1.0
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 700.0 
	End
End


SpecialPower SpecialAbilityCreateAHeroBattleRage_Level1
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	110000 ; Changed from 180000 to act like MotW Swordmaster
	PublicTimer	=	No
End

SpecialPower SpecialAbilityCreateAHeroBattleRage_Level2
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	110000
	PublicTimer	=	No
End

SpecialPower SpecialAbilityCreateAHeroBattleRage_Level3
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	110000
	PublicTimer	=	No
End

SpecialPower SpecialAbilityCreateAHeroBattleRage_Level4
	Enum		=	SPECIAL_GENERAL_TARGETLESS
	ReloadTime	=	110000
	PublicTimer	=	No
End

;-------
;WIZARDS
;-------

SpecialPower SpecialAbilityForcePush_Level1
	Enum									  =	SPECIAL_WIZARD_BLAST
	ReloadTime								  =	60000 ;From 60000
	PublicTimer								  =	No
End

SpecialPower SpecialAbilityForcePush_Level2
	Enum									  =	SPECIAL_WIZARD_BLAST
	ReloadTime								  =	60000 ; 60000
	PublicTimer								  =	No
End

SpecialPower SpecialAbilityForcePush_Level3
	Enum									  =	SPECIAL_WIZARD_BLAST
	ReloadTime								  =	60000
	PublicTimer								  =	No
End

Weapon ForcePush_Level1
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	  =	0
	LeechRangeWeapon		  =	Yes
	AttackRange			  =	50 ; CREATE_A_HERO_FORCE_PUSH_RANGE_L1
	WeaponSpeed			  =	401			// dist/sec 
	RadiusDamageAffects		  =	ENEMIES	NEUTRALS NOT_SIMILAR
	DelayBetweenShots		  =	5000			   // time between shots, msec
	PreAttackDelay			  =	100
	PreAttackType			  =	PER_ATTACK // Do	the	delay each time	we attack a	new	target
	FireFX				  =	FX_WizardTelekinesis	// CASEY TODO New FX for this power
	FiringDuration			  =	100
	DamageDealtAtSelfPosition	  =	Yes	
	IsAimingWeapon			  =	Yes
	AcceptableAimDelta		  =	15
	AntiAirborneVehicle		  =	No
	AntiAirborneMonster		  =	No

	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 80
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist		  =	.75
		ShockWaveAmount	  =	75.0
		ShockWaveArc	  =	75
		ShockWaveRadius	  =	110.0
		ShockWaveTaperOff =	0.75
		ShockWaveZMult	  =	1.000
		ShockWaveSpeed	  =	700.0 
	End
	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 900
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType	 = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
End


Weapon ForcePush_Level2
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	  =	0
	LeechRangeWeapon		  =	Yes
	AttackRange			  =	50 ; fixed from CREATE_A_HERO_FORCE_PUSH_RANGE_L2 (150)
	WeaponSpeed			  =	401			// dist/sec 
	RadiusDamageAffects		  =	ENEMIES	NEUTRALS NOT_SIMILAR
	DelayBetweenShots		  =	5000			   // time between shots, msec
	PreAttackDelay			  =	100
	PreAttackType			  =	PER_ATTACK // Do	the	delay each time	we attack a	new	target
	FireFX				  =	FX_WizardTelekinesis	// CASEY TODO New FX for this power
	FiringDuration			  =	100
	DamageDealtAtSelfPosition	  =	Yes	
	IsAimingWeapon			  =	Yes
	AcceptableAimDelta		  =	15
	AntiAirborneVehicle		  =	No
	AntiAirborneMonster		  =	No


	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 150
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist		  =	.75
		ShockWaveAmount	  =	75.0
		ShockWaveArc	  =	75
		ShockWaveRadius	  =	110.0
		ShockWaveTaperOff =	0.75
		ShockWaveZMult	  =	1.000
		ShockWaveSpeed	  =	700.0 
	End
	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1250
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist		  =	.75
		ShockWaveAmount	  =	75.0
		ShockWaveArc	  =	75
		ShockWaveRadius	  =	110.0
		ShockWaveTaperOff =	0.75
		ShockWaveZMult	  =	1.000
		ShockWaveSpeed	  =	700.0 
	End
End

Weapon ForcePush_Level3
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	 	  =	0
	LeechRangeWeapon		  =	Yes
	AttackRange			  =	70 ; Fixed from CREATE_A_HERO_FORCE_PUSH_RANGE_L3 (200)
	WeaponSpeed			  =	401			// dist/sec 
	RadiusDamageAffects		  =	ENEMIES	NEUTRALS NOT_SIMILAR
	DelayBetweenShots		  =	5000			   // time between shots, msec
	PreAttackDelay			  =	100
	PreAttackType			  =	PER_ATTACK // Do	the	delay each time	we attack a	new	target
	FireFX					  =	FX_WizardTelekinesis	// CASEY TODO New FX for this power
	FiringDuration			  =	100
	DamageDealtAtSelfPosition =	Yes	
	IsAimingWeapon			  =	Yes
	AcceptableAimDelta		  =	15
	AntiAirborneVehicle		  =	No
	AntiAirborneMonster		  =	No


	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 250
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
	MetaImpactNugget                    // A Nugget that throws things back with force
//		HeroResist		  =	.75
		ShockWaveAmount	  =	75.0
		ShockWaveArc	  =	75
		ShockWaveRadius	  =	110.0
		ShockWaveTaperOff =	0.75
		ShockWaveZMult	  =	1.000
		ShockWaveSpeed	  =	700.0 
	End
	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1800
		DamageArc	 = 75
		Radius		 = 110.0
		DamageType	 = MAGIC
		DamageFXType = MAGIC
		DeathType	 = EXPLODED
		DamageSpeed	 = 700.0 // must	match the ShockWaveSpeed below
	End
End


SpecialPower SpecialAbilityBallLightning_L1
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	40000  ; From 90000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	120.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
	InitiateAtLocationSound					  = CaH_BallLightning
End

SpecialPower SpecialAbilityBallLightning_L2
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	45000  ; From 90000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	180.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
	InitiateAtLocationSound					  = CaH_BallLightning
End

SpecialPower SpecialAbilityBallLightning_L3
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	50000  ; From 90000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	240.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
	InitiateAtLocationSound					  = CaH_BallLightning
End

Weapon CreateAHerBallLightningWeapon_L1
	AttackRange			   = CREATE_A_HERO_BALL_LIGHTNING_RANGE
	WeaponSpeed			   = 801		//	dist/sec 
	HitPercentage		   = 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	   = 4500		// time between shots, msec
	PreAttackDelay		   = 200		// 1467 is	the	prep time for archer.  
	PreAttackType		   = PER_SHOT	//	Do the delay each time we attack a new target
	FiringDuration		   = 1			// Duration	of the archer firing shot is 500ms.
	
	FireFX				   = FX_CAHBallLightningFireFX // CASEY TODO New FX for this power
	FiringDuration		   = 50
	AntiAirborneVehicle	   = Yes
	AntiAirborneMonster	   = Yes


	RadiusDamageAffects	   = ENEMIES NOT_SIMILAR
	ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES	WALLS

	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 800 ; 250
		DamageType	 = FLAME
		DamageFXType	 = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ;15
		DelayTime	 = 200	
	End

	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 800 ; 250
		DamageType	 = MAGIC
		DamageFXType = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ; 15
		DelayTime	 = 200	
	End
End

Weapon CreateAHerBallLightningWeapon_L2
	AttackRange			   = CREATE_A_HERO_BALL_LIGHTNING_RANGE
	WeaponSpeed			   = 801		//	dist/sec 
	HitPercentage		   = 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	   = 4500		// time between shots, msec
	PreAttackDelay		   = 200		// 1467 is	the	prep time for archer.  
	PreAttackType		   = PER_SHOT	//	Do the delay each time we attack a new target
	FiringDuration		   = 1			// Duration	of the archer firing shot is 500ms.
	
	FireFX				   = FX_CAHBallLightningFireFX // CASEY TODO New FX for this power
	FiringDuration		   = 50
	AntiAirborneVehicle	   = Yes
	AntiAirborneMonster	   = Yes

	RadiusDamageAffects	   = ENEMIES NOT_SIMILAR
	ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES	WALLS

	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1100 ;500
		DamageType	 = FLAME
		DamageFXType = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ; 15
		DelayTime	 = 200	
	End
	
	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1100 ;500
		DamageType	 = MAGIC
		DamageFXType = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ; 15
		DelayTime	 = 200	
	End
End

Weapon CreateAHerBallLightningWeapon_L3
	AttackRange			   = CREATE_A_HERO_BALL_LIGHTNING_RANGE
	WeaponSpeed			   = 801		//	dist/sec 
	HitPercentage		   = 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	   = 4500		// time between shots, msec
	PreAttackDelay		   = 200		// 1467 is	the	prep time for archer.  
	PreAttackType		   = PER_SHOT	//	Do the delay each time we attack a new target
	FiringDuration		   = 1			// Duration	of the archer firing shot is 500ms.
	
	FireFX				   = FX_CAHBallLightningFireFX // CASEY TODO New FX for this power
	FiringDuration		   = 50
	AntiAirborneVehicle	   = Yes
	AntiAirborneMonster	   = Yes

	RadiusDamageAffects	   = ENEMIES NOT_SIMILAR
	ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES	WALLS

	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1600 ;1000
		DamageType	 = FLAME
		DamageFXType = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ; 15
		DelayTime	 = 200	
	End
	
	DamageNugget                        // A basic Nugget that just does damage
		Damage		 = 1600 ; 1000
		DamageType	 = MAGIC
		DamageFXType = ELECTRIC
		DeathType	 = BURNED
		Radius		 = 25 ; 15
		DelayTime	 = 200	
	End	
End

SpecialPower SpecialAbilityLightBlast_L1
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	70000 ;From 12000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	120.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
End

SpecialPower SpecialAbilityLightBlast_L2
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	70000 ;From 12000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	120.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
End

SpecialPower SpecialAbilityLightBlast_L3
	Enum									  =	SPECIAL_WOUND_ARROW
	ReloadTime								  =	80000 ;From 12000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	120.0
	ObjectFilter							  =	ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
End

Weapon CreateAHeroLightBlastWeapon_L1  // 
	AttackRange			= CREATE_A_HERO_PHASER_RANGE				//600
	LeechRangeWeapon	= Yes
	WeaponSpeed			= 801      // dist/sec 
	HitPercentage		= 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	= 4500		// time between shots, msec
	FireFX              = FX_CaHBeamWeapon // CASEY TODO New FX for this power
	FiringDuration      = 1
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	AcceptableAimDelta	= 15

	RadiusDamageAffects = ENEMIES NOT_SIMILAR

	DamageNugget                        // A basic Nugget that just does damage
		Damage        = 3200	
		DamageScalar  = 200% NONE +MordorWitchKingOnFellBeast +GondorGwaihir	
		DamageScalar  = 180% NONE +MordorFellBeast
		Radius        = 17.6
		DelayTime     = 200           //The target is dying before the laser appears in the new laser tweak, so try to kill when the laser turns on
		DamageType    = MAGIC
		DamageFXType  = MAGIC
		DeathType     = NORMAL
	End

End

Weapon CreateAHeroLightBlastWeapon_L2
	AttackRange			= CREATE_A_HERO_PHASER_RANGE				//600
	LeechRangeWeapon	= Yes
	WeaponSpeed			= 801      // dist/sec 
	HitPercentage		= 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	= 4500		// time between shots, msec
	FireFX              = FX_CaHBeamWeapon // CASEY TODO New FX for this power
	FiringDuration      = 1
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	AcceptableAimDelta	= 15

	RadiusDamageAffects = ENEMIES NOT_SIMILAR

	DamageNugget                        // A basic Nugget that just does damage
		Damage        = 4500	
		DamageScalar  = 200% NONE +MordorWitchKingOnFellBeast +GondorGwaihir	
		DamageScalar  = 180% NONE +MordorFellBeast
		Radius        = 17.6
		DelayTime     = 200           //The target is dying before the laser appears in the new laser tweak, so try to kill when the laser turns on
		DamageType    = MAGIC
		DamageFXType  = MAGIC
		DeathType     = NORMAL
	End

End

Weapon CreateAHeroLightBlastWeapon_L3
	AttackRange			= CREATE_A_HERO_PHASER_RANGE				//600
	LeechRangeWeapon	= Yes
	WeaponSpeed			= 801      // dist/sec 
	HitPercentage		= 100		// When this weapon is used it will hit exactly 100% of the time.
	DelayBetweenShots	= 4500		// time between shots, msec
	FireFX              = FX_CaHBeamWeapon // CASEY TODO New FX for this power
	FiringDuration      = 1
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	AcceptableAimDelta	= 15

	RadiusDamageAffects = ENEMIES NOT_SIMILAR

	DamageNugget                        // A basic Nugget that just does damage
		Damage        = 6000	
		DamageScalar  = 200% NONE +MordorWitchKingOnFellBeast +GondorGwaihir	
		DamageScalar  = 180% NONE +MordorFellBeast
		Radius        = 17.6
		DelayTime     = 200           //The target is dying before the laser appears in the new laser tweak, so try to kill when the laser turns on
		DamageType    = MAGIC
		DamageFXType  = MAGIC
		DeathType     = NORMAL
	End

End





Weapon LegendsWizardFireballWarheadL1
	ClearNuggets ;;.;;
  ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS
  RadiusDamageAffects = ENEMIES NEUTRALS NOT_SIMILAR MINES // ALLIES
	
	FireLogicNugget //@@@ fire logic testing
		LogicType	=	INCREASE_BURN_RATE
		Radius		=	40
		Damage		=	10
	End	

	DamageNugget                        // A basic Nugget that just does damage
         Damage        = 1000; 400
         Radius        = 50
         DelayTime     = 0
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
         DamageScalar  = 5000% NONE +MINE // Make sure we one shot kill mines, without risking wasting some poor hero with a torch
	End
End

FXParticleSystem WizardFireballFire_02
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 15 15
    Size = 15 20
    BurstCount = 8 8
  End
  Color = DefaultColor
    Color2 = R:97 G:10 B:0 0
    Color3 = R:0 G:0 B:0 15
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = -1 -1
    SizeRateDamping = 1 1
    AngleZ = -3 3
    AngularRateZ = -0.1 -0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.7 0.75
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = SphereEmissionVolume
    Radius = 8
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    SpeedMultiplier = 1
  End
End

FXParticleSystem WizardFireballFire_02a
  System
    Priority = ALWAYS_RENDER
    Type = GPU_PARTICLE
    ParticleName = EXFireScroll2.tga
    Lifetime = 3 3
    Size = 15 20
    BurstCount = 15 15
  End
  Color = DefaultColor
    Color2 = R:97 G:10 B:0 3
  End
  Alpha = DefaultAlpha
    Alpha1 = 1 1 0
  End
  Update = DefaultUpdate
    SizeRate = -1 -1
    SizeRateDamping = 1 1
    AngleZ = -3 3
    AngularRateZ = -0.1 -0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.7 0.75
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = SphereEmissionVolume
    Radius = 2
  End
  Draw = GpuDraw
    FramesPerRow = 4
    TotalFrames = 16
    SpeedMultiplier = 1
  End
End

Weapon LegendsWizardFireballWarheadL2
	ClearNuggets ;;.;;
  ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS
  RadiusDamageAffects = ENEMIES NEUTRALS NOT_SIMILAR MINES // ALLIES
	
	FireLogicNugget //@@@ fire logic testing
		LogicType	=	INCREASE_BURN_RATE
		Radius		=	40
		Damage		=	10
	End	

	DamageNugget                        // A basic Nugget that just does damage
         Damage        = 1700; 800
         Radius        = 55
         DelayTime     = 0
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
         DamageScalar  = 5000% NONE +MINE // Make sure we one shot kill mines, without risking wasting some poor hero with a torch
	End

	MetaImpactNugget                         // A Nugget that throws things back with force
//		HeroResist        =  0.75
		ShockWaveAmount   = 80.00
		ShockWaveRadius   = SARUMAN_FIREBALL_RADIUS
		ShockWaveTaperOff =  0.75
		ShockWaveZMult    =  1.20
	End
End

Weapon LegendsWizardFireballWarheadL3
  ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS
  RadiusDamageAffects = ENEMIES NEUTRALS NOT_SIMILAR MINES // ALLIES
	ClearNuggets ;;.;;
	
	FireLogicNugget //@@@ fire logic testing
		LogicType	=	INCREASE_BURN_RATE
		Radius		=	40
		Damage		=	10
	End	

	DamageNugget                        // A basic Nugget that just does damage
         Damage        = 2800; 1200
         Radius        = 65
         DelayTime     = 0
         DamageType    = FLAME
         DamageFXType  = BIG_ROCK
         DeathType     = BURNED
         DamageScalar  = 5000% NONE +MINE // Make sure we one shot kill mines, without risking wasting some poor hero with a torch
	End

	MetaImpactNugget                         // A Nugget that throws things back with force
//		HeroResist        =  0.75
		ShockWaveAmount   = 80.00
		ShockWaveRadius   = SARUMAN_FIREBALL_RADIUS
		ShockWaveTaperOff =  0.75
		ShockWaveZMult    =  1.20
	End
End

Object WizardFireballProjectileL1

ReplaceModule ModuleTag_04
  Behavior = BezierProjectileBehavior ModuleTag_04New
    
    FirstHeight = 9  // Height of Bezier control points above highest intervening terrain
    SecondHeight = 9
    FirstPercentIndent = 20% // Percentage of shot distance control points are placed
    SecondPercentIndent = 100%
    FlightPathAdjustDistPerSecond = 50 // Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
    DetonateCallsKill = Yes
    CurveFlattenMinDist = 50.0
  End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_DeathWeaponModule
    StartsActive = Yes
    DeathWeapon = LegendsWizardFireballWarheadL1
  End
END

End

Object WizardFireballProjectileL2

ReplaceModule ModuleTag_04
  Behavior = BezierProjectileBehavior ModuleTag_04New
    
    FirstHeight = 9  // Height of Bezier control points above highest intervening terrain
    SecondHeight = 9
    FirstPercentIndent = 20% // Percentage of shot distance control points are placed
    SecondPercentIndent = 100%
    FlightPathAdjustDistPerSecond = 50 // Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
    DetonateCallsKill = Yes
    CurveFlattenMinDist = 50.0
  End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_DeathWeaponModule
    StartsActive = Yes
    DeathWeapon = LegendsWizardFireballWarheadL2
  End
END

End

Object WizardFireballProjectileL3

ReplaceModule ModuleTag_04
  Behavior = BezierProjectileBehavior ModuleTag_04New
    
    FirstHeight = 9  // Height of Bezier control points above highest intervening terrain
    SecondHeight = 9
    FirstPercentIndent = 20% // Percentage of shot distance control points are placed
    SecondPercentIndent = 100%
    FlightPathAdjustDistPerSecond = 50 // Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
    DetonateCallsKill = Yes
    CurveFlattenMinDist = 50.0
  End
End

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_DeathWeaponModule
    StartsActive = Yes
    DeathWeapon = LegendsWizardFireballWarheadL3
  End
END

END


Weapon CreateAHeroWordOfPower
	DamageNugget
		Damage		= 1300		; +500
		Radius		= 250.0
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0
	End
End



SpecialPower SpecialAbilityCreateAHeroWordOfPoultry_Level1
	Enum									  =	SPECIAL_ARROW_STORM
	ReloadTime								  =	300000 ; From 240000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	CREATE_A_HERO_WORD_OF_POULTRY_RADIUS_L1
End

SpecialPower SpecialAbilityCreateAHeroWordOfPoultry_Level2
	Enum									  =	SPECIAL_ARROW_STORM
	ReloadTime								  =	300000 ; From 240000
	PublicTimer								  =	No
	RadiusCursorRadius						  =	CREATE_A_HERO_WORD_OF_POULTRY_RADIUS_L2
End


SpecialPower SpecialAbilityATeleportToCaster//SpecialAbilityTeleportToCaster	//	Terrible HACK!  Added the 'A' between 'Ability' and 'Teleport' to cause the name to sort differently for a demo (otherwise, it sorts late in the list and we don't have room in the UI to display it  :O )
	Enum			= SPECIAL_TELEPORT_TEAM_TO_CASTER
	RadiusCursorRadius	= 100.0
	ReloadTime		= 60000
	ObjectFilter		= ANY	+INFANTRY +CAVALRY ALLIES
	InitiateSound		= CaH_TeleportPart1
End

SpecialPower SpecialAbilityTeleportStoredObjects
	Enum			= SPECIAL_TELEPORT_LIST_TO_POSITION
	RadiusCursorRadius	= 100.0
	ReloadTime		= 60000
End

SpecialPower SpecialAbilityTeleportStoredObjects_2
	Enum			= SPECIAL_TELEPORT_LIST_TO_POSITION
	RadiusCursorRadius	= 100.0
	ReloadTime		= 60000
End

;--------------
;ORC/URUK/TROLL
;--------------

SpecialPower SpecialAbilityCreateAHeroOilFire_Level1
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	130000 ; From 180000
	PublicTimer								  =	No
End

SpecialPower SpecialAbilityCreateAHeroIgniteOil_Level1
	Enum										= SPECIAL_GENERAL_TARGETLESS
	ReloadTime									= 1000
	PublicTimer									= No
End

SpecialPower SpecialAbilityCreateAHeroOilFire_Level2
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	130000 ; From 180000
	PublicTimer								  =	No
End

SpecialPower SpecialAbilityCreateAHeroIgniteOil_Level2
	Enum										= SPECIAL_GENERAL_TARGETLESS
	ReloadTime									= 1000
	PublicTimer									= No
End

SpecialPower SpecialAbilityCreateAHeroOilFire_Level3
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	140000 ; From 180000
	PublicTimer								  =	No
End

SpecialPower SpecialAbilityCreateAHeroIgniteOil_Level3
	Enum										= SPECIAL_GENERAL_TARGETLESS
	ReloadTime									= 1000
	PublicTimer									= No
End

SpecialPower SpecialAbilityCreateAHeroBerserkerRage_Level1
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	120000 ; From 180000
End

SpecialPower SpecialAbilityCreateAHeroBerserkerRage_Level2
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	120000  ; From 180000
End

SpecialPower SpecialAbilityCreateAHeroBerserkerRage_Level3
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	130000 ; From 180000
End

SpecialPower SpecialAbilityCreateAHeroBerserkerRage_Level4
	Enum									  =	SPECIAL_GENERAL_TARGETLESS
	ReloadTime								  =	140000 ; From 180000
End

SpecialPower SpecialAbilityCreateAHeroFireBomb_Level1
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000 ; From 60000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroFireBomb_Level2
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroFireBomb_Level3
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroFireBomb_Level4
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000
	PublicTimer		= No
End

SpecialPower SpecialAbilityCreateAHeroSoSCrippleStrikeMelee_Level1
	Enum		=	SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	=	55000 ; 45000
	PublicTimer	=	No
	ObjectFilter	= ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroSoSCrippleStrikeMelee_Level2
	Enum		=	SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime	=	55000 ; 45000
	PublicTimer	=	No
	ObjectFilter	= ANY +HERO +INFANTRY +CAVALRY +MONSTER -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast -SummonedDragon ENEMIES
End


Weapon CreateAHeroCrippleStrikeMelee_Level1
	LeechRangeWeapon	=	Yes
	AttackRange		=	30.0
	MeleeWeapon		=	Yes
	DelayBetweenShots	=	GLOIN_DELAYBETWEENSHOTS
	PreAttackDelay		=	GLOIN_PREATTACKDELAY
	PreAttackType		=	PER_SHOT
	FiringDuration		=	GLOIN_FIRINGDURATION

	DamageNugget
		Damage		= 1000 ; 600
		Radius		= 0.0
		DelayTime	= 0
		DamageType	= HERO
		DamageFXType	= MAGIC
		DeathType	= NORMAL
	End
	AttributeModifierNugget
		AttributeModifier        = AttributeModCrippleStrike_Level1
		DamageFXType             = SWORD_SLASH 
		SpecialObjectFilter      = CRIPPLE_STRIKE_OBJECT_FILTER
	End            

End

Weapon CreateAHeroCrippleStrikeMelee_Level2
	LeechRangeWeapon		  =	Yes
	AttackRange				  =	30.0
	MeleeWeapon				  =	Yes
	//FireFX					  =	FX_LurtzCripplingStrike	//FX_GondorSwordHit
	DelayBetweenShots		  =	GLOIN_DELAYBETWEENSHOTS	// time between shots, msec
	PreAttackDelay			  =	GLOIN_PREATTACKDELAY	// 433 is natural time of the stabbing animation.
	PreAttackType			  =	PER_SHOT				// Do the delay	each time we attack	a new target
	FiringDuration			  =	GLOIN_FIRINGDURATION	// min 600 for anim

	// Hero damage.
	DamageNugget										// A basic Nugget that just does damage
		Damage			= 2000 ; 1200
		Radius			= 0.0
		DelayTime		= 0
		DamageType		= HERO
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End
	// Cripple.
	AttributeModifierNugget
		AttributeModifier        = AttributeModCrippleStrike_Level2
		DamageFXType             = SWORD_SLASH 
		SpecialObjectFilter      = CRIPPLE_STRIKE_OBJECT_FILTER
	End            

End

Weapon CreateAHeroCrippleStrikeMelee_Level3      // BALANCE Archer Weapon //orc archer
	LeechRangeWeapon		  =	Yes
	AttackRange				  =	30.0
	MeleeWeapon				  =	Yes
	//FireFX					  =	FX_LurtzCripplingStrike	//FX_GondorSwordHit
	DelayBetweenShots		  =	GLOIN_DELAYBETWEENSHOTS	// time between shots, msec
	PreAttackDelay			  =	GLOIN_PREATTACKDELAY	// 433 is natural time of the stabbing animation.
	PreAttackType			  =	PER_SHOT				// Do the delay	each time we attack	a new target
	FiringDuration			  =	GLOIN_FIRINGDURATION	// min 600 for anim

	// Hero damage.
	DamageNugget										// A basic Nugget that just does damage
		Damage			= 2700 ; 1800
		Radius			= 0.0
		DelayTime		= 0
		DamageType		= HERO
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End
	// Cripple.
	AttributeModifierNugget
		AttributeModifier        = AttributeModCrippleStrike_Level3
		DamageFXType             = SWORD_SLASH 
		SpecialObjectFilter      = CRIPPLE_STRIKE_OBJECT_FILTER
	End            

End

Weapon CreateAHeroCrippleStrikeMelee_Level4       // BALANCE Archer Weapon //orc archer
	LeechRangeWeapon		  =	Yes
	AttackRange				  =	30.0
	MeleeWeapon				  =	Yes
	//FireFX					  =	FX_LurtzCripplingStrike	//FX_GondorSwordHit
	DelayBetweenShots		  =	GLOIN_DELAYBETWEENSHOTS	// time between shots, msec
	PreAttackDelay			  =	GLOIN_PREATTACKDELAY	// 433 is natural time of the stabbing animation.
	PreAttackType			  =	PER_SHOT				// Do the delay	each time we attack	a new target
	FiringDuration			  =	GLOIN_FIRINGDURATION	// min 600 for anim

	// Hero damage.
	DamageNugget										// A basic Nugget that just does damage
		Damage			= 5500 ; 2200
		Radius			= 0.0
		DelayTime		= 0
		DamageType		= HERO
		DamageFXType	= MAGIC
		DeathType		= NORMAL
	End
	// Cripple.
	AttributeModifierNugget
		AttributeModifier        = AttributeModCrippleStrike_Level4
		DamageFXType             = SWORD_SLASH 
		SpecialObjectFilter      = CRIPPLE_STRIKE_OBJECT_FILTER
	End            

End

;----------
;EASTERLING (Made them great boss assassins)
;----------


SpecialPower SpecialAbilityCreateAHeroAssassin_Level1
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000 ;From 60000
	PublicTimer		= No
	ObjectFilter		= ANY +HERO +INFANTRY +CAVALRY -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroAssassin_Level2
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000 ;From 60000
	PublicTimer		= No
	ObjectFilter		= ANY +HERO +INFANTRY +CAVALRY -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroAssassin_Level3
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000 ;From 60000
	PublicTimer		= No
	ObjectFilter		= ANY +HERO +INFANTRY +CAVALRY -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast ENEMIES
End

SpecialPower SpecialAbilityCreateAHeroAssassin_Level4
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 60000 ;From 60000
	PublicTimer		= No
	ObjectFilter		= ANY +HERO +INFANTRY +CAVALRY -MACHINE -STRUCTURE -GondorGwaihir -MordorFellBeast ENEMIES
End
Weapon LegendsCreateAHeroAssassinWeapon
	LeechRangeWeapon      = Yes
	AttackRange           = CREATE_A_HERO_ASSASSIN_RANGE
	MeleeWeapon           = Yes
	FireFX                = FX_CAHAssassin
	DelayBetweenShots     = CREATE_A_HERO_ASSASSIN_DELAYBETWEENSHOTS 			// time between shots, msec
	PreAttackDelay        = CREATE_A_HERO_ASSASSIN_PREATTACKDELAY 	// 400 is sword swing delay time before contact with target.
	PreAttackType         = PER_SHOT // Do the delay each time we attack a new target

	FiringDuration        = CREATE_A_HERO_ASSASSIN_FIRINGDURATION 	// Duration of the sword swing

	DamageNugget                // A basic Nugget that just does damage
		Damage					= 4500 ; +7000
		Radius					= 0.0
		DelayTime				= 0
		DamageType				= HERO
		DamageFXType			= SWORD_SLASH
		DeathType				= NORMAL
		RequiredUpgradeNames	= Upgrade_CreateAHeroAssassin_Level3
		ForbiddenUpgradeNames   = Upgrade_CreateAHeroAssassin_Level4
		SpecialObjectFilter      = CREATE_A_HERO_ASSASSIN_OBJECT_FILTER
	End

	DamageNugget                // A basic Nugget that just does damage
		Damage					= 6500 ; +10000
		Radius					= 0.0
		DelayTime				= 0
		DamageType				= HERO
		DamageFXType			= SWORD_SLASH
		DeathType				= NORMAL
		RequiredUpgradeNames	= Upgrade_CreateAHeroAssassin_Level4
		SpecialObjectFilter      = CREATE_A_HERO_ASSASSIN_OBJECT_FILTER
	End
End













;--------------------
;PROPS
;--------------------

Upgrade Upgrade_WellOfHealing
  Type	= OBJECT
End

Upgrade Upgrade_WellOfRestoration
  Type	= OBJECT
End

FXParticleSystem WellOfHealing
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 40 40
    Size = 15 15
    BurstCount = 2 3	;15 35
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:100 G:140 B:200 0
    Color2 = R:0 G:0 B:0 30
  End
  Update = DefaultUpdate
    SizeRate		= -0.6 -0.6
;    SizeRateDamping	= 0.1 0.1
    AngleZ = 0.01 0.01
    AngularRateZ = 0.1 0.1
    AngularDamping = 0.9 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.25
    VelocityDamping = 0.5 0.7
  End
  EmissionVelocity = OutwardEmissionVelocity
    OtherSpeed = 0 1.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 3	;4
    Length = 10	;24
    Offset = X=0 Y=0 Z=19
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem WellOfRestoration
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXGandalfStaffFlare.tga
    Lifetime = 40 40
    Size = 15 15
    BurstCount = 2 3	;15 35
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:200 G:100 B:160 0
    Color2 = R:0 G:0 B:0 30
  End
  Update = DefaultUpdate
    SizeRate		= -0.6 -0.6
;    SizeRateDamping	= 0.1 0.1
    AngleZ = 0.01 0.01
    AngularRateZ = 0.1 0.1
    AngularDamping = 0.9 0.99
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.25
    VelocityDamping = 0.5 0.7
  End
  EmissionVelocity = OutwardEmissionVelocity
    OtherSpeed = 0 1.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 3	;4
    Length = 10	;24
    Offset = X=0 Y=0 Z=19
  End
  Draw = DefaultDraw
  End
End

FXList FX_WellOfHealing
	PlayEvenIfShrouded = Yes 
	ParticleSystem
		Name = WellOfHealing
		Offset = X:0.0 Y:0.0 Z:30.0
		AttachToObject = Yes
	End
End

FXList FX_WellOfRestoration
	PlayEvenIfShrouded = Yes 
	ParticleSystem
		Name = WellOfRestoration
		Offset = X:0.0 Y:0.0 Z:30.0
		AttachToObject = Yes
	End
End


ModifierList WellOfHealingAttribute
	Category = SPELL
	Duration = 0
	FX	 = FX_WellOfHealing
End

ModifierList WellOfRestorationAttribute
	Category = SPELL
	Duration = 0
	FX	 = FX_WellOfRestoration
End





Object LothlorienLUWell

	KindOf = PRELOAD STRUCTURE IMMOBILE CAN_SEE_THROUGH_STRUCTURE IGNORE_FOR_VICTORY 

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_DrawNew
	OkToChangeModelColor  = No
	UseStandardModelNames = Yes
	StaticModelLODMode = yes
		DefaultModelConditionState
			Model = LUWELL
		End
	END
END

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_HealingWellEffect
		TriggeredBy	  	= Upgrade_WellOfHealing
		AttributeModifier 	= WellOfHealingAttribute
	End
  END

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RestorationWellEffect
		TriggeredBy	  	= Upgrade_WellOfRestoration
		AttributeModifier 	= WellOfRestorationAttribute
	End
  END

;	GeometryMajorRadius		= 0.1
;	GeometryMinorRadius		= 0.1

End
































Object WaterReflectionSkydome_GapOfRohan

;ReplaceModule ModuleTag_01
;    Draw = W3DScriptedModelDraw ModuleTag_01New
;        DefaultModelConditionState
;            Model = skybox_day
;        End
;    End
;END

;  KindOf = PRELOAD IMMOBILE STRUCTURE CAN_CAST_REFLECTIONS IGNORED_IN_GUI

End




































;--------------------------------------------
;(017) CUSTOM CHARACTERS
;--------------------------------------------

;--------------------------------------------------------
;CUSTOM HERO 0 - INRUK, THE HALF-TROLL OUTCAST
;--------------------------------------------------------

;INRUK

SpecialPower SpecialAbilityLegendsTrollsMight
	Enum				= SPECIAL_HERO_MODE
	ReloadTime			= 120000
End

SpecialPower SpecialAbilityLegendsOrcsCunning
	Enum				= SPECIAL_GENERAL_TARGETLESS; SPECIAL_HERO_MODE
	ReloadTime			= 120000
End

SpecialPower SpecialAbilityInrukBigWham
	Enum				= SPECIAL_WORD_OF_POWER
	ReloadTime			= 80000
END

CommandButton Command_ConstructGoblinTroll			; Troll's Might
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityLegendsTrollsMight
	Object			= None
	Options			= NONE
	TextLabel		= CONTROLBAR:LegendsTrollsMight
	DescriptLabel		= CONTROLBAR:TooltipLegendsTrollsMight
	ButtonImage		= BWFissure_Marauder
	ButtonBorderType	= ACTION
	NeededUpgrade		= None
	Radial			= No
	InPalantir	   	= Yes
	ShowProductionCount	= No
	AutoAbility		= Yes
	AutoDelay		= 30.0 ; this should sync with the Aragorn's hero mode effect time
	PresetRange		= 50.0 ; Whatever this is, it was in aragorn's blademaster ability
End

CommandButton Command_ConstructGoblinFighterHorde		; Goblin/Orc's Cunning
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityLegendsOrcsCunning
	Object			= None
	Options			= NONE
	TextLabel		= CONTROLBAR:LegendsOrcsCunning
	DescriptLabel		= CONTROLBAR:TooltipLegendsOrcsCunning
	ButtonImage		= BWCave_GoblinWarrior
	ButtonBorderType	= ACTION
	Radial			= No
	InPalantir	   	= Yes
	ShowProductionCount	= No
	AutoAbility		= Yes
	AutoDelay		= 30.0 ; this should sync with the Aragorn's hero mode effect time
	PresetRange		= 50.0 ; Whatever this is, it was in aragorn's blademaster ability
End

CommandButton Command_WildShelobTunnel				; Big Wham!
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityInrukBigWham
	Options			= NEED_UPGRADE
	NeededUpgrade		= Upgrade_ThranduilWildWalk	; Given at lv6
	TextLabel		= CONTROLBAR:LegendsBigWham
	DescriptLabel		= CONTROLBAR:TooltipLegendsBigWham
	ButtonImage		= HSShelobTunnel
	ButtonBorderType	= ACTION 
	CursorName		= EvilAbilityObj  
	InvalidCursorName	= GenericInvalid
	PresetRange		= 50.0
	UnitSpecificSound	= MarauderVoiceAttackBuilding
	InPalantir		= Yes
	AutoAbility		= Yes
End


CommandSet InrukCommandset
	 1 = Command_ToggleStance
	 2 = Command_ConstructGoblinTroll			; Troll's Might
	 3 = Command_ConstructGoblinFighterHorde		; Orc's Cunning
	 4 = Command_WildShelobTunnel				; Big Wham!

    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
END




FXParticleSystem BigWhamHit
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXGimliAxeSpecial.tga
    Lifetime = 25 25
    SystemLifetime = 1
    Size = 13 17
    BurstCount = 3 3
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:243 G:143 B:52 0
    Color2 = R:0 G:0 B:0 25
  End
  Update = DefaultUpdate
    SizeRate = 1.6 1.6
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularDamping = 1 1

    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:8
    EndPoint = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem BigWhamFlash
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLdrshpLvl2b.tga
    Lifetime = 5 5
    SystemLifetime = 1
    Size = 95 120
    BurstCount = 3 3
  End
  Color = DefaultColor
    Color1 = R:243 G:143 B:52 0
    Color2 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = -2 -2
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:10
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem BigWhamExplosion
  System
    Priority = VERY_LOW_OR_ABOVE
    IsOneShot = Yes
    Shader = ALPHA
    ParticleName = EXfireballF.tga
    Lifetime = 80 80
    SystemLifetime = 2
    Size = 14 17
    StartSizeRate = 0.1 0.1
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:255 G:255 B:255 10
    Color3 = R:255 G:255 B:255 15
    Color4 = R:0 G:0 B:0 55
    Color5 = R:0 G:0 B:0 60
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.4 0.6 5
    Alpha3 = 0.1 0.3 40
    Alpha4 = 0 0 80
  End
  Update = DefaultUpdate
    SizeRate = 3 7
    SizeRateDamping = 0.8 0.8
    AngleZ = -3 1.5
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 0.75 0.75
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0 5
  End
  EmissionVolume = CylinderEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem BigWhamExplosionGlow
  System
    Priority = VERY_LOW_OR_ABOVE
    IsOneShot = Yes
    ParticleName = EXexplo03.tga
    Lifetime = 50 50
    SystemLifetime = 2
    Size = 15 17
    StartSizeRate = 0.1 0.1
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:215 G:211 B:204 0
    Color2 = R:143 G:134 B:112 20
    Color3 = R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.75 1 5
    Alpha3 = -0.5 0 10
  End
  Update = DefaultUpdate
    SizeRate = 3 6
    SizeRateDamping = 0.8 0.8
    AngleZ = -7 7
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.1
    VelocityDamping = 0.75 0.75
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0 5
  End
  EmissionVolume = CylinderEmissionVolume
  End
  Draw = DefaultDraw
  End
End


FXList FX_InrukBigWham
	ParticleSystem
		Name = BigWhamHit
	End
	ParticleSystem
		Name = BigWhamFlash
	End
	ParticleSystem
		Name = BigWhamExplosion
	End
	ParticleSystem
		Name = BigWhamExplosionGlow
	End
	TerrainScorch
		Type		= RANDOM
		Weather		= NORMAL
		RandomRange	= X:0 Y:0
		Radius		= 25
	End
	Sound
		Name = DrogothFireballImpactMS
	END
End



Weapon InrukBigWham
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	AttackRange		= 20
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 501         ; dist/sec 
	MinWeaponSpeed		= 441
	MaxWeaponSpeed		= 601
	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	DelayBetweenShots	= 5000
	PreAttackDelay		= 300
	PreAttackType		= PER_ATTACK
	FireFX			= FX_InrukBigWham
	FiringDuration		= 1400

	DamageNugget
		Damage		= 1200 ;;.;; 600
		DamageTaperOff = 600 ;;.;; 
		Radius		= 50.0
		DamageType	= HERO
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 ; must match the ShockWaveSpeed below
	End
	MetaImpactNugget
;		HeroResist	= .75
		ShockWaveAmount   = 55.0
		ShockWaveRadius   = 50.0
		ShockWaveTaperOff = 1.0
		ShockWaveZMult    = 1.000
		ShockWaveSpeed	  = 700.0 
	End
End


Weapon InrukPike
	ClearNuggets ;;.;;
	LeechRangeWeapon      = Yes
	AttackRange           = 35
	MeleeWeapon           = Yes
	DelayBetweenShots     = 900 ; 1400
	PreAttackDelay        = 800; 600				
	PreAttackType         = PER_SHOT
	FireFX                = FX_GondorSwordHit
	FireFlankFX	= FX_Flanking
	FiringDuration        = 600				

	DamageNugget
		Damage			= 200 ; 300
		DamageType		= HERO
		DamageFXType		= SWORD_SLASH
		DeathType		= NORMAL
		FlankingBonus		= 50%
		DamageArc      = 90 ;;.;; 45
		Radius = 6 ;;.;; 
	End

	MetaImpactNugget
		HeroResist	= .99
		ShockWaveAmount   = 55.0
		ShockWaveTaperOff = 0.3
		ShockWaveZMult    = 0.800 
	End
End

FXParticleSystem InrukBuffRed
  System
    Priority = ALWAYS_RENDER
    ParticleName = ExSpearHead.tga ; EXRing01.tga
    Lifetime = 15 15
    SystemLifetime = 900
    SortLevel = 1
    Size = 10 15
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color2 = R:91 G:30 B:30 5
    Color3 = R:0 G:0 B:0 15
    Color4 = R:32 G:32 B:32 0
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.01
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 0 0.7
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 2
    Offset = X:0 Y:0 Z:15
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem InrukBuffGreen
  System
    Priority = ALWAYS_RENDER
    ParticleName = ExSpearHead.tga ; EXRing01.tga
    Lifetime = 15 15
    SystemLifetime = 900
    SortLevel = 1
    Size = 10 15
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color2 = R:50 G:91 B:30 5
    Color3 = R:0 G:0 B:0 15
    Color4 = R:32 G:32 B:32 0
  End
  Update = DefaultUpdate
    SizeRate = 1 1
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.01
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 0 0.7
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 2
    Offset = X:0 Y:0 Z:15
  End
  Draw = DefaultDraw
  End
End

FXList FX_InrukTrollsMight
	ParticleSystem
		Name			= InrukBuffRed
		AttachToObject		= Yes
	End
End

FXList FX_InrukOrcsCunning
	ParticleSystem
		Name			= InrukBuffGreen
		AttachToObject		= Yes
	End
End

ModifierList InrukTrollsMight
	Category			= SPELL
	Modifier			= ARMOR	-25%
	Modifier			= DAMAGE_MULT 200%
	Duration			= 30000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
	FX				= FX_InrukTrollsMight
End

ModifierList InrukOrcsCunning
	Category			= SPELL
	Modifier			= ARMOR	50%
	Modifier			= DAMAGE_MULT 75%
	Duration			= 30000
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
	FX				= FX_InrukOrcsCunning
End




ChildObject ElvenThranduil WildMarauder			;INRUK OBJECT

	DisplayMeleeDamage = #MULTIPLY( 200 1 );;-;; 
	
	
ReplaceModule ModuleTag_01
	Draw = W3DHordeModelDraw ModuleTag_01dddd

		OkToChangeModelColor = Yes
		  
		StaticModelLODMode = No
		
		DefaultModelConditionState
		Model = WUMaraud_SKN
		End

		ModelConditionState = COMING_OUT_OF_FACTORY
			Model = WUMaraud_SKN
		End

	   	
		IdleAnimationState
			Flags = RANDOMSTART
			StateName = Bored
			Animation = IDLA
				AnimationName		= WUMaraud_SKL.WUMaraud_IDLB	; IDLA
				AnimationMode		= LOOP
				AnimationBlendTime	= 15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Planted"	then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end
//				if Prev == "Selected" or Prev == "Trans_Down_To_Up" then CurDrawableSetTransitionAnimState("TRANS_SB_Normal") end
			EndScript
		End

	    		
		AnimationState						= PASSENGER
			Animation						= Grabbed
				AnimationName				= WUMaraud_SKL.WUMaraud_FLYA
				AnimationMode				= LOOP
			End
		End
		
		AnimationState						= FREEFALL
			StateName						= STATE_Falling
			Animation						= Falling
				AnimationName				= WUMaraud_SKL.WUMaraud_FLYA
				AnimationMode				= LOOP
				AnimationBlendTime			= 10
			End
		End
			
		;------special pikeman porcupine formation animations-----------------------------------	
		
		AnimationState = ALTERNATE_FORMATION FIRING_OR_PREATTACK_A
	 		Animation = ATKC
				AnimationName		= WUMaraud_SKL.WUMaraud_ATKA
				AnimationMode		= LOOP
				UseWeaponTiming		= Yes	
			End
		End
		
		AnimationState = ALTERNATE_FORMATION FIRING_OR_PREATTACK_A WEAPONSTATE_CLOSE_RANGE ;TEMP
			Animation = ATKC
				AnimationName		= WUMaraud_SKL.WUMaraud_ATKA
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			StateName = PikeUp
		End
		
		AnimationState = ALTERNATE_FORMATION MOVING BACKING_UP
			Animation = Moving_Back
				AnimationName = WUMaraud_SKL.WUMaraud_BAKA	
				AnimationMode = LOOP
			End	
		End
		
		AnimationState						= DYING BURNINGDEATH
			Animation
				AnimationName				= WUMaraud_SKL.WUMaraud_DIEA
				AnimationMode				= ONCE
				AnimationBlendTime			= 10
			End
		End
		

		;--------------------normal animations---------------------------	    	    
		; --- stunned anims --- ;    	    
		AnimationState = STUNNED_FLAILING
			Animation = Flying_1
				AnimationName = WUMaraud_SKL.WUMaraud_FLYA
				AnimationMode = LOOP
			End
			Flags							= MAINTAIN_FRAME_ACROSS_STATES2
		End
	    
		AnimationState = DYING SPLATTED
 			Animation = Splat
				AnimationName = WUMaraud_SKL.WUMaraud_LNDA
				AnimationMode = ONCE
			End
		End
	    
	    
		; --- death anims --- ;

		AnimationState = DYING AFLAME
			Animation = Flaming_Death
				AnimationName = WUMaraud_SKL.WUMaraud_RUNB
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End
	    
		AnimationState = DYING
			Animation = Dying_2
				AnimationName = WUMaraud_SKL.WUMaraud_DIEA
				AnimationMode = ONCE
			End
		End

		AnimationState = STUNNED_STANDING_UP
			Animation = Standing_Back_Up
				AnimationName = WUMaraud_SKL.WUMaraud_GTPA
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End

		AnimationState						= STUNNED
			StateName						= STATE_Stunned
			Animation						= Splattered_On_Ground
				AnimationName				= WUMaraud_SKL.WUMaraud_LNDA
				AnimationMode				= ONCE
			End
		End

		
		AnimationState						= BURNINGDEATH
			Animation
				AnimationName				= WUMaraud_SKL.WUMaraud_MFDA
				AnimationMode				= LOOP
				Distance					= 120
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= WUMaraud_SKL.WUMaraud_IDLA
				AnimationMode				= LOOP
			End
		End

		AnimationState  = COMING_OUT_OF_FACTORY
			Animation = Being_Built
				AnimationName		= WUMaraud_SKL.WUMaraud_RUNB
				AnimationMode		= LOOP
				AnimationBlendTime	= 0
			End
		End	
		
;------------------ BIG WHAM SPECIAL ABILITY ----------------		

		AnimationState							= SPECIAL_WEAPON_ONE
			Animation						= CHRA
				AnimationName					= WUMaraud_SKL.WUMaraud_CHRA
				AnimationMode					= ONCE
				AnimationSpeedFactorRange			= 0.9 0.9
			End
;			Flags							= RANDOMSTART
		End

;------------------------------------------------------------
	    	
			
		AnimationState = MOVING BACKING_UP
			Animation = Moving_Back
				AnimationName = WUMaraud_SKL.WUMaraud_BAKA
				AnimationMode = LOOP
			End	
		End
	    
		AnimationState = MOVING EMOTION_AFRAID
			Animation = Moving_1
				AnimationName = WUMaraud_SKL.WUMaraud_RUNB
				AnimationMode = LOOP
			End
			Flags = MAINTAIN_FRAME_ACROSS_STATES
			ParticleSysBone = None InfantryDustTrails
		End
	    
		AnimationState = MOVING EMOTION_ALERT
			Animation = Moving_1
				AnimationName = WUMaraud_SKL.WUMaraud_RUNA ;RUNB
				AnimationMode = LOOP
				AnimationSpeedFactorRange = 1.6 1.6
			End
			Flags = MAINTAIN_FRAME_ACROSS_STATES
			ParticleSysBone = None InfantryDustTrails
		End
	    
		AnimationState = MOVING ATTACKING
			Animation = Moving_1
				AnimationName = WUMaraud_SKL.WUMaraud_RUNA ;RUNB
				AnimationMode = LOOP
				AnimationSpeedFactorRange = 1.6 1.6
			End
			Flags = MAINTAIN_FRAME_ACROSS_STATES
			ParticleSysBone = None InfantryDustTrails
		End
	    
		AnimationState = MOVING ENGAGED
			Animation = Moving_1
				AnimationName = WUMaraud_SKL.WUMaraud_RUNA ;RUNB
				AnimationMode = LOOP
				AnimationSpeedFactorRange = 1.6 1.6
			End
			Flags = MAINTAIN_FRAME_ACROSS_STATES
			ParticleSysBone = None InfantryDustTrails
		End

		AnimationState = MOVING
			Flags = RANDOMSTART
			Animation = Moving_1
				AnimationName = WUMaraud_SKL.WUMaraud_RUNB
				AnimationMode = LOOP
				AnimationSpeedFactorRange = 1.1 1.1
			End
			ParticleSysBone = None InfantryDustTrails
		End
	    

		; --- Attacking --- ;

		AnimationState =  FIRING_OR_PREATTACK_A
			Animation = KickSinceWeAreMelee
				AnimationName		= WUMaraud_SKL.WUMaraud_ATKA
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes	
			End
		End

		; --- emotions --- ;

		AnimationState							= WAR_CHANT
			Animation							= Chant
				AnimationName					= WUMaraud_SKL.WUMaraud_IDLA
				AnimationMode					= LOOP
			End
		End			

		AnimationState							= EMOTION_AFRAID
			Animation							= FERA
				AnimationName					= WUMaraud_SKL.WUMaraud_FERA
				AnimationMode					= LOOP
			End
			Flags								= RANDOMSTART
		End
		
		AnimationState							= EMOTION_CELEBRATING
			Animation							= CHRA
				AnimationName					= WUMaraud_SKL.WUMaraud_CHRA
				AnimationMode					= LOOP
			End
			Flags								= RANDOMSTART
		End
		
		AnimationState							= EMOTION_TAUNTING
			Animation
				AnimationName					= WUMaraud_SKL.WUMaraud_TNTA
				AnimationMode					= LOOP
			End
			Animation
				AnimationName					= WUMaraud_SKL.WUMaraud_TNTB
				AnimationMode					= LOOP
			End
			Flags								= RANDOMSTART
		End
		
		AnimationState							= EMOTION_POINTING
			Animation							= Pointing1
				AnimationName					= WUMaraud_SKL.WUMaraud_PNTA
				AnimationMode					= LOOP
			End
			Flags								= RANDOMSTART
		End

;		AnimationState							= EMOTION_ALERT
;			Animation							= ALERT
;				AnimationName					= WUMaraud_SKL.WUMaraud_IDLE
;				AnimationMode					= LOOP
;			End
;			Flags								= RESTART_ANIM_WHEN_COMPLETE MAINTAIN_FRAME_ACROSS_STATES2
;			BeginScript
;				Prev = CurDrawablePrevAnimationState()
;				if Prev == "PikeDown"	then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end
;			EndScript
;		End
			
;		AnimationState							= ATTACKING
;			Animation							= ALERT
;				AnimationName					= WUMaraud_SKL.WUMaraud_IDLE
;				AnimationMode					= LOOP
;			End
;			Flags								= RESTART_ANIM_WHEN_COMPLETE MAINTAIN_FRAME_ACROSS_STATES2
;			BeginScript
;				Prev = CurDrawablePrevAnimationState()
;				if Prev == "PikeDown"	then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end
;			EndScript
;		End
		
;		AnimationState							= ENGAGED
;			Animation							= ALERT
;				AnimationName					= WUMaraud_SKL.WUMaraud_IDLE
;				AnimationMode					= LOOP
;			End
;			Flags								= RESTART_ANIM_WHEN_COMPLETE MAINTAIN_FRAME_ACROSS_STATES2
;			BeginScript
;				Prev = CurDrawablePrevAnimationState()
;				if Prev == "PikeDown"	then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end
;			EndScript
;		End
		
;		AnimationState  = JUST_BUILT
;			Animation = Being_Built
;				AnimationName		= WUMaraud_SKL.WUMaraud_BLDA
;				AnimationMode		= ONCE
;				AnimationBlendTime	= 0
;			End
;		End

		AnimationState							= RAISING_FLAG
			Animation							= CHRA
				AnimationName					= WUMaraud_SKL.WUMaraud_CHRA
				AnimationMode					= LOOP
			End
		End

		AnimationState = SELECTED
			Animation				= Selected_Loop
				AnimationName		= WUMaraud_SKL.WUMaraud_ATNB
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
			StateName				= Selected
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Planted"	then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end			
				if Prev == "Bored" then CurDrawableSetTransitionAnimState("TRANS_BS_Normal") end
			EndScript
			Flags = RESTART_ANIM_WHEN_COMPLETE
		End
		

		; --- transition states --- ;
		
		TransitionState = Trans_Down_To_Up
			Animation = Transition
				AnimationName = WUMaraud_SKL.WUMaraud_PLTC
				AnimationMode = ONCE
			End
		End
	    
		TransitionState = Trans_Up_To_Down
			Animation = Transition
				AnimationName = WUMaraud_SKL.WUMaraud_PLTA
				AnimationMode = ONCE
			End
		End
	    
		TransitionState = TRANS_BS_Normal
			Animation = Transition
				AnimationName				= WUMaraud_SKL.WUMaraud_ATNA
				AnimationMode				= ONCE
				AnimationBlendTime			= 20
				AnimationMustCompleteBlend	= yes
			End
		End
	    
		TransitionState = TRANS_SB_Normal
			Animation = Transition
				AnimationName				= WUMaraud_SKL.WUMaraud_IDLA
				AnimationMode				= ONCE
				AnimationBlendTime			= 10
				AnimationMustCompleteBlend	= yes
			End
		End    
	    
	    
		TransitionState = TRANS_SR_Alt
		End
	    
		TransitionState = TRANS_RS_Alt
		End
	    
		TransitionState = TRANS_BS_Alt
		End
	    
		TransitionState = TRANS_SB_Alt
		End
	    
		TransitionState = TRANS_BR_Alt
		End
	    
		TransitionState = TRANS_RB_Alt
		End
    
	End ;Draw
END ;ReplaceModule

AddModule
 	Behavior = EmotionTrackerUpdate	Module_EmotionTracker
		TauntAndPointDistance		=	INFANTRY_TAUNT_POINT_RADIUS		; max distance to taunted/pointed objet
		TauntAndPointUpdateDelay	=	1000	; how often scan (milliseconds)
		TauntAndPointExcluded		=	NONE
		AfraidOf					=	EMOTION_AFRAIDOF_OBJECTFILTER
		AlwaysAfraidOf				=	EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
		PointAt						=	EMOTION_POINTAT_OBJECTFILTER
		HeroScanDistance			=	150
		FearScanDistance			=	INFANTRY_FEAR_SCAN_RADIUS

		AddEmotion	=	Terror_Base
		AddEmotion	=	Doom_Base
		//	AddEmotion	=   BraceForBeingCrushed_Base		// Pikemen don't fear getting crushed
		AddEmotion	=	UncontrollableFear_Base_Evil
		AddEmotion	=	FearIdle_Base
		AddEmotion	=	FearBusy_Base
		AddEmotion	=	Point_Base

		AddEmotion	=	Taunt_Base	
		AddEmotion	=	CheerIdle_Base
		AddEmotion	=	CheerBusy_Base
		AddEmotion	=	HeroCheerIdle_Base
		AddEmotion	=	HeroCheerBusy_Base
		AddEmotion	=	Alert_Base
	End
END

	CommandPoints		= 0
	Scale			= 0.82
	DisplayName		= Inruk
	KindOf			= PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP ATTACK_NEEDS_LINE_OF_SIGHT 
	VisionRange			= VISION_STANDARD_MELEE
	ShroudClearingRange 		= SHROUD_CLEAR_TROLL

	LocomotorSet
		Locomotor     = HumanLocomotor
		Condition     = SET_NORMAL
		Speed         = 50		
	End

	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    InrukPike
	End
	

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_ForgedBlades
		UpgradeToGrant = Upgrade_WildForgedBlades
	End 
End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_HeavyArmor
		UpgradeToGrant = Upgrade_WildHeavyArmor
	End 
End

;----------- TROLL'S MIGHT --------------

  	;;.;;	Behavior = SpecialPowerModule ModuleTag_TrollsMightStarter
	;;.;;		SpecialPowerTemplate    = SpecialAbilityLegendsTrollsMight
	;;.;;		StartsPaused		= No
	;;.;;	End
    ;;.;;	
	;;.;;	Behavior = HeroModeSpecialAbilityUpdate ModuleTag_TrollsMightUpdate
	;;.;;		SpecialPowerTemplate    = SpecialAbilityLegendsTrollsMight
	;;.;;		HeroAttributeModifier	= InrukTrollsMight
	;;.;;		HeroEffectDuration	= 30000 ; this should sync with the auto ability delay re-fire time in commandButtons.ini
	;;.;;		UnpackTime              = 1 ; insant unpack
	;;.;;		TriggerSound		= AragornBladeMaster
	;;.;;	End

	Behavior = SpecialPowerModule ModuleTag_TrollsMightStarter
		SpecialPowerTemplate = SpecialAbilityLegendsTrollsMight
		UpdateModuleStartsAttack		= Yes ;;-;;
	End
	Behavior = ActivateModuleSpecialPower ModuleTag_TrollsMightUpdate  ;;-;;
		SpecialPowerTemplate			= SpecialAbilityLegendsTrollsMight
		TriggerSpecialPower				= ModuleTag_TriggerMode1
		UnpackTime              		= 500
		PackTime                		= 500
		UnpackingVariation				= 2 ;; sets PACKING_TYPE_2
		TriggerSound					= AragornBladeMaster
		End
	Behavior = SpecialPowerModule ModuleTag_TriggerMode1 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyOne
		UpdateModuleStartsAttack		= No
		AttributeModifier				= InrukTrollsMight
		AttributeModifierRange			= 1
		AttributeModifierAffectsSelf	= Yes
		AttributeModifierAffects		= ANY +HERO
	End

	Behavior = AISpecialPowerUpdate SpecialPowerNaturesFavour
		CommandButtonName = Command_ConstructGoblinTroll ;Command_ConstructGoblinFighterHorde
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End


;----------- ORC'S CUNNING ---------------

  	;;.;;	Behavior = SpecialPowerModule ModuleTag_OrcsCunningStarter
	;;.;;		SpecialPowerTemplate    = SpecialAbilityLegendsOrcsCunning
	;;.;;		StartsPaused		= No
	;;.;;	End
    ;;.;;	
	;;.;;	Behavior = HeroModeSpecialAbilityUpdate ModuleTag_OrcsCunningUpdate
	;;.;;		SpecialPowerTemplate    = SpecialAbilityLegendsOrcsCunning
	;;.;;		HeroAttributeModifier	= InrukOrcsCunning
	;;.;;		HeroEffectDuration	= 30000 ; this should sync with the auto ability delay re-fire time in commandButtons.ini
	;;.;;		UnpackTime              = 1 ; insant unpack
	;;.;;		TriggerSound		= AragornBladeMaster
	;;.;;	End

	Behavior = SpecialPowerModule ModuleTag_OrcsCunningStarter
		SpecialPowerTemplate = SpecialAbilityLegendsOrcsCunning
		UpdateModuleStartsAttack		= Yes ;;-;;
	End
	Behavior = ActivateModuleSpecialPower ModuleTag_OrcsCunningUpdate  ;;-;;
		SpecialPowerTemplate			= SpecialAbilityLegendsOrcsCunning
		TriggerSpecialPower				= ModuleTag_TriggerMode2
		UnpackTime              		= 500
		PackTime                		= 500
		UnpackingVariation				= 2 ;; sets PACKING_TYPE_2
		TriggerSound					= AragornBladeMaster
		End
	Behavior = SpecialPowerModule ModuleTag_TriggerMode2 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyTwo
		UpdateModuleStartsAttack		= No
		AttributeModifier				= InrukOrcsCunning
		AttributeModifierRange			= 1
		AttributeModifierAffectsSelf	= Yes
		AttributeModifierAffects		= ANY +HERO
	End
	Behavior = AISpecialPowerUpdate SpecialPowerNaturesFavour
		CommandButtonName = Command_ConstructGoblinFighterHorde
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End

;------------ BIG WHAM -------------------

AddModule
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WhamEnabler
		SpecialPowerTemplate		= SpecialAbilityInrukBigWham
		TriggeredBy			= Upgrade_ThranduilWildWalk
	End
END

AddModule
	Behavior = SpecialPowerModule ModuleTag_WhamStarter       
		SpecialPowerTemplate		= SpecialAbilityInrukBigWham
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WhamWeaponFireUpdate   
		SpecialPowerTemplate		= SpecialAbilityInrukBigWham
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes

		UnpackTime			= 1100 
		PackTime			= 3300	
		FreezeAfterTriggerDuration	= 800 ; Hold AI for this long after we fire.
		
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 30.0
		
		SpecialWeapon			= InrukBigWham
	End
END

AddModule
	Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
		CommandButtonName = SpecialAbilityInrukBigWham
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
		SpecialPowerRadius = 30
	End
END

;----------------------------------------

AddModule
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior		; Autoability enabler
	End
END

AddModule
	Behavior = StancesBehavior ModuleTag_StancesBehavior			; Allow stances
 	       StanceTemplate = Hero
	End
END

ReplaceModule ModuleTag_porcupineFormation
	Body	= PorcupineFormationBodyModule ModuleTag_BodyModule
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth			= 3400				; 3000 was too little
		MaxHealthDamaged		= 700
		DamageWeaponTemplate		= PikemenPorcupineDamage
		CrushDamageWeaponTemplate	= PikemenPorcupineCrushDamage
		CrusherLevelResisted		= 1;	;What crusher level can I resist?: 1 = infantry, 2 = trees, 3 = vehicles
		BurningDeathBehavior 		= Yes
		BurningDeathFX       		= FX_InfantryBurningFlame
	End
END

  AddModule ; Regeneration for Inruk (I don't mind the other marauders regenerating too)
	Behavior = AutoHealBehavior ModuleTag_LegendsFaramirHealing
		StartsActive		  =	Yes
		HealingAmount		  =	100 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY
		HealOnlyIfNotInCombat =	Yes
	End
  END

	CommandSet		= InrukCommandset

END

;-------------------- END INRUK -----------------------
;------------------------------------------------------













;--------------------------------------------------------
;CUSTOM HERO 1 - AEGION, THE RANGER
;--------------------------------------------------------



;------------SWIFT THE WHITE HAWK------------

Locomotor FellBeastLocomotor ; For the eagles
	Surfaces		= AIR ; GROUND RUBBLE
	MinSpeed                = 0%
	SlowTurnRadius		= 32.0 ;  From a standing starts, 40 foot radius.
	FastTurnRadius		= 48.0 ; Once it gets moving, uses a 60 foot radius to turn.
	TurnTime		= 3500
	TurnTimeDamaged		= 4500
	Acceleration		= 400  ; 1 second to accelerate to full speed.
	NonDirtyTransform	= Yes ; this stops unit from being regiestered in the collision manager 

	Lift                    = 100%
	LiftDamaged             = 100%
	Braking 		= 1000  ; 1 second to brake from full speed.
	MinTurnSpeed            = 30%
	PreferredHeight         = 60      ; cruise height
	PreferredAttackHeight   = 5 ; attack height
	AllowAirborneMotiveForce = Yes
	ZAxisBehavior           = SURFACE_RELATIVE_HEIGHT
	Appearance = GIANT_BIRD
	
	CloseEnoughDist	= 2
	PitchStiffness = 0.5                  ;  stiffness of the "springs" in the suspension forward & back.
	RollStiffness = 0.4                   ;  stiffness of the "springs" in the suspension side to side.
	PitchDamping = 0.9                    ;  How fast it damps.  0=perfect spring, bounces forever.  1=glued to terrain.
	RollDamping = 0.7                     ;  How fast it damps.  0=perfect spring, bounces forever.  1=glued to terrain.
	ForwardVelocityPitchFactor = 0        ;  How much velocity will cause the front to lift/dip
	LateralVelocityRollFactor = 0.8       ;  How much cornering will cause the chassis to roll.
	Apply2DFrictionWhenAirborne = Yes
	AirborneTargetingHeight = 25
	LocomotorWorksWhenDead = Yes          ; JetSlowDeathBehavior needs this to function correctly
  
	RudderCorrectionDegree		= 0.099 ; makes movement appear noisier, swimmy, not so synthetic.. drawable only
	RudderCorrectionRate		= 0.027
	ElevatorCorrectionDegree	= 0.163
	ElevatorCorrectionRate		= 0.016
	AeleronCorrectionDegree		= 0.073
	AeleronCorrectionRate		= 0.021
	
	SwoopStandoffRadius		=	310.0;
	SwoopStandoffHeight		=	50.0;
	SwoopTerminalVelocity	=	0.18;
	SwoopAccelerationRate	=	0.012
	SlideIntoPlaceTime      =	900
	;SwoopSpeedTuningFactor	=   0.8 
	
End

Weapon SwiftPlowAttack  
	ClearNuggets ;;.;;
    RadiusDamageAffects = ENEMIES ALLIES NOT_SIMILAR
	AttackRange				= 24.0
	AcceptableAimDelta			= 5			; Just needs to sort of face in the general direction.
	DelayBetweenShots			= 4000			; time between shots, msec
	FireFX					= FX_BuildingHitByFlyer

	AntiAirborneVehicle			= Yes			;allows attack of flying units
	AntiAirborneMonster			= Yes			;no... THIS allows attack of flying units because somebody was a funny man.
	AntiAirborneInfantry			= Yes	  
	MeleeWeapon				= No
	CanSwoop				= Yes
	ChaseWeapon				= Yes ; Not full melee, but we get to move to attack a passive acquire, even if player owned.

	DamageNugget                        				; A basic Nugget that just does damage
		Damage				= 50 ; 250
		DamageScalar   			= 1000% NONE +MACHINE
		DamageScalar  			= 30% NONE +HERO
		Radius				= 25.0 ;30
		DelayTime			= 0
		DamageType			= HERO
		DamageFXType			= CLUBBING
		DeathType			= NORMAL
	End
	DamageNugget                    		    		; A basic Nugget that just does damage
		Damage				= 50 ; 200  
		Radius				= 25.0 ;30
		DelayTime			= 1
		DamageType			= FLY_INTO
		DamageFXType			= CLUBBING
		DeathType			= NORMAL
	End
	DamageNugget                        				; A basic Nugget that just does damage
		Damage				= 100; 500
		DamageScalar   			= 1000% NONE +MACHINE
		DamageScalar  			= 30% NONE +HERO
		Radius				= 25.0 ;30
		DelayTime			= 0
		DamageType			= HERO
		DamageFXType			= CLUBBING
		DeathType			= NORMAL
	End
	MetaImpactNugget        				        ; A Nugget that throws things back with force
;		HeroResist			= 50.0			
		ShockWaveAmount   		= 30.0
		ShockWaveRadius   		= 30.0 ;48
		ShockWaveTaperOff 		= 0.5
	End
End

Weapon SwiftClawAttack 
	AttackRange				= 20.0
	AcceptableAimDelta			= 5			; Just needs to sort of face in the general direction.
	DelayBetweenShots			= 250			; time between shots, msec
	ClipSize               			= 2			;4	; how many shots in a Clip (0 == infinite)
	ClipReloadTime         			= 2000
	AutoReloadsClip		    		= Yes	
	FireFX					= FX_EagleClawAttack
	AntiAirborneVehicle			= Yes			;allows attack of flying units
	AntiAirborneInfantry			= Yes	  
	AntiAirborneMonster			= Yes
	MeleeWeapon				= Yes
	CanSwoop				= Yes
	ChaseWeapon			= Yes ; Not full melee, but we get to move to attack a passive acquire, even if player owned.
	PreferredTargetBone = B_HEAD

	DamageNugget							; A basic Nugget that just does damage
		Damage				= 600 ; 500
		Radius				= 10.0
		DelayTime     			= 1		
		DamageType			= HERO ; ;SIEGE
		DamageFXType			= CLUBBING
		DeathType			= NORMAL
	End
End

ExperienceLevel	GondorGwaihirLevel1	; So Spike isn't level 10
	TargetNames					=	GondorGwaihir ElvenFortressEagle
	RequiredExperience				=	1
	ExperienceAward					=	50
	Rank						=	1	;10
END	

Armor SpikeArmor
  Armor = DEFAULT         100%
  Armor = SLASH           30%
  Armor = PIERCE          20%
  Armor = SPECIALIST      0%
  Armor = CRUSH           0%
  Armor = SIEGE           100%
  Armor = FLAME           30%
  Armor = MAGIC           150%
  Armor = HERO            100%
  Armor = HERO_RANGED     60%
  Armor = STRUCTURAL	  50%
  FlankedPenalty 	 = 50%
  Armor = CAVALRY_RANGED   20%
End


Object GondorGwaihir ; Elf CaH Summon Familiar / Swift the White Hawk

	DisplayName = OBJECT:Spike

	KindOf				= PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER CANNOT_RETALIATE

	Scale = 0.19

	CrusherLevel           = 1	; So he can't take down trees (2) and catapults (3)

	WeaponSet
		Conditions		= None

		Weapon             	= PRIMARY		SwiftPlowAttack
		PreferredAgainst	= PRIMARY		MACHINE HORDE	 ;STRUCTURE		

		Weapon			= SECONDARY		SwiftClawAttack
		PreferredAgainst	= SECONDARY		MONSTER CAVALRY INFANTRY
	End

	ArmorSet
		Conditions      = None
		Armor           = SpikeArmor
		DamageFX        = GwaihirDamageFX
	End

	VisionRange = 1
	ShroudClearingRange = 0
	CommandPoints = 0

	FormationPreviewDecal 
        	Texture = FPflyingUnitDecal
        	Width = 48
        	Height = 48
    	End

ReplaceModule ModuleTag_SlowDeath
	Behavior = SlowDeathBehavior ModuleTag_SlowDeathNew
		DeathTypes = ALL -FADED
		FadeDelay = 0
		FadeTime = 2500
		DestructionDelay = 2500
		;Sound = INITIAL EagleVoiceDie	
	        DeathFlags = DEATH_2
	End
END

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_021
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 2000	; 1000 HP was TOO weak
		HealingBuffFx = None
		DodgePercent      		= 55
	End
END

	LocomotorSet
		Locomotor = FellBeastLocomotor
		Condition = SET_NORMAL 
		Speed     = 80 ; 120
	End
	LocomotorSet
		Locomotor = FellBeastLocomotor
		Condition = SET_SUPERSONIC 
		Speed     = 115 ; 165
	End
	LocomotorSet
		Locomotor = FellBeastLocomotor
		Condition = SET_WANDER 
		Speed     = 50 ; 88
	End

	PathfindDiameter = 20.0

;AddModule							; Now a script resets Aegion's summon ability when Spike dies.
;	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
;		MinLifetime		= 120000
;		MaxLifetime		= 120000
;		DeathType		= FADED
;	End
;END

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

  AddModule
	Behavior = SubObjectsUpgrade Body_ReskinWhiteHawk
		TriggeredBy		= Upgrade_GandalfWhite
		UpgradeTexture		= GUGwaihjir.tga		0 GUGwaihir_White.tga
		RecolorHouse		= No
	End
  End

	HealthBoxScale		= 0.8
	HealthBoxHeightOffset	= -4.0

	Geometry		= CYLINDER
	GeometryMajorRadius 	= 8.0
	GeometryMinorRadius 	= 8.0
	GeometryHeight		= 6.0

	GeometryIsSmall		= Yes

END




;-----AEGION'S STUFF FOR SWIFT THE HAWK-----

Upgrade Upgrade_AegionLevel8 ; Make sure you give this when Aegion gets to lv8 (ExpSystem on this map.ini)
  Type = OBJECT
End


ObjectCreationList OCL_SpawnSwiftTheHawk
	CreateObject
		ObjectNames = GondorGwaihir
		Count = 1
		FadeIn = Yes
		FadeTime = 2000
		IgnoreCommandPointLimit = Yes
		Disposition = LIKE_EXISTING
	End
End

SpecialPower SpecialAbilityLegendsSwiftTheHawk
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 180000	 ; After Spike dies, he can be summoned again in 3 mins
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= EagleVoiceSelect
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End

;----------------------AEGION COMMANDBUTTONS----------------------

CommandButton Command_SpellBookEagleAllies ; Swift, the hawk
	Command			  	= SPECIAL_POWER
	SpecialPower	   		= SpecialAbilityLegendsSwiftTheHawk
	TextLabel		  	= CONTROLBAR:LegendsSwiftTheHawk	
	DescriptLabel			= CONTROLBAR:TooltipLegendsSwiftTheHawk
	LacksPrerequisiteLabel  	= CONTROLBAR:TooltipLegendsSwiftTheHawkNoLevel
	ButtonImage			= SBGood_EagleAllies
	Options				= NEED_TARGET_POS CONTEXTMODE_COMMAND NEED_UPGRADE
	NeededUpgrade			= Upgrade_AegionLevel8
	RadiusCursorType  		= EagleAlliesRadiusCursor
	CursorName		  	= Bombard
	InvalidCursorName		= GenericInvalid	 
	ButtonBorderType		= ACTION
	InPalantir		 	= Yes
End

CommandButton Command_ConstructInnGondorRangerHorde		; Storyteller
	Command			= TOGGLE_STANCE
	Options			= NONPRESSABLE
	Upgrade			= NONE
	Object			= None
	NeededUpgrade		= None
	NeededUpgradeAny	= No
	TextLabel		= CONTROLBAR:LegendsStoryTeller
	ButtonImage		= BCInn_DunedainRanger
	ButtonBorderType   	= ACTION
	DescriptLabel		= CONTROLBAR:ToolTipLegendsStoryTeller
	InPalantir		= Yes
	Radial			= No
	ShowProductionCount	= No
	UnitSpecificSound	= Silence
End

CommandButton Command_BlackArrows ; Toggle Arrows
	Command			= TOGGLE_WEAPONSET
	FlagsUsedForToggle	= WEAPONSET_TOGGLE_1
	SpecialPower		= NONE
	Options		 	= TOGGLE_IMAGE_ON_WEAPONSET
	NeededUpgrade		= Upgrade_GandalfWhite
	ButtonImage		= HSFaramirWoundingArrow
	CursorName		= Bombard
	InvalidCursorName	= GenericInvalid
	TextLabel		= CONTROLBAR:LegendsToggleArrows
	DescriptLabel		= CONTROLBAR:ToolTipLegendsToggleArrows
	InPalantir		= Yes
	ButtonBorderType   	= ACTION
End

CommandButton Command_PurchaseUpgradeGondorArcherFireArrows ; Fire Arrows
	Command			= TOGGLE_STANCE ; SPECIAL_POWER
;	SpecialPower            = SpecialAbilityAegionFlaming
	Options			= NONPRESSABLE
	Upgrade			= None
	TextLabel		= CONTROLBAR:LegendsAegionFlamingArrows
	DescriptLabel		= CONTROLBAR:ToolTipLegendsAegionFlamingArrows
	ButtonImage		= BGArcheryRange_FireArrows
	ButtonBorderType	= ACTION
	Radial			= No
	InPalantir		= Yes
	DisableOnModelCondition = WEAPONSET_TOGGLE_1
End

CommandButton Command_PurchaseTechnologyElvenSilverthornArrows ; Silverthorn Arrows
	Command			= TOGGLE_STANCE ; SPECIAL_POWER
;	SpecialPower            = SpecialAbilityAegionSilverthorn
	Options			= NONPRESSABLE
	Upgrade			= None
	TextLabel		= CONTROLBAR:AegionSilverthornArrows
	ButtonImage		= BEEregionForge_SilverthornArrows
	ButtonBorderType	= ACTION
	DescriptLabel		= CONTROLBAR:ToolTipAegionSilverthornArrows
	Radial			= No
	InPalantir		= Yes
	EnableOnModelCondition  = WEAPONSET_TOGGLE_1
End



CommandSet AegionCommandSet
	 1 = Command_ToggleStance
	 2 = Command_SpellBookEagleAllies 			; Swift the Hawk
	 3 = Command_ConstructInnGondorRangerHorde			; Storyteller
	 4 = Command_BlackArrows				; Toggle arrows
	 5 = Command_PurchaseUpgradeGondorArcherFireArrows	; Flaming Arrows
	 6 = Command_PurchaseTechnologyElvenSilverthornArrows	; Silverthorn Arrows

    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
End

ModifierList AegionNPCOverpowering
  	Category					= SPELL
;	Modifier					= HEALTH_MULT 120%
  	Modifier					= DAMAGE_MULT 220%	; So helps more take down the Boss
;	Duration					= 0			; Lasts forever
;	FX = FX_NightmareFire
;	ModelCondition = WEAPONSET_TOGGLE_1
End


ModifierList AegionPowerArrows
  	Category	= WEAPON
  	Modifier	= DAMAGE_MULT 600%	; This good?
End

ModifierList Storyteller
	Category					= LEADERSHIP
	Modifier					= EXPERIENCE 115%
	Duration					= 3000
End


ExperienceLevel	BoromirLevel6
	TargetNames						=	GondorBoromir	
	RequiredExperience					=	780
	ExperienceAward						=	BOROMIR_LVL6_EXP_AWARD	
	AttributeModifiers					=	HeroLevelUpDamage5
	Rank							=	6
	LevelUpFx						=	FX:GandalfLevelUp1FX
	;LevelUpOCL						=	OCL_GandalfLevelUp1OCL
	SelectionDecal
		Texture						=	decal_hero_good
		Style						=	SHADOW_ALPHA_DECAL
		OpacityMin					=	50%	
		OpacityMax					=	100%
		MinRadius					=	40
		MaxRadius					=	200
		MaxSelectedUnits				=	1	
	End	
END	

ExperienceLevel	BoromirLevel7
	TargetNames						=	GondorBoromir	
	RequiredExperience					=	1110
	ExperienceAward						=	BOROMIR_LVL7_EXP_AWARD	
	AttributeModifiers					=	HeroLevelUpDamage6
	Rank							=	7
	Upgrades						=   	Upgrade_FaramirCaptainOfGondor
	LevelUpFx						=	FX:GandalfLevelUp1FX
	;LevelUpOCL						=	OCL_GandalfLevelUp1OCL
  SelectionDecal
		Texture						=	decal_hero_good
		Style						=	SHADOW_ALPHA_DECAL
		OpacityMin					=	50%	
		OpacityMax					=	100%
		MinRadius					=	40
		MaxRadius					=	200
		MaxSelectedUnits				=	1	
	End	
END	

ExperienceLevel	BoromirLevel8
	TargetNames						=	GondorBoromir	
	RequiredExperience					=	1390
	ExperienceAward						=	BOROMIR_LVL8_EXP_AWARD	
	AttributeModifiers					=	HeroLevelUpDamage7
	Rank							=	8
	Upgrades						=   	Upgrade_AegionLevel8
	LevelUpFx						=	FX:GandalfLevelUp1FX
	;LevelUpOCL						=	OCL_GandalfLevelUp1OCL
	SelectionDecal
		Texture						=	decal_hero_good
		Style						=	SHADOW_ALPHA_DECAL
		OpacityMin					=	50%	
		OpacityMax					=	100%
		MinRadius					=	40
		MaxRadius					=	200
		MaxSelectedUnits				=	1
	End	
END	

ExperienceLevel	BoromirLevel9
	TargetNames						=	GondorBoromir	
	RequiredExperience					=	1670 ; 1670 Can't go above this for some reason
	ExperienceAward						=	BOROMIR_LVL9_EXP_AWARD	
	AttributeModifiers					=	HeroLevelUpDamage8
	Rank							=	9
	LevelUpFx						=	FX:GandalfLevelUp1FX
	;LevelUpOCL						=	OCL_GandalfLevelUp1OCL
	SelectionDecal
		Texture						=	decal_hero_good
		Style						=	SHADOW_ALPHA_DECAL
		OpacityMin					=	50%	
		OpacityMax					=	100%
		MinRadius					=	40
		MaxRadius					=	200
		MaxSelectedUnits				=	1	
	End	
END	

ExperienceLevel	BoromirLevel10
	TargetNames						=	GondorBoromir	
	RequiredExperience					=	1950 ;1950
	ExperienceAward						=	BOROMIR_LVL10_EXP_AWARD	
	AttributeModifiers					=	HeroLevelUpDamage9
	Rank							=	10
	LevelUpFx						=	FX:GandalfLevelUp1FX
	;LevelUpOCL						=	OCL_GandalfLevelUp1OCL
	SelectionDecal
		Texture						=	decal_hero_good
		Style						=	SHADOW_ALPHA_DECAL
		OpacityMin					=	50%	
		OpacityMax					=	100%
		MinRadius					=	40
		MaxRadius					=	200
		MaxSelectedUnits				=	1	
	End	
END








;-----------------AEGION OBJECT----------------------
;----------------------------------------------------

ChildObject GondorBoromir DwarvenDain



  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_GandalfWhiteUpgrade
		UpgradeToGrant = Upgrade_GandalfWhite ; Upgrade I give it automatically to easily give other initial stuff to the unit
	End 
  End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_SuperArrowDamageBoss ; Increases the damage of Aegion (Warning: Both for bow (silverthorn) and "sword" (flaming))
		TriggeredBy	  	=	Upgrade_LegolasKnifeFighter
		AttributeModifier 	=	AegionNPCOverpowering
	End
  END

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_AegionDamageIncrease 	; Gives Aegion an attribute modifier that increases his damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	AegionPowerArrows
	End
  END

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_AegionArmorAtt 	; Gives Aegion CaH ARMOR ATTRIBUTE 14 (16 was too strong)
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	ArmorAttribute14
	End
  END


	ReplaceModule ModuleTag_05
	Behavior = SlowDeathBehavior ModuleTag_051
		DeathTypes = ALL
		SinkDelay = 5000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 20000
		Sound = INITIAL HeroEvilManVoiceDie
		ShadowWhenDead = No
	End
	End

	EvaEventDieOwner 		= None

	RemoveModule Icon

	DisplayName = Aegion

	SelectPortrait = CPHaradrim
	ButtonImage = HICAHHaradrim

  AddModule
	Behavior = StancesBehavior ModuleTag_StancesBehavior			; Allow stances
 	       StanceTemplate = Hero
	End
  END

	AddModule
	Behavior = GrantUpgradeCreate ModuleTag_12
		UpgradeToGrant = Upgrade_ElvenArrows
	End 
	End

	AddModule
	Behavior = GrantUpgradeCreate ModuleTag_13
		UpgradeToGrant = Upgrade_WildFireArrows
	End 
	End

;--------SWIFT THE HAWK---------

AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsSwiftTheHawk
	SpecialPowerTemplate	= SpecialAbilityLegendsSwiftTheHawk
	TriggeredBy		= Upgrade_AegionLevel8
End
END

AddModule
Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsSwiftTheHawk
	SpecialPowerTemplate	= SpecialAbilityLegendsSwiftTheHawk
	OCL			= OCL_SpawnSwiftTheHawk
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End
END

;---------Storyteller----------

	Behavior = AttributeModifierAuraUpdate ModuleTag_Storyteller
		StartsActive	= Yes
		BonusName	= Storyteller
		RefreshDelay	= 2000
		Range		= 150
		ObjectFilter	= NONE +HERO
	End

;------------------------------


	AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = CHCM_FN.tga		0 CHHW_SMN_01.tga
		RecolorHouse		   = No
	End
	End

	AddModule
	Behavior = SubObjectsUpgrade Hero4_Upgrade1
	TriggeredBy		   = Upgrade_GandalfWhite
	HideSubObjects		   = CLUB_03 ; Commandant Club
	HideSubObjects		   = HMR_03 ; Hammer
	HideSubObjects		   = SWRD_03 ; Short Sword
	HideSubObjects		   = SWRD_04 ; Short Sword
	HideSubObjects		   = CMSword01 ;Sabre
	HideSubObjects		   = CMSword02 ;Small Halbred


;	HideSubObjects		   = SLDR_01
	HideSubObjects		   = SLDR_02
	HideSubObjects		   = CHEST_01
	HideSubObjects		   = CHEST_02

	HideSubObjects		   = HLMT_01
	HideSubObjects		   = HLMT_02
	HideSubObjects		   = HLMT_03
	HideSubObjects		   = HLMT_04
	HideSubObjects		   = HLMT_05

	HideSubObjects		   = GNLT_01
	HideSubObjects		   = GNLT_02

	HideSubObjects		   = BOOT_01
	HideSubObjects		   = BOOT_02

	HideSubObjects		   = ARROW

	FadeTimeInSeconds      = 0.0
	End
	End

; Easterling cah model is 	CHCM_CM_U_SKN
; here is the second model	CHCM_FN_U_SKN
; Easterling cah Skeleton	CHCM_CM_C_SKL
; here is the 2nd skeleton	CHCM_CM_U_SKL

	;Draw module
ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

		DefaultModelConditionState
			Model               		= CHCM_FN_U_SKN
			Skeleton            		= CHCM_CM_U_SKL
			WeaponLaunchBone	= PRIMARY B_HandR
;			ParticleSysBone = B_SWORD GondorSwordHitFlash FollowBone:Yes ; Makes a flash effect whenever an order is given or something...
		END

//================== ANIMATIONS =================================================================


//----------- Climbing/rappelling ---------------
AnimationState						= CLIMBING WEAPONSET_TOGGLE_1
	StateName						= STATE_Climbing
	Animation						= Climbing
		AnimationName				= CHCM_CM_U_WALB
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing_WeaponToggle") return end
	EndScript
End
TransitionState = Trans_RunningToClimbing_WeaponToggle
	Animation = Transition
		AnimationName = CHCM_CM_B_WALA
		AnimationMode = ONCE
	End
End

AnimationState						= CLIMBING
	StateName						= STATE_Climbing
	Animation						= Climbing
		AnimationName				= CHCM_CM_U_WALB
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing_WeaponToggle") return end
	EndScript
End
TransitionState = Trans_RunningToClimbing_WeaponToggle
	Animation = Transition
		AnimationName = CHCM_CM_B_WALA
		AnimationMode = ONCE
	End
End

AnimationState						= RAPPELLING WEAPONSET_TOGGLE_1
	StateName						= STATE_Rappelling
	Animation						= Rapelling
		AnimationName				= CHCM_CM_U_WALD
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRappelling") return end
	EndScript
End

AnimationState						= RAPPELLING
	StateName						= STATE_Rappelling
	Animation						= Rapelling
		AnimationName				= CHCM_CM_U_WALD
		AnimationMode				= LOOP
		AnimationBlendTime			= 10
	End
	BeginScript//script to set transition from moving
		Prev = CurDrawablePrevAnimationState()
		if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRappelling") return end
	EndScript
End

TransitionState = Trans_ClimbingToRappelling
	Animation = Transition
		AnimationName = CHCM_CM_U_WALC
		AnimationMode = ONCE
	End
End

TransitionState = Trans_RappellingToRunning_WeaponToggle
	Animation = Transition
		AnimationName = MUGblnSwrd_B_WALE
		AnimationMode = ONCE
	End
End

TransitionState = Trans_RappellingToRunning
	Animation = Transition
		AnimationName = MUGblnSwrd_U_WALE
		AnimationMode = ONCE
	End
End
	
//Mounted?

TransitionState				=	TRANS_Select
	Animation
		AnimationName		=	CHCM_CM_M_ATNA
		AnimationMode		=	ONCE
	End
End

// --------- UNMOUNTED  ------------

//------------------  DYING -------------------------------------------------------------

// --- Flying through the air.
AnimationState        = STUNNED_FLAILING WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = CHCM_CM_B_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Bow ;STATE_SWORD
	Animation
		AnimationName     = CHCM_CM_B_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

// --- Dying anims
AnimationState        = DYING SPLATTED WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = CHCM_CM_B_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Bow ;STATE_Sword
	Animation
		AnimationName     = CHCM_CM_B_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = CHCM_CM_B_DIEA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Bow ; STATE_Sword
	Animation
		AnimationName     = CHCM_CM_B_DIEA
		AnimationMode     = ONCE
	End
End


// --- Stunned anims


AnimationState        = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = CHCM_CM_B_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Bow ; STATE_Sword
	Animation
		AnimationName     = CHCM_CM_B_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED WEAPONSET_TOGGLE_1
	StateName           = STATE_Bow
	Animation
		AnimationName     = CHCM_CM_B_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Bow ;STATE_Sword
	Animation
		AnimationName     = CHCM_CM_B_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------



//--------------------- Wound Arrow anim
AnimationState        =  SPECIAL_WEAPON_TWO
	StateName = STATE_Bow
	Animation
		AnimationName       = CHCM_CM_U_SPCL CHCM_CM_U_ATKC
		AnimationMode       = ONCE
	End
	FrameForPristineBonePositions = 59
	BeginScript
		CurDrawableShowSubObject("arrow")
	EndScript
End
		
//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHCM_CM_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End

		//--- Running with bow
		AnimationState			= MOVING WEAPONSET_TOGGLE_1
			StateName           = STATE_RunningBow
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHCM_CM_B_RUNA
				AnimationSpeedFactorRange = 0.85 0.85
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
				if Prev == "STATE_RunningSword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning_WeaponToggle") return end
			EndScript
		End

		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningBow ;STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHCM_CM_B_RUNA
				AnimationSpeedFactorRange = 0.85 0.85
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
				if Prev == "STATE_RunningSword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning_WeaponToggle") return end
			EndScript
		End

		//---------------------------------------------------
		//New style firing with bow
		AnimationState					=	PREATTACK_A WEAPONSET_TOGGLE_1
			StateName					=	STATE_Firing
			Animation					=	ReadyToDrawn
				AnimationName			=	CHCM_CM_B_ATKA1
				AnimationMode			=	ONCE
				//AnimationBlendTime		=	10
			End
		End

		AnimationState					=	FIRING_OR_RELOADING_A WEAPONSET_TOGGLE_1
			StateName					=	STATE_Firing
			Animation					=	LooseReloadDraw
				AnimationName			=	CHCM_CM_B_ATKA2
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 1.1 1.1		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
				//AnimationBlendTime		=	10
			End
		End


		AnimationState				= FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
			StateName				= STATE_Firing
			Animation
				AnimationName		= CHCM_CM_B_ATKA1
				AnimationMode		= ONCE
				UseWeaponTiming		= No			// UseWeaponTiming plus random weapon field equals desync.  Leaving as warning
			End
		End

		AnimationState					=	PREATTACK_A
			StateName				=	STATE_Firing
			Animation				=	ReadyToDrawn
				AnimationName			=	CHCM_CM_B_ATKA1
				AnimationMode			=	ONCE
				//AnimationBlendTime		=	10
			End
		End

		AnimationState					=	FIRING_OR_RELOADING_A
			StateName					=	STATE_Firing
			Animation					=	LooseReloadDraw
				AnimationName			=	CHCM_CM_B_ATKA2
				AnimationMode			=	ONCE
				AnimationSpeedFactorRange = 1.1 1.1		// Therefore, this is all you get.  A slight speed up so that the animation can always finish before any possible random value Design sets the range for
				//AnimationBlendTime		=	10
			End
		End


		AnimationState				= FIRING_OR_PREATTACK_A
			StateName				= STATE_Firing
			Animation
				AnimationName		= CHCM_CM_B_ATKA1
				AnimationMode		= ONCE
				UseWeaponTiming		= No			// UseWeaponTiming plus random weapon field equals desync.  Leaving as warning
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

// this hit animation attack stance
		AnimationState = EMOTION_ALERT HIT_REACTION WEAPONSET_TOGGLE_1
			Animation
				AnimationName = CHCM_CM_B_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION WEAPONSET_TOGGLE_1
			Animation
				AnimationName = CHCM_CM_B_HITA
				AnimationMode = ONCE
			End
		End


		AnimationState = HIT_REACTION
			Animation
				AnimationName = CHCM_CM_B_HITA
				AnimationMode = ONCE
			End
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= CHCM_CM_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End

		//	WIZARD BLAST ANIMS MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_TWO MOUNTED
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPLD CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
		End
	
		//	WIZARD BLAST ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_TWO
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPCB CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
		End

		//	ISTARI LIGHT STAFF WEAPON MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_THREE MOUNTED	// FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHCM_CM_U_SPCD CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		//	ISTARI LIGHT STAFF WEAPON ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_THREE // FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHCM_CM_U_SPCE CHCM_CM_U_ATKA//	isitari's light?
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End
		
		; Throwing and cripple strike
		AnimationState		  =	SPECIAL_WEAPON_FOUR
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPCD
				AnimationMode =	ONCE
			End
			FrameForPristineBonePositions	= 44
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPCE
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX
			StateName		  =	Attacking
			Animation
				AnimationName =	CHCM_CM_U_SPCF
				AnimationMode =	ONCE
			End
		End

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHCM_CM_U_SPCC CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHCM_CM_U_SPCA CHCM_CM_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHCM_CM_U_SPCB CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHCM_CM_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHCM_CM_U_SPCC CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHCM_CM_U_SPCA CHCM_CM_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHCM_CM_U_SPCB CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
//----------- Captain of Gondor - Sword --------------------------------------------
		AnimationState        = PACKING_TYPE_2 WEAPONSET_TOGGLE_1
			StateName		  =	CaptainPower
			Animation           = GUHero_CHRC
				AnimationName     = CHCM_CM_U_CHRC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
		End

//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHCM_CM_U_SPCE CHCM_CM_U_SPCA CHCM_CM_U_CHRD
				AnimationMode     = ONCE
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHCM_CM_U_SPCC CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHCM_CM_U_SPCA CHCM_CM_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHCM_CM_U_SPCB CHCM_CM_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHCM_CM_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHCM_CM_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHCM_CM_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHCM_CM_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End

		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHCM_CM_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		

		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHCM_CM_U_SPCD
				AnimationMode =	ONCE
			End
		End




//====== LEVELED
		AnimationState				= LEVELED WEAPONSET_TOGGLE_1
			Animation			= LevelUp
				AnimationName		= CHCM_CM_B_CHRA CHCM_CM_B_LVLA
				AnimationMode		= ONCE
			End
		End

		AnimationState				= LEVELED
			Animation			= LevelUp
				AnimationName		= CHCM_CM_B_CHRA CHCM_CM_B_LVLA
				AnimationMode		= ONCE
			End
		End

//---------------------- EMOTIONS ---------------------------------------------------------------

		// cheer, mounted
		AnimationState				=	EMOTION_CELEBRATING MOUNTED
			Animation 
				AnimationName		=	CHCM_CM_M_CHRA CHCM_CM_M_IRFA
				AnimationMode		=	ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End

		// cheer, w/ bow on foot
		AnimationState				=	EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
			Animation 
				AnimationName		=	CHCM_CM_B_CHRA
				AnimationMode		=	ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End

		// cheer, on foot
		AnimationState				=	EMOTION_CELEBRATING
			Animation 
				AnimationName		=	CHCM_CM_B_CHRA
				AnimationMode		=	ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, w/ bow on foot
		AnimationState				=	EMOTION_TAUNTING WEAPONSET_TOGGLE_1
			Animation 
				AnimationName		=	CHCM_CM_B_TNTA
				AnimationMode		=	ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation 
				AnimationName		=	CHCM_CM_B_TNTA
				AnimationMode		=	ONCE
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
		End
		


//====== ENGAGED -- This animation was making that glitchy animation before each shot. Took it out.
;		AnimationState				= ENGAGED
;			StateName			= STATE_ready
;			Animation
;				AnimationName		= CHCM_CM_U_IDLA
;				AnimationMode		= ONCE
;			End
;		End
		
// --- Idle Toggled
		AnimationState				= WEAPONSET_TOGGLE_1
			StateName				= STATE_Idle_Bow
			Animation
				AnimationName		=	CHCM_CM_B_IDLA
				AnimationPriority	=	20
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End


		IdleAnimationState
			StateName			= STATE_Idle_Bow ; STATE_Idle_Sword
			Animation
				AnimationName		=	CHCM_CM_B_IDLA
				AnimationPriority	=	20
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15
			End
			Flags				=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End
		

	//---transitions--------------------------------------------

		TransitionState = TRANS_BoredToSelectedSword
			Animation = ATNC
				AnimationName		= CHCM_CM_U_ATNF CHCM_CM_U_ATNE
				AnimationMode		= ONCE
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNA
				AnimationName	= CHCM_CM_U_ATNF
				AnimationMode	= ONCE
			End		
		End	

		TransitionState = TRANS_BoredToSelectedBow
			Animation = ATNC
				AnimationName		= CHCM_CM_U_ATNF CHCM_CM_U_ATNE
				AnimationMode		= ONCE
			End		
		End
		
		TransitionState = TRANS_CaptainBowToSelectedBow
			Animation = ATNC
				AnimationName		= CHCM_CM_U_ATNF
				AnimationMode		= ONCE
				AnimationBlendTime	= 10
				AnimationSpeedFactorRange = 1.5 1.5
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredBow
			Animation			= ATNA
				AnimationName	= CHCM_CM_U_ATNF
				AnimationMode	= ONCE
			End		
		End		

	End	

End
 
ReplaceModule ModuleTag_foo
	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_fooNew
		ModelCondition = Required:EMOTION_CELEBRATING	Excluded:DYING ENGAGED	Sound:EmotionDunedainRangerVoxCheerLoop
		ModelCondition = Required:EMOTION_TAUNTING	Excluded:DYING ENGAGED	Sound:EmotionDunedainVoxTauntLoop
		ModelCondition = Required:EMOTION_POINTING	Excluded:DYING ENGAGED	Sound:EmotionDunedainVoxTauntLoop
		ModelCondition = Required:RAISING_FLAG		Excluded:DYING ENGAGED	Sound:EmotionDunedainRangerVoxCheerLoop
	End
END

ReplaceModule ModuleTag_AnimAudioBehavior
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior1
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:FootstepDirtA			Animation:CHSS_UK_U_SKL.CHSS_UK_U_RUNA	Frames:5 17

		AnimationSound = Sound:BodyFallSoldier			Animation:CHSS_UK_U_SKL.CHSS_UK_U_LNDA	Frames:4

		AnimationSound = Sound:TrollTreeSwing			Animation:CHSS_UK_U_SKL.CHSS_UK_U_SPCD	Frames:35
	END
END

	Side				= Isengard

	WeaponSet
		Conditions 		= None 
		Weapon     		= PRIMARY  GoblinArcherBow ;GondorRangerBow ; Flaming Arrows
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI		
	End

	WeaponSet
		Conditions		= WEAPONSET_TOGGLE_1 ; Silverthorn arrows
		Weapon			= PRIMARY    GondorArcherBow  ;MirkwoodArcherSilverthornBow ;ElvenThranduilBowDeadeye
	End

	ArmorSet
		Conditions      = None
		Armor           = CAHArmorHeroOfTheWest
		DamageFX        = NormalDamageFX
	End

	CommandSet  = AegionCommandSet

	CommandPoints = 0


;ReplaceModule ModuleTag_LGAU
;	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU1
;		Key = Hero
;	End
;End

			VoiceAttack 							= HeroEvilManVoiceAttack
			VoiceAttackAir							= HeroEvilManVoiceAttack
			VoiceAttackCharge 						= HeroEvilManVoiceAttack
			VoiceAttackMachine 						= HeroEvilManVoiceAttack
			VoiceAttackStructure 						= HeroEvilManVoiceAttack
			VoiceCreated							= HeroEvilManVoiceSalute
			VoiceFear							= HeroEvilManVoiceHelpMe
			VoiceFullyCreated						= HeroEvilManVoiceSalute
			VoiceGuard							= HeroEvilManVoiceMove
			VoiceMove 							= HeroEvilManVoiceMove
			VoiceMoveToCamp 						= HeroEvilManVoiceMove
			VoiceMoveWhileAttacking 					= HeroEvilManVoiceMove
			VoicePriority							= 95
			VoiceRetreatToCastle 						= HeroEvilManVoiceMove
			VoiceSelect 							= HeroVoiceSelect2 ; HeroEvilManVoiceSelectMS
			VoiceSelectBattle  						= HeroEvilManVoiceSelectBattle
		
			SoundImpact								= ImpactHorse
		
			UnitSpecificSounds
				VoiceEnterUnitElvenTransportShip	= HeroEvilManVoiceMove
				VoiceEnterUnitMordorMumakil			= HeroEvilManVoiceMove
				VoiceEnterUnitSlaughterHouse		= HeroEvilManVoiceMove
				VoiceEnterUnitTransportShip			= HeroEvilManVoiceMove
				VoiceGarrison						= HeroEvilManVoiceMove
				VoiceInitiateCaptureBuilding		= HeroEvilManVoiceCaptureBuilding
			End

	CrowdResponseKey = None

ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 				= EMOTION_CHEER_RADIUS
		MaxHealth         			= 5200
		PermanentlyKilledByFilter		= NONE	
   		DodgePercent      			= 10%	
	End
End

  ReplaceModule ModuleTag_DainHealing
	Behavior = AutoHealBehavior ModuleTag_LegendsFaramirHealing
		StartsActive		  =	Yes
		HealingAmount		  =	100 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY
		HealOnlyIfNotInCombat =	Yes
	End
  END

	LocomotorSet
		Locomotor = HeroHumanScalingLocomotor
		Condition = SET_NORMAL_UPGRADED
		Speed     = 57	; with 50 he is slower than the other heroes for some reason
	End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Removing Leadership Modules
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

;This will remove Stubborn Pride and leadership from him that is  defaultly in King Dain's object modules.
	RemoveModule ModuleTag_StubbornPrideUnpause
	RemoveModule ModuleTag_StubbornPrideSpecialPower
	RemoveModule ModuleTag_StubbornPrideUpdate
	RemoveModule ModuleTag_DainLeadership
	RemoveModule ModuleTag_DainLeadershipUpdate
	RemoveModule ModuleTag_Leadership


	Geometry		= CYLINDER
	GeometryMajorRadius	= 8.0
	GeometryMinorRadius	= 8.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	Shadow			= SHADOW_DECAL
	ShadowSizeX		= 20
	ShadowSizeY		= 20
	ShadowTexture		= ShadowI
	PathfindDiameter = 20.0
End





;--------------AEGION's WEAPONS-------------

;FLAMING ARROWS
Weapon GoblinArcherBow
	AttackRange			= GOBLIN_ARCHER_RANGE    ;Horde member so it needs to be bigger than the horde weapon attack range.
   
   	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( GOBLIN_ARCHER_RANGE .01 )
   
   
    LeechRangeWeapon    = Yes
	WeaponSpeed		= 300         ; dist/sec 
	MinWeaponSpeed		= 121
	MaxWeaponSpeed		= 400      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX			= FX_RohanArcherBowWeapon  
	ScaleWeaponSpeed	= Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage		= 100     ;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius		= 20.0     ;When this weapon misses it can randomly miss by as much as this distance.
	
	AcceptableAimDelta	= 20	; prevent twitchy reaiming in horde on horde
	DelayBetweenShots	= 0
	PreAttackDelay      	= GOBLIN_ARCHER_PREATTACKDELAY
	PreAttackType       	= PER_POSITION
	PreAttackRandomAmount   = 200 
	FiringDuration     	= 0
	
	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 1000
	ContinuousFireOne	= 0
	ContinuousFireCoast	= GOBLIN_ARCHER_BOW_RELOADTIME_MAX 
	
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged		= No ; Will not check for a DodgePercent on the target to have a second chance at failing HitPercent

	ProjectileNugget	; Default arrow
		ProjectileTemplateName  = EvilFactionArrow
		WarheadTemplateName     = GoblinArcherBowWarhead
		ForbiddenUpgradeNames   = Upgrade_WildFireArrows
	End

;	ProjectileNugget    ; Fire Arrow
;		ProjectileTemplateName  = EvilFactionFireArrow
;		WarheadTemplateName      = GoblinArcherBowFireWarhead
;		RequiredUpgradeNames     = Upgrade_WildFireArrows
;	End
End





;AEGION SILVERTHORN ARROWS


Weapon AegionSilverthornWarhead
	ClearNuggets ;;.;;
  	RadiusDamageAffects = ENEMIES NOT_SIMILAR
;  	FireFX                = FX_Something
  
  	DamageNugget				;Normal (hero) damage
	    	Damage        = 1800;120
		Radius        = 1.0
	   	DelayTime     = 0
	    	DamageType    = HERO			;Used to be Pierce
	    	DamageFXType  = GOOD_ARROW_PIERCE
	    	DeathType     = EXPLODED
	End

  	DamageNugget				;Magic damage
	    	Damage        = 700;30
		Radius        = 1.0
	    	DelayTime     = 0
		DamageType    = MAGIC
		DamageFXType  = MAGIC
	    	DeathType     = EXPLODED
	    	DamageScalar  = 25% NONE +STRUCTURE +SUMMONED
	End
	
	MetaImpactNugget
		SpecialObjectFilter	= NONE +INFANTRY
		ShockWaveAmount		= 50.0
		ShockWaveRadius		= 10.0
		ShockWaveArc		= 90 ; in degrees to each side 180 is full circle
		ShockWaveTaperOff	= 1.0
		ShockWaveSpeed		= 0.0
		ShockWaveZMult		= 1.0
		OnlyWhenJustDied	= Yes
	End
End




Object GondorArcherArrow 			; ObjectReskin GondorArcherArrow GoodFactionArrow

RemoveModule ModuleTag_Draw
RemoveModule ModuleTag_Draw2
RemoveModule ModuleTag_02
RemoveModule ModuleTag_03
RemoveModule ModuleTag_04

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_DrawNew
		DefaultModelConditionState     
			Model = NONE
		End
    End
END

AddModule
    Draw = W3DStreakDraw ModuleTag_Draw2New
		Length		= 15
		Width		= 3
		NumSegments	= 6				; number of segements in the streak, increase for smoother line
		Color		= R:0 G:190 B:255
		Texture		= EXArrowStreakFire.tga
	End
END

AddModule
    Draw = W3DStreakDraw ModuleTag_Draw3New
		Length = 50
		Width = 1
		NumSegments = 6				; number of segements in the streak, increase for smoother line
		Color		= R:0 G:190 B:255
		Texture = EXLightStreaks2.tga
	End
END

	SoundAmbient = SilverthorneArrowFlyBy

	EditorSorting     = SYSTEM
	ArmorSet
		Armor = NoArmor
	End
	VisionRange = 0.0

; *** ENGINEERING Parameters ***
	KindOf = PROJECTILE NO_COLLIDE

AddModule
	Body = ActiveBody ModuleTag_02New
		MaxHealth       = 10.0
	End
END

AddModule
	Behavior = DestroyDie ModuleTag_03New
	End
END
  
AddModule 
	Behavior = BezierProjectileBehavior ModuleTag_04New
		DetonateCallsKill = Yes
		FirstHeight = 36  ; Height of Bezier control points above highest intervening terrain
		SecondHeight = 36
		FirstPercentIndent = 20% ; Percentage of shot distance control points are placed
		SecondPercentIndent = 90%
		FlightPathAdjustDistPerSecond = 50 ; Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
		GroundHitFX = FX_GondorArrowDeath	;FX_HawkStrikeHit
		CurveFlattenMinDist = 50.0
	End
END

;AddModule
;	Behavior = CreateObjectDie ModuleTag_06
;		DeathTypes = ALL
;		CreationList = OCL_GoodFactionShatteredArrowBits
;	End
;END

AddModule
	Behavior = FXListDie ModuleTag_07
		DeathTypes = ALL -CRUSHED -SPLATTED
		DeathFX = FX_GondorArrowDeath
	End
END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_DeathWeaponModule
    StartsActive = Yes
    DeathWeapon = AegionSilverthornWarhead
  End
END

  Geometry = Sphere
  GeometryIsSmall = Yes
  GeometryMajorRadius = 0.8

End





Weapon GondorArcherBow  
	AttackRange		= ELVEN_MIRKWOOD_ARCHER_RANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1
	
	WeaponSpeed		= 321
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 481
	FireFX			= FX_RohanArcherBowWeapon
	ScaleWeaponSpeed	= Yes
	HitPercentage		= 100
	ScatterRadius		= 16.0

	AcceptableAimDelta	= 20
	DelayBetweenShots	= 0
	PreAttackDelay		= ROHAN_YEOMAN_PREATTACKDELAY  
	PreAttackRandomAmount	= 200  
	PreAttackType		= PER_POSITION
	FiringDuration		= 0   

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 4200			; Min:ROHAN_YEOMAN_BOW_RELOADTIME_MIN Max:ROHAN_YEOMAN_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= ROHAN_YEOMAN_BOW_RELOADTIME_MAX 

	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged		= No

	ProjectileNugget	; Default arrow
		ProjectileTemplateName  = GondorArcherArrow
		WarheadTemplateName     = GondorArcherBowWarhead
		ForbiddenUpgradeNames   = Upgrade_GondorArcherFireArrows ; ;Upgrade_GondorFireArrows
	End
	ProjectileNugget	; Fire arrow available through fire upgrade
		ProjectileTemplateName  = GondorArcherFireArrow
		WarheadTemplateName     = GondorArcherBowFireWarhead
		RequiredUpgradeNames    = Upgrade_GondorArcherFireArrows ; ;Upgrade_GondorFireArrows
	End
End











Weapon MirkwoodArcherSilverthornBow
	AttackRange		= ELVEN_MIRKWOOD_ARCHER_RANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1
	
	WeaponSpeed		= 321
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 481
	FireFX			= FX_RohanArcherBowWeapon
	ScaleWeaponSpeed	= Yes
	HitPercentage		= 100
	ScatterRadius		= 16.0

	AcceptableAimDelta	= 20
	DelayBetweenShots	= 0
	PreAttackDelay		= ROHAN_YEOMAN_PREATTACKDELAY  
	PreAttackRandomAmount	= 200  
	PreAttackType		= PER_POSITION
	FiringDuration		= 0   

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 2200			; Min:ROHAN_YEOMAN_BOW_RELOADTIME_MIN Max:ROHAN_YEOMAN_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= ROHAN_YEOMAN_BOW_RELOADTIME_MAX 

	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged		= No

	ProjectileNugget
		ProjectileTemplateName  = MirkwoodArcherSilverthornProjectile
		WarheadTemplateName     = MirkwoodArcherSilverthornBowWarhead
	End

End

Weapon LegolasBow
	AttackRange		= ELVEN_MIRKWOOD_ARCHER_RANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1
	
	WeaponSpeed		= 321
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 481
	FireFX			= FX_RohanArcherBowWeapon
	ScaleWeaponSpeed	= Yes
	HitPercentage		= 100
	ScatterRadius		= 16.0

	AcceptableAimDelta	= 20
	DelayBetweenShots	= 0
	PreAttackDelay		= ROHAN_YEOMAN_PREATTACKDELAY  
	PreAttackRandomAmount	= 200  
	PreAttackType		= PER_POSITION
	FiringDuration		= 0   

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 4000			; Min:ROHAN_YEOMAN_BOW_RELOADTIME_MIN Max:ROHAN_YEOMAN_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= ROHAN_YEOMAN_BOW_RELOADTIME_MAX 

	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged		= No
    
	ProjectileNugget                    ; Default Arrow
		ProjectileTemplateName  = GoodFactionArrow
		WarheadTemplateName     = LegolasBowWarhead
	End
End

Weapon ElvenThranduilBowDeadeye
	AttackRange		= ELVEN_MIRKWOOD_ARCHER_RANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1
	
	WeaponSpeed		= 321
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 481
	FireFX			= FX_RohanArcherBowWeapon
	ScaleWeaponSpeed	= Yes
	HitPercentage		= 100
	ScatterRadius		= 16.0

	AcceptableAimDelta	= 20
	DelayBetweenShots	= 0
	PreAttackDelay		= ROHAN_YEOMAN_PREATTACKDELAY  
	PreAttackRandomAmount	= 200  
	PreAttackType		= PER_POSITION
	FiringDuration		= 0   

	ClipSize		= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= 9000			; Min:ROHAN_YEOMAN_BOW_RELOADTIME_MIN Max:ROHAN_YEOMAN_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= ROHAN_YEOMAN_BOW_RELOADTIME_MAX 

	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged		= No

	ProjectileNugget
		ProjectileTemplateName	= GoodFactionArrowDeadeye
		WarheadTemplateName	= ElvenThranduilBowWarheadDeadeye
		ForbiddenUpgradeNames	= Upgrade_RohanFireArrows
	End

End















;--------------------- END AEGION ------------------------
;---------------------------------------------------------














;--------------------------------------------------------
;CUSTOM HERO 2 - RHEIA, THE DRUID
;--------------------------------------------------------
Upgrade Upgrade_RheiaLevel2
	Type			= OBJECT
End

Upgrade Upgrade_RheiaLevel4
	Type			= OBJECT
End

Upgrade Upgrade_RheiaLevel5
	Type			= OBJECT
End

Upgrade Upgrade_RheiaLevel7
	Type			= OBJECT
End

Upgrade Upgrade_RheiaLevel8
	Type			= OBJECT
End

Upgrade Upgrade_RheiaLevel9
	Type			= OBJECT
End

SpecialPower SpecialAbilityActivateeDummy3
	Enum				= SPECIAL_GENERAL_TARGETLESS_THREE
	ReloadTime			= 1
End

SpecialPower SpecialAbilityActivateeDummy2
	Enum				= SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime			= 1
End

SpecialPower SpecialAbilityColorSpray
	Enum				= SPECIAL_WIZARD_BLAST
	ReloadTime			= 55000
End

SpecialPower SpecialAbilityRegeneration
	Enum				= SPECIAL_WORD_OF_POWER
	ReloadTime			= 100000
End

SpecialPower SpecialAbilityEntanglingVines
	Enum				= SPECIAL_GENERAL_TARGETLESS
	ReloadTime			= 170000
	RadiusCursorRadius		= 100
	InitiateAtLocationSound		= SpellTaint
;	ViewObjectDuration		= 5000
;	ViewObjectRange			= 90
;	Flags				= NO_FORBIDDEN_OBJECTS RESPECT_RECHARGE_TIME_DISCOUNT WATER_OK
	ForbiddenObjectFilter		= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange		= 30
	PreventActivationConditions	= HIDDEN
End


SpecialPower SpecialAbilityNaturesFavour
	Enum				= SPECIAL_TRIGGER_ATTRIBUTE_MODIFIER
	ReloadTime			= 180000
;	RadiusCursorRadius		= 130.0
	InitiateAtLocationSound 	= SpellElvenWood
End

SpecialPower SpecialAbilityNaturesAlly
	Enum	  		= SPECIAL_SUMMON_ALLIES
	ReloadTime		= 180000	 ; 3 min, Bear unsummons in 45 secs
	PublicTimer		= No
	RadiusCursorRadius	= 30.0
	InitiateAtLocationSound	= TrollIdleYell01
	Flags			= LIMIT_DISTANCE NO_FORBIDDEN_OBJECTS
	MaxCastRange		= 180
	ForbiddenObjectFilter	= NO_SUMMON_ALLIES_NEAR_THESE
	ForbiddenObjectRange	= 30.0
End







CommandButton Command_SpellBookCloudBreak				; COLOR SPRAY
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityColorSpray
	TextLabel		= CONTROLBAR:LegendsColorSpray
	DescriptLabel		= CONTROLBAR:TooltipLegendsColorSpray
	ButtonImage		= SBGood_CloudBreak
	Options                 = NEED_TARGET_ENEMY_OBJECT NEED_UPGRADE
	NeededUpgrade		= Upgrade_RheiaLevel2
	ButtonBorderType        = ACTION 
	CursorName              = Bombard
	InvalidCursorName       = GenericInvalid
	AutoAbility		= Yes
	PresetRange		= 80.0
	InPalantir		= Yes
End

CommandButton Command_ArwenElvenGrace					; REGENERATION
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityRegeneration
	TextLabel		= CONTROLBAR:LegendsRegeneration
	ButtonImage		= HSAragornAthelas
	Options         	= NEED_UPGRADE
	NeededUpgrade		= Upgrade_RheiaLevel4
	CursorName		= Bombard
	RadiusCursorType	= AthelasRadiusCursor
	InvalidCursorName	= GenericInvalid
	ButtonBorderType	= ACTION 
	DescriptLabel		= CONTROLBAR:TooltipLegendsRegeneration
	InPalantir		= Yes
	AutoAbility		= Yes
	UnitSpecificSound       = PeasantFemaleVoiceCower
End

CommandButton Command_ConstructElvenMallornTree				; Nature's Favour
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityNaturesFavour		;SpecialAbilityTheodenGloriousCharge
	Object			= NONE
	Options         	= NEED_UPGRADE
	NeededUpgrade		= Upgrade_RheiaLevel5
	TextLabel		= CONTROLBAR:LegendsNaturesFavour
	DescriptLabel		= CONTROLBAR:TooltipLegendsNaturesFavour
	RadiusCursorType        = TrainingRadiusCursor
	ButtonImage		= BEMallornTree
	ButtonBorderType	= ACTION
	Radial			= No
	InPalantir		= Yes
	RadiusCursorType        = MoveUnseenRadiusCursor
	AutoAbility		= Yes
	PresetRange		= 130.0
End

CommandButton Command_SpecialAbilityGrabPassenger ; Command_SpellBookTaint	; Entangling Vines
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityEntanglingVines ; SpecialAbilityWormtongueVenomousWords
	Options			= NEED_TARGET_POS NEED_UPGRADE
	NeededUpgrade		= Upgrade_RheiaLevel9
;	Object           	= NONE
	TextLabel		= CONTROLBAR:LegendsEntanglingVines
	DescriptLabel		= CONTROLBAR:TooltipLegendsEntanglingVines
	ButtonImage		= SBEvil_Taint
	ButtonBorderType	= ACTION
	RadiusCursorType	= DevastationRadiusCursor
	PresetRange		= 180.0
	CursorName		= AttackObj
	InvalidCursorName	= GenericInvalid
	Radial			= No
	InPalantir		= Yes
End

CommandButton Command_IsengardWargSentryUnleash				; Nature's Ally
	Command			= SPECIAL_POWER
	Options			= NEED_TARGET_POS CONTEXTMODE_COMMAND NEED_UPGRADE
	NeededUpgrade		= Upgrade_RheiaLevel8
	SpecialPower            = SpecialAbilityNaturesAlly
	TextLabel               = CONTROLBAR:LegendsNaturesAlly
	DescriptLabel           = CONTROLBAR:TooltipLegendsNaturesAlly
	ButtonImage             = BIWargSentry_Warg
	RadiusCursorType  	= WordOfPoultryRadiusCursor
	ButtonBorderType        = ACTION
	Radial			= No
	InPalantir		= Yes
	;UnitSpecificSound	= CampOrcReleaseWarg
End





CommandSet RheiaCommandSet
	 1 = Command_ToggleStance
	 2 = Command_SpellBookCloudBreak				; Color Spray
	 3 = Command_ArwenElvenGrace					; Regeneration
	 4 = Command_ConstructElvenMallornTree				; Nature's Favour
	 6 = Command_SpecialAbilityGrabPassenger			; Entangling Vines
	 5 = Command_IsengardWargSentryUnleash				; Summon Nature's Ally

    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
End











Object TaintTree
	Scale = 1.2  

ReplaceModule	ModuleTag_Draw
  Draw = W3DScriptedModelDraw ModuleTag_DrawNew
	DefaultModelConditionState
          Model = ptoldforest13
        End
  End
END

  DisplayName = OBJECT:Taint
  EditorSorting = MISC_MAN_MADE

  KindOf = IMMOBILE UNATTACKABLE TAINTEFFECT
  

ReplaceModule ModuleTag_02
  Behavior = LifetimeUpdate ModuleTag_02New
    MinLifetime = 28000   ; min lifetime in msec
    MaxLifetime = 32000  ; max lifetime in msec
  End
END

ReplaceModule	ModuleTag_03
  Behavior = SlowDeathBehavior ModuleTag_03New
	DeathTypes = ALL
    SinkDelay         = 0
    SinkRate          = 2     ; in Dist/Sec
    DestructionDelay  = 8000
  End
END

  Geometry = CYLINDER
  GeometryMajorRadius = 8.0
  GeometryMinorRadius = 8.0
  GeometryHeight = 38.4
  GeometryIsSmall = Yes
End





ObjectCreationList OCL_EntanglingVines
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 10000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 0
		Offset			= X:-20 Y:60 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 8000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 180
		Offset			= X:-60 Y:45 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 11000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 70
		Offset			= X:-20 Y:0 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 8000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 120
		Offset			= X:-45 Y:-45 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 7000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 250
		Offset			= X:20 Y:20 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 9000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 300
		Offset			= X:20 Y:-20 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 6000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 20
		Offset			= X:45 Y:-40 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 5000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 160
		Offset			= X:60 Y:30 Z:0
	End
	CreateObject
		ObjectNames		= TaintTree
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 10000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 60
		Offset			= X:50 Y:-42 Z:0
	End
End








CommandSet NaturesAllyCommandSet
	 1 = Command_ToggleStance

	13 = Command_AttackMove
	14 = Command_Stop
End



FXParticleSystem NaturesAllyAttackParticle
  System
    Shader = ALPHA
    ParticleName = EXCloud01.tga
    Lifetime = 30 30
    SystemLifetime = 3
    SortLevel = 1
    Size = 1 2
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:199 G:183 B:154 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.75 0.75 0
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 4 15
    SizeRateDamping = 0.95 0.8
    AngleZ = -0.5 0.5
    AngularRateZ = -0.1 0.1
    AngularDamping = 0.98 0.98
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.9 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 1 2 
;    Y = 0 0
    Z = 0 0.5
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:18 Y:0 Z:5
    EndPoint = X:19 Y:0 Z:5
  End
  Draw = DefaultDraw
  End
End

FXList FX_NaturesAllyAttack
  ParticleSystem
    Name = NaturesAllyAttackParticle
    OrientToObject = Yes
  END
  Sound
    Name = TrollTreeShakeYell
  End
End



Weapon NaturesAllyCrush
  LeechRangeWeapon      = Yes
  AttackRange           = 9999999.0
  MeleeWeapon           = No
  DelayBetweenShots     = 0				; time between shots, msec
  PreAttackDelay        = 0				;PreAttackDelay+FiringDuration = UseWeaponTiming = Yes duration
  PreAttackType         = PER_SHOT 
  FiringDuration        = 0
  FireFX				= FX_GenericCrushImpactSound

  DamageNugget
    Damage        = 80 ; Rivendel Lancer = 50
    AcceptDamageAdd = No ; ;
    Radius        = 5 ;;.;; 0.0
    DelayTime     = 0
    DamageType    = CRUSH
    DeathType     = NORMAL
    FlankingBonus = 350% ; ;200%
  End
End



Weapon NaturesAllyWeapon
  LeechRangeWeapon      = Yes
  AttackRange           = STANDARD_MELEE_ATTACK_RANGE
  MeleeWeapon           = Yes
  FireFX                = FX_NaturesAllyAttack
  DelayBetweenShots     = 500	;1000							; time between shots, msec
  PreAttackDelay        = 300				; 400 is sword swing delay time before contact with target.
  FiringDuration        = 600				; Duration of the sword swing
  PreAttackType         = PER_SHOT											; Do the delay each time we attack a new target

	DamageNugget
		Damage			= 200 ; 60
		Radius			= 15.0
		DelayTime		= 0
		DamageType		= CAVALRY
		DamageFXType		= SMALL_ROCK
		DeathType		= NORMAL
	End

	MetaImpactNugget
		ShockWaveAmount   	= 30.0
		ShockWaveRadius   	= 15.0
		ShockWaveTaperOff 	= 1.0
		ShockWaveArc      	= 40
		ShockWaveZMult    	= 0.5
 		HeroResist		= 1
	End

End



ChildObject TomBombadil ElvenRivendellLancer				;NATURE's ALLY - BEAR

	SelectPortrait	= NONE ; UnitPortraitsNoArt
	ButtonImage	= WOR_RivendellLancer

RemoveModule	ModuleTag_01

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_01New
    DefaultModelConditionState
		Model               = CUBear_SKN
    End
    

   	AnimationState
		StateName			= FIRING_OR_PREATTACK_A ;;.;; ATTACKING			; This is actually the idle animation, but at 5x speed it almost looks as if it was biting!
		Animation = ATKA
			AnimationName		= CUBear_SKL.CUBear_IDLA
			AnimationPriority	= 10
			AnimationMode		= ONCE
;			UseWeaponTiming		= Yes
;			AnimationBlendTime	= 10
			AnimationSpeedFactorRange = 5 5 
		End
    End

;	AnimationState				= MOVING WANDER
;		Animation			= WLKA
;			AnimationName		= CUBear_SKL.CUBear_WLKA
;			AnimationBlendTime	= 20
;			AnimationMustCompleteBlend = yes
;		End
;	End

	AnimationState				= MOVING 			;PANICKING ;I used the panic move animation because it runs instead of walking
		Animation			= RUNA
			AnimationName		= CUBear_SKL.CUBear_RUNA
			AnimationMode		= LOOP
		End
		Flags				= RANDOMSTART
	End    
	    	
;	AnimationState				= MOVING
;		StateName			= STATE_moving
;		Animation			= Moving
;			AnimationName		= CUBear_SKL.CUBear_WALKA
;			AnimationBlendTime	= 10
;			AnimationMustCompleteBlend = yes
;		End
;		
;		BeginScript
;			Prev = CurDrawablePrevAnimationState()
;			if Prev == "STATE_Alert" then CurDrawableSetTransitionAnimState("TRANS_AlertToIdle") end
;		EndScript
;		
;	End

		AnimationState			= MOVING TURN_LEFT 
			Animation		= Moving
				AnimationName	= CUBear_SKL.CUBear_WALKA
				AnimationMode	= LOOP
				AnimationBlendTime	= 10
			End
		End

		AnimationState			= MOVING TURN_RIGHT 
			Animation		= Moving
				AnimationName	= CUBear_SKL.CUBear_WALKA
				AnimationMode	= LOOP
				AnimationBlendTime	= 10
			End
		End
	
	TransitionState				= TRANS_AlertToIdle
		Animation			= IDLE
			AnimationName		= CUBear_SKL.CUBear_IDLE
			AnimationMode		= ONCE
		End
	End	
	
	TransitionState				= TRANS_IdleToAlert
		Animation			= IDLC
			AnimationName		= CUBear_SKL.CUBear_IDLC
			AnimationMode		= ONCE
		End
	End		

	AnimationState        			= EMOTION_ALERT
		StateName			= STATE_Alert
		Animation           		= ALERT_1
			AnimationName     	= CUBear_SKL.CUBear_IDLD
			AnimationMode     	= ONCE
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToAlert") end
		EndScript
		Flags               = RESTART_ANIM_WHEN_COMPLETE ; acts like an idle animation & keeps running the animations.
	End
	
	AnimationState        			= DYING
		Animation           		= CUBear_DIEA
  			AnimationName		= CUBear_SKL.CUBear_DIEA
			AnimationMode		= ONCE
		End
	End

   	IdleAnimationState
		StateName			= STATE_Idle
		Animation = IdleA
			AnimationName		= CUBear_SKL.CUBear_IDLA
			AnimationPriority	= 10
			AnimationMode		= ONCE
			AnimationBlendTime	= 10
			AnimationSpeedFactorRange = 3 3 
		End
		Animation = IdleB
			AnimationName		= CUBear_SKL.CUBear_IDLB
			AnimationPriority	= 10
			AnimationMode		= ONCE
			AnimationBlendTime	= 10
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Alert" then CurDrawableSetTransitionAnimState("TRANS_AlertToIdle") end
		EndScript
    End
			
 End

END

	WeaponSet
		Conditions			= None 
		Weapon				= PRIMARY NaturesAllyWeapon
		AutoChooseSources		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions			= None
		Armor				= RivendellLancerArmor
		DamageFX			= NormalDamageFX
	End

	CommandSet				= NaturesAllyCommandSet
	CommandPoints				= 0
	DisplayName				= OBJECT:Bear
	CrushableLevel				= 2
	CrusherLevel				= 1
	CrushWeapon				= NaturesAllyCrush

	MinCrushVelocityPercent		= 50 ; ;40 ; Has to be moving at at least this % of full speed.
	CrushDecelerationPercent	= 5 ; ;20 ; Lose this % of max velocity when crushing.

	CrushKnockback	= 10;
	CrushZFactor	= 1.0

	VoiceAttack						= TrollRoar
	VoiceAttackCharge					= TrollRoar
	VoiceAttackStructure 					= TrollDie
 	VoiceAttackMachine					= TrollRoar
	VoiceCreated						= TrollDie
	VoiceFullyCreated					= TrollDie
	VoiceGuard						= TrollDie
	VoiceMove						= TrollVoiceMove
	VoiceMoveToCamp 					= TrollDie
	VoiceMoveWhileAttacking					= TrollRoar
	VoicePriority						= 40	
	VoiceRetreatToCastle 					= TrollDie
	VoiceSelect						= TrollTreeShakeYell
	VoiceSelectBattle					= TrollRoar

	SoundCrushing						= RohirrimCrushing 		;Sound made when crushing another unit underhoof
	SoundImpact 						= ImpactHorse
	SoundMoveStart 						= GondorHorseMoveStart
	
	VoiceEnterStateAttack 					= TrollIdleYell01
	VoiceEnterStateAttackCharge 				= TrollRoar
	VoiceEnterStateAttackStructure	 			= TrollRoar
	VoiceEnterStateAttackMachine 				= TrollRoar
	VoiceEnterStateMove 					= TrollVoiceMove
	VoiceEnterStateMoveToCamp 				= TrollVoiceMove
	VoiceEnterStateMoveWhileAttacking			= TrollRoar
	VoiceEnterStateRetreatToCastle	 			= TrollRoar

	UnitSpecificSounds
		VoiceEnterUnitElvenTransportShip		= TrollDie
		VoiceGarrison					= TrollDie
		VoiceInitiateCaptureBuilding			= TrollDie
	End

RemoveModule ModuleTag_LGAU
RemoveModule ModuleTag_foo
RemoveModule ModuleTag_AnimAudioBehavior
RemoveModule ForgedBlades_VisualUpgrade
RemoveModule Armor_Upgrade
RemoveModule ModuleTag_HMC

	KindOf	= PRELOAD HEAVY_MELEE_HITTER SELECTABLE CAN_CAST_REFLECTIONS TROLL_BUFF_NUGGET MONSTER SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT NO_FREEWILL_ENTER PATH_THROUGH_INFANTRY SCARY CAN_ATTACK_WALLS ARMY_SUMMARY

	LocomotorSet
		Locomotor = NormalHorseHordeMemberLocomotor
		Condition = SET_NORMAL 
		Speed     = 70
	End

ReplaceModule ModuleTag_08
	Behavior = SlowDeathBehavior ModuleTag_08New
		DeathTypes		= ALL 
		SinkDelay		= 3000
		SinkRate		= 0.80     ; in Dist/Sec
		DestructionDelay	= 12000
		Sound			= INITIAL TrollRoar
	End
END

	Geometry				= CYLINDER
	GeometryMajorRadius			= 20.0
	GeometryHeight				= 20.0
	GeometryIsSmall				= No
	Shadow					= SHADOW_VOLUME_NON_SELF_2

ReplaceModule ModuleTag_02
	Body = ActiveBody ModuleTag_02New
		MaxHealth		= 10000
		MaxHealthDamaged	= 8000

		BurningDeathBehavior	= Yes
		BurningDeathFX		= FX_CavalryBurningFlame
		DodgePercent		= 30 ; ;
	End
END

AddModule
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= 45000
		MaxLifetime		= 45000
		DeathType		= FADED
	End
END

END















ObjectCreationList OCL_SpawnNaturesAlly
	CreateObject
		ObjectNames		= TomBombadil		; Bear
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 8000
		IgnoreCommandPointLimit	= Yes
		Disposition		= ABSOLUTE_ANGLE
		DispositionAngle	= 0
	End
END



















FXParticleSystem NaturesFavourGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXglow.tga
    Lifetime = 20 20
    SystemLifetime = 980
    Size = 50 50
    BurstDelay = 6 6
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color2 = R:0 G:100 B:0 5
    Color3 = R:0 G:0 B:0 20
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXList FX_NaturesFavour
	Sound
		Name = SpellElvenWood
	End

;  TintDrawable
;	Color			= R:190 G:255 B:190
;	PreColorTime		= 100				; these numbers must add up to the (30 * number of seconds) of gloriious charge
;	PostColorTime		= 100
;	SustainedColorTime	= 400
;	Frequency		= 0
;	Amplitude		= 0
;  End
  
  ParticleSystem
	Name = NaturesFavourGlow
	AttachToObject = Yes
	Offset = X:0.0 Y:0 Z:5.0
  End
End









FXParticleSystem RheiaColorSprayWaveRed		; The red particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20				; Random between these values, this time meaning 20 frames everytime
    SystemLifetime = 48
    Size = 4 4					; Initial size of the particle (ranging from 2 to 2 > always 2)
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:80 G:0 B:0 0			; R G B TIME - At *time* (msec) it changes the color to the next on the list
    Color2 = R:250 G:0 B:0 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5				; Increases size between 2x and 2.5x
    SizeRateDamping = 1 1			; 1 = "Normal" acceleration rate for size increase
    AngleZ = 0 7				; 2D angle of the particle (0-360). 0-7 is pretty much facing up
    AngularRateZ = -0.1 0.1			; Rotates randomly from 10% (0.1) clockwise to 10% (-0.1) counter-clockwise
    AngularDamping = 1 1			; Rotation acceleration, 1 = normal.
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3				; Positive gravity means that the particles will rise up
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 5 5					; X Speed of the particle's movement (+ is front, - is rear)
    Y = 4 4					; Y Speed of the particle's movement (+ is left, - is right)
    Z = -0.9 -0.9				; Z Speed of the particle's movement (+ is up, - is down), slightly downwards because the gravity makes it rise later
  End
  EmissionVolume = LineEmissionVolume		; Defines the "volume" (location) from which the particle spawns (volume = a wizard's staff, or mouth of a dragon)
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem RheiaColorSprayWaveRedGreen	; The Yellow particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20
    SystemLifetime = 49
    Size = 4 4
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:80 G:80 B:0 0
    Color2 = R:200 G:200 B:0 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 5.5 5.5
    Y = 2.4 2.4
    Z = -0.9 -0.9
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem RheiaColorSprayWaveGreen	; The Yellow particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20
    SystemLifetime = 50
    Size = 4 4
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:0 G:80 B:0 0
    Color2 = R:0 G:250 B:0 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 6 6
    Y = 0.8 0.8
    Z = -0.9 -0.9
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem RheiaColorSprayWaveGreenBlue	; The Cyan particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20
    SystemLifetime = 50
    Size = 4 4
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:0 G:80 B:80 0
    Color2 = R:0 G:200 B:200 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 6 6
    Y = -0.8 -0.8
    Z = -0.9 -0.9
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem RheiaColorSprayWaveBlue	; The Blue particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20
    SystemLifetime = 49
    Size = 4 4
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:80 0
    Color2 = R:0 G:0 B:250 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 5.5 5.5
    Y = -2.4 -2.4
    Z = -0.9 -0.9
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem RheiaColorSprayWaveBlueRed	; The Purple particle of the color spray
  System
    Priority = ALWAYS_RENDER
    ParticleName = exleadership2.tga
    Lifetime = 20 20
    SystemLifetime = 48
    Size = 4 4
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:80 G:0 B:80 0
    Color2 = R:200 G:0 B:200 8
    Color3 = R:0 G:0 B:0 12
  End
  Update = DefaultUpdate
    SizeRate = 3 3.5
    SizeRateDamping = 1 1
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
    Gravity = 0.3 0.3
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 5 5
    Y = -4 -4
    Z = -0.9 -0.9
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End




FXList FX_RheiaColorspray
  ParticleSystem
    Name = RheiaColorSprayWaveRed
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End
  ParticleSystem
    Name = RheiaColorSprayWaveRedGreen
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End
  ParticleSystem
    Name = RheiaColorSprayWaveGreen
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End
  ParticleSystem
    Name = RheiaColorSprayWaveGreenBlue
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End
  ParticleSystem
    Name = RheiaColorSprayWaveBlue
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End
  ParticleSystem
    Name = RheiaColorSprayWaveBlueRed
     OrientToObject = Yes
     Offset = X:0.0 Y:0 Z:15.0
  End

  CameraShakerVolume
    Radius = 500
    Duration_Seconds = 1.2
    Amplitude_Degrees = 0.2
  End
      Sound 
            Name = SpellSummonTomBombadilSpawn ; GandalfWizardBlast
      End
End






FXParticleSystem RheiaEntanglingVine
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exdebuff.tga
    Lifetime		= 30 30
    SystemLifetime	= 780
    Size		= 5 5
    BurstDelay		= 30 30
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End

  Color			= DefaultColor
    Color1		= R:20 G:20 B:20  0
    Color2		= R:0  G:30 B:0   14
    Color3		= R:0  G:0  B:0   20
  End

  Alpha			= DefaultAlpha
    Alpha1		= 1   1   0
    Alpha2		= 0.1 0.1 14
    Alpha3		= 0   0   20
  End

  Update		= DefaultUpdate
    SizeRate		= 1.5 1.5
    SizeRateDamping	= 1 1
    AngleZ		= 0 7
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End

  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0 ; No acceleration
  End

  EmissionVelocity	= OrthoEmissionVelocity
    Z = 1 1
  End

  EmissionVolume	= LineEmissionVolume
  End

  Draw			= DefaultDraw
  END

END




FXList FX_EntanglingVines
;  BuffNugget
;	BuffType = Dominate		; Can't be heal, because buffs replace any other buffs of the same time, and a hero is likely healed while crippled.
;	BuffInfantryTemplate = CripplingStrikeBuff
;	BuffCavalryTemplate = CripplingStrikeBuff
;	BuffTrollTemplate = CripplingStrikeBuff
;    BuffOrcTemplate = CripplingStrikeBuff
;	IsComplexBuff = No
;	BuffLifeTime = 30000
;  End
  ParticleSystem
    Name = RheiaEntanglingVine
     OrientToObject = Yes
     AttachToObject = Yes
     Offset = X:0.0 Y:0 Z:0.0
  End
  Sound
    Name = SpellDevastation
  End
  Sound
    Name = LurtzCrippleArrowImpact
  End 
  CameraShakerVolume
    Radius = 500
    Duration_Seconds = 5
    Amplitude_Degrees = 0.15
  End
End





FXParticleSystem  RheiaRegenerationFX
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exhpcorestar.tga
    Lifetime		= 40 40
    SystemLifetime	= 60		; Refreshes every 2 seconds
    Size		= 3 3
    BurstDelay		= 2 2
    BurstCount		= 1 1
  End
  Color			= DefaultColor
    Color1		= R:0  G:80 B:90  0
    Color2		= R:0  G:0  B:100 24
    Color3		= R:0  G:0  B:0   40
  End
  Update		= DefaultUpdate
    SizeRate		= 0.4 0.4
    SizeRateDamping	= 1 1
    AngleZ		= 0 7
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0.09 0.09 ; Particles go upwards
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.1 0.1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 10
  End
  Draw			= DefaultDraw
  END
END

FXList FX_RegenerationFX
  ParticleSystem
    Name = RheiaRegenerationFX
     AttachToObject = Yes
     Offset = X:0.0 Y:0 Z:2.0
  End
END


FXParticleSystem  RheiaRegenerationCenterFX
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= extornadoswirl.tga
    Lifetime		= 100 100
    SystemLifetime	= 15
    Size		= 5 5
    BurstDelay		= 20 20
    BurstCount		= 9 9
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:0  G:120 B:90  0
    Color2		= R:0  G:0  B:100 74
    Color3		= R:0  G:0  B:0   100
  End
  Update		= DefaultUpdate
    SizeRate		= 1.2 1.8
    SizeRateDamping	= 1 1
    AngleZ		= 0 7
    AngularRateZ	= 0.1 0.2
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius		= 1
  End
  Draw			= DefaultDraw
  END
END


FXList FX_RegenerationAuraCenter
  ParticleSystem
    Name = RheiaRegenerationCenterFX
     AttachToObject = Yes
     Offset = X:0.0 Y:0 Z:10.0
  End
  Sound
    Name = SpellSunflare4
  END
END






FXParticleSystem  RheiaEntanglingMinesCenter
  System
    Priority		= VERY_LOW_OR_ABOVE
    Shader		= ALPHA
    ParticleName	= EXCloud02.tga
    Lifetime		= 155 155
    SystemLifetime	= 30
    Size		= 30 45
    BurstDelay		= 5 5
    BurstCount		= 9 12
  End
  Color			= DefaultColor
    Color1		= R:73 G:73 B:63 0
    Color2		= R:0 G:0 B:0 155
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0.7 0.7 0
  End
  Update		= DefaultUpdate
    SizeRate		= 0.5 0.6
    SizeRateDamping	= 0.8 0.85
    AngleZ		= -0.1 0.1
;    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    Gravity		= -0.1 -0.1
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z			= 2 3
  End
  EmissionVolume	= CylinderEmissionVolume
    Radius		= 70
    Length		= 6
    Offset		= X:0 Y:0 Z:5
  End
  Draw			= DefaultDraw
  End
End

FXList FX_EntanglingVinesCenter
  ParticleSystem
    Name = RheiaEntanglingMinesCenter
     Offset = X:0.0 Y:0 Z:5.0
  End
  Sound
    Name = SpellSunflare4
  END
END







ModifierList HealingFXAttribute
	Category			= SPELL
	Duration			= 3000				; (It is refreshed every 2 seconds, so it's fine)
	FX				= FX_RegenerationFX	
End


ModifierList RheiaNaturesFavour
	Category			= BUFF
	Modifier			= ARMOR 20%
	Modifier			= RESIST_FEAR 100%
	Duration			= 28000				; 28 secs ok?
	FX				= FX_NaturesFavour
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
End

ModifierList EnganglingVinesAttributeModifier
	Category			= DEBUFF
	Modifier			= SPEED 0%	 // multiplier - 0% means max speed is 0. jba
	Modifier			= ARMOR	-20%
	Duration			= 28000				; 28 seconds ok?
;	FX				= FX_EntanglingVinesSingles
	ClearModelCondition		= MOVING
End

ModifierList RheiaDamage
	Category			= INNATE_DAMAGEMULT
	Modifier			= DAMAGE_MULT 150%
	Duration			= 0
End








Object Cine_PointLightWHITE

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_Draw
    DefaultModelConditionState
      Model               = None
    End
  END
END
	EditorSorting     = SYSTEM

	ArmorSet
		Armor = NoArmor
	End
	
	VisionRange = 0.0

	KindOf = IMMOBILE UNATTACKABLE

AddModule
	Body = ActiveBody ModuleTag_TheActiveBody
		MaxHealth = 99999.0
	End
END

AddModule
	Behavior = LifetimeUpdate ModuleTag_01
		MinLifetime = 20000
		MaxLifetime = 20000
	End
END

AddModule	
	Behavior = AutoHealBehavior ModuleTag_HealUpdate
		StartsActive	= Yes
		HealingAmount	= 45.0
		HealingDelay	= 200
		Radius		= 250
	End
END	

AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
		StartsActive	= Yes
		BonusName	= HealingFXAttribute
		RefreshDelay	= 2000
		Range		= 250
		ObjectFilter	= ANY +HERO
	End	
END

END



ObjectCreationList OCL_RegenerationAura
	CreateObject
		ObjectNames = Cine_PointLightWHITE
	End
End










Weapon ColorSpray
	ClearNuggets ;;.;;
	IdleAfterFiringDelay		= 0
	LeechRangeWeapon		= Yes
	AttackRange			= GANDALF_FORCE_ATTACK_RANGE
	WeaponSpeed			= 301         ; dist/sec 
	RadiusDamageAffects		= ENEMIES NEUTRALS NOT_SIMILAR
	DelayBetweenShots		= 5000               ; time between shots, msec
	PreAttackDelay			= 1000
	PreAttackType			= PER_ATTACK ; Do the delay each time we attack a new target
	FireFX				= FX_RheiaColorspray
	FiringDuration			= 100
	DamageDealtAtSelfPosition	= Yes 
	IsAimingWeapon			= Yes
	AcceptableAimDelta		= 15
	AntiAirborneVehicle		= No
	AntiAirborneMonster		= No

	DamageNugget
		Damage			= 750 ; 500
		DamageArc 		= 65 ; 75
		Radius			= 80.0 ; 110
		DamageType		= MAGIC
		DamageFXType		= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 300.0 ; 700. must match the ShockWaveSpeed below
	End

	EmotionWeaponNugget
		EmotionType		= UNCONTROLLABLE_FEAR
		Radius			= 35.0
;		DamageArc 		= 65 ; Arcs don't work on EmotionWeaponNuggets, darn!
		Duration		= 14 		;in seconds		
;		SpecialObjectFilter	= ALL ENEMIES
	End


;	MetaImpactNugget
;;		HeroResist		= .75
;		ShockWaveAmount		= 30.0
;		ShockWaveArc		= 65 ; 75
;		ShockWaveRadius		= 70.0 ; 110
;		ShockWaveTaperOff	= 0.75
;		ShockWaveZMult		= 0.500
;		ShockWaveSpeed		= 300.0 ; 700
;	End
End










Weapon EntanglingVinesWeapon				; NOT USED IN THE END
	ClearNuggets ;;.;;
  	RadiusDamageAffects = ENEMIES NEUTRALS
	FireFX				= FX_EntanglingVinesCenter

	DamageNugget
		Damage			= 100 ; 500
		DamageArc 		= 360
		Radius			= 70.0 ; 110
		DamageType		= MAGIC
		DamageFXType		= MAGIC
		DeathType		= EXPLODED
	End

	DOTNugget
		Damage        = 25
		SpecialObjectFilter		= ANY +INFANTRY +MONSTER +CAVALRY -HERO -MordorBalrog -GondorGwaihir -GondorGwaihir_Summoned -MordorFellBeast -MordorWitchKingOnFellBeast -TomBombadil -TomBombadil_Summoned -Drogoth -ElvenFortressEagle
		AcceptDamageAdd = No
		Radius        = 100.0
		DelayTime     = 0
		DamageType    = SLASH
;		DamageFXType  = SMALL_ROCK
		DeathType     = NORMAL
		DamageInterval = 1000
		DamageDuration = 20000
	End

	ParalyzeNugget
		Radius				= 100.0
		Duration			= 35000
		SpecialObjectFilter		= ANY +INFANTRY +MONSTER +CAVALRY -HERO -MordorBalrog -GondorGwaihir -GondorGwaihir_Summoned -MordorFellBeast -MordorWitchKingOnFellBeast -TomBombadil -TomBombadil_Summoned -Drogoth -ElvenFortressEagle
		ParalyzeFX			= FX_DevastationStunEffect
	End

End













;          ---------------------------
;-----------------Rheia Object-------------------
;          ---------------------------

ChildObject WildGoblinKing DwarvenGloin

	DisplayMeleeDamage = #MULTIPLY( CREATE_A_HERO_DAMAGE 2 );;-;; Bbecause he added another nugget.
	Scale = 1

	SelectPortrait = CPShieldMaiden
	ButtonImage = HICAHShieldMaiden

	DisplayName = Rheia

	ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
	     
	CommandPoints					= 0
	Side						= Mordor
	EditorSorting					= UNIT

	AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_GandalfWhite  ;
	End 
	End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RheiaDamage 	; Gives Rheia more damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	RheiaDamage
	End
  END

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RheiaArmor 	; Gives Rheia CaH ARMOR ATTRIBUTE 13 (just enough to stay alive)
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	ArmorAttribute13
	End
  END

	ReplaceModule ModuleTag_05
	Behavior = SlowDeathBehavior ModuleTag_051
		DeathTypes = ALL -KNOCKBACK
		SinkDelay = 5000
		SinkRate = 0.80     ; in Dist/Sec
		DestructionDelay = 27000
		Sound = INITIAL HeroElfFemaleVoiceDie
	End
	End

	EvaEventDieOwner 		= None

;	RecruitText = CONTROLBAR:GloinRecruit
;	ReviveText	= CONTROLBAR:GloinRevive


	RemoveModule Icon  ; This is the model module that makes that blueish glow ring around dwarven heroes.

ReplaceModule HitReactionBehaviorModuleTag
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTagNew
		HitReactionLifeTimer1 = 2200 ; level 1 (light  damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer2 = 15 ; level 2 (medium damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer3 = 10 ; level 3 (heavy  damage)  hit reaction animations in frames (5 per sec)

		HitReactionThreshold1 = 2500.0   ; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 2500.0  ; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 5000.0  ; level 3 (heavy  damage) threshold trigger
	End
END

	AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			   = Upgrade_GandalfWhite

	HideSubObjects		   = QUIVR

	HideSubObjects		   = MithlondBow ; Bow 1
	HideSubObjects		   = Belthronding ; Bow 2
	HideSubObjects		   = WizardSword ; Extra sword
	HideSubObjects		   = ARROWNOCK ; Extra sword

	HideSubObjects		   = SLDR_01	; Green shoulders
	HideSubObjects		   = SLDR_02	; Golden elf shoulders
	HideSubObjects		   = SLDR_03	; Metal shoulders
	HideSubObjects		   = SLDR_04	; Rohirrim shoulders
	HideSubObjects		   = SLDR_05	; Left shoulder pad

	HideSubObjects		   = HLMT_01
	HideSubObjects		   = HLMT_02
;	HideSubObjects		   = HLMT_03	; Headband sort of

	HideSubObjects		   = GNLT_01
	HideSubObjects		   = GNLT_02
	HideSubObjects		   = GNLT_03
;	HideSubObjects		   = GNLT_04
	HideSubObjects		   = GNLT_05	; Left gauntlet

	HideSubObjects		   = BOOT_01
	HideSubObjects		   = BOOT_02
	HideSubObjects		   = BOOT_03	; Simple metal guards
;	HideSubObjects		   = BOOT_04	; Simple dark-green metal guards
	HideSubObjects		   = BOOT_05

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
	End


	AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = CHAR_FE.tga		0 CHAR_FE.tga	; No change, after all.
		RecolorHouse		   = No
	End
	End









;------- COLOR SPRAY SPELL --------------------------------------------------------------------------------

AddModule
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ColorSprayEnabler 
		SpecialPowerTemplate		= SpecialAbilityColorSpray
		TriggeredBy			= Upgrade_RheiaLevel2
	End
END

AddModule
	Behavior = SpecialPowerModule ModuleTag_ColorSprayStarter                      
		SpecialPowerTemplate		= SpecialAbilityColorSpray
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= PeasantFemaleVoiceSelectBattle ;this plays when she targets, not when he firesPeasantFemaleVoiceAttackBuilding
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ColorSprayUpdae
		SpecialPowerTemplate    = SpecialAbilityColorSpray
		WhichSpecialWeapon	= 3

;		AntiCategory		= LEADERSHIP
;		AttributeModifier	= BoromirGondorHornAntiCategory		; Used for the anti category duration only.
;		AttributeModifierRange	= 80.0 ; ;100.0

		SkipContinue		= Yes
		UnpackTime              = 1300
		PreparationTime         = 1   
		PersistentPrepTime      = 1400 
		PackTime                = 300 
		AwardXPForTriggering    = 0		
		StartAbilityRange	= 50.0		; How close Rheia gets to the target before firing
		MustFinishAbility	= Yes
		SpecialWeapon		= ColorSpray								
	End
END

;	Behavior = SpecialPowerModule ModuleTag_HornStarter						
;		SpecialPowerTemplate		= SpecialAbilityColorSpray
;		UpdateModuleStartsAttack	= Yes
;		AntiCategory			= LEADERSHIP
;		AttributeModifier		= BoromirGondorHornAntiCategory		; Used for the anti category duration only.
;		AttributeModifierRange		= 70.0 ; ;100.0
;		StartsPaused			= Yes								; obtained on level 2
;	End

AddModule
	Behavior = AISpecialPowerUpdate ColorSprayAI
		CommandButtonName = Command_SpellBookCloudBreak
		SpecialPowerAIType = AI_SPECIAL_POWER_GANDALF_WIZARD_BLAST
		SpecialPowerRadius = 70
	End
END

;------------------------------------------

AddModule
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End
END

;------- REGENERATION --------------------------------------------------------------------------------

AddModule
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RegenerationEnabler
		SpecialPowerTemplate		= SpecialAbilityRegeneration
		TriggeredBy			= Upgrade_RheiaLevel4
	End
END

;AddModule
;	Behavior = SpecialPowerModule ModuleTag_RegenerationUpdate   
;		SpecialPowerTemplate		= SpecialAbilityRegeneration
;		UpdateModuleStartsAttack	= No
;		StartsPaused			= Yes
;	End	
;END

AddModule
	Behavior = OCLSpecialPower ModuleTag_RegenerationOCL
		SpecialPowerTemplate		= SpecialAbilityRegeneration
		OCL				= OCL_RegenerationAura
		TriggerFX			= FX_RegenerationAuraCenter
		CreateLocation			= CREATE_AT_LOCATION
		StartsPaused			= Yes
		SetModelCondition		= ModelConditionState:USER_1
		SetModelConditionTime		= 8.1
	End
END

;AddModule
;	Behavior = SpecialAbilityUpdate ModuleTag_RegenerationAnimation
;		SpecialPowerTemplate		= SpecialAbilityRegeneration
;		UnpackTime			= 1
;		PreparationTime			= 1
;		PackTime			= 2000
;		UnpackingVariation		= 5
;	End
;END

;------------------------------------------

;------- NATURE'S FAVOUR ------------------------------------------------------------------------------

AddModule
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_NaturesFavourEnabler
		SpecialPowerTemplate = SpecialAbilityNaturesFavour
		TriggeredBy = Upgrade_RheiaLevel5							; NATURE'S FAVOUR UPGRADE REQUIREMENT (CHECK EXP LEVELS)
	End
END

AddModule
	Behavior = SpecialPowerModule ModuleTag_NaturesFavourUpdate   
		SpecialPowerTemplate		= SpecialAbilityNaturesFavour
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		AttributeModifier		= RheiaNaturesFavour
		AttributeModifierRange		= 130
		AttributeModifierAffectsSelf	= Yes
		AttributeModifierAffects	= ANY +HERO
		AttributeModifierFX		= FX_NaturesFavour
		InitiateSound			= PeasantFemaleVoiceSelect ;this plays when she targets, not when he fires
	End
END

AddModule	
	Behavior = SpecialAbilityUpdate ModuleTag_NaturesFavourAnimation
		UnpackTime              = 1000
		UnpackingVariation	= 1
		SpecialPowerTemplate	= SpecialAbilityNaturesFavour
 		PreparationTime         = 0  
 		PersistentPrepTime      = 0
 		PackTime                = 1330
 	End
END


AddModule
	Behavior = AISpecialPowerUpdate SpecialPowerNaturesFavour
		CommandButtonName = Command_ConstructElvenMallornTree
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
END

;------------------------------------------

;------- ENTANGLING VINES ------------------------------------------------------------------------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EntanglingVinesUnpause
		SpecialPowerTemplate		= SpecialAbilityEntanglingVines ; SpecialAbilityWormtongueVenomousWords ; 
		TriggeredBy			= Upgrade_RheiaLevel9							; ENTANGLING VINES UPGRADE REQUIREMENT (CHECK EXP LEVELS)
	End

	Behavior = SpecialPowerModule ModuleTag_EntanglingVinesSpecialPower
		SpecialPowerTemplate		= SpecialAbilityEntanglingVines ; SpecialAbilityWormtongueVenomousWords
		StartsPaused			= Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= PeasantFemaleVoiceAttackBuilding ;this plays when she targets, not when he fires
	End
	
	Behavior = ActivateModuleSpecialPower ModuleTag_EntanglingVinesUpdate
		SpecialPowerTemplate		= SpecialAbilityEntanglingVines ; SpecialAbilityWormtongueVenomousWords
		StartAbilityRange		= 180
		TriggerSpecialPower		= ModuleTag_OCLSpecialPowerEntanglingVines TARGETPOS	; Vines
		TriggerSpecialPower		= ModuleTag_WormtongueVenomousWordsDebuff TARGETPOS	; Armor debuff
;		TriggerSpecialPower		= ModuleTag_DamageHandler TARGETPOS			; Damage over time, won't work
	End

	Behavior = SpecialPowerModule ModuleTag_WormtongueVenomousWordsDebuff
		SpecialPowerTemplate		= SpecialAbilityActivateeDummy
		AntiCategory			= LEADERSHIP BUFF
		AttributeModifier		= EnganglingVinesAttributeModifier ; WormtongueVenomousWordsDebuff
		AttributeModifierRange		= 100.0 ; ;100.0
		AttributeModifierAffects	= ANY +INFANTRY +CAVALRY -MACHINE -IMMOBILE -DOZER -STRUCTURE -BASE_FOUNDATION -HORDE -DwarvenBattleWagon -RohanOathbreaker -MordorRamCrew +MordorWorker -IsengardRamCrew -IsengardBeserker
	End

	Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerEntanglingVines
		SpecialPowerTemplate	= SpecialAbilityActivateeDummy2
		OCL			= OCL_EntanglingVines
		TriggerFX		= FX_EntanglingVinesCenter
		CreateLocation		= CREATE_AT_LOCATION
		StartsPaused		= Yes
		SetModelCondition	= ModelConditionState:USER_1
		SetModelConditionTime	= 8.1
	End

;	Behavior = Fireweaponupdate ModuleTag_DamageHandler
;		FireWeaponNugget
;			WeaponName = EntanglingVinesWeapon
;			FireDelay = 0
;			OneShot = Yes	; Alternative is to fire as often as the reload time of this weapon allows
;		End
;	END


;-----------------------------------------------

;-------- Nature's Ally -------------------------------------------------------------------------------


Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LegendsNaturesAlly
	SpecialPowerTemplate	= SpecialAbilityNaturesAlly
	TriggeredBy		= Upgrade_RheiaLevel8							; NATURE'S ALLY UPGRADE REQUIREMENT (CHECK EXP LEVELS)
End



Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_LegendsNaturesAlly
	InitiateSound		= PeasantFemaleVoiceMove
	SpecialPowerTemplate	= SpecialAbilityNaturesAlly
	OCL			= OCL_SpawnNaturesAlly
	TriggerFX		= FX_BombadilSummoningStart
	CreateLocation		= CREATE_AT_LOCATION
	StartsPaused		= Yes
	SetModelCondition	= ModelConditionState:USER_1
	SetModelConditionTime	= 8.1
End


;-----------------------------------------------














// --------- ANIMATIONS  ------------

	ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

		DefaultModelConditionState
			Model			= CHAR_FE_U_SKN
			Skeleton		= CHAR_FE_U_SKL
			WeaponLaunchBone	= PRIMARY Bat_HandL
		End

//------------------  DYING -------------------------------------------------------------

// --- Flying through the air.

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHAR_FE_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

// --- Dying anims

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHAR_FE_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHAR_FE_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHAR_FE_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims

AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHAR_FE_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHAR_FE_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------


// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= CHAR_FE_U_LVLA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= CHAR_FE_U_SPCA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

//--------------------- Wound Arrow anim
AnimationState        =  SPECIAL_WEAPON_TWO
	StateName = STATE_Bow
	Animation
		AnimationName       = CHAR_FE_U_SPCL CHAR_FE_U_ATKC
		AnimationMode       = ONCE
	End
	FrameForPristineBonePositions = 59
	BeginScript
		CurDrawableShowSubObject("arrow")
	EndScript
End
		
//------------------ ATTACKING --------------------------------------------------------------------
		// Attacking Anims [Weapon_A]
		
		

//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHAR_FE_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End


		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			Animation
				AnimationName   = CHAR_FE_U_RUNA
				AnimationSpeedFactorRange = 0.85 0.85
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHAR_FE_U_ATKA1 CHAR_FE_U_ATKA CHAR_FE_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

// this hit animation attack stance
		AnimationState = EMOTION_ALERT HIT_REACTION WEAPONSET_TOGGLE_1
			Animation
				AnimationName = CHAR_FE_B_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHAR_FE_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHAR_FE_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= CHAR_FE_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHAR_FE_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End

		//	EX COLOR SPRAY    //
		AnimationState		  =	SPECIAL_WEAPON_TWO
			StateName		  =	Attacking
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.1 0.1
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.1 0.1
			End
		End

		//	COLOR SPRAY //
		AnimationState		  =	SPECIAL_WEAPON_THREE
			StateName		  =	Attacking
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
;			Animation CHRB
;				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
;				AnimationMode		=	ONCE
;				AnimationSpeedFactorRange = 1.2 1.2
;			End
		End
		
		; Throwing and cripple strike
		AnimationState		  =	SPECIAL_WEAPON_FOUR
			StateName		  =	Attacking
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE
			StateName		  =	Attacking
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX
			StateName		  =	Attacking
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
		End

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHAR_FE_U_SPCC CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHAR_FE_U_SPCA CHAR_FE_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHAR_FE_U_SPCB CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHAR_FE_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHAR_FE_U_SPCC CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHAR_FE_U_SPCA CHAR_FE_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHAR_FE_U_SPCB CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
//----------- Captain of Gondor - Sword --------------------------------------------
		AnimationState        = PACKING_TYPE_2 WEAPONSET_TOGGLE_1
			StateName		  =	CaptainPower
			Animation           = GUHero_CHRC
				AnimationName     = CHAR_FE_U_CHRC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
		End

//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHAR_FE_U_SPCE CHAR_FE_U_SPCA CHAR_FE_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHAR_FE_U_SPCC CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHAR_FE_U_SPCA CHAR_FE_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHAR_FE_U_SPCB CHAR_FE_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHAR_FE_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHAR_FE_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHAR_FE_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHAR_FE_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		

		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHAR_FE_U_SPCB
				AnimationMode =	ONCE
			End
		End
		


		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHAR_FE_U_SPCD
				AnimationMode =	ONCE
			End
		End




//====== LEVELED

		AnimationState				= LEVELED 						// This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= CHAR_FE_U_CHRA CHAR_FE_U_LVLA
				AnimationMode		= ONCE
			End
		End

//---------------------- EMOTIONS ---------------------------------------------------------------

		// cheer, on foot
		AnimationState				=	EMOTION_CELEBRATING
			Animation CHRA
				AnimationName		=	CHAR_FE_U_CHRA CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_CHRB CHAR_FE_U_CHRA CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End		
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation CHRA
				AnimationName		=	CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHAR_FE_U_TNTB CHAR_FE_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End		


//====== ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHAR_FE_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
// --- Idle Toggled

		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHAR_FE_U_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
			Animation = Foot_IDLC // Bored Fidget
				AnimationName       = CHAR_FE_U_IBFA
				AnimationMode       = ONCE
				AnimationPriority   = 2
			End
			//Animation = Foot_IDLD // Bored Fidget
			//	AnimationName       = CHAR_FE_U_IBFB
			//	AnimationMode       = ONCE
			//	AnimationPriority   = 1
			//End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
	End
	End





;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;End Of Animations
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<



	Side = Mordor


	WeaponSet
		Conditions					= None
		Weapon						= PRIMARY    CreateAHeroBasicMeleeWeapon
		AutoChooseSources				= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

;	WeaponSet
;		Conditions		= WEAPONSET_HERO_MODE
;		Weapon			= PRIMARY    RheiaHeroWeapon
;	End


	ArmorSet
		Conditions					= None
		Armor						= CAHArmorHeroOfTheWest
		DamageFX					= NormalDamageFX
	End
	

	ThreatBreakdown GoblinFighterHorde_DetailedThreat
		AIKindOf = CAVALRY
	End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Voice
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
	VoiceAttack 				= PeasantFemaleVoiceAttack
	VoiceAttackCharge 			= PeasantFemaleVoiceAttackCharge
	VoiceAttackStructure 			= PeasantFemaleVoiceAttackBuilding
	VoiceAttackMachine 			= PeasantFemaleVoiceAttack
	VoiceCreated 				= PeasantFemaleVoiceSalute
	VoiceFullyCreated 			= PeasantFemaleVoiceSalute
	VoiceGuard				= PeasantFemaleVoiceMove
	VoiceMove 				= PeasantFemaleVoiceMove
	VoiceMoveToCamp 			= PeasantFemaleVoiceMoveCamp
	VoiceMoveWhileAttacking 		= PeasantFemaleVoiceDisengage
	VoicePriority				= 30
	VoiceFear				= PeasantFemaleVoiceFearDisperse
	VoiceRetreatToCastle 			= PeasantFemaleVoiceRetreat
	VoiceSelect 				= PeasantFemaleVoiceSelect
	VoiceSelectBattle  			= PeasantFemaleVoiceSelectBattle
	
	VoiceEnterStateAttack 			= PeasantFemaleVoiceEnterStateAttack
	VoiceEnterStateAttackCharge 		= PeasantFemaleVoiceEnterStateAttackCharge
	VoiceEnterStateAttackStructure		= PeasantFemaleVoiceEnterStateAttackBuilding
	VoiceEnterStateAttackMachine 		= PeasantFemaleVoiceEnterStateAttackBuilding
	VoiceEnterStateMove 			= PeasantFemaleVoiceEnterStateMove
	VoiceEnterStateMoveToCamp 		= PeasantFemaleVoiceEnterStateMoveCamp
	VoiceEnterStateMoveWhileAttacking 	= PeasantFemaleVoiceEnterStateDisengage
	VoiceEnterStateRetreatToCastle		= PeasantFemaleVoiceEnterStateRetreat

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Animation sounds
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

;TrollFootstepRampage
;TrollFootstep


;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

	KindOf			= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ;ATTACK_NEEDS_LINE_OF_SIGHT CAN_CLIMB_WALLS

	CommandSet  = RheiaCommandSet
	CommandPoints = 0

	LocomotorSet
		Locomotor					= HeroHumanScalingLocomotor
		Condition					= SET_NORMAL
		Speed						= 50
	End

	ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= 4500 
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= 50%	
	End
	End

  ReplaceModule ModuleTag_GloinHealing					;This makes CaH regenerate a lot faster
	Behavior = AutoHealBehavior ModuleTag_LegendsFaramirHealing
		StartsActive		  =	Yes
		HealingAmount		  =	100 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY
		HealOnlyIfNotInCombat =	Yes
	End
  END

RemoveModule	ModuleTag_SlamStarter
RemoveModule	ModuleTag_ShakeFoundationStarter
RemoveModule	ModuleTag_SmashStarter

	Geometry		= CYLINDER
	GeometryMajorRadius	= 8.0
	GeometryMinorRadius	= 8.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	Shadow			= SHADOW_DECAL
	ShadowSizeX		= 20
	ShadowSizeY		= 20
	ShadowTexture		= ShadowI
	PathfindDiameter	= 20.0

End

ExperienceLevel	WildGoblinKingLevel2
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL2_EXP_NEEDED  
	ExperienceAward				= WILD_GOBLIN_KING_LVL2_EXP_AWARD
	AttributeModifiers			= HeroLevelUpDamage1
	Rank					= 2
	LevelUpFx				= FX:GandalfLevelUp1FX

	Upgrades				= Upgrade_RheiaLevel2
	SelectionDecal
		Texture				= decal_hero_evil	
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	
END

ExperienceLevel	WildGoblinKingLevel4
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL4_EXP_NEEDED  
	ExperienceAward				= WILD_GOBLIN_KING_LVL4_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage3
	Rank					= 4
	LevelUpFx				= FX:GandalfLevelUp1FX
	
	Upgrades				= Upgrade_RheiaLevel4

	SelectionDecal
		Texture				= decal_hero_evil
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	WildGoblinKingLevel5
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL5_EXP_NEEDED; 2000  
	ExperienceAward				= WILD_GOBLIN_KING_LVL5_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage4
	Rank					= 5
	LevelUpFx				= FX:GandalfLevelUp1FX

	Upgrades				= Upgrade_RheiaLevel5
	SelectionDecal
		Texture				= decal_hero_evil
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	WildGoblinKingLevel7
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL7_EXP_NEEDED ; 3400  
	ExperienceAward				= WILD_GOBLIN_KING_LVL7_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage6
	Rank					= 7
	LevelUpFx				= FX:GandalfLevelUp1FX

	Upgrades				= Upgrade_RheiaLevel7
	SelectionDecal
		Texture				= decal_hero_evil
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	WildGoblinKingLevel8
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL8_EXP_NEEDED ; 5500  
	ExperienceAward				= WILD_GOBLIN_KING_LVL8_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage7
	Rank					= 8
	LevelUpFx				= FX:GandalfLevelUp1FX

	Upgrades				= Upgrade_RheiaLevel8
	SelectionDecal
		Texture				= decal_hero_evil
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	

END


ExperienceLevel	WildGoblinKingLevel9
	TargetNames				= WildGoblinKing
	RequiredExperience			= WILD_GOBLIN_KING_LVL9_EXP_NEEDED ; 5500  
	ExperienceAward				= WILD_GOBLIN_KING_LVL9_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage8
	Rank					= 9
	LevelUpFx				= FX:GandalfLevelUp1FX

	Upgrades				= Upgrade_RheiaLevel9
	SelectionDecal
		Texture				= decal_hero_evil
		Style				= SHADOW_ALPHA_DECAL
		OpacityMin			= 50%	
		OpacityMax			= 100%
		MinRadius			= 40
		MaxRadius			= 200
		MaxSelectedUnits		= 40
	End	

END





;------------- END RHEIA ----------------













;--------------------------------------------------------
;CUSTOM HERO 3 - RHAKID, THE ORC ILLUSIONIST
;--------------------------------------------------------

SpecialPower SpecialAbilityMirrorImage
	Enum			= SPECIAL_GENERAL_TARGETLESS
	ReloadTime		= 200000
;	PublicTimer		= No
;	RadiusCursorRadius	= CREATE_A_HERO_SUMMON_FAMILIAR_CURSOR_RADIUS
;	Flags			= WATER_OK
;	InitiateAtLocationSound	= SpellDraftGeneric
End

SpecialPower SpecialAbilityUncontrollableRage
	Enum		= SPECIAL_HERO_MODE
	ReloadTime	= 190000
End

SpecialPower SpecialAbilityBlazingSweep
	Enum		= SPECIAL_KNIFE_ATTACK
	ReloadTime	= 100000
END

SpecialPower SpecialAbilityThornMetalArmor
	Enum		= SPECIAL_FAKE_LEADERSHIP_BUTTON
	ReloadTime	= 1
END

Upgrade Upgrade_RhakidLevel9
	Type		= OBJECT
End

Upgrade Upgrade_RhakidLevel10
	Type		= OBJECT
End



FXParticleSystem MirrorImageSmoke
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire01.tga
    Lifetime = 120 120
    SystemLifetime = 35
    Size = 4 5
    BurstDelay = 6 6
    BurstCount = 1 2
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:40 G:40 B:45 5
    Color3 = R:0 G:0 B:0 120
  End
  Update = DefaultUpdate
    SizeRate = 1.3 1.1
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.1 0.1
    Y = -0.1 0.1
    Z = 0.2 0.5
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem OathBreakerSmokeGlow
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLnzFlar2.tga
    Lifetime = 120 120
    SystemLifetime = 30
    Size = 1 1
    BurstDelay = 5 6
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:72 G:72 B:80 0
    Color2 = R:0 G:0 B:0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 2
    SizeRateDamping = 0.9 0.99
    AngleZ = -1 1
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.985 0.99
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 2 2.5
    OtherSpeed = 0.3 0.3
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 1
  End
  Draw = DefaultDraw
  End
End



FXList FX_MirrorImage
  ParticleSystem
    Name = MirrorImageSmokeGlow
  End
  ParticleSystem
    Name = MirrorImageSmoke
  End
;  ParticleSystem
;    Name = OathBreakerFlare 
;  End
;  ParticleSystem
;    Name = oathBreakerLightShaft 
;  End
  Sound
    Name = SpellDraftGeneric
  End
End










FXParticleSystem BlazingSweepParticlesYellow
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLightRays.tga
    Lifetime = 30 30
    SystemLifetime = 20
    Size = 15 18
    BurstDelay = 3 3
    BurstCount = 5 5
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:72 G:10 B:0 0
    Color2 = R:200 G:200 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 1.8 1.9
    SizeRateDamping = 0.99 0.99
    AngleZ = 0.7 0.7
    AngularRateZ = -0.4 -0.5
    AngularDamping = 0.78 0.82
    AngularDampingXY = 0.98 0.98
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 1
    Length = 4
    Offset = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End



FXParticleSystem BlazingSweepFireBursts
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire03.tga
    Lifetime = 25 25
    SystemLifetime = 25 25
    SortLevel = 1
    Size = 7 9
    BurstCount = 7 9
    InitialDelay = 12 12
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:185 G:85 B:40 1
    Color3 = R:255 G:6 B:0 25
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.05 0.2 1
    Alpha3 = 0 0 25
  End
  Update = DefaultUpdate
    SizeRate = 0.2 0.3
    SizeRateDamping = 1 1
    AngleZ = -7 7
    AngularDamping = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.02
    VelocityDamping = 0.97 0.99
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:8 Y:-5 Z:8
    EndPoint = X:8 Y:5 Z:8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 1.8 4
    Y = -2 2
    Z = 0 0.1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem BlazingSweepSmokeBursts
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXCloud03.tga
    Lifetime = 45 45
    SystemLifetime = 28 28
    SortLevel = 1
    Size = 4 7
    BurstCount = 1 1
    InitialDelay = 12 12
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:247 G:150 B:62 15
    Color2 = R:0 G:0 B:0 45
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.2 0.5 1
    Alpha2 = 0 0 45
  End
  Update = DefaultUpdate
    SizeRate = 0.2 0.3
    SizeRateDamping = 1 1
    AngleZ = -7 7
    AngularDamping = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.025
    VelocityDamping = 0.97 0.99
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:5 Y:2 Z:1
    EndPoint = X:5 Y:4 Z:1
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 1.8 4
    Y = -2 2
    Z = 0 0.1
  End
  Draw = DefaultDraw
  End
End


FXList FX_BlazingSweep
;  ParticleSystem
;    Name = BlazingSweepParticlesYellow
;    OrientToObject = Yes
;    AttachToObject = Yes
;  End
  ParticleSystem
    Name = BlazingSweepFireBursts
    OrientToObject = Yes
  End
  ParticleSystem
    Name = BlazingSweepSmokeBursts
    OrientToObject = Yes
  End
;  ParticleSystem
;    Name = BlazingSweepParticlesOrange
;    OrientToObject = Yes
;  End
;  ParticleSystem
;    Name = BlazingSweepParticlesRed
;    OrientToObject = Yes
;  End
  Sound
    Name = FireStartWoosh
  End
END


FXParticleSystem BlazingSweepSword1
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXFire03.tga
    Lifetime = 17 17
    SystemLifetime = 35 35
    SortLevel = 1
    Size = 5 6
    BurstCount = 4 6
    InitialDelay = 7 7
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:185 G:85 B:40 1
    Color3 = R:255 G:6 B:0 17
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.05 0.2 1
    Alpha3 = 0 0 17
  End
  Update = DefaultUpdate
    SizeRate = 0.1 0.2
    SizeRateDamping = 1 1
    AngleZ = -7 7
    AngularDamping = 1 1
  End
  Physics = DefaultPhysics
    Gravity = -0.01
    VelocityDamping = 1 1
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:10 Z:0
    EndPoint = X:5 Y:25 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.1 0.1
    Y = -0.1 0.25
    Z = -0.1 0.1
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem BlazingSweepSword2
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXCloud03.tga
    Lifetime = 35 35
    SortLevel = 1
    Size = 2 6
    BurstCount = 1 1
;    InitialDelay = 1 1
    IsEmitAboveGroundOnly = Yes
  End
  Color = DefaultColor
    Color1 = R:247 G:150 B:62 15
    Color2 = R:0 G:0 B:0 30
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.2 0.5 1
    Alpha2 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 2 3
    SizeRateDamping = 0.9 0.99
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.85
    DriftVelocity = X:0 Y:0 Z:0.24
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:5 Z:0
    EndPoint = X:0 Y:25 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.1 0.1
    Y = -0.1 0.2
    Z = -0.1 0.1
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.1
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
    TurbulenceAmplitude = 0.02
    TurbulenceFrequency = 25
  End
End



FXList FX_UncontrollableRage
  TintDrawable
	Color			= R:180 G:0 B:0
	PreColorTime		= 10
	PostColorTime		= 10
	SustainedColorTime	= 780 ; 440
	Frequency		= 0
	Amplitude		= 0
  End
  Sound
    Name = OrcBatteringRamVoiceAttackCharge
  End
End

ModifierList UncontrollableRageAttribute
	Category = WEAPON
	Duration = 28000	;Match this with HeroEffectDuration
	Modifier = SPEED 140%
	Modifier = DAMAGE_MULT 120%
	Modifier = ARMOR -10%
	FX	 = FX_UncontrollableRage
END

ModifierList RhakidDamage
	Category			= INNATE_DAMAGEMULT
	Modifier			= DAMAGE_MULT 215%
	Duration			= 0
End

ModifierList RhakidBossAttributtes
	Category = BUFF			;Is this ok?
	Duration = 0			;Permanent
	Modifier = HEALTH 10000
	Modifier = SPEED 120%
	Modifier = ARMOR 100%
	Modifier = DAMAGE_MULT 110%
END

ModifierList RhakidBossAttributtes2
	Category = BUFF			;Is this ok?
	Duration = 0			;Permanent
	Modifier = HEALTH 17500		; even more hitpoints than before
	Modifier = SPEED 120%
	Modifier = ARMOR 100%
	Modifier = DAMAGE_MULT 130%	;
END

ModifierList RhakidPartyAttributtes
	Category = BUFF
	Duration = 0
	Modifier = HEALTH 20500
END

CommandButton Command_SpawnOathbreakers					;Mirror Image
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityMirrorImage
	TextLabel		= CONTROLBAR:LegendsMirrorImage
	DescriptLabel		= CONTROLBAR:TooltipLegendsMirrorImage
	ButtonImage		= UCOathbreaker_OathTimer
	Options			= NONE
	RadiusCursorType	= SummonOathBreakersRadiusCursor
	CursorName		= Bombard
	InvalidCursorName	= GenericInvalid  
	ButtonBorderType	= ACTION 
	InPalantir		= Yes
	;UnitSpecificSound	= AragornVoiceSummonOathbreakers
	AutoAbility		= Yes
	;TriggerWhenReady	= Yes ;
End

CommandButton Command_PurchaseUpgradeWildFortressRazorSpines		;Thorn metal armor
	Command         	= SPECIAL_POWER 
	SpecialPower        	= SpecialAbilityThornMetalArmor
	Options			= NONPRESSABLE
	Upgrade         	= None
	TextLabel       	= CONTROLBAR:LegendsThornMetalArmor
	DescriptLabel   	= CONTROLBAR:TooltipLegendsThornMetalArmor
	ButtonImage     	= BWFortress_RazorSpines
	ButtonBorderType	= ACTION
	Radial          	= No
	InPalantir	   	= Yes
End

CommandButton Command_SpecialAbilityWormtongueEscape			; Escape
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityWormtongueEscape
	TextLabel		= CONTROLBAR:LegendsEscape
	DescriptLabel   	= CONTROLBAR:TooltipLegendsEscape
	ButtonImage		= HSWormtongueEscape
	ButtonBorderType	= ACTION
	InPalantir		= Yes
	AutoAbility		= No
End

CommandButton Command_SpecialAbilityTerribleFury			; Uncontrollable Rage
	Command             	= SPECIAL_POWER
	Options			= NEED_UPGRADE
	NeededUpgrade		= Upgrade_RhakidLevel10
	SpecialPower        	= SpecialAbilityUncontrollableRage
	TextLabel             	= CONTROLBAR:LegendsUncontrollableRage
	DescriptLabel        	= CONTROLBAR:TooltipLegendsUncontrollableRage
	ButtonImage        	= HSSauronTerribleFury
	ButtonBorderType  	= ACTION 
	InPalantir		= Yes
	AutoAbility		= Yes
	AutoDelay		= 30.0 ; this should sync with the Aragorn's hero mode effect time
	PresetRange		= 50.0
	;UnitSpecificSound		= OrcGroupExtraLarge_AttackChargeMS
End

CommandButton Command_SpecialAbilityLurtzCarnage			; Blazing Sweep
	Command			= SPECIAL_POWER
	Options			= NEED_UPGRADE NEED_TARGET_ENEMY_OBJECT
	NeededUpgrade		= Upgrade_RhakidLevel9
	SpecialPower		= SpecialAbilityBlazingSweep
	ButtonImage		= HSLurtzCarnageAbility
	ButtonBorderType	= ACTION 
	TextLabel		= CONTROLBAR:LegendsBlazingSweep
	DescriptLabel		= CONTROLBAR:TooltipLegendsBlazingSweep
	EnableOnModelCondition	= USER_2	;WEAPONSET_TOGGLE_1
	CursorName              = EvilAbilityObj
	InvalidCursorName       = GenericInvalid 
	InPalantir		= Yes
	AutoAbility		= Yes
	PresetRange		= 30.0
	UnitSpecificSound	= OrcBatteringRamVoiceAttackCharge
End

CommandButton Command_ConstructRohanArmory			; Boss only Firebombs
	Command			= SPECIAL_POWER 
	Object			= NONE
	SpecialPower		= SpecialAbilityCreateAHeroFireBomb_Level4
	Options			= NEED_TARGET_ENEMY_OBJECT ; NEED_TARGET_NEUTRAL_OBJECT CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:CAH_FireBomb_Level4
	ButtonImage		= UCCommon_Firebomb
	CursorName		= Bombard
	ButtonBorderType	= ACTION 
	DescriptLabel		= CONTROLBAR:ToolTipCAH_FireBomb_Level4
	InvalidCursorName	= GenericInvalid
	InPalantir		= No
	Radial			= No
	AutoAbility		= No
	PresetRange		= 200.0
End


CommandSet RhakidCommandSet
	1 = Command_ToggleStance
	2 = Command_SpawnOathbreakers				; Mirror Image
	3 = Command_PurchaseUpgradeWildFortressRazorSpines	; Thorn Metal Armor
	4 = Command_SpecialAbilityWormtongueEscape		; Escape
	5 = Command_SpecialAbilityLurtzCarnage			; Blazing sweep
	6 = Command_SpecialAbilityTerribleFury			; Uncontrollable Rage

    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
	15 = Command_ConstructRohanArmory			; Boss only firebombs
END

CommandSet RhakidMirrorCommandSet
    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
END






Weapon BlazingSweep
	ClearNuggets ;;.;;
	IdleAfterFiringDelay		= 0
	LeechRangeWeapon		= Yes
	AttackRange			= 30	; 100
	WeaponSpeed			= 401
	RadiusDamageAffects		= ENEMIES NEUTRALS NOT_SIMILAR
	DelayBetweenShots		= 5000 ;50000
	PreAttackType    		= PER_ATTACK
	PreAttackDelay   		= 2500
	FireFX           		= FX_BlazingSweep
	FiringDuration       		= 1500
	DamageDealtAtSelfPosition	= Yes 
	IsAimingWeapon			= Yes
	AcceptableAimDelta		= 15
	AntiAirborneVehicle		= No
	AntiAirborneMonster		= No

	DamageNugget
		Damage			= 1650
		DamageArc 		= 60
		Radius			= 80.0
		DamageType		= FLAME
		DamageFXType		= MAGIC
		DeathType		= BURNED
		DamageSpeed		= 700.0
		DelayTime		= 800		; Because PreAttackDelay won't work
	End
	MetaImpactNugget
		HeroResist		= 0.85
		ShockWaveAmount		= 70.0
		ShockWaveArc		= 60
		ShockWaveRadius		= 80.0
		ShockWaveTaperOff	= 0.35
		ShockWaveZMult		= 1.000
		ShockWaveSpeed		= 700.0
		DelayTime		= 800		; Because PreAttackDelay won't work
	End
End


Weapon ThornMetalArmorWeapon
	RadiusDamageAffects	= ENEMIES
	ClearNuggets ;;.;;

  	DelayBetweenShots	= 1500			; time between each damage dealing
	ClipSize		= 0			;4	; how many shots in a Clip (0 == infinite)
  
	DamageNugget
		Damage		= 2
		Radius		= 28.0
		DelayTime	= 0
		DamageType	= SLASH
;		DamageFXType	= SWORD_SLASH ;MAGIC (magic used in debug to check range, and balance)
		DeathType	= NORMAL
		DamageScalar	= 0% NONE +STRUCTURE
		CylinderAOE	= Yes
	End
End


Weapon UncontrollableRageWeapon
	LeechRangeWeapon	= Yes
	AttackRange		= STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon		= Yes
	FireFX			= FX_GondorSwordHit
	DelayBetweenShots	= 200 ; 1400 (5x normal)
	PreAttackDelay		= FARAMIR_PREATTACKDELAY
	PreAttackType		= PER_SHOT
	FiringDuration		= 200 ; 1200
	UseInnateAttributes	= Yes

	DamageNugget								; A basic Nugget that just does damage
		Damage		= CREATE_A_HERO_DAMAGE
		Radius		= 18.0
		DelayTime	= 0
		DamageType	= HERO
		DamageArc	= 90
		DamageFXType	= SWORD_SLASH
		DeathType	= NORMAL
	End


	MetaImpactNugget ; This is where it gets epic... only used when enemy dies (Goblins rain apart! :P)
       		HeroResist      = .75
      		ShockWaveAmount = 40.0
        	ShockWaveArc    = 90 ;Angle of metaimpact
        	ShockWaveRadius = 18.0 ;How far the metaimpact reaches
        	ShockWaveTaperOff = 0.8 ; Lenght thrown forward (Approx x2 metres)
        	ShockWaveZMult = 1.4  ; Height thrown upwards (approx x metres)
		OnlyWhenJustDied = Yes
    	End

END


ExperienceLevel	ElrondLevel9	;RhakidLv9
	TargetNames			=	ElvenElrond
	RequiredExperience		=	ELROND_LVL9_EXP_NEEDED	
	ExperienceAward			=	ELROND_LVL9_EXP_AWARD
	Rank				=	9
	AttributeModifiers		=	HeroLevelUpDamage8
	Upgrades			=	Upgrade_RhakidLevel9
	SelectionDecal
		Texture			=	decal_hero_good
		Style			=	SHADOW_ALPHA_DECAL
		OpacityMin		=	50%	
		OpacityMax		=	100%
		MinRadius		=	40
		MaxRadius		=	200
		MaxSelectedUnits	=	40
	End	
End

ExperienceLevel	ElrondLevel10	;RhakidLv10
	TargetNames			=	ElvenElrond
	RequiredExperience		=	ELROND_LVL10_EXP_NEEDED	
	ExperienceAward			=	ELROND_LVL10_EXP_AWARD
	Rank				=	10
	AttributeModifiers		=	HeroLevelUpDamage9
	Upgrades			=	Upgrade_RhakidLevel10
	SelectionDecal
		Texture			=	decal_hero_good
		Style			=	SHADOW_ALPHA_DECAL
		OpacityMin		=	50%	
		OpacityMax		=	100%
		MinRadius		=	40
		MaxRadius		=	200
		MaxSelectedUnits	=	40
	End	
End



Weapon MirrorWeapon
	LeechRangeWeapon	= Yes
	AttackRange		= STANDARD_MELEE_ATTACK_RANGE
	MeleeWeapon		= Yes
	FireFX			= FX_GondorSwordHit
	DelayBetweenShots	= 1400 ;miliseconds
	PreAttackDelay		= FARAMIR_PREATTACKDELAY
	PreAttackType		= PER_SHOT
	FiringDuration		= 1200
	UseInnateAttributes	= Yes

	DamageNugget
		Damage        = 1
		Radius        = 1
		DelayTime     = 0
		DamageType    = HERO
		DamageFXType  = CLUBBING
		DeathType     = NORMAL
	End
End

Armor MirrorRhakid
  Armor = DEFAULT         18%    
  Armor = MAGIC            50%  
  Armor = HERO            100%   
End





;--------- MIRROR IMAGE RHAKID --------

ChildObject MordorPorter DwarvenGloin


	DisplayMeleeDamage = #MULTIPLY( 1 1 );;-;; 
	DisplayName	= OBJECT:Prop
	SelectPortrait	= None	;	upmordor_orchorde
	ButtonImage 	= WOR_OrcWarrior	;	hicahorcraider
	Scale		= 1.0
	CommandPoints	= 0
	KindOf		= PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY
	CommandSet	= RhakidMirrorCommandSet
	Side = Mordor

	EvaEventDieOwner = None

	RemoveModule Icon

	AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_GandalfWhite  ;
	End 
	End

AddModule 								;Mirror Images Regenerate quickly
	Behavior = AutoHealBehavior ModuleTag_LegendsMirrorHealing
		StartsActive		  =	Yes
		HealingAmount		  =	200 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY
		HealOnlyIfNotInCombat	  =	No 		; Heals constantly
	End
END

AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = CHSS_OR.tga		0 CHSS_OR_01.tga
		RecolorHouse		   = No
	End
End


AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy		= Upgrade_GandalfWhite
	HideSubObjects		= Firebrand 		; Firebrand
;	HideSubObjects		= Firebrand_FX01	; Firebrand's fire effect
	HideSubObjects		= Gurthang		; Thin sword
	HideSubObjects		= SWRD_03		; Machete 
	HideSubObjects		= SWRD_04		; Curved short thick blade
	HideSubObjects		= SWRD_05		; Razor Orc Blade
	HideSubObjects		= TROLLBANE		; Plain Greatsword
;	HideSubObjects		= Uruk_Sword_02		; Uruk Sword
	HideSubObjects		= Uruk_Sword_03		; Butcher's knife
	HideSubObjects		= WestronSword		; Long-hilted longsword
	HideSubObjects		= WizardSword		; Longer-hilted longsword


;	HideSubObjects		= SLDR_01		; Wing shoulder pads
	HideSubObjects		= SLDR_02		; Plain shoulder pads
	HideSubObjects		= SLDR_03		; Spikey shoulder pads
;	HideSubObjects		= SLDR_04		; Blood scavenger shoulder pads

;	HideSubObjects		= HLMT_02		; Tusks mask
;	HideSubObjects		= HLMT_03		; Viking wings
;	HideSubObjects		= HLMT_04		; Horns mask
;	HideSubObjects		= HLMT_05		; Blood scavenger Mask

	HideSubObjects		= GNLT_01		; Wing gauntlets
	HideSubObjects		= GNLT_02		; Spikey gauntlets
	HideSubObjects		= GNLT_03		; Plain gauntlets
;	HideSubObjects		= GNLT_04		; Blood scavenger gauntlets

	HideSubObjects		= SHIELD_1OG		; Wounding shield
	HideSubObjects		= SHIELD_2OG		; Spikey shield

	HideSubObjects		= SHLD_01		; Wounding shield
	HideSubObjects		= SHLD_02		; Spikey shield

	HideSubObjects		= Object02		; Barrel

	HideSubObjects		= BOOT_01		; Plain boots
;	HideSubObjects		= BOOT_02		; Wing boots
	HideSubObjects		= BOOT_03		; Spikey boots
;	HideSubObjects		= BOOT_04		; Blood scavenger boots

	FadeTimeInSeconds	= 0.0
	RecolorHouse		= No

	End
End

;---------------------------------------

	ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

		DefaultModelConditionState
			Model               = CHSS_OR_U_SKN
			Skeleton            = CHSS_GB_U_SKL
	
;			WeaponLaunchBone	= PRIMARY Bat_HandL
		End

//================== ANIMATIONS =================================================================


TransitionState				=	TRANS_Select
	Animation
		AnimationName		=	CHSS_GB_M_ATNA
		AnimationMode		=	ONCE
	End
End

// --------- UNMOUNTED  ------------

//------------------  DYING -------------------------------------------------------------

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHSS_GB_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims

AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHSS_GB_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHSS_GB_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End

		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHSS_GB_U_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

		//---------------------------------------------------


		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHSS_GB_U_ATKA1 CHSS_GB_U_ATKA CHSS_GB_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

// this hit animation attack stance

		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHSS_GB_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHSS_GB_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//====== ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHSS_GB_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
;Iddle
		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHSS_GB_U_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
			Animation = Foot_IDLC // Bored Fidget
				AnimationName       = CHSS_GB_U_IBFA
				AnimationMode       = ONCE
				AnimationPriority   = 2
			End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		
END ; Draw Module
END ; Module Replace


			VoiceAttack 					= FellBeastWingFlaps
			VoiceAttackAir					= FellBeastWingFlaps
			VoiceAttackCharge 				= FellBeastWingFlaps
			VoiceAttackMachine 				= FellBeastWingFlaps
			VoiceAttackStructure 				= FellBeastWingFlaps
			VoiceCreated					= FellBeastWingFlaps
			VoiceFear					= FellBeastWingFlaps
			VoiceFullyCreated				= FellBeastWingFlaps
			VoiceGuard					= FellBeastWingFlaps
			VoiceMove 					= FellBeastWingFlaps
			VoiceMoveToCamp 				= FellBeastWingFlaps
			VoiceMoveWhileAttacking 			= FellBeastWingFlaps
			VoicePriority					= 18
			VoiceRetreatToCastle 				= FellBeastWingFlaps
			VoiceSelect 					= FellBeastWingFlaps
			VoiceSelectBattle  				= FellBeastWingFlaps
		
			SoundImpact					= ImpactHorse
		
			UnitSpecificSounds
				VoiceEnterUnitElvenTransportShip	= Silence
				VoiceEnterUnitMordorMumakil		= Silence
				VoiceEnterUnitSlaughterHouse		= Silence
				VoiceEnterUnitTransportShip		= Silence
				VoiceGarrison				= Silence
				VoiceInitiateCaptureBuilding		= Silence
			End

	WeaponSet
		Conditions		= None
		Weapon			= PRIMARY	MirrorWeapon
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions		= None
		Armor			= MirrorRhakid
		DamageFX		= NormalDamageFX
	End

	LocomotorSet
		Locomotor = HeroHumanScalingLocomotor
		Condition = SET_NORMAL_UPGRADED
		Speed     = 50
	End


  Behavior = LifetimeUpdate ModuleTag_LifetimeUpdater
    MinLifetime = 43000   ; min lifetime in msec
    MaxLifetime = 48000  ; max lifetime in msec
  End

ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 				= EMOTION_CHEER_RADIUS
		MaxHealth         			= 500
		PermanentlyKilledByFilter		= NONE	
   		DodgePercent      			= 40%	
	End
End

  	Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes		= ALL
		FadeDelay		= 0
		FadeTime		= 5000
		DestructionDelay	= 5000
        	DeathFlags		= DEATH_1	
		FX			= INITIAL FX_UnSummonElvenAllies
		Sound			= INITIAL SpellGenericUnsummonFasterMS
	End

RemoveModule ModuleTag_05 ;Other slow death behavior
RemoveModule ModuleTag_07 ;ditto

RemoveModule ModuleTag_LGAU

	Geometry			= CYLINDER
	GeometryMajorRadius	= 6.0
	GeometryMinorRadius	= 6.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes

END
















ObjectCreationList OCL_MirrorImage
	CreateObject
		ObjectNames		= MordorPorter 
		Count			= 1
		UseJustBuiltFlag	= Yes
;		StartingBusyTime	= 2000
		FadeIn			= Yes
		FadeTime		= 4000
		IgnoreCommandPointLimit	= Yes
		Disposition 		= RELATIVE_ANGLE
		DispositionAngle	= 0
	End
END

Object AragornArmyofTheDeadSmallEgg
;	Draw = W3DScriptedModelDraw ModuleTag_Draw
;		DefaultModelConditionState
;			Model = None
;		End
;	End
;	KindOf = INERT IMMOBILE UNATTACKABLE
	
;	Body = ActiveBody ModuleTag_MakesKillWork
;		MaxHealth = 1
;	End
;	Behavior = LifetimeUpdate ModuleTag_HatchTrigger
;		MinLifetime = 0.0
;		MaxLifetime = 0.0
;	End

ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcessNew
		DestructionDelay = 4000
		FX = INITIAL FX_MirrorImage
		OCL = MIDPOINT OCL_MirrorImage
	End
END

End

ObjectCreationList OCL_MirrorImageEggs
	CreateObject
		ObjectNames		= AragornArmyofTheDeadSmallEgg
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 1000	;Seconds delay before the actual spawn?
		IgnoreCommandPointLimit	= Yes
		Disposition 		= RELATIVE_ANGLE
		DispositionAngle	= 0
		Offset			= X:-50 Y:20 Z:0
	End

	CreateObject
		ObjectNames		= AragornArmyofTheDeadSmallEgg
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 1000	;Seconds delay before the actual spawn?
		IgnoreCommandPointLimit	= Yes
		Disposition 		= RELATIVE_ANGLE
		DispositionAngle	= 0
		Offset			= X:-25 Y:10 Z:0
	End

	CreateObject
		ObjectNames		= AragornArmyofTheDeadSmallEgg
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 1000
		IgnoreCommandPointLimit	= Yes
		Disposition 		= RELATIVE_ANGLE
		DispositionAngle	= 0
		Offset			= X:25 Y:-10 Z:0
	End

	CreateObject
		ObjectNames		= AragornArmyofTheDeadSmallEgg
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 1000
		IgnoreCommandPointLimit	= Yes
		Disposition 		= RELATIVE_ANGLE
		DispositionAngle	= 0
		Offset			= X:50 Y:-20 Z:0
	End
END








ChildObject ElvenElrond DwarvenGloin

	DisplayMeleeDamage = #MULTIPLY( CREATE_A_HERO_DAMAGE 2 );;-;; Bbecause he added another nugget.
	DisplayName	= Rhakid
	SelectPortrait	= upmordor_orchorde	;	CPCAHOrcRider
	ButtonImage 	= WOR_OrcWarrior	;	hicahorcraider
	Scale		= 1.0
	CommandPoints	= 0
	KindOf		= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY
	CommandSet	= RhakidCommandSet

	EvaEventDieOwner = None

	RemoveModule Icon

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_GandalfWhite  ;
	End 
End

  AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RhakidDamage 	; Gives Rhakid more damage
		TriggeredBy	  	=	Upgrade_GandalfWhite
		AttributeModifier 	=	RhakidDamage
	End
  END

AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RhakidArmor 	; Gives Rhakid CaH ARMOR ATTRIBUTE 18 (very tough guy)
		TriggeredBy	  = Upgrade_GandalfWhite
		AttributeModifier = ArmorAttribute18
	End
END

AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RhakidPartyAttrbts	; Gives Rhakid even more armor and damage to fight the heroes
		TriggeredBy	  = Upgrade_LegolasTrainArchers 
		AttributeModifier = RhakidPartyAttributtes
	End
END

AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RhakidBoss 	; Gives Rhakid even more armor and damage to fight the heroes
		TriggeredBy	  = Upgrade_LegolasKnifeFighter 
		AttributeModifier = RhakidBossAttributtes
	End
END

AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_RhakidBoss2 	; Gives Rhakid even mooooore armor and damage to fight the heroes
		TriggeredBy	  = Upgrade_LegolasArrowWind 
		AttributeModifier = RhakidBossAttributtes2
	End
END

AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = CHSS_OR.tga		0 CHSS_OR_01.tga
		RecolorHouse		   = No
	End
End


AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy		= Upgrade_GandalfWhite
	HideSubObjects		= Firebrand 		; Firebrand
;	HideSubObjects		= Firebrand_FX01	; Firebrand's fire effect
	HideSubObjects		= Gurthang		; Thin sword
	HideSubObjects		= SWRD_03		; Machete 
	HideSubObjects		= SWRD_04		; Curved short thick blade
	HideSubObjects		= SWRD_05		; Razor Orc Blade
	HideSubObjects		= TROLLBANE		; Plain Greatsword
;	HideSubObjects		= Uruk_Sword_02		; Uruk Sword
	HideSubObjects		= Uruk_Sword_03		; Butcher's knife
	HideSubObjects		= WestronSword		; Long-hilted longsword
	HideSubObjects		= WizardSword		; Longer-hilted longsword


;	HideSubObjects		= SLDR_01		; Wing shoulder pads
	HideSubObjects		= SLDR_02		; Plain shoulder pads
	HideSubObjects		= SLDR_03		; Spikey shoulder pads
;	HideSubObjects		= SLDR_04		; Blood scavenger shoulder pads

;	HideSubObjects		= HLMT_02		; Tusks mask
;	HideSubObjects		= HLMT_03		; Viking wings
;	HideSubObjects		= HLMT_04		; Horns mask
;	HideSubObjects		= HLMT_05		; Blood scavenger Mask

	HideSubObjects		= GNLT_01		; Wing gauntlets
	HideSubObjects		= GNLT_02		; Spikey gauntlets
	HideSubObjects		= GNLT_03		; Plain gauntlets
;	HideSubObjects		= GNLT_04		; Blood scavenger gauntlets

	HideSubObjects		= SHIELD_1OG		; Wounding shield
	HideSubObjects		= SHIELD_2OG		; Spikey shield

	HideSubObjects		= SHLD_01		; Wounding shield
	HideSubObjects		= SHLD_02		; Spikey shield

	HideSubObjects		= Object02		; Barrel

	HideSubObjects		= BOOT_01		; Plain boots
;	HideSubObjects		= BOOT_02		; Wing boots
	HideSubObjects		= BOOT_03		; Spikey boots
;	HideSubObjects		= BOOT_04		; Blood scavenger boots

	FadeTimeInSeconds	= 0.0
	RecolorHouse		= No

	End
End

	Behavior = ModelConditionUpgrade ModuleTag_TurnWhite
		TriggeredBy			= Upgrade_GandalfWhite
		AddConditionFlags	= USER_2
	End

	Behavior = ModelConditionUpgrade ModuleTag_GiveEnemyIdleAnim
		TriggeredBy			= Upgrade_LegolasKnifeFighter
		AddConditionFlags	= USER_6
	End

	Behavior = ModelConditionUpgrade ModuleTag_GiveEnemyIdleAnimAgain
		TriggeredBy			= Upgrade_LegolasArrowWind
		AddConditionFlags	= USER_6
	End

;--------------- Mirror Image ---------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MirrorImageEnabler
		SpecialPowerTemplate	= SpecialAbilityMirrorImage
		TriggeredBy		= Upgrade_GandalfWhite			; Mirror Image requirement
	End

	Behavior = OCLSpecialPower ModuleTag_MirrorImage
		SpecialPowerTemplate	= SpecialAbilityMirrorImage
		OCL			= OCL_MirrorImageEggs		;OCL_MirrorImage
		CreateLocation		= CREATE_AT_EDGE_NEAR_SOURCE	; Never used before in bfme. I rock! XD
		StartsPaused		= Yes
;		SetModelCondition	= ModelConditionState:USER_1
		SetModelConditionTime	= 3.1 ;8.1
	End

	Behavior = SpecialAbilityUpdate ModuleTag_MirrorImageAnimation
		UnpackTime              = 500
		UnpackingVariation	= 1
		SpecialPowerTemplate	= SpecialAbilityMirrorImage
 		PreparationTime         = 0  
 		PersistentPrepTime      = 0
 		PackTime                = 1030
		FreezeAfterTriggerDuration = 2500 ; Hold AI for this long after we fire.
 	End

	Behavior = AISpecialPowerUpdate EscapeAI
		CommandButtonName = Command_SpawnOathbreakers
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End

;------------ Thorn Metal Armor -------------

	Behavior = FireWeaponUpdate ModuleTag_WINDY
		FireWeaponNugget
			WeaponName = ThornMetalArmorWeapon
			FireDelay = 500
			OneShot = No
		End
	End

;------------------ ESCAPE ------------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElfCloakUnpause
		SpecialPowerTemplate		= SpecialAbilityWormtongueEscape
		TriggeredBy			= Upgrade_GandalfWhite			;Escape upgrade requirement
	End

	Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
		SpecialPowerTemplate		= SpecialAbilityWormtongueEscape
		StartsPaused			= Yes
		UpdateModuleStartsAttack	= Yes
	End

	Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate   
		SpecialPowerTemplate		= SpecialAbilityWormtongueEscape
		EffectDuration			= 9000 ; 40000
		ShowPalantirTimer		= Yes
	End	
	
	Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
		InvisibilityNugget
			InvisibilityType		= STEALTH
			ForbiddenConditions		= USING_ABILITY
			BecomeStealthedFX		= FX_WormtongueEscapeOn
			ExitStealthFX			= FX_WormtongueEscapeOff
		End
		StartsActive				= No
		UpdatePeriod				= 2000
	End


;------------ Uncontrollable Rage -------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UncontrollableRageUnpause
		SpecialPowerTemplate		= SpecialAbilityUncontrollableRage 
		TriggeredBy			= Upgrade_RhakidLevel10							; ENTANGLING VINES UPGRADE REQUIREMENT (CHECK EXP LEVELS)
	End

	;;.;;	Behavior = SpecialPowerModule ModuleTag_UncontrollableRageStarter
	;;.;;		SpecialPowerTemplate		= SpecialAbilityUncontrollableRage
	;;.;;		StartsPaused			= Yes		; Starts inactive (greyed out) until the module above activates it
	;;.;;		UpdateModuleStartsAttack	= Yes 		; CHECK IF THIS IS OK > Yes
	;;.;;		AttributeModifier		= UncontrollableRageAttribute
	;;.;;		AttributeModifierAffectsSelf	= Yes
	;;.;;	End
	;;.;;	
	;;.;;	Behavior = HeroModeSpecialAbilityUpdate ModuleTag_UncontrollableRageUpdate
	;;.;;		SpecialPowerTemplate		= SpecialAbilityUncontrollableRage
	;;.;;		;HeroAttributeModifier		= UncontrollableRageAttribute
	;;.;;		HeroEffectDuration		= 28000
	;;.;;		UnpackTime              	= 1 ; insant unpack
	;;.;;		TriggerSound			= OrcGroupExtraLarge_AttackChargeMS
	;;.;;	End

	Behavior = SpecialPowerModule ModuleTag_UncontrollableRageStarter
		SpecialPowerTemplate = SpecialAbilityUncontrollableRage
		UpdateModuleStartsAttack		= Yes ;;-;;
	End
	Behavior = ActivateModuleSpecialPower ModuleTag_UncontrollableRageUpdate  ;;-;;
		SpecialPowerTemplate			= SpecialAbilityUncontrollableRage
		TriggerSpecialPower				= ModuleTag_TriggerMode3
		UnpackTime              		= 500
		PackTime                		= 500
		UnpackingVariation				= 2 ;; sets PACKING_TYPE_2
		TriggerSound					= OrcGroupExtraLarge_AttackChargeMS
	End
	Behavior = SpecialPowerModule ModuleTag_TriggerMode3 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyThree
		UpdateModuleStartsAttack		= No
		StartsPaused					= No
	End
	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_UncontrollableRageUpdate3 ;;-;;
		SpecialPowerTemplate			= SpecialAbilityActivateeDummyThree
		Duration						= 30000
		AttributeModifier				= UncontrollableRageAttribute
		WeaponSetFlags					= WEAPONSET_HERO_MODE
		StartsPaused					= No
	End

	Behavior = AISpecialPowerUpdate UncRageAI
		CommandButtonName = Command_SpecialAbilityTerribleFury
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End

;------------ Blazing Sweep -------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlazingSweepUnpause
		SpecialPowerTemplate		= SpecialAbilityBlazingSweep
		TriggeredBy			= Upgrade_RhakidLevel9
	End

	Behavior = SpecialPowerModule ModuleTag_BlastStarter                      
		SpecialPowerTemplate		= SpecialAbilityBlazingSweep
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= OrcBatteringRamVoiceAttack
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastWeaponFireUpdate
		SpecialPowerTemplate		= SpecialAbilityBlazingSweep
		WhichSpecialWeapon		= 2
		SkipContinue			= Yes

		UnpackTime			= 1000
		PreparationTime			= 1   
		PersistentPrepTime		= 1500 
		PackTime			= 1


		AwardXPForTriggering		= 0		
		StartAbilityRange		= 30.0
		MustFinishAbility		= Yes
		SpecialWeapon			= BlazingSweep
	End

	Behavior = AISpecialPowerUpdate BlazingSweepAI
		CommandButtonName = Command_SpecialAbilityLurtzCarnage
		SpecialPowerAIType = AI_SPECIAL_POWER_GANDALF_WIZARD_BLAST
		SpecialPowerRadius = 30
	End

;----------------- Boss Power, Firebombs -------------------------

Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroFireBombEnabler_Level4
	SpecialPowerTemplate	= SpecialAbilityCreateAHeroFireBomb_Level4
	TriggeredBy		= Upgrade_LegolasKnifeFighter
End

Behavior = SpecialPowerModule ModuleTag_CreateAHeroFireBombStarter_Level4
	SpecialPowerTemplate	= SpecialAbilityCreateAHeroFireBomb_Level4
	UpdateModuleStartsAttack = Yes
	StartsPaused		= Yes
End

Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroFireBombUpdate_Level4
	SpecialPowerTemplate	= SpecialAbilityCreateAHeroFireBomb_Level4
	UnpackTime		= 1500
	PackTime		= 2000 
	AwardXPForTriggering	= 0
	StartAbilityRange	= CREATE_A_HERO_FIRE_BOMB_DO_POWER_RANGE_L4
	ApproachRequiresLOS	= Yes
	SpecialWeapon		= CreateAHeroFireBomb_Level4
	WhichSpecialWeapon	= 4
End

;---------------------------------------


//================== ANIMATIONS =================================================================

	ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

		DefaultModelConditionState
			Model               = CHSS_OR_U_SKN
			Skeleton            = CHSS_GB_U_SKL
	
;			WeaponLaunchBone	= PRIMARY Bat_HandL
		End

//------------------  DYING -------------------------------------------------------------

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHSS_GB_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims

AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHSS_GB_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHSS_GB_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------


// RAIN OF ARROWS SPECIAL POWER //
AnimationState				= PACKING_TYPE_1  WEAPONSET_TOGGLE_1
	StateName				= rainofarrows
	Animation
		AnimationName		= CHSS_GB_B_ATKA2
		AnimationMode		= LOOP
	End
End

// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= CHSS_GB_U_LVLA
		AnimationMode		= ONCE
	End
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= CHSS_GB_U_SPCA
		AnimationMode		= ONCE
	End
End


//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHSS_GB_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End


;Running in RAGE
		AnimationState					= MOVING HERO
			StateName				= STATE_RunningSword
			Flags					= RANDOMSTART
			Animation
				AnimationName   		= CHSS_GB_U_RUNB		; Running wackily, Rhakid style!
//				AnimationMode   		= LOOP
				AnimationSpeedFactorRange	= 1.2 1.25
			End
		End


		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHSS_GB_U_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End

		//---------------------------------------------------


		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHSS_GB_U_ATKA1 CHSS_GB_U_ATKA CHSS_GB_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

// this hit animation attack stance

		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHSS_GB_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHSS_GB_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= CHSS_GB_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHSS_GB_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End

		//	WIZARD BLAST ANIMS MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_TWO MOUNTED
			StateName		  =	Attacking
			Animation
				AnimationName =	CHSS_GB_U_SPLD CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
		End
	

;------- BLAZING SWEEP --------------

		AnimationState			=	SPECIAL_WEAPON_TWO UNPACKING
			StateName		=	Attacking
			Animation
				AnimationName	=	CHSS_GB_U_SPCB
				AnimationMode	=	ONCE
				AnimationSpeedFactorRange	= 1.5 1.5
			End
;			ParticleSysBone = B_HANDR BlazingSweepSword1	FollowBone:Yes
			ParticleSysBone = B_HANDR BlazingSweepSword2	FollowBone:Yes
		End

		AnimationState			=	SPECIAL_WEAPON_TWO PREPARING
			StateName		=	Attacking
			Animation
				AnimationName	=	CHSS_GB_U_ATKC
				AnimationMode	=	ONCE
				AnimationSpeedFactorRange	= 1 1
			End
			ParticleSysBone = B_HANDR BlazingSweepSword1	FollowBone:Yes
			ParticleSysBone = B_HANDR BlazingSweepSword2	FollowBone:Yes
		End

		AnimationState			=	SPECIAL_WEAPON_TWO PACKING
			StateName		=	Attacking
			Animation
				AnimationName	=	CHSS_GB_U_CINA
				AnimationMode	=	ONCE
				AnimationSpeedFactorRange	= 1.2 1.2
			End
		End

;-----------------------------------

		//	ISTARI LIGHT STAFF WEAPON MOUNTED //
		AnimationState		  =	SPECIAL_WEAPON_THREE MOUNTED	// FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHSS_GB_U_SPCD CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		//	ISTARI LIGHT STAFF WEAPON ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_THREE // FIRING_OR_PREATTACK_C
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHSS_GB_U_SPCE CHSS_GB_U_ATKA//	isitari's light?
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End
		
		; Throwing and cripple strike
		AnimationState		  =	SPECIAL_WEAPON_FOUR
			StateName		  =	Attacking
			Animation
				AnimationName =	CHSS_GB_U_SPCD
				AnimationMode =	ONCE
			End
			FrameForPristineBonePositions	= 44
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHSS_GB_U_SPCE
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX
			StateName		  =	Attacking
			Animation
				AnimationName =	CHSS_GB_U_SPCF
				AnimationMode =	ONCE
			End
		End

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHSS_GB_U_SPCC CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHSS_GB_U_SPCA CHSS_GB_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHSS_GB_U_SPCB CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHSS_GB_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHSS_GB_U_SPCC CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHSS_GB_U_SPCA CHSS_GB_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHSS_GB_U_SPCB CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
//----------- Captain of Gondor - Sword --------------------------------------------
		AnimationState        = PACKING_TYPE_2 WEAPONSET_TOGGLE_1
			StateName		  =	CaptainPower
			Animation           = GUHero_CHRC
				AnimationName     = CHSS_GB_U_CHRC
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.2 1.2
			End
		End

//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHSS_GB_U_SPCE CHSS_GB_U_SPCA CHSS_GB_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHSS_GB_U_SPCC CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHSS_GB_U_SPCA CHSS_GB_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHSS_GB_U_SPCB CHSS_GB_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHSS_GB_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHSS_GB_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHSS_GB_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHSS_GB_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End

		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHSS_GB_U_SPCB
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHSS_GB_U_SPCD
				AnimationMode =	ONCE
			End
		End




//====== LEVELED

		AnimationState				= LEVELED 						// This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= CHSS_GB_U_CHRA CHSS_GB_U_LVLA
				AnimationMode		= ONCE
			End
		End

//---------------------- EMOTIONS ---------------------------------------------------------------


		// cheer, on foot
		AnimationState				=	EMOTION_CELEBRATING
			Animation CHRA
				AnimationName		=	CHSS_GB_U_CHRA CHSS_GB_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHSS_GB_U_CHRB CHSS_GB_U_CHRA CHSS_GB_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation CHRA
				AnimationName		=	CHSS_GB_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHSS_GB_U_TNTB CHSS_GB_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End


//====== ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHSS_GB_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
;Iddle

		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHSS_GB_U_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
			Animation = Foot_IDLC // Bored Fidget
				AnimationName       = CHSS_GB_U_IBFA
				AnimationMode       = ONCE
				AnimationPriority   = 2
			End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		

	//---transitions--------------------------------------------

		TransitionState = TRANS_BoredToSelectedSword
		// Once we have proper animations for enter -> idle -> exit, fix this properly.
			Animation = ANTD
				AnimationName	= CHSS_GB_U_ATNA CHSS_GB_U_ATND CHSS_GB_U_IDLA
				AnimationMode	= ONCE
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= CHSS_GB_U_ATNC CHSS_GB_U_ATNF CHSS_GB_U_ATNE
				AnimationMode	= ONCE
			End		
		End	

END ; Draw Module
END ; Module Replace

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Voice
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
			VoiceAttack 					= HeroOrcVoiceAttack
			VoiceAttackAir					= HeroOrcVoiceAttack
			VoiceAttackCharge 				= HeroOrcVoiceAttack
			VoiceAttackMachine 				= HeroOrcVoiceAttack
			VoiceAttackStructure 				= HeroOrcVoiceAttack
			VoiceCreated					= HeroOrcVoiceSalute
			VoiceFear					= HeroOrcVoiceHelpMe
			VoiceFullyCreated				= HeroOrcVoiceSalute
			VoiceGuard					= HeroOrcVoiceMove
			VoiceMove 					= HeroOrcVoiceMove
			VoiceMoveToCamp 				= HeroOrcVoiceMove
			VoiceMoveWhileAttacking 			= HeroOrcVoiceMove
			VoicePriority					= 95
			VoiceRetreatToCastle 				= HeroOrcVoiceMove
			VoiceSelect 					= HeroOrcVoiceSelectMS
			VoiceSelectBattle  				= HeroOrcVoiceSelectBattle
		
			SoundImpact					= ImpactHorse
		
			UnitSpecificSounds
				VoiceEnterUnitElvenTransportShip	= HeroOrcVoiceMove
				VoiceEnterUnitMordorMumakil		= HeroOrcVoiceMove
				VoiceEnterUnitSlaughterHouse		= HeroOrcVoiceMove
				VoiceEnterUnitTransportShip		= HeroOrcVoiceMove
				VoiceGarrison				= HeroOrcVoiceMove
				VoiceInitiateCaptureBuilding		= HeroOrcVoiceCaptureBuilding
			End
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

	Side = Mordor


	WeaponSet
		Conditions		= None
		Weapon			= PRIMARY	CreateAHeroBasicMeleeWeapon
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	WeaponSet
		Conditions		= WEAPONSET_HERO_MODE
		Weapon			= PRIMARY	UncontrollableRageWeapon
	End

	ArmorSet
		Conditions		= None
		Armor			= CAHArmorServantOfSauron
		DamageFX		= NormalDamageFX
	End

	LocomotorSet
		Locomotor = HeroHumanScalingLocomotor
		Condition = SET_NORMAL_UPGRADED
		Speed     = 50
	End

  AddModule
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End
  END

  ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 				= EMOTION_CHEER_RADIUS
		MaxHealth         			= 4100
		PermanentlyKilledByFilter		= NONE	
   		DodgePercent      			= 40%	
	End
  End

  ReplaceModule ModuleTag_GloinHealing
	Behavior = AutoHealBehavior ModuleTag_LegendsFaramirHealing
		StartsActive		  =	Yes
		HealingAmount		  =	100 ;30
		HealingDelay		  =	500
		StartHealingDelay	  =	HERO_HEAL_DELAY
		HealOnlyIfNotInCombat	  =	Yes
	End
  END

ReplaceModule HitReactionBehaviorModuleTag
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTagNew
		HitReactionLifeTimer1 = 10200 ; level 1 (light  damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer2 = 15 ; level 2 (medium damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer3 = 10 ; level 3 (heavy  damage)  hit reaction animations in frames (5 per sec)

		HitReactionThreshold1 = 2000.0   ; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 2500.0  ; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 5000.0  ; level 3 (heavy  damage) threshold trigger
	End
END

RemoveModule ModuleTag_LGAU

	Geometry		= CYLINDER
	GeometryMajorRadius	= 8.0
	GeometryMinorRadius	= 8.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	PathfindDiameter = 20.0

End










;--------------------- END RHAKID ------------------------
;---------------------------------------------------------


























;--------------------------------------------------------
;CUSTOM HERO 4 - RASELAS, THE SHADOWMAGE
;--------------------------------------------------------

Armor RaselasArmor
	Armor = DEFAULT		5%
	Armor = FLAME		9%
	Armor = MAGIC		14%
	Armor = HERO		5%
	Armor = HERO_RANGED	6%
End



;-------------------

FXParticleSystem AcidFogParticle
  System
    Shader			= ALPHA
    SortLevel			= 1
    Priority = ALWAYS_RENDER
    ParticleName		= EXSnowCloud.tga
    Lifetime			= 180 200
    SystemLifetime		= 350 350
    Size			= 15 20
    BurstDelay			= 12 15
    BurstCount			= 3 6
    IsGroundAligned		= Yes
    IsEmitAboveGroundOnly	= Yes
  End
  Color = DefaultColor
    Color1		= R:0 	G:0	B:0	1
    Color2		= R:0	G:240	B:0	30
    Color3		= R:0	G:0	B:0	200
  End
  Alpha = DefaultAlpha
    Alpha1		= 0 	0	0
    Alpha2		= 0.5	0.5	10
    Alpha3		= 0.6	0.6	170
    Alpha4		= 0	0	200
  End
  Update = DefaultUpdate
    SizeRate		= 0.4 0.6
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -0.02 0.02
    AngularDamping	= 0.3 0.3
    AngularDampingXY	= 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    DriftVelocity	= X:0.03 Y:0.02 Z:0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.12 0.12
    Y = -0.12 0.12
    Z = 0 0.15
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 75
    Length = 10
;    Offset = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
  Wind = DefaultWind
    WindMotion = PingPong
    WindStrength = 0.4
    WindAngleChangeMin = 0.149924
    WindAngleChangeMax = 0.449946
    WindPingPongStartAngleMax = 0.785398
    WindPingPongEndAngleMin = 5.49779
    WindPingPongEndAngleMax = 6.28319
  End
End


Weapon AcidFogWeapon
	RadiusDamageAffects	= ENEMIES NEUTRALS ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;

  	DelayBetweenShots	= 500			; time between each damage dealing
	ClipSize		= 0			;4	; how many shots in a Clip (0 == infinite)
  
	DamageNugget
		Damage		= 85	;75 was too litle
		Radius		= 75.0
		DelayTime	= 0
		DamageType	= UNRESISTABLE
;		DamageFXType	= MAGIC ;(magic used so we can temporarily "see" the damage to check range, and balance)
		DeathType	= NORMAL
		DamageScalar	= 0% NONE +STRUCTURE
		CylinderAOE	= Yes
	End
End


Object RaselasAcidCloud

AddModule
  Draw = W3DScriptedModelDraw ModuleTag_Draw
    DefaultModelConditionState
      Model = None
      ParticleSysBone = None AcidFogParticle
    End
  End
END

AddModule
	Body = ActiveBody ModuleTag_TheActiveBody
		MaxHealth = 99999.0
	End
END

  EditorSorting = SYSTEM

	KindOf = IMMOBILE UNATTACKABLE

AddModule
	Behavior = LifetimeUpdate ModuleTag_Lifetime
		MinLifetime = 11000
		MaxLifetime = 11000
	End
End

AddModule
	Behavior = FireWeaponUpdate ModuleTag_WINDY
		FireWeaponNugget
			WeaponName = AcidFogWeapon
			FireDelay = 500
			OneShot = No
		End
	End
END

END


FXParticleSystem BurstAcidCloud
  System

    Shader		= ALPHA
    Priority		= ALWAYS_RENDER
    ParticleName	= exsmokering.tga
    Lifetime		= 40 45
    SystemLifetime	= 5
    Size		= 5 8
    BurstDelay		= 15 15
    BurstCount		= 3 5
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:0   G:20 B:20  0
    Color2		= R:5  G:120 B:5 30
    Color3		= R:0    G:0  B:0   50
  End
  Alpha			= DefaultAlpha
    Alpha1		= 0   0   0
    Alpha2		= 0.7 0.7 5
    Alpha3		= 0   0   50
  End
  Update		= DefaultUpdate
    SizeRate		= 3 6
    SizeRateDamping	= 0.98 0.99
    AngleZ		= 0 180
    AngularRateZ	= -0.5 0.5
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0 ; No acceleration
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.02 0.02
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END


FXList FX_AcidCloud
  ParticleSystem
    Name = BurstAcidCloud
    Offset = X:0.0 Y:0.0 Z:11
  End
  ParticleSystem
    Name = BurstAcidCloud
    Offset = X:0.0 Y:0.0 Z:3
  End
  CameraShakerVolume
    Radius = 500
    Duration_Seconds = 8
    Amplitude_Degrees = 0.02
  End
  Sound
    Name = SpellBarrageStartMS
  END
End



ObjectCreationList OCL_LegendsSummonAcidCloud
	CreateObject
		ObjectNames = RaselasAcidCloud
		Count = 1
		FadeIn = Yes
		FadeTime = 1500
		Disposition = LIKE_EXISTING
	End
End

Weapon AcidCloudWeapon
	AttackRange		= 80
	WeaponSpeed		= 801
	HitPercentage		= 100
	DelayBetweenShots	= 2000
	PreAttackDelay		= 1500
	PreAttackType		= PER_SHOT
	FiringDuration		= 1100

	FireFX			= FX_AcidCloud

	RadiusDamageAffects = ENEMIES NEUTRALS ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;

	WeaponOCLNugget
		WeaponOCLName = OCL_LegendsSummonAcidCloud
	End
End

;-------------------



FXParticleSystem FiremagicMissileParticleFlare
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exminerlight.tga
    Lifetime		= 18 18
    SystemLifetime	= 3
    Size		= 3 3
    BurstCount		= 1 2
  End
  Color = DefaultColor
    Color1		= R:40 G:10 B:10 0
    Color2		= R:220 G:200 B:200 5
    Color3		= R:220 G:0 B:0 15
  End
  Update = DefaultUpdate
    SizeRate		= 2.5 3.8
    SizeRateDamping	= 0.98 0.99
    AngleZ		= 0 7
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Y = 0 0
    Z = 0 0
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXParticleSystem FiremagicMissileParticleBurst
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exgandalfstaffflare2.tga
    Lifetime		= 24 30
    SystemLifetime	= 3
    Size		= 0.4 1.4
    BurstCount		= 8 10
;    IsGroundAligned	= Yes
  End
  Color = DefaultColor
    Color1		= R:40 G:5 B:5 0
    Color2		= R:220 G:150 B:150 5
    Color3		= R:220 G:0 B:0 15
    Color3		= R:20 G:0 B:0 30
  End
  Update = DefaultUpdate
    SizeRate		= 0.7 1.5
    SizeRateDamping	= 0.92 0.96
    AngleZ		= 0 0
    AngularRateZ	= 0 0
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping	= 0.94 1
    Gravity		= 0 0
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0.1 4
    Y = -1.7 1.7
    Z = -0.5 0.50
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End

FXList FX_RaselasFireMagicMissile
  Sound
    Name = CaH_TeleportPart1 ; EagleDieExplosion
  End
  ParticleSystem
    Name = FiremagicMissileParticleFlare
    Offset = X:27.0 Y:0.0 Z:19.0
  End
  ParticleSystem
    Name = FiremagicMissileParticleBurst
    Offset = X:27.0 Y:0.0 Z:19.0
    OrientToObject = Yes
  End
  CameraShakerVolume
    Radius = 300
    Duration_Seconds = 1
    Amplitude_Degrees = 0.2
  End
End


FXParticleSystem RaselasMagicMissileParticle
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXspearhead.tga
    Lifetime = 28 28
    SortLevel = 1
    Size = 5 5
    BurstCount = 4 4
;    InitialDelay	= 10 10
    IsGroundAligned = Yes
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color1 = R:250 G:60 B:70 0
    Color2 = R:0 G:0 B:0 15
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.25 0.25 0
    Alpha2 = 0 0 28
  End
  Update = DefaultUpdate
    SizeRate = -0.17 -0.17
    SizeRateDamping = 1 1
    AngleZ = 0 2
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:-5 Y:0 Z:0
    EndPoint = X:-5 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem RaselasMagicMissileTail
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= excoldcloud.tga
    Lifetime		= 35 35
    Size		= 8 8
    BurstDelay		= 8 12
    BurstCount		= 3 4
    IsParticleUpTowardsEmitter = Yes
;    InitialDelay	= 10 10
    SortLevel		= 1
  End
  Color			= DefaultColor
    Color1		= R:255 G:255 B:255 0
    Color2		= R:255 G:255 B:255 35
  End
;  Alpha			= DefaultAlpha
;    Alpha1		= 1 1 0
;    Alpha2		= 1 1 4
;    Alpha2		= 0 0 5
;  End
  Update		= DefaultUpdate
    SizeRate		= 1 1.5
    AngleZ		= 0 180
    AngularRateZ	= -0.8 0.5
    SizeRateDamping	= 1 1
    AngularDamping	= 0.98 0.99
    AngularDampingXY	= 1 1
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
  End
  EmissionVelocity	= OrthoEmissionVelocity
  End
  EmissionVolume	= PointEmissionVolume
  End
  Draw = RenderObjectDraw
  End
End


FXParticleSystem FiremagicMissileHitParticle
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exminerlight.tga
    Lifetime		= 18 18
    SystemLifetime	= 2
    Size		= 20 28
    BurstCount		= 1 2
  End
  Color = DefaultColor
    Color1		= R:40 G:10 B:10 0
    Color2		= R:220 G:50 B:50 5
    Color3		= R:220 G:30 B:30 14
    Color3		= R:2 G:0 B:0 18
  End
  Update = DefaultUpdate
    SizeRate		= 0.6 -0.4
    SizeRateDamping	= 0.99 1
    AngleZ		= 0 7
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics = DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0.15 0.15
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Y = 0 0
    Z = 0 0
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  END
End


FXList FX_RaselasMagicMissileHit
  Sound
    Name = Gui_PalantirChoosePowerClick ; EagleDieExplosion 
  End
  ParticleSystem
    Name = FiremagicMissileHitParticle
    Offset = X:0.0 Y:0.0 Z:8.0
  End
  CameraShakerVolume
    Radius = 300
    Duration_Seconds = 0.2
    Amplitude_Degrees = 0.3
  End
End


Weapon RaselasMagicMissileWarhead
	ProjectileCollidesWith	= STRUCTURES WALLS  
	RadiusDamageAffects	= ENEMIES NEUTRALS NOT_SIMILAR
	ClearNuggets ;;.;;
	FireFX			= FX_RaselasMagicMissileHit
  DamageNugget
    Damage			= 350 ;550
    Radius			= 8
    DelayTime			= 0
    DamageType			= MAGIC
    DamageFXType		= MAGIC
    DeathType			= NORMAL
    AcceptDamageAdd		= No
  End
  MetaImpactNugget
    ShockWaveAmount   		= 80.0
    ShockWaveRadius   		= 8.0
    ShockWaveTaperOff 		= 0.7
    ShockWaveZMult    		= 1
  End
End


Object HaldirGoldenArrowProjectile

ReplaceModule ModuleTag_Draw
	Draw = W3DScriptedModelDraw ModuleTag_DrawNew
		DefaultModelConditionState     
			Model = NONE ; RULegolas_AROW
			ParticleSysBone = None RaselasMagicMissileParticle FOLLOWBONE:YES
			ParticleSysBone = None RaselasMagicMissileTail FOLLOWBONE:YES
;			ParticleSysBone = None ThranDeadeyeArrow FOLLOWBONE:YES
		End
	End
END

ReplaceModule ModuleTag_Draw2
	Draw = W3DStreakDraw ModuleTag_Draw2New
	    Length		= 18
	    Width		= 18
	    NumSegments		= 6				; number of segements in the streak, increase for smoother line
	    Color		= R:250 G:90 B:90
	    Texture		= exhpcoresun.tga ; EXLightStreaks2.tga
	End
END

;	Body = ActiveBody ModuleTag_02
;		MaxHealth       = 10.0
;	End

ReplaceModule ModuleTag_04
	Behavior = BezierProjectileBehavior ModuleTag_04New
		DetonateCallsKill	= Yes
		FirstHeight		= 19
		SecondHeight		= 19
		FirstPercentIndent	= 15% ; Percentage of shot distance control points are placed
		SecondPercentIndent	= 90%
		FlightPathAdjustDistPerSecond = 40 ; Can allow a max speed this can attempt to follow a target. Units are their velocity we can tag. (45 is default human speed)
		;GroundHitFX		= FX_HawkStrikeHit
		CurveFlattenMinDist	= 500.0
	End
END

RemoveModule ModuleTag_06 ;Create arrow bits
RemoveModule ModuleTag_07
;;.;; RemoveModule ModuleTag_GoldenArrow ; Spawn light rays

;ReplaceModule ModuleTag_07
;	Behavior = FXListDie ModuleTag_07New
;		DeathTypes = ALL -CRUSHED -SPLATTED
;		DeathFX = FX_RaselasMagicMissileHit			; TO DO
;	End
;END

AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_RaselasMagicMissileWarHead
    StartsActive = Yes
    DeathWeapon = RaselasMagicMissileWarhead
  End
END

End



Weapon HaldirGoldenArrow; LegolasBowArrowStorm	;The LegolasBowArrowStormProjectile is used by CAH!
	AttackRange		= 320
	WeaponSpeed		= 110         ; dist/sec 
	MinWeaponSpeed		= 60
	MaxWeaponSpeed		= 130

	ScatterRadius		= 0.0
	DelayBetweenShots	= 20
	PreAttackDelay		= 200
	PreAttackType		= PER_SHOT
	FiringDuration		= 300

	FireFX			= FX_RaselasFireMagicMissile
	HitPercentage		= 100

;	ProjectileNugget
;		ProjectileTemplateName	= HaldirGoldenArrowProjectile
;		WarheadTemplateName	= HaldirGoldenArrowWarhead
;	End

;;  ProjectileNugget
;;    ProjectileTemplateName = LegolasBowArrowStormProjectile
;;    WarheadTemplateName = LegolasBowArrowStormWarhead
;;  End

End


;-------------------


FXParticleSystem InvulnerabilityScreenParticles
  System
    Priority = ALWAYS_RENDER
    ParticleName = exhpring_narrow.tga	;ExDebuff.tga		; exbarb.tga ;execlipseblur.tga ;exhpring_narrow.tga
    Lifetime = 60 60
    SystemLifetime = 1050		; 35 seconds (1 = 30)
    SortLevel = 1
    Size = 13 13
    BurstDelay = 2 2.1
    BurstCount = 1 1
    IsGroundAligned = Yes
    IsEmitAboveGroundOnly = No
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:0 0
    Color2 = R:0 G:150 B:255 4
    Color3 = R:0 G:50 B:255 17
    Color4 = R:0 G:0 B:0 59
  End
;  Alpha = DefaultAlpha
;    Alpha1 = 0.8 0.8 1
;    Alpha2 = 0 0 50
;  End
  Update = DefaultUpdate
    SizeRate = 3 3
    SizeRateDamping = 0.84 0.84
    AngleZ = 1 1
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.99 0.99
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 0.75 0.75
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:-0
    EndPoint = X:0 Y:0 Z:-0
  End
  Draw = DefaultDraw
  End
End


FXList FX_RaselasInvulnerabilityScreen
;  Sound
;    Name		= SpellEnshroudingMist
;  End
  ParticleSystem
    Name		= InvulnerabilityScreenParticles
;    Offset		= X:0.0 Y:0.0 Z:-60.0
    AttachToObject	= Yes
  End
End



FXParticleSystem InvulnerabilityScreenStartParticles	; Initial burst
  System
    Priority = ALWAYS_RENDER
    ParticleName = exhpring_narrow.tga	;ExDebuff.tga		; execlipseblur.tga
    Lifetime = 20 20
    SystemLifetime = 15
    SortLevel = 1
    Size = 16 16
    BurstDelay = 2 2
    BurstCount = 4 4
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:0 G:201 B:255 0
    Color2 = R:0 G:101 B:255 10
  End
;  Alpha = DefaultAlpha
;    Alpha1 = 0.8 0.8 1
;    Alpha2 = 0 0 50
;  End
  Update = DefaultUpdate
    SizeRate = 3 3
    SizeRateDamping = 0.9 0.9
    AngleZ = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = -1 0.8
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End

FXList FX_RaselasInvulnerabiliyScreenStart
  Sound
    Name		= SpellEnshroudingMist
  End
;  ParticleSystem
;    Name		= InvulnerabilityScreenStartParticles
;    AttachToObject	= Yes
;  End
End


ModifierList RaselasInvulnerabilityScreen
	Category  = SPELL
	Modifier  = SPEED 0%
	Modifier  = INVULNERABLE CREATE_A_HERO_INVULNERABILITY_MODIFIER	
	Duration  = 35000					// Matches RefreshRate of giving module
	FX	  = FX_RaselasInvulnerabilityScreen
End

ModifierList RaselasInvulnerabilityScreen2	; So he plays an animation
	Category  = SPELL
	Duration  = 4500
	ModelCondition = USER_4
End

;-----------------------

FXParticleSystem RiseHellKnightsDust
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXsmokeplume.tga
    Lifetime = 125 125
    SystemLifetime = 8
    Size = 10 25
    BurstCount = 8 12
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:123 G:111 B:87 1
    Color2 = R:56 G:56 B:56 0
  End
  Alpha = DefaultAlpha
    Alpha1 = 0.1 0.3 1
    Alpha2 = 0 0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 3
    SizeRateDamping = 0.85 0.95
    AngleZ = 0 7
    AngularRateZ = -0.03 0.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.95 0.96
    DriftVelocity = X:0 Y:0 Z:0.05
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 3 5
    OtherSpeed = 0 1
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RiseHellKnightsBurst
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXblast3.tga
    Lifetime = 45 45
    SystemLifetime = 95
    SortLevel = 1
    Size = 8 8
    BurstDelay = 2 4
    BurstCount = 1 1
    IsGroundAligned = Yes
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:50 G:0 B:155 1
    Color2 = R:190 G:0 B:0 35
    Color3 = R:0 G:0 B:0 45
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = 2 4
    SizeRateDamping = 0.95 1
    AngleZ = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 0.1 0.5
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RiseHellKnightsBurst2
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXmultidot.tga ; EXEmbersLight.tga
    Lifetime = 45 45
    SystemLifetime = 85
    SortLevel = 1
    Size = 70 120
    BurstDelay = 3 5
    BurstCount = 1 1
    IsGroundAligned = Yes
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:80 G:0 B:155 1
    Color2 = R:10 G:0 B:155 35
    Color3 = R:0 G:0 B:0 45
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = -1 -6
    SizeRateDamping = 0.98 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 0.1 1
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RiseHellKnightsColumn
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXcross02.tga
    Lifetime = 45 45
    SystemLifetime = 125
    SortLevel = 1
    Size = 40 40
    BurstDelay = 1 1
    BurstCount = 2 2
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:40 G:0 B:200 1
    Color2 = R:190 G:0 B:0 35
    Color3 = R:0 G:0 B:0 45
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 0.985 0.985
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 1 13
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 7
  End
  Draw = DefaultDraw
  End
End

FXList FX_RiseHellKnights
  Sound
    Name		= SpellDarkness ;SpellRainOfFireMS
  End
  ParticleSystem
    Name		= RiseHellKnightsDust
;    AttachToObject	= Yes
  End
  ParticleSystem
    Name		= RiseHellKnightsBurst
;    AttachToObject	= Yes
  End
;  ParticleSystem
;    Name		= RiseHellKnightsBurst2
;;    AttachToObject	= Yes
;  End
  ParticleSystem
    Name		= RiseHellKnightsColumn
;    AttachToObject	= Yes
  End
End

FXParticleSystem PreRiseHellKnightsShafts
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXcross02.tga
    Lifetime = 65 65
    SystemLifetime = 25
    SortLevel = 1
    Size = 55 65
    BurstDelay = 8 10
    BurstCount = 3 4
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:100 G:0 B:200 1
    Color2 = R:190 G:0 B:0 45
    Color3 = R:0 G:0 B:0 65
  End
  Update = DefaultUpdate
    SizeRate = 1 5
    SizeRateDamping = 0.985 0.985
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0.2 0.2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 160
    Offset = X:0 Y:0 Z:15
  End
  Draw = DefaultDraw
  End
End

FXList FX_PreRiseHellKnights				; Not used, currently using particlesysbone in draw module instead 
  Sound
    Name		= SpellDarkness
  End
  ParticleSystem
    Name		= RiseHellKnightsBurst2
  End
  ParticleSystem
    Name		= PreRiseHellKnightsShafts
  End
End

Object CINE_FreeDwarfPrisoner
END

Weapon RiseHellKnightsWeapon
	IdleAfterFiringDelay	= 0
	AttackRange		= 800
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 90
	MinWeaponSpeed		= 80
	MaxWeaponSpeed		= 100
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ENEMIES NEUTRALS ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots	= 9000
	PreAttackDelay		= 100
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_PreRiseHellKnights
	FireFX			= FX_RiseHellKnights
	FiringDuration		= 1400
	DamageNugget
		Damage		= 100
		Radius		= 30.0
		DamageType	= MAGIC
		DamageFXType	= SWORD_SLASH
		DeathType	= EXPLODED
		DamageSpeed	= 700.0 ; must match the ShockWaveSpeed below
	End
	DamageNugget                        ; This raises nearby deathknights -- DOESN'T SEEM TO WORK :S (So now I'm falling back on scripting)
		Damage		= 20
		Radius		= 900.0
		DamageType	= HERO
		DamageFXType	= MAGIC
		DeathType	= NORMAL
		DamageSpeed	= 700.0
		DamageScalar	= 500000000% NONE +CINE_FreeDwarfPrisoner ; This damages only dead HellKnights, and revives them (kills them and spawns ocl)
	End
	MetaImpactNugget
;		HeroResist			= .75
		ShockWaveAmount   = 120.0
		ShockWaveRadius   = 30.0
		ShockWaveTaperOff = 0.1
		ShockWaveZMult    = 0.100
		ShockWaveSpeed	  = 700.0 
	End
End


;-----------------------

FXParticleSystem RaselasDefeatedInitialWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXRing01.tga
    Lifetime = 25 25
    SystemLifetime = 45
    SortLevel = 1
    Size = 400 400
    StartSizeRate = 1 1
    BurstDelay = 2 2
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:99 G:99 B:99 10
    Color3 = R:0 G:0 B:0 22
    ColorScale = -20 20
  End
  Update = DefaultUpdate
    SizeRate = -10 -10
    SizeRateDamping = 1.05 1.05
    AngleZ = -180 180
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -4 -4
    OtherSpeed = -4 -4
  End
  EmissionVolume = LineEmissionVolume
    IsHollow = Yes
    StartPoint = X:0 Y:0 Z:-8
    EndPoint = X:0 Y:0 Z:10
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RaselasDefeatedInitialCenter
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar1.tga
    Lifetime = 40 40
    SystemLifetime = 20
    SortLevel = 1
    Size = 5 5
    BurstDelay = 5 5
    BurstCount = 1 1
    InitialDelay = 20 20
  End
  Color = DefaultColor
    Color2 = R:200 G:200 B:200 20
    Color3 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 1.03 1.03
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.75 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:8
    EndPoint = X:0 Y:0 Z:8
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RaselasDefeatedInitialVortex
  System
    Priority = HIGH_OR_ABOVE
    ParticleName = EXLnzFlar2.tga
    Lifetime = 40 40
    SystemLifetime = 100
    SortLevel = 1
    Size = 5 5
    BurstDelay = 1 1
    BurstCount = 20 25
    IsParticleUpTowardsEmitter = Yes
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:0 1
    Color2 = R:200 G:200 B:200 5
    Color3 = R:0 G:0 B:0 40
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1.05 1.05
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = -1.2 -1.8
  End
  EmissionVolume = CylinderEmissionVolume
    IsHollow = Yes
    Radius = 240
    Length = 16
  End
  Draw = DefaultDraw
  End
End

FXList FX_PreRaselasDefeated
  ParticleSystem
    Name = RaselasDefeatedInitialWave
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = RaselasDefeatedInitialCenter
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = RaselasDefeatedInitialVortex
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = GandalfBlastRipple
    Offset = X:0.0 Y:0.0 Z:0.0
  End
End






FXParticleSystem RaselasDefeatedBlastFinalLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXexplo01.tga
    Lifetime = 35 35
    SystemLifetime = 15
    SortLevel = 1
    Size = 10 10
    BurstCount = 2 2
  End
  Color = DefaultColor
    Color1 = R:180 G:180 B:180 0
    Color2 = R:0 G:0 B:0 35
  End
  Update = DefaultUpdate
    SizeRate = 38 63
    SizeRateDamping = 0.92 0.89
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RaselasDefeatedBlastFinalShockWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXRing01.tga
    Lifetime = 300 300
    SystemLifetime = 15
    SortLevel = 1
    Size = 1 1
    BurstCount = 1 2
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:255 G:255 B:255 0
    Color2 = R:0 G:0 B:0 300
    ColorScale = -40 40

  End
  Update = DefaultUpdate
    SizeRate = 0.4 8
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem RaselasDefeatedColumn
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXcross02.tga
    Lifetime = 130 130
    SystemLifetime = 300
    SortLevel = 1
    Size = 40 40
    BurstDelay = 1 1
    BurstCount = 2 2
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:0 0
    Color2 = R:200 G:200 B:200 2
    Color3 = R:0 G:0 B:0 128
    ColorScale = -75 75
  End
  Update = DefaultUpdate
    SizeRate = 0.7 0.7
    SizeRateDamping = 0.993 0.993
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.96 0.96
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 0.3 4.2
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 22
  End
  Draw = DefaultDraw
  End
End



FXList FX_RaselasDefeated
  ParticleSystem
    Name = RaselasDefeatedBlastFinalLight
    Offset = X:0.0 Y:0.0 Z:60   ;Z:8.0
  End
  ParticleSystem
    Name = RaselasDefeatedBlastFinalShockWave
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = GandalfBlastDust
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  ParticleSystem
    Name = RaselasDefeatedColumn		; (Copy RiseHellKnightsColumn, but in white color)
  End
  Sound
    Name = GandalfBlastWeapon
  End
End



Weapon RaselasDefeatedWeapon
	IdleAfterFiringDelay	= 0
	AttackRange		= 900
	MinimumAttackRange	= 0.8
	WeaponSpeed		= 85
	MinWeaponSpeed		= 60
	MaxWeaponSpeed		= 91
	ScaleWeaponSpeed	= Yes
	RadiusDamageAffects	= ALLIES NEUTRALS ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots	= 9000
	PreAttackDelay		= 100
	PreAttackType		= PER_ATTACK
	PreAttackFX		= FX_PreRaselasDefeated
	FireFX			= FX_RaselasDefeated
	FiringDuration		= 1400
	DamageNugget
		Damage		= 500000	; KILL EVERYTHING (except heroes, which are invulnerable by scripts)
		Radius		= 900.0
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 120.0
	End
	MetaImpactNugget
		ShockWaveAmount   = 200.0
		ShockWaveRadius   = 900.0
		ShockWaveTaperOff = 0.05
		ShockWaveZMult    = 0.1
		ShockWaveSpeed	  = 120.0
		DelayTime     = 0
	End
End

;-------------------------------------------------------

SpecialPower SpecialAbilityActivateeDummy
	Enum              	= SPECIAL_GENERAL_TARGETLESS_THREE
	ReloadTime        	= 1000
End

SpecialPower SpecialAbilityActivateeDummy2
	Enum              	= SPECIAL_PART_THE_HEAVENS
	ReloadTime        	= 1000
End

SpecialPower SpecialAbilityLegendsInvulnerabilityScreen			; Invulnerability Screen
	Enum              	= SPECIAL_GENERAL_TARGETLESS_TWO
	ReloadTime        	= 5000 ; 180000
	RadiusCursorRadius	= 120.0
End

SpecialPower SpecialAbilityLegendsLightningStorm			; Lightning Storm
	Enum              	= SPECIAL_SPELL_BOOK_BOMBARD
	ReloadTime        	= 5000 ; 180000
	RadiusCursorRadius	= 200.0
End

SpecialPower SpecialAbilityLegendsTimeStop				; Time Stop
	Enum			= SPECIAL_GENERAL_TARGETLESS
	ReloadTime		= 5000 ; 180000
	;UnitSpecificSoundToUseAsEnterStateInitiateIntendToDoVoice = VoiceSpecialAbilityCurseEnemy		;plays but on targetting
End

SpecialPower SpecialAbilityLegendsBlastWave				; Blastwave
	Enum			= SPECIAL_WORD_OF_POWER
	ReloadTime		= 5000 ; 40000
End

SpecialPower SpecialPowerLegendsGreaterSummon
	Enum			= SPECIAL_SPELL_BOOK_HOBBIT_ALLIES
	ReloadTime		= 5000 ; 180000
END

SpecialPower SpecialPowerMagicMissile					; Magic Missile
	Enum			= SPECIAL_ARROW_STORM
	ReloadTime		= 5000
	RadiusCursorRadius	= 250.0		;Changing this??? Don't, unless you are changing ArrowStormUpdate's TargetRadius. They need to match.
	ViewObjectDuration	= 5000
	ViewObjectRange		= 300
	Flags			= WATER_OK
	;InitiateAtLocationSound = GenericSpell
END

SpecialPower RaselasBallLightning
	Enum				= SPECIAL_WOUND_ARROW
	ReloadTime			= 5000
	PublicTimer			= No
	RadiusCursorRadius		= 20
	ObjectFilter			= ALL	-BASE_FOUNDATION -INERT	-IGNORED_IN_GUI	-WALK_ON_TOP_OF_WALL -BLOCKING_GATE	-WALL_UPGRADE -UNATTACKABLE	-MOVE_ONLY
	InitiateAtLocationSound		= CaH_BallLightning
End

SpecialPower SpecialAbilityAcidFog					; Acid Fog
	Enum			= SPECIAL_SCREECH
	ReloadTime		= 5000
;	RadiusCursorRadius	= 75.0
;	Flags			= NO_FORBIDDEN_OBJECTS LIMIT_DISTANCE
;	ForbiddenObjectFilter	= NO_SUMMON_NEAR_OBJECT_FILTER
;	ForbiddenObjectRange	= 100
;	MaxCastRange		= 350
;	InitiateAtLocationSound	= DainSummonRoyalGuardMS 
End

SpecialPower SpecialAbilityRaselasTeleport				; Teleport (Blink)
	Enum			= SPECIAL_BALROG_WINGS
	ReloadTime		= 30000
	PublicTimer		= No
	
	Flags			= WATER_OK
;	ForbiddenObjectFilter	= NONE +STRUCTURE
;	ForbiddenObjectRange	= 10
	InitiateAtLocationSound = CaH_Invulnerability
End

SpecialPower SpecialAbilityRiseHellKnights				; Rise Fallen Hellknights
	Enum			= SPECIAL_SCREECH
	ReloadTime		= 5000
End

SpecialPower SpecialAbilityRaselasDefeated				; Raselas Defeated animation and FX
	Enum			= SPECIAL_SHIELD_BUBBLE
	ReloadTime		= 5000
End


CommandButton Command_IsengardWizardsTowerLightningStrike	; Lightning Storm
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityLegendsLightningStorm
	Options			= NEED_TARGET_POS ;HIDE_WHILE_DISABLED
	TextLabel		= CONTROLBAR:LegendsRaselasLightningStorm
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasLightningStorm
	ButtonImage             = HSSarumanThunderbolt
	RadiusCursorType        = ThunderBoltRadiusCursor
	ButtonBorderType        = ACTION 
	CursorName		= AttackObj
	InvalidCursorName       = GenericInvalid  
	AutoAbility		= Yes
	InPalantir		= Yes
	Radial			= No
End

CommandButton Command_HourOfTheWitchKing			; Timestop
	Command                 = SPECIAL_POWER
	SpecialPower            = SpecialAbilityLegendsTimeStop
	Options                 = NONE
	TextLabel               = CONTROLBAR:LegendsRaselasTimestop
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasTimestop
	ButtonImage             = HSWitchKingHour
	ButtonBorderType        = ACTION
	PresetRange		= 40.0
	InPalantir		= Yes
End

CommandButton Command_SpecialAbilityWordOfPower			; Blastwave
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityLegendsBlastWave
;	Options                 = NONE
	TextLabel               = CONTROLBAR:LegendsRaselasBlastwave
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasBlastwave
	ButtonImage             = Gandolf_radcircle
	ButtonBorderType        = ACTION 
	AutoAbility		= Yes
	PresetRange		= 40.0
	InPalantir		= Yes
End

CommandButton Command_SpecialAbilityIsengardWizardBlast		; Magic Missile
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialPowerMagicMissile
	Options                 = NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel               = CONTROLBAR:LegendsRaselasMagicMissile
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasMagicMissile
	ButtonImage             = HPSarumanWizardBlast
	ButtonBorderType        = ACTION 
	CursorName              = Bombard
	RadiusCursorType        = ArrowStormRadiusCursor
	InvalidCursorName       = GenericInvalid
	PresetRange		= 300.0
	InPalantir		= Yes
	AutoAbility		= No
End

CommandButton InvulnerabilityScreen					;Invulnerability Screen
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialAbilityLegendsInvulnerabilityScreen
	TextLabel		= CONTROLBAR:LegendsInvulnerabilityScreen
	DescriptLabel		= CONTROLBAR:TooltipLegendsInvulnerabilityScreen
	ButtonImage		= UCOathbreaker_OathTimer
	ButtonBorderType	= ACTION 
	InPalantir		= Yes
	;UnitSpecificSound	= AragornVoiceSummonOathbreakers
	AutoAbility		= No
	InPalantir		= Yes
	;TriggerWhenReady	= Yes
End

CommandButton Command_SpellBookDragonAlly			; Greater Summon
	Command			= SPECIAL_POWER
	SpecialPower		= SpecialPowerLegendsGreaterSummon
	TextLabel		= CONTROLBAR:LegendsRaselasSummon
	DescriptLabel		= CONTROLBAR:TooltipLegendsRaselasSummon
	Options			= NEED_TARGET_POS
	FlagsUsedForToggle	= MOUNTED										; What we really want is to toggle Theoden's audio if he is mounted or unmounted. Ya, this is a hack
	ButtonImage		= HSWitchKingMountDismount HSWitchKingMountDismount
	ButtonBorderType	= ACTION 
	RadiusCursorType	= SummonDragonRadiusCursor
	CursorName          	= AttackObj
	InvalidCursorName   	= GenericInvalid
	InPalantir		= Yes
	PresetRange		= 150.0
End

CommandButton Command_PurchaseUpgradeMordorFortressMorgulSorcery	; Acid Fog
	Command           	= SPECIAL_POWER
	SpecialPower		= SpecialAbilityAcidFog
	Upgrade           	= NONE
	Options			= NONE	; NEED_TARGET_POS
	TextLabel         	= CONTROLBAR:LegendsRaselasAcidFog
	DescriptLabel     	= CONTROLBAR:TooltipLegendsRaselasAcidFog
	ButtonImage       	= BMFortress_MorgulSorcery
	ButtonBorderType  	= ACTION
	Radial            	= No
	InPalantir	   	= Yes
;	CursorName              = EvilAbilityObj
;	RadiusCursorType	= EnshroudingMistRadiusCursor
;	InvalidCursorName	= GenericInvalid
	AutoAbility		= No
	PresetRange		= 300.0
End

CommandButton Command_SarumanThunderBolt
	Command			= SPECIAL_POWER 
	SpecialPower		= RaselasBallLightning
	Options			= NEED_TARGET_ENEMY_OBJECT
	TextLabel		= CONTROLBAR:RaselasBallLightning
	ButtonImage		= HSBallLightning
	RadiusCursorType        = None
	CursorName		= Bombard
	InvalidCursorName	= GenericInvalid
	ButtonBorderType	= ACTION	
	DescriptLabel		= CONTROLBAR:TooltipRaselasBallLightning
	AutoAbility		= Yes
	InPalantir		= Yes
End

CommandButton RaselasTeleport						; Teleport (Blink)
	Command			= SPECIAL_POWER 
	SpecialPower		= SpecialAbilityRaselasTeleport
	Options			= NEED_TARGET_POS CONTEXTMODE_COMMAND
	TextLabel		= CONTROLBAR:LegendsRaselasTeleport
	ButtonImage		= CAHTeleport
	ButtonBorderType	= ACTION	
	CursorName		= EvilAbilityObj	 
	InvalidCursorName	= GenericInvalid
	DescriptLabel		= CONTROLBAR:TooltipLegendsRaselasTeleport
	InPalantir		= Yes
End

CommandButton RiseHellKnights						; Rise Fallen Hellknights
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityRiseHellKnights
;	Options                 = NONE
	TextLabel               = CONTROLBAR:LegendsRaselasRiseHellknights
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasRiseHellknights
	ButtonImage             = Gandolf_radcircle
	ButtonBorderType        = ACTION
	PresetRange		= 40.0
	InPalantir		= Yes
End

CommandButton RaselasDefeated						; Raselas Defeated Anim
	Command                 = SPECIAL_POWER 
	SpecialPower            = SpecialAbilityRaselasDefeated
;	Options                 = NONE
	TextLabel               = CONTROLBAR:LegendsRaselasDefeated
	DescriptLabel           = CONTROLBAR:TooltipLegendsRaselasDefeated
	ButtonImage             = Gandolf_radcircle
	ButtonBorderType        = ACTION
	PresetRange		= 40.0
	InPalantir		= Yes
End

CommandSet RaselasCommandSet

	 1 = Command_IsengardWizardsTowerLightningStrike	; Lightning Storm
	 2 = Command_HourOfTheWitchKing 			; Timestop
	 3 = Command_SpecialAbilityWordOfPower			; Blastwave
	 4 = Command_SpecialAbilityIsengardWizardBlast		; Magic Missile
	 5 = Command_SarumanThunderBolt		 		; Ball lightning
	 6 = Command_PurchaseUpgradeMordorFortressMorgulSorcery	; Acid Fog

	 7 = InvulnerabilityScreen				; Invulnerability Screen
	 8 = RaselasTeleport					; Teleport
	 9 = RiseHellKnights					; Rise Hell Knights
	 10 = RaselasDefeated					; Raselas Defeated Anim

    	12 = Command_CaptureBuilding
	13 = Command_AttackMove
	14 = Command_Stop
END










FXParticleSystem TimeStopFX
  System
    Priority		= ALWAYS_RENDER
    ParticleName	= exdebuff.tga ; exbarb.tga
    Lifetime		= 700 700
    SystemLifetime	= 700
    Size		= 1.5 1.5
    BurstDelay		= 801 801
    BurstCount		= 1 1
    IsGroundAligned	= Yes
  End
  Color			= DefaultColor
    Color1		= R:20   G:20 B:20  0
    Color2		= R:120  G:80 B:222 30
    Color3		= R:0    G:0  B:0   690
  End
;  Alpha			= DefaultAlpha
;    Alpha1		= 1   1   0
;    Alpha2		= 0.5 0.5 30
;    Alpha3		= 0   0   750
;  End
  Update		= DefaultUpdate
    SizeRate		= 0.03 0.03
    SizeRateDamping	= 1 1
    AngleZ		= 0 180
    AngularRateZ	= -0.1 0.1
    AngularDamping	= 1 1
    AngularDampingXY	= 1 1			
  End
  Physics		= DefaultPhysics
    VelocityDamping	= 1 1
    Gravity		= 0 0 ; No acceleration
  End
  EmissionVelocity	= OrthoEmissionVelocity
    Z = 0.02 0.02
  End
  EmissionVolume	= LineEmissionVolume
  End
  Draw			= DefaultDraw
  END
END


FXList FX_TimeStop
  ParticleSystem
    Name = TimeStopFX
    Offset = X:0.0 Y:0.0 Z:20
  End
  ParticleSystem
    Name = TimeStopFX
    Offset = X:0.0 Y:0.0 Z:11
  End
  ParticleSystem
    Name = TimeStopFX
    Offset = X:0.0 Y:0.0 Z:3
  End
;  ParticleSystem
;    Name = TimeStopFX
;    Offset = X:0.0 Y:0.0 Z:3
;    InitialDelay = 3000 3000 UNIFORM
;  End
;  ParticleSystem
;    Name = TimeStopFX
;    Offset = X:0.0 Y:0.0 Z:20
;    InitialDelay = 3000 3000 UNIFORM
;  End
End






FXParticleSystem TimestopBlastFinalShockWave
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXhpbibi.tga ; EXRing01.tga
    Lifetime = 40 40
    SystemLifetime = 5
    SortLevel = 1
    Size = 1 1
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:250 G:250 B:250 0
    Color2 = R:0 G:0 B:0 40
    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 35 35
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem TimestopBlastFinalShockWave2
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXhpgranada.tga ;EXhpenergytics.tga ; EXRing01.tga
    Lifetime = 65 65
    SystemLifetime = 5
    SortLevel = 1
    Size = 1 1
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:120 G:120 B:120 0
    Color2 = R:0 G:0 B:0 65
    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 8 8
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End


FXList FX_TimeStopBlast
  ParticleSystem
    Name = GandalfBlastFinalLight
    Offset = X:0.0 Y:0.0 Z:60   ;Z:8.0
  End
  ParticleSystem
    Name = TimestopBlastFinalShockWave
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = TimestopBlastFinalShockWave2
    Offset = X:0.0 Y:0.0 Z:20.0
  End
  ParticleSystem
    Name = GandalfBlastDust
    Offset = X:0.0 Y:0.0 Z:15.0
  End
  Sound
    Name = DrogothFireballStart		;GandalfBlastWeapon
  End
;  CameraShakerVolume
;    Radius = 700
;    Duration_Seconds = 8
;    Amplitude_Degrees = 0.035
;  End
End


Weapon RaselasTimestopWeapon
  	RadiusDamageAffects	= ENEMIES NOT_SIMILAR	; NEUTRALS ALLIES Everyone except Raselas himself (not anymore)
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	AttackRange		= 30
	MinimumAttackRange	= 0.1
	WeaponSpeed		= 401         ; dist/sec 
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 601      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	ScaleWeaponSpeed	= Yes ; Used for lob weapons, scales speed proportional to range
	DelayBetweenShots	= 5000               ; time between shots, msec
	PreAttackDelay		= 2600
	PreAttackType		= PER_ATTACK ; Do the delay each time we attack a new target
	PreAttackFX		= FX_GandalfPreAttackBlastReal
	FireFX			= FX_TimeStopBlast
	FiringDuration		= 1400

	ParalyzeNugget
		Radius		= 180.0
		Duration	= 18000
		SpecialObjectFilter	= ANY +INFANTRY +MONSTER +CAVALRY +HERO -MordorBalrog 
		ParalyzeFX	= FX_TimeStop	; FX_DevastationStunEffect
	End

End









FXParticleSystem RaselasBlastWaveFinalLight
  System
    Priority = ALWAYS_RENDER
    ParticleName = exexplo01.tga
    Lifetime = 10 10
    SystemLifetime = 5
    SortLevel = 1
    Size = 3 3
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:244 G:241 B:247 0
    Color2 = R:0 G:0 B:0 10
  End
  Update = DefaultUpdate
    SizeRate = 180 80
    SizeRateDamping = 0.8 0.7
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 1
    VelocityDamping = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
    Speed = 1 1
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End



FXParticleSystem RaselasBlastWaveFinalShockWave1
  System
    Priority = ALWAYS_RENDER
    ParticleName = execlipseblur.tga 	; exlvlupclutter.tga ; EXRing01.tga
    Lifetime = 40 40
    SystemLifetime = 10
    SortLevel = 1
    Size = 2 2
    BurstDelay = 11 11
    BurstCount = 2 2
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:244 G:241 B:240 0
    Color2 = R:0 G:0 B:0 8
    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 30 30
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem RaselasBlastWaveFinalShockWave2
  System
    Priority = ALWAYS_RENDER
    ParticleName = exlvlupclutter.tga ; EXRing01.tga
    Lifetime = 40 40
    SystemLifetime = 10
    SortLevel = 1
    Size = 2 2
    BurstDelay = 2 2
    BurstCount = 2 2
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:244 G:241 B:157 0
    Color2 = R:0 G:0 B:0 28
    ColorScale = -40 40
  End
  Update = DefaultUpdate
    SizeRate = 6 6
    SizeRateDamping = 1 1
    AngleZ = -180 180
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
    IsHollow = Yes
  End
  Draw = DefaultDraw
  End
End



FXList FX_RaselasBlastWave
  ParticleSystem
    Name = RaselasBlastWaveFinalLight
    Offset = X:9.0 Y:-3.0 Z:4   ;Z:8.0
  End
  ParticleSystem
    Name = RaselasBlastWaveFinalShockWave1
    Offset = X:9.0 Y:-3.0 Z:5.0
  End
  ParticleSystem
    Name = RaselasBlastWaveFinalShockWave2
    Offset = X:9.0 Y:-3.0 Z:5.0
    InitialDelay = 2000 2000 UNIFORM
  End
  ParticleSystem
    Name = GandalfBlastDust
    Offset = X:9.0 Y:-3.0 Z:7.0
    InitialDelay = 3000 3000 UNIFORM
  End
  CameraShakerVolume
    Radius = 700
    Duration_Seconds = 0.3
    Amplitude_Degrees = 6.0
  End
  Sound
    Name = GandalfBlastWeapon
;    InitialDelay = 600 600 UNIFORM
  End
End











Weapon RaselasBlastWaveWeapon
	RadiusDamageAffects	= NEUTRALS ENEMIES ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;
	IdleAfterFiringDelay	= 0
	AttackRange		= 200
	MinimumAttackRange	= 0.1
	WeaponSpeed		= 401         ; dist/sec 
	MinWeaponSpeed		= 371
	MaxWeaponSpeed		= 601      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	ScaleWeaponSpeed	= No ; Used for lob weapons, scales speed proportional to range
	DelayBetweenShots	= 5000               ; time between shots, msec
	PreAttackDelay		= 2600
	PreAttackType		= PER_ATTACK ; Do the delay each time we attack a new target
	PreAttackFX		= FX_GandalfPreAttackBlastReal
	FireFX			= FX_RaselasBlastWave
	FiringDuration		= 1400
	DamageNugget                        ; A basic Nugget that just does damage
		Damage		= 700
		Radius		= 150.0
		DamageType	= MAGIC
		DamageFXType	= MAGIC
		DeathType	= EXPLODED
		DamageSpeed	= 60.0 ; must match the ShockWaveSpeed below
	End
	MetaImpactNugget                    ; A Nugget that throws things back with force
;		HeroResist	= .01
		ShockWaveAmount = 180.0	; Heroes resist up to 50 (ShockwaveResist = 50)
		ShockWaveRadius = 150.0
		ShockWaveTaperOff = 0.01
		ShockWaveZMult  = 0.04
		ShockWaveSpeed	= 60.0 
	End
END




;X = Absolute Down
;Z = Front
;Y = Left

FXParticleSystem RaselasWeaponFX
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXfire03.tga
    Lifetime = 28 28
    SystemLifetime = 25
    SortLevel = 1
    Size = 3 5
    BurstDelay = 1 1
    BurstCount = 4 6
    InitialDelay = 8 8
  End
  Color = DefaultColor
    Color2 = R:0 G:0 B:0 1
    Color2 = R:0 G:0 B:255 2
    Color3 = R:40 G:0 B:150 17
    Color4 = R:10 G:0 B:100 23
    Color5 = R:0 G:0 B:0 28
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = -0.03 -0.1
    SizeRateDamping = 0.985 0.985
    AngleZ = -1 1
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = 0.2
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 3
    Offset = X:-4 Y:0 Z:-3
  End
  Draw = DefaultDraw
  End
End


Weapon RaselasLightningBolt
	AttackRange		= CREATE_A_HERO_BALL_LIGHTNING_RANGE
	WeaponSpeed		= 801
	HitPercentage		= 100
	DelayBetweenShots	= 4500
	PreAttackDelay		= 200
	PreAttackType		= PER_SHOT
	FiringDuration		= 1
	
	FireFX			= FX_CAHBallLightningFireFX
	FiringDuration		= 50
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes

	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	ProjectileCollidesWith	= ENEMIES NEUTRAL STRUCTURES	WALLS

	DamageNugget
		Damage		= 1200 ; 1000
		DamageType	= FLAME
		DamageFXType	= ELECTRIC
		DeathType	= BURNED
		Radius		= 15
		DelayTime	= 200	
	End
	
	DamageNugget
		Damage		= 1950 ; 1000
		DamageType	= MAGIC
		DamageFXType	= ELECTRIC
		DeathType	= BURNED
		Radius		= 15
		DelayTime	= 200	
	End

	MetaImpactNugget
		ShockWaveAmount		= 90.0
		ShockWaveRadius		= 17.6
		ShockWaveTaperOff	= 0.2
		DelayTime		= 200		  //The target is dying before the laser	appears	in the new laser tweak,	so try to kill when	the	laser turns	on
	End
	
End



Weapon RaselasLightningStormWarhead

	ProjectileCollidesWith	= MONSTERS STRUCTURES
	RadiusDamageAffects	= ENEMIES ALLIES NOT_SIMILAR
	ClearNuggets ;;.;;

	DamageNugget                        
		Damage        		= 500 ; +100
		Radius			= ISENGARD_WIZARDSTOWER_LIGHTNING_SHOT_DMG_RADIUS
		DamageType    		= FLAME
		DamageFXType  		= BOLT
		DeathType     		= NORMAL
	End

	DamageNugget                        
		Damage        		= 500 ; +400
		Radius			= ISENGARD_WIZARDSTOWER_LIGHTNING_SHOT_DMG_RADIUS		
		DamageType    		= MAGIC
		DamageFXType  		= BOLT
		DeathType     		= NORMAL
	End
End



Object WizardTowerProjectile
    
AddModule
  Behavior = FireWeaponWhenDeadBehavior ModuleTag_ExtraDamage
    StartsActive = Yes
    DeathWeapon = RaselasLightningStormWarhead
  End
END

End





FXList FX_RaselasMeleeHit
  Sound
    Name = ImpactGimliAxeProjectile
  End
End


Weapon RaselasMeleeWeapon

	LeechRangeWeapon	= Yes
	AttackRange		= 20
	MeleeWeapon		= Yes
	FireFX			= FX_RaselasMeleeHit
	DelayBetweenShots	= FARAMIR_DELAYBETWEENSHOTS
	PreAttackDelay		= FARAMIR_PREATTACKDELAY
	PreAttackType		= PER_SHOT
	FiringDuration		= FARAMIR_FIRINGDURATION

	DamageNugget
		Damage		= 650 ; 150
		Radius		= 0.0
		DamageArc	= 0
		DelayTime	= 0
		DamageType	= HERO
		DamageFXType	= MAGIC
		DeathType	= NORMAL
	End
END


;----------------- RASELAS OBJECT --------------------

ChildObject  MordorMouthOfSauron	DwarvenGloin
        
	Scale = 1.15
	
	SelectPortrait	= CPAvatar
	ButtonImage	= HICAHAvatar
	DisplayName	= Raselas
	ShockwaveResistance = 9999999		; Immune to all shock
	CommandPoints	= 0
	Side		= Mordor

  AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_GandalfWhite			; Granted at start to trigger other stuff. Gandalf has nothing to do with it, it's a random upgrade.
	End 
  End

;  AddModule
;	Behavior = AttributeModifierUpgrade ModuleTag_RheiaDamage 	; Gives Raselas more damage
;		TriggeredBy	  	=	Upgrade_GandalfWhite
;		AttributeModifier 	=	RaselasDamage
;	End
;  END

; AddModule
;	Behavior = AttributeModifierUpgrade ModuleTag_RaselasArmor 	; Gives Rheia CaH ARMOR ATTRIBUTE 13 (just enough to stay alive)
;		TriggeredBy	  	=	Upgrade_GandalfWhite
;		AttributeModifier 	=	RaselasArmorModifier
;	End
;  END

;-------------- Lightning Storm ----------------

;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
;		SpecialPowerTemplate	= SpecialAbilityLegendsLightningStorm
;		TriggeredBy				= Upgrade_IsengardFortressWizardsTower
;	End

	Behavior = SpecialPowerModule ModuleTag_LightningStrike                      
		SpecialPowerTemplate		= SpecialAbilityLegendsLightningStorm
		UpdateModuleStartsAttack	= Yes
;		StartsPaused			= Yes
		StartsPaused			= No
		InitiateSound			= WizardTowerLightningStrikeRumbleMS
	End

	Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
		SpecialPowerTemplate    = SpecialAbilityLegendsLightningStorm
		StartAbilityRange       = 350
		UnpackingVariation	= 4
		CanShootEmptyGround	= Yes
		
		UnpackTime              = 4900	;// Pull out arrow
		PreparationTime         = 1		;// Quick shot
		PersistentPrepTime      = 1300	;// looping the quick shot
		PackTime                = 2300	;// back to idle

		ApproachRequiresLOS     = No	;// required so that it doesn't shoot through walls
		AwardXPForTriggering    = 0
		
		;ActiveLoopSound	= GandalfLightningLoop  ;// Sound loops entire time ability is actively firing

		;//Specific to ArrowStorm
		WeaponTemplate		= WizardTowerLightningWeapon	; It's a projectile, so we can't edit it
		TargetRadius		= 90 ;60 ;30
		ShotsPerTarget		= 2
		ShotsPerBurst		= 1
		MaxShots		= 6   ;// will double up if run out of targets
	End

	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior	
		SpecialAbility		= SpecialAbilityLegendsLightningStorm ;// Use this ability
	End

;--------------------------------------------------

;--------------------- Timestop ---------------------

;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TimestopEnabler
;		SpecialPowerTemplate = SpecialAbilityLegendsTimeStop
;		TriggeredBy = Upgrade_GandalfWordOfPower
;	End

	Behavior = SpecialPowerModule ModuleTag_TimestopStarter       
		SpecialPowerTemplate      = SpecialAbilityLegendsTimeStop
		UpdateModuleStartsAttack  = Yes
;		StartsPaused		  = Yes
		StartsPaused		  = No
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_TimestopWeaponFireUpdate   
		SpecialPowerTemplate   		= SpecialAbilityLegendsTimeStop
		WhichSpecialWeapon		= 3
		SkipContinue			= Yes
		UnpackTime              	= 2600 
		PreparationTime			= 600
		PersistentPrepTime		= 1400
		PackTime			= 3200	
		FreezeAfterTriggerDuration	= 2500 		; Hold AI for this long after we fire.
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 50.0
		
		SpecialWeapon		= RaselasTimestopWeapon
	End

;--------------------------------------------------

;--------------------- Blastwave ---------------------

;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WordEnabler
;		SpecialPowerTemplate = SpecialAbilityLegendsBlastWave
;		TriggeredBy = Upgrade_GandalfWordOfPower
;	End

	Behavior = SpecialPowerModule ModuleTag_WordStarter       
		SpecialPowerTemplate      = SpecialAbilityLegendsBlastWave
		UpdateModuleStartsAttack  = Yes
;		StartsPaused		  = Yes
		StartsPaused		  = No
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WordWeaponFireUpdate   
		SpecialPowerTemplate		= SpecialAbilityLegendsBlastWave
		WhichSpecialWeapon		= 4
		SkipContinue			= Yes
		UnpackTime			= 1 
		PreparationTime			= 1100
		PersistentPrepTime		= 2800
		PackTime			= 2700	
		FreezeAfterTriggerDuration	= 2700
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 50.0
		
		SpecialWeapon			= RaselasBlastWaveWeapon
	End

;--------------------------------------------------

;------------------  ACID CLOUD  ----------------------


AddModule
	Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerModuleTag_AcidCloudSpecialPower
		SpecialPowerTemplate		= SpecialAbilityAcidFog
		OCL				= OCL_LegendsSummonAcidCloud
		TriggerFX			= FX_AcidCloud
		CreateLocation			= CREATE_AT_LOCATION
		StartsPaused			= No
		SetModelCondition		= ModelConditionState:USER_2
		SetModelConditionTime		= 4
	End
END


;	Behavior = SpecialPowerModule ModuleTag_AcidCloudStarter      
;		SpecialPowerTemplate    	= SpecialAbilityAcidFog
;		UpdateModuleStartsAttack	= Yes
;		StartsPaused			= No
;	End

;	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_AcidCloudUpdate  
;		SpecialPowerTemplate		= SpecialAbilityAcidFog
;		WhichSpecialWeapon		= 2
;		SkipContinue			= Yes
;		UnpackTime               	= 3200 
;		PackTime                 	= 6400	
;		FreezeAfterTriggerDuration	= 8500 		; Hold AI for this long after we fire.
;		AwardXPForTriggering     	= 0		
;		StartAbilityRange	 	= 50.0
;	
;		SpecialWeapon		  	= AcidCloudWeapon
;	End


;--------------------- Magic Missile ---------------------

;AddModule
;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MagicMissileEnabler
;		SpecialPowerTemplate = SpecialPowerMagicMissile
;		TriggeredBy = Upgrade_LegolasArrowWind
;	End
;END

AddModule
	Behavior = SpecialPowerModule ModuleTag_MagicMissileStarter                      
		SpecialPowerTemplate		= SpecialPowerMagicMissile
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No ;Yes
		InitiateSound			= SpellGenericUnsummonFaster		;this plays when he targets, not when he fires
	End
END

AddModule
	Behavior = ArrowStormUpdate ModuleTag_MagicMissileUpdate                
		SpecialPowerTemplate		= SpecialPowerMagicMissile
		StartAbilityRange		= 380.0
		
		UnpackTime			= 800	; Pull out arrow
		PreparationTime			= 200	; Quick shot
		PersistentPrepTime		= 600	; looping the quick shot
		PackTime			= 1200	; back to idle
		UnpackingVariation		= 3
		ParalyzeDurationWhenCompleted	= 600	;Once the unit SUCCESSFULLY COMPLETES an ability, paralyze unit briefly to deal with animation transitions.
		ParalyzeDurationWhenAborted	= 800	;If the unit ABORTS the ability, paralyze the unit briefly to deal with animation transitions.

		ApproachRequiresLOS		= Yes ; required so that it doesn't shoot through walls

		AwardXPForTriggering		= 0

		;Specific to ArrowStorm
		WeaponTemplate			= HaldirGoldenArrow ; (RaselasMagicMissile)
		TargetRadius			= 250	;CHANGING THIS??? Change RadiusCursorRadius to match this value in the appropriate SpecialPower.ini template.
		ShotsPerTarget			= 1
		ShotsPerBurst			= 5
		MaxShots			= 5  ; can end sooner if no targets
 		CanShootEmptyGround		= No ; ...unless this is set
	End
END

;--------------------------------------------------

;--------------------- Greater Summon -------------

;--------------------------------------------------



;------------------- Invulnerability Screen -----------------

;AddModule
;	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_InvulEnabler
;		SpecialPowerTemplate		= SpecialAbilityLegendsInvulnerabilityScreen
;		TriggeredBy			= Upgrade_CreateAHeroInvulnerability_Level3
;	End
;END






	Behavior = SpecialPowerModule ModuleTag_EntanglingVinesSpecialPower
		SpecialPowerTemplate		= SpecialAbilityLegendsInvulnerabilityScreen
		StartsPaused			= No
		UpdateModuleStartsAttack	= Yes
;		InitiateSound			= PeasantFemaleVoiceAttackBuilding ;this plays when he targets, not when he fires
	End
	
	Behavior = ActivateModuleSpecialPower ModuleTag_EntanglingVinesUpdate
		SpecialPowerTemplate		= SpecialAbilityLegendsInvulnerabilityScreen
		StartAbilityRange		= 1
		TriggerSpecialPower		= ModuleTag_Lalala1	TARGETPOS
		TriggerSpecialPower		= ModuleTag_Lalala2	TARGETPOS
	End

	Behavior = SpecialPowerModule ModuleTag_Lalala1
		SpecialPowerTemplate		= SpecialAbilityActivateeDummy
		AttributeModifier		= RaselasInvulnerabilityScreen
		AttributeModifierRange		= 1
		AttributeModifierAffectsSelf	= Yes
		AttributeModifierAffects	= ANY +CAVALRY	+INFANTRY
		AttributeModifierFX		= FX_RaselasInvulnerabiliyScreenStart
	End

	Behavior = SpecialPowerModule ModuleTag_Lalala2
		SpecialPowerTemplate		= SpecialAbilityActivateeDummy2
		AttributeModifier		= RaselasInvulnerabilityScreen2
		AttributeModifierRange		= 1
		AttributeModifierAffectsSelf	= Yes
		AttributeModifierAffects	= ANY +CAVALRY	+INFANTRY
	End






;AddModule
;	Behavior = SpecialPowerModule ModuleTag_InvulStarter
;		SpecialPowerTemplate		= SpecialAbilityLegendsInvulnerabilityScreen
;		UpdateModuleStartsAttack	= No
;		StartsPaused			= No	;Yes
;		AttributeModifier		= RaselasInvulnerabilityScreen2
;		AttributeModifierRange		= 1
;		AttributeModifierAffectsSelf	= Yes
;		AttributeModifierAffects	= ANY +CAVALRY	+INFANTRY
;;		AttributeModifierFX		= FX_RaselasInvulnerabiliyScreenStart
;	End
;End

;AddModule
;	Behavior = SpecialPowerModule ModuleTag_InvulStarter2
;		SpecialPowerTemplate		= SpecialAbilityLegendsInvulnerabilityScreen
;		UpdateModuleStartsAttack	= No
;		StartsPaused			= No	;Yes
;		AttributeModifier		= RaselasInvulnerabilityScreen
;		AttributeModifierRange		= 1
;		AttributeModifierAffectsSelf	= Yes
;		AttributeModifierAffects	= ANY +CAVALRY	+INFANTRY
;		AttributeModifierFX		= FX_RaselasInvulnerabiliyScreenStart
;	End
;End

;----------------------------------------------------




;------------------- Ball Lightning ------------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_RaselasBallLightning
		SpecialPowerTemplate	 = RaselasBallLightning
		UpdateModuleStartsAttack = Yes
		StartsPaused		 = No
;		InitiateSound		 = HeroWizardVoiceAttack //this plays when he targets, not when he fires
	End
END

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BallLightningUpdate_L3
		SpecialPowerTemplate = RaselasBallLightning
		SkipContinue			= Yes
		UnpackTime			= 1
		PreparationTime			= 1200  
		PersistentPrepTime		= 1000
;		PackTime			= 800
		FreezeAfterTriggerDuration	= 300
		AwardXPForTriggering		= 0
		StartAbilityRange		= CREATE_A_HERO_BALL_LIGHTNING_START_RANGE //	Note: This has to be smaller than the weapon range or it'll	never succeed
		ApproachRequiresLOS		= Yes		 
		SpecialWeapon			= RaselasLightningBolt
		MustFinishAbility		= Yes
		WhichSpecialWeapon		= 2
		BusyForDuration			= 1000
	End
END

;--------------------------------------------------


;------------------- Teleport ------------------

Behavior = SpecialPowerModule ModuleTag_TeleportStarter                      
	SpecialPowerTemplate		= SpecialAbilityRaselasTeleport
	UpdateModuleStartsAttack	= Yes
	TriggerFX			= FX_Blink
End
Behavior = TeleportSpecialAbilityUpdate ModuleTag_TeleportUpdate   
	SpecialPowerTemplate		= SpecialAbilityRaselasTeleport

	UnpackingVariation		= 1
	UnpackTime			= 1600
	PackTime			= 1800

	ApproachRequiresLOS		= No
	BusyForDuration			= 1800
	
	DestinationWeaponName =	CreateaHeroBlinkDestination
End


;--------------------------------------------------

;--------------------- Rise Hell Knights ---------------------

	Behavior = SpecialPowerModule ModuleTag_RiseHellKnightsStarter       
		SpecialPowerTemplate      = SpecialAbilityRiseHellKnights
		UpdateModuleStartsAttack  = Yes
		StartsPaused		  = No
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RiseHellKnightsFireUpdate   
		SpecialPowerTemplate		= SpecialAbilityRiseHellKnights
		WhichSpecialWeapon		= 6
		SkipContinue			= Yes
		UnpackTime			= 1500 
		PreparationTime			= 400
		PersistentPrepTime		= 5300
		PackTime			= 3000	
		FreezeAfterTriggerDuration	= 6800	; 4800 + 2000
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 50.0
		
		SpecialWeapon			= RiseHellKnightsWeapon
	End

;--------------------------------------------------




;--------------------- Raselas Defeated ---------------------

	Behavior = SpecialPowerModule ModuleTag_RaselasDefeatedStarter       
		SpecialPowerTemplate      = SpecialAbilityRaselasDefeated
		UpdateModuleStartsAttack  = Yes
		StartsPaused		  = No
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RaselasDefeatedFireUpdate   
		SpecialPowerTemplate		= SpecialAbilityRaselasDefeated
		WhichSpecialWeapon		= 5
		SkipContinue			= Yes
		UnpackTime			= 5000 
		PreparationTime			= 1
		PersistentPrepTime		= 6300
		PackTime			= 15000	
		FreezeAfterTriggerDuration	= 18800		; Enough time so he stays dead on the ground for the rest of the cutscene
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 50.0
		BusyForDuration			= 22800		; Enough time so he stays dead on the ground for the rest of the cutscene
		
		SpecialWeapon			= RaselasDefeatedWeapon
	End

;--------------------------------------------------



AddModule
	Behavior = SubObjectsUpgrade CorruptedWeapon_Upgrade01562
	TriggeredBy			= Upgrade_GandalfWhite

;	HideSubObjects		   = AVATAR_HEAD	; Don't lose your head (or uncomment this line)
;	HideSubObjects		   = AVEYES		; Eyes effect

	HideSubObjects		   = HLMT_01		; Wizard Hat
	HideSubObjects		   = HLMT_02		; Hair
	HideSubObjects		   = HLMT_03		; Wizard Hat + Hair
;	HideSubObjects		   = HLMT_04		; Headband/Good crown
;	HideSubObjects		   = HLMT_05		; Evil Crown
	HideSubObjects		   = HLMT_06		; Mask
	HideSubObjects		   = HLMT_07		; Headband/Good crown + Hair


;	HideSubObjects		   = WIZARDSTAFF01	; Fancy staff black
	HideSubObjects		   = WIZARDSTAFF02	; Druid staff
	HideSubObjects		   = WIZARDSTAFF03	; Fancy staff shorter, wood
	HideSubObjects		   = WIZARDSTAFF04	; Macelike staff
;	HideSubObjects		   = WIZARDSTAFF05	; staff

;	HideSubObjects		   = SLDR_01		; Rohan Shoulders
;	HideSubObjects		   = SLDR_02		; Plate Shoulders

;	HideSubObjects		   = WIZSTAFF01_FX01	; Purple Aura 1
;	HideSubObjects		   = WIZSTAFF01_FX2	; Purple Aura 2
;	HideSubObjects		   = WIZSTAFF01_FX3	; Purple Aura 3
;	HideSubObjects		   = WIZSTAFF01_FX4	; Round effect

	HideSubObjects		   = WIZSTAFF02_FX1	; Green Aura

;	HideSubObjects		   = WIZSTAFF03_FX01	; Blood Border
;	HideSubObjects		   = WIZSTAFF03_FX02	; Blood tip

;	HideSubObjects		   = WIZSTAFF04_FX01	; Spiral part 1
;	HideSubObjects		   = WIZSTAFF04_FX02	; Spiral part 2
;	HideSubObjects		   = WIZSTAFF04_FX03	; Spiral part 3
;	HideSubObjects		   = WIZSTAFF04_FX04	; Spiral Tip
;	HideSubObjects		   = WIZSTAFF04_FX05	; Spiral Tip
;	HideSubObjects		   = WIZSTAFF04_FX06	; Spiral Tip
;	HideSubObjects		   = WIZSTAFF04_FX07	; Spiral Tip

;	HideSubObjects		   = MESH		; Bear for weapon launch
	HideSubObjects		   = ARROW		; for weapon launch
	HideSubObjects		   = MINEDARROW		; for weapon launch
	HideSubObjects		   = O1_MESH		; for weapon launch

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End


	AddModule
	Behavior = SubObjectsUpgrade Body_ChangeSkin
		TriggeredBy		   = Upgrade_GandalfWhite
		UpgradeTexture		   = chwz_wd.tga		0 chwz_wd_02.tga	; Dark costume.
		RecolorHouse		   = No
	End
	End


;------------


AddModule
  Draw = W3DScriptedModelDraw ModuleTag_01EXTRA
    DefaultModelConditionState
	Model			= iufbllsta_skn ;cubear_skn
	Skeleton		= iufbllsta_skl ;cubear_skl
	WeaponLaunchBone	= PRIMARY B_RFTBOW1 ; B_HEAD
    End
  End
END


//================== ANIMATIONS =================================================================

	ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_011

;	ExtraPublicBone = WizStaff02_FXBO
;	ExtraPublicBone = WizStaff02_FX1
;	ExtraPublicBone = B_STAFF

		DefaultModelConditionState
			Model			= CHWZ_AV_U_SKN
			Skeleton		= CHWZ_YW_U_SKL
;			WeaponLaunchBone	= PRIMARY B_Staff;WizStaff02_FXBO ; B_STAFF ; B_HAND_R
		End

// --------- UNMOUNTED  ------------

//------------------  DYING -------------------------------------------------------------

AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHWZ_YW_U_DIEB
		AnimationMode     = ONCE
	End
End


// --- Stunned anims


AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHWZ_YW_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End


AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHWZ_YW_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------

// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= CHWZ_YW_U_LVLA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= CHWZ_YW_U_SPCA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

	

//------------------ MOVING -------------------------------------------------------------

		AnimationState        = MOVING USER_4                 // Moving slaughter
			StateName           = Slaughter
			Flags               = RANDOMSTART
			//ParticleSysBone     = None InfantryDustTrails
			Animation           = GUHero_ATKE
				AnimationName     = CHWZ_YW_U_ATKE
				AnimationMode     = LOOP
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
			EndScript
		End


		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHWZ_YW_U_RUNA
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End



		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHWZ_YW_U_ATKA1 CHWZ_YW_U_ATKA CHWZ_YW_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName		= CHWZ_YW_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName		= CHWZ_YW_U_ATKC
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			ParticleSysBone			= WIZSTAFF02_FXBO RaselasWeaponFX FollowBone:yes	;B_STAFF
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------


		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHWZ_YW_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHWZ_YW_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState				= SPECIAL_POWER_1							; Aragorn shouting Elendil anim
			StateName				= STATE_ready
			Animation
				AnimationName		= CHWZ_YW_U_SPCA
				AnimationMode		= ONCE
			End
			ParticleSysBone			= B_SWORDBONE ElendilFlare FollowBone:yes
			ParticleSysBone			= B_SWORDBONE ElendilSwordFlare FollowBone:yes
;			FXEvent	= Name: FX_ElendilGlowEvent
		End

		// WORD OF POWER ANIMS ON FOOT //
		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
			//FXEvent			  =	Frame:5	Name:FX_GandalfPreAttackBlast
		End


; ---------- Ball lightning ----------


		AnimationState		  =	SPECIAL_WEAPON_TWO PREPARING
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End

;		AnimationState		  =	SPECIAL_WEAPON_TWO PACKING
;			StateName		  =	Attacking
;			Animation
;				AnimationName =	CHWZ_YW_U_ATNA	;WPNA
;				AnimationMode =	ONCE
;			End
;		End

; ------------ Timestop -------------------

		AnimationState		  =	SPECIAL_WEAPON_THREE UNPACKING
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_TNTA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		AnimationState		  =	SPECIAL_WEAPON_THREE PREPARING
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_CHRA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		AnimationState		  =	SPECIAL_WEAPON_THREE PACKING
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_SPCE
				AnimationMode =	ONCE
			End
		End

;----------------------

; ------------ Blastwave -------------------

		AnimationState		  =	SPECIAL_WEAPON_FOUR PREPARING
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_IBFB	;LVLA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:30 Name:FX_GandalfStaffFlare
		End

		AnimationState		  =	SPECIAL_WEAPON_FOUR PACKING
			StateName		  =	Attacking
			Animation		  =	StaffLaser
				AnimationName =	CHWZ_YW_U_CHRA
				AnimationMode =	ONCE
			End
		End

;----------------------



		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHWZ_YW_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End
;----------------- Magic Missiles -------------------

		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
;			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
		End
	
;		AnimationState		  =	PACKING_TYPE_3 PREPARING
;			StateName		  =	Attacking
;			Animation		  =	LightningSwordLoop
;				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
;				AnimationMode =	LOOP
;			End
;		End

;		AnimationState		  =	PACKING_TYPE_3 PACKING
;			StateName		  =	Attacking
;			Animation		  =	LightningSwordPutAway
;				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
;				AnimationMode =	ONCE
;			End
;		End



;---------------- Lighting Storm --------------------

		AnimationState		  =	PACKING_TYPE_4 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_WPNA CHWZ_YW_U_ATKA ; SPCC
				AnimationMode =	ONCE
			End
			ParticleSysBone = B_STAFF FX_CreateAHeroLightningCharge FollowBone:Yes
			ParticleSysBone = B_STAFF FX_GandalfLightningSword FollowBone:Yes
;			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
;			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_LVLA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
				AnimationSpeedFactorRange = 1.35 1.35
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_TNTA CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 1.3 1.3
			End
		End


;-------------- Acid Cloud ----------------------

		AnimationState			= USER_2
			StateName = Attacking
			Animation
				AnimationName = CHWZ_YW_U_CHRA
				AnimationMode = ONCE
				AnimationBlendTime = 0
				AnimationSpeedFactorRange = 0.8 0.8
			End
;			ParticleSysBone = NONE SummonedDragonDust	FollowBone:Yes
		End


;----------- Invulnerability --------------


		AnimationState		  =	USER_4
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.8 0.8
			End
		End

;----------- Raise Fallen Hell Knights --------------

		AnimationState		  =	SPECIAL_WEAPON_SIX UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_LVLA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 1 1
			End
			ParticleSysBone = NONE RiseHellKnightsBurst2	FollowBone:Yes
;			ParticleSysBone = NONE PreRiseHellKnightsShafts	FollowBone:Yes		;Looked crappy
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_CHRA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.3 0.3
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_SIX PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCE
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End

;---------------------- Raselas Defeated -----------------------


		AnimationState		  =	SPECIAL_WEAPON_FIVE UNPACKING
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.4 0.4
			End
			ParticleSysBone = None RaselasDefeatedInitialVortex FOLLOWBONE:YES
;			ParticleSysBone = None RaselasDefeatedInitialCenter FOLLOWBONE:YES
;			ParticleSysBone = None RaselasDefeatedInitialVortex FOLLOWBONE:YES
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE PREPARING
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_DIEA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.3 0.3
			End
		End

		AnimationState		  =	SPECIAL_WEAPON_FIVE PACKING
			StateName		  =	Attacking
			Animation
				AnimationName =	CHWZ_YW_U_RBRN
				AnimationMode =	ONCE
                		AnimationSpeedFactorRange    = 0 0
			End
;           		Flags                    = START_FRAME_LAST
		End

;------------------------------------------------------------
		
//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHWZ_YW_U_SPCE CHWZ_YW_U_SPCA CHWZ_YW_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHWZ_YW_U_SPCC CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHWZ_YW_U_SPCA CHWZ_YW_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHWZ_YW_U_SPCB CHWZ_YW_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 5

		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHWZ_YW_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		
		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCB
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 6

		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHWZ_YW_U_SPCD
				AnimationMode =	ONCE
			End
		End


//---------------------- EMOTIONS ---------------------------------------------------------------

		// cheer, on foot
;AnimationState = EMOTION_CELEBRATING 
;	Animation WPNA
;		AnimationName	   = CHWZ_YW_C_WPNA
;		AnimationMode	   = ONCE
;		AnimationBlendTime = 20
;	End
;	Animation CLRA
;		AnimationName	   = CHWZ_YW_C_CLRA
;		AnimationMode	   = ONCE
;		AnimationBlendTime = 20
;	End
;	Flags			   = RESTART_ANIM_WHEN_COMPLETE
;End


;		AnimationState				=	EMOTION_CELEBRATING
;			Animation CHRA
;				AnimationName		=	CHWZ_YW_U_CHRA CHWZ_YW_U_TNTA
;				AnimationMode		=	ONCE
;			End
;			Animation CHRB
;				AnimationName		=	CHWZ_YW_U_CHRB CHWZ_YW_U_CHRA CHWZ_YW_U_TNTA
;				AnimationMode		=	ONCE
;			End
;			Flags					=	RESTART_ANIM_WHEN_COMPLETE
;		End
		
		// taunt, on foot
;		AnimationState				=	EMOTION_TAUNTING
;			Animation CHRA
;				AnimationName		=	CHWZ_YW_U_TNTA
;				AnimationMode		=	ONCE
;			End
;			Animation CHRB
;				AnimationName		=	CHWZ_YW_U_TNTB CHWZ_YW_U_TNTA
;				AnimationMode		=	ONCE
;			End
;			Flags					=	RESTART_ANIM_WHEN_COMPLETE
;		End
		


//ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHWZ_YW_U_IDLA	;IDLA
				AnimationMode		= ONCE
			End
		End
		
//IDLE
		IdleAnimationState
			StateName					= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHWZ_YW_U_ATNB	; IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End
;			Animation = Foot_IDLC
;				AnimationName       = CHWZ_YW_U_IBFB	; Animation used for Blastwave power
;				AnimationMode       = ONCE
;				AnimationPriority   = 2
;			End
			//Animation = Foot_IDLD // Bored Fidget
			//	AnimationName       = CHWZ_YW_U_IBFB
			//	AnimationMode       = ONCE
			//	AnimationPriority   = 1
			//End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End
		

	//---transitions--------------------------------------------

		TransitionState = TRANS_BoredToSelectedSword
		// Once we have proper animations for enter -> idle -> exit, fix this properly.
			Animation = ANTD
				AnimationName	= CHWZ_YW_U_ATNA CHWZ_YW_U_ATND CHWZ_YW_U_IDLA
				AnimationMode	= ONCE
			End		
		End
		
		TransitionState = TRANS_SelectedToBoredSword
			Animation			= ATNF
				AnimationName	= CHWZ_YW_U_ATNC CHWZ_YW_U_ATNF CHWZ_YW_U_ATNE
				AnimationMode	= ONCE
			End		
		End			

	End		; Draw Module
END			; Replace Module



	WeaponSet
		Conditions					= None
		Weapon						= PRIMARY    RaselasMeleeWeapon
		AutoChooseSources				= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

;	WeaponSet
;		Conditions		= WEAPONSET_HERO_MODE
;		Weapon			= PRIMARY    RheiaHeroWeapon
;	End


	ArmorSet
		Conditions					= None
		Armor						= RaselasArmor
		DamageFX					= NormalDamageFX
	End
	

	ThreatBreakdown GoblinFighterHorde_DetailedThreat
		AIKindOf = CAVALRY
	End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
;Voice
;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
			VoiceAttack 					= HeroWizardVoiceAttack
			VoiceAttackAir					= HeroWizardVoiceAttack
			VoiceAttackCharge 				= HeroWizardVoiceAttack
			VoiceAttackMachine 				= HeroWizardVoiceAttack
			VoiceAttackStructure 				= HeroWizardVoiceAttack
			VoiceCreated					= HeroWizardVoiceAvatarSalute
			VoiceFear					= HeroWizardVoiceHelpMe
			VoiceFullyCreated				= HeroWizardVoiceAvatarSalute
			VoiceGuard					= HeroWizardVoiceMove
			VoiceMove 					= HeroWizardVoiceMove
			VoiceMoveToCamp 				= HeroWizardVoiceMove
			VoiceMoveWhileAttacking 			= HeroWizardVoiceMove
			VoicePriority					= 95
			VoiceRetreatToCastle 				= HeroWizardVoiceMove
			VoiceSelect 					= HeroWizardVoiceSelectMS
			VoiceSelectBattle  				= HeroWizardVoiceSelectBattle
		
			SoundImpact					= ImpactHorse
		
			UnitSpecificSounds
				VoiceAttackFireball			= HeroWizardVoiceAttack
				VoiceEnterUnitElvenTransportShip	= HeroWizardVoiceMove
				VoiceEnterUnitMordorMumakil		= HeroWizardVoiceMove
				VoiceEnterUnitSlaughterHouse		= HeroWizardVoiceMove
				VoiceEnterUnitTransportShip		= HeroWizardVoiceMove
				VoiceGarrison				= HeroWizardVoiceMove
				VoiceInitiateCaptureBuilding		= HeroWizardVoiceCaptureBuilding
			End

;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

	KindOf	= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ;ATTACK_NEEDS_LINE_OF_SIGHT CAN_CLIMB_WALLS

	CommandSet  = RaselasCommandSet
	CommandPoints = 0

	LocomotorSet
		Locomotor					= HeroHumanScalingLocomotor
		Condition					= SET_NORMAL
		Speed						= 50
	End

	ReplaceModule ModuleTag_RespawnBody
	Body = RespawnBody ModuleTag_RespawnBody1
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= 60000 
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= 20%	
	End
	End

ReplaceModule HitReactionBehaviorModuleTag
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTagNew
		HitReactionLifeTimer1 = 8200		; level 1 (light  damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer2 = 8800		; level 2 (medium damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer3 = 8500		; level 3 (heavy  damage)  hit reaction animations in frames (5 per sec)

		HitReactionThreshold1 = 4500.0		; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 9000.0		; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 20000.0		; level 3 (heavy  damage) threshold trigger
	End
END

RemoveModule	ModuleTag_SlamStarter
RemoveModule	ModuleTag_ShakeFoundationStarter
RemoveModule	ModuleTag_SmashStarter
RemoveModule	ModuleTag_GloinHealing			; We don't want this nasty boss regenerating, do we.

	Geometry		= CYLINDER
	GeometryMajorRadius	= 150.0
	GeometryMinorRadius	= 32.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	Shadow			= SHADOW_DECAL
	ShadowSizeX		= 20
	ShadowSizeY		= 20
	ShadowTexture		= ShadowI

;	HealthBoxScale		= 3.0
;	HealthBoxHeightOffset	= 21.0

End























;-----------------------------------------------------
; HELL KNIGHT
;-----------------------------------------------------

Armor HellKnightArmor
  Armor = DEFAULT         8%
  Armor = HERO		  10%
  Armor = HERO_RANGED	  10%
  Armor = MAGIC		  18%
  Armor = FLAME           15%
  Armor = POISON	  0%
End

FXParticleSystem HellKnightHitFlare
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXLightRays.tga
    Lifetime = 20 20
    SystemLifetime = 1
    SortLevel = 1
    Size = 5 5
    BurstCount = 20 20
  End
  Color = DefaultColor
    Color1 = R:83 G:60 B:255 0
    Color2 = R:0 G:0 B:0 20
  End
  Update = DefaultUpdate
    SizeRate = 15 20
    SizeRateDamping = 0.6 0.65
    AngleZ = -7 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -0.4 0.4
    Y = -0.4 0.4
  End
  EmissionVolume = LineEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXList FX_HellKnightMagicHit
  ParticleSystem
    Name = HellKnightHitFlare
    AttachToObject	= Yes
    AttachToBone	= BAT_RIBS
  End
End

DamageFX HellKnightDamageFX
  ThrottleTime = DEFAULT 10
  AmountForMajorFX  = DEFAULT  0.0
  MajorFX           = DEFAULT  FX_HellKnightMagicHit
End









FXParticleSystem DieHellKnightBlast
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXblast3.tga
    Lifetime = 35 35
    SystemLifetime = 100
    SortLevel = 1
    Size = 2 2
    BurstDelay = 4 6
    BurstCount = 1 1
    IsGroundAligned = Yes
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:40 G:0 B:200 1
    Color2 = R:190 G:0 B:0 28
    Color3 = R:0 G:0 B:0 35
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = 4 7
    SizeRateDamping = 0.97 0.99
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    Z = 0.1 0.5
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 7
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem DieHellKnight
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXfire03.tga
    Lifetime = 45 45
    SystemLifetime = 100
    SortLevel = 1
    Size = 20 26
    BurstDelay = 1 1
    BurstCount = 2 2
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:0 G:0 B:0 0
    Color2 = R:40 G:0 B:200 1
    Color3 = R:190 G:0 B:0 35
    Color4 = R:0 G:0 B:0 45
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = -0.2 -0.5
    SizeRateDamping = 0.985 0.985
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 1 13
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 7
  End
  Draw = DefaultDraw
  End
End

FXList FX_HellKnightDie
   Sound
	Name = SpellSunflare4
   END
   ParticleSystem
    Name = DieHellKnight
    Offset = X:0 Y:0 Z:0
  End
   ParticleSystem
    Name = DieHellKnightBlast
    Offset = X:0 Y:0 Z:0
  End
END



FXParticleSystem RaiseDeadColumn
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXcross02.tga
    Lifetime = 45 45
    SystemLifetime = 125
    SortLevel = 1
    Size = 40 40
    BurstDelay = 1 1
    BurstCount = 2 2
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:40 G:0 B:200 1
    Color2 = R:190 G:0 B:0 35
    Color3 = R:0 G:0 B:0 45
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 0.985 0.985
    AngleZ = 0 0
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.92 0.92
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 0 0
    Z = 1 13
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 7
  End
  Draw = DefaultDraw
  End
End

FXList FX_HellKnightReborn
   Sound
	Name = SpellSunflare4
   END
   ParticleSystem
    Name = RaiseDeadColumn
    Offset = X:8 Y:0 Z:0
  End
END

ModifierList HellKnightFreezeWhileResurrecting
	Category = SPELL
	Modifier = SPEED 0%
	Duration = 8200				; Matches resurrecting animation
End


Object CINE_FreeDwarfPrisoner	; So that OCL has something to use
END

Object CINE_GoblinSwordsman	; So that OCL has something to use
END




ObjectCreationList OCL_SpawnDeadHellKnight
	CreateObject
		ObjectNames		= CINE_FreeDwarfPrisoner
		Count			= 1
		FadeIn			= No
		IgnoreCommandPointLimit = Yes
		Disposition		= LIKE_EXISTING		;RELATIVE_ANGLE
;		DispositionAngle	= 0
		InheritScriptingName	= Yes			; Unit retains it's name so we can use scripts, whoohoooo!!!!!!!!! :D :D :D
	End
End



ObjectCreationList OCL_SpawnLivingHellKnight
	CreateObject
		ObjectNames		= CINE_GoblinSwordsman
		UseJustBuiltFlag	= Yes
		Count			= 1
		FadeIn			= Yes
		FadeTime		= 2000
		IgnoreCommandPointLimit = Yes
		Disposition		= LIKE_EXISTING
;		DispositionAngle	= 0
		InheritScriptingName	= Yes			; Unit retains it's name so we can use scripts, whoohoooo!!!!!!!!! :D :D :D
	End
End



; NOTE TO SELF:
; Z = Front
; X = Up
; Y = 


FXParticleSystem HellKnightFireCenter
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXfire03.tga
    Lifetime = 8 8	;28 28
;    SystemLifetime = 125
    SortLevel = 1
    Size = 8 9
    BurstDelay = 1 1
    BurstCount = 4 6
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color2 = R:00 G:0 B:0 0
    Color2 = R:50 G:0 B:255 2
    Color3 = R:0 G:0 B:255 6
    Color4 = R:0 G:0 B:0 8
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = -0.1 -0.3
    SizeRateDamping = 0.985 0.985
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = 0.2
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 2.5 4
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 3
    Offset = X:-6.5 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End


FXParticleSystem HellKnightFireCenter2
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXfire03.tga
    Lifetime = 28 28
;    SystemLifetime = 125
    SortLevel = 1
    Size = 8 9
    BurstDelay = 1 1
    BurstCount = 4 6
;    InitialDelay = 25 25
  End
  Color = DefaultColor
    Color1 = R:50 G:0 B:255 2
    Color2 = R:0 G:0 B:255 17
    Color3 = R:0 G:20 B:100 23
    Color4 = R:0 G:0 B:0 28
    ColorScale = -55 55
  End
  Update = DefaultUpdate
    SizeRate = -0.1 -0.3
    SizeRateDamping = 0.985 0.985
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
;    Gravity = 0.2
    VelocityDamping = 0.8 0.8
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = 2.5 4
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 3
    Offset = X:-6.5 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End



; X = Back
; Z = Up

FXParticleSystem HellKnightSmokeCenter
  System
    Priority = ALWAYS_RENDER
    Shader = ALPHA
    ParticleName = EXVapor04.tga
    Lifetime = 30 30
    SortLevel = 1
    BurstDelay = 1 1
    BurstCount = 1 1
  End

  Color = DefaultColor
    Color1 = R:52 G:44 B:101 0
    Color2 = R:68 G:54 B:109 30
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.35 0.5 10
    Alpha3 = 0 0 30
  End
  Update = DefaultUpdate
    SizeRate = 5 5
    SizeRateDamping = 0.8 0.8
    AngleZ = 0 7
    AngularRateZ = -0.01 0.01
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.7 0.7
    DriftVelocity = X:0.032 Y:0.064 Z:0.08
  End
  EmissionVelocity = CylindricalEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Radius = 2
    Offset = X:-0.5 Y:0 Z:4
  End
  Draw = DefaultDraw
  End
End

;---------


SpecialPower SpecialAbilityHellKnightParalyze			; WHY DOESN'T THIS ABILITY WORK??? :(
	Enum			= SPECIAL_WIZARD_BLAST		; Maybe because the original object (Cine_GoblinSwordsman) doesn't exist in bfme?
	ReloadTime		= 5000 ; 60000			; It will remain a mistery.
END

FXList FX_HellKnightParalyze		; TO DO / TODO
END

FXList FX_HellKnightParalyzeEffect	; TO DO / TODO
END


Weapon HellKnightParalyzeWeapon
  	RadiusDamageAffects	= ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
;	IdleAfterFiringDelay	= 0
	AttackRange		= 30
	MinimumAttackRange	= 0.1
	WeaponSpeed		= 401
	MinWeaponSpeed		= 241
	MaxWeaponSpeed		= 601
	DelayBetweenShots	= 5000               ; time between shots, msec
	PreAttackDelay		= 1600
	PreAttackType		= PER_ATTACK ; Do the delay each time we attack a new target
	FireFX			= FX_HellKnightParalyze
	FiringDuration		= 1400

	DamageNugget
		Damage			= 500		; Vampire Lord deals 580
		Radius			= 30.0
		DamageArc		= 75
		DelayTime		= 0
		DamageType		= HERO
		DamageFXType		= MAGIC
		DeathType		= NORMAL
		DamageSpeed		= 700.0
	End

	ParalyzeNugget
		Radius		= 0.0
		Duration	= 12000
		SpecialObjectFilter	= ANY +INFANTRY +MONSTER +CAVALRY +HERO -MordorBalrog 
		ParalyzeFX	= FX_HellKnightParalyzeEffect
	End

End


CommandButton HellKnightParalyze
  Command                 = SPECIAL_POWER
  SpecialPower            = SpecialAbilityHellKnightParalyze
  Options                 = NEED_TARGET_ENEMY_OBJECT
  TextLabel               = CONTROLBAR:LegendsHellKnightTouchOfDoom
  CursorName              = EvilAbilityObj
  InvalidCursorName       = GenericInvalid
  ButtonImage             = HSGoblinKingPoisonedStinger
  ButtonBorderType        = ACTION
  DescriptLabel           = CONTROLBAR:ToolTipLegendsHellKnightTouchOfDoom
  InPalantir			  = Yes
  AutoAbility			  = Yes  
End


;---------


CommandSet HellKnightCommandSet
	1	= Command_ToggleStance
	2	= HellKnightParalyze		; Doesn't seem to work, for some reason
	13	= Command_AttackMove
	14	= Command_Stop
End


FXList FX_HellKnightSwordHit
  Sound
    Name = ImpactRainOfFire	;GoblinKingSkullTotem ;ImpactSauronMace		
  End
END


Weapon HellKnightSword
;	IdleAfterFiringDelay		= 0
	MeleeWeapon           		= Yes
	LeechRangeWeapon		= Yes
	AttackRange			= 20				;11.5
	WeaponSpeed			= 401
	RadiusDamageAffects		= ENEMIES NOT_SIMILAR
	ClearNuggets ;;.;;
	DelayBetweenShots		= FARAMIR_DELAYBETWEENSHOTS
	PreAttackDelay			= 1000				;800
	PreAttackType			= PER_ATTACK			; PER_SHOT
	FireFX				= FX_HellKnightSwordHit
	FiringDuration			= 1200				;1200
	DamageDealtAtSelfPosition	= Yes 
	IsAimingWeapon			= Yes
	AcceptableAimDelta		= 15
	AntiAirborneVehicle		= No
	AntiAirborneMonster		= No

	DamageNugget
		Damage			= 80		; 100
		Radius			= 30.0
		DamageArc		= 75
		DelayTime		= 0
		DamageType		= HERO
		DamageFXType		= MAGIC
		DeathType		= NORMAL
		DamageSpeed		= 700.0
	End

	DamageNugget
		Damage			= 100		; 130
		Radius			= 30.0
		DamageArc		= 75
		DelayTime		= 0
		DamageType		= MAGIC
		DamageFXType		= FLAME
		DeathType		= NORMAL
		DamageSpeed		= 700.0
	End

	MetaImpactNugget
		HeroResist		= 1
      		ShockWaveAmount		= 40.0
        	ShockWaveArc		= 75	; Angle of metaimpact
        	ShockWaveRadius		= 30	; How far the metaimpact reaches
        	ShockWaveTaperOff	= 0.8	; Lenght thrown forward (Approx x2 metres)
        	ShockWaveZMult		= 1.4 	; Height thrown upwards (approx x metres)
		ShockWaveSpeed		= 700.0 
;		OnlyWhenJustDied	= Yes
    	End
End






Object CINE_FreeDwarfPrisoner				; Dead Hell Knight

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_Draw

		DefaultModelConditionState
			Model               = CHHW_CG_U_SKN
			Skeleton            = CHHW_CG_U_SKL
		End

		AnimationState        = USER_2						; Falling to the ground
			StateName           = STATE_Sword
			Animation
				AnimationName     = CHHW_CG_U_DIEA
				AnimationMode     = ONCE
			End
		End

		IdleAnimationState							; Dead on the floor
			StateName				= STATE_Idle_Sword	
			Animation = Foot_IDLB
				AnimationName			= CHHW_CG_U_DIEA
				AnimationMode			= ONCE_BACKWARDS
				AnimationSpeedFactorRange	= 0 0
			End
			Flags					= START_FRAME_LAST
		End

	End ; draw
END ; AddModule

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_DamrodLeadership
	End 
End

AddModule
	Behavior = ModelConditionUpgrade ModuleTag_BuildHackUserFlag
		TriggeredBy				= Upgrade_DamrodLeadership
		RequiresAllTriggers			= Yes
		AddTempConditionFlag			= ModelConditionState:USER_2			;For dying animation
		TempConditionTime			= 5.2 ; Model condition fades afterwards
	End
END

AddModule
	Behavior = SubObjectsUpgrade ModuleTag_ChooseArmorPieces
	TriggeredBy			   = Upgrade_DamrodLeadership

	HideSubObjects		   = AXE_01		; Axe
;	HideSubObjects		   = Belthronding	; Belthronding		(Claymore)
	HideSubObjects		   = WESTRONSWORD	; Belthronding again	(Claymore)
;	HideSubObjects		   = Firebrand		; Firebrand		(Flaming Longsword)
	HideSubObjects		   = Firebrand_FX01	; Firebrand's fire effect
	HideSubObjects		   = GURTHANG		; Damascus Longsword
	HideSubObjects		   = SWRD_05		; Gladius
;	HideSubObjects		   = TROLLBANE		; Greatsword of Greater Giant Bane
	HideSubObjects		   = SPEAR		; Spear

	HideSubObjects		   = SLDR_01	; Golden shoulder pads
;	HideSubObjects		   = SLDR_02	; Plate shoulder pads

	HideSubObjects		   = HLMT_01	; Golden Helmet
;	HideSubObjects		   = HLMT_02	; Plate Hemlet

;	HideSubObjects		   = GNLT_00	; Plate Gauntlets
	HideSubObjects		   = GNLT_01	; Golden Gauntlets
	HideSubObjects		   = GNLT_02	; Scale Gauntlets

	HideSubObjects		   = BOOT_00	; Plate Greaves
	HideSubObjects		   = BOOT_01	; Golden Greaves
	HideSubObjects		   = BOOT_02	; Scaled Greaves


	HideSubObjects		   = Shield_01	; Misc round shield
	HideSubObjects		   = SHLD_01	; Wooden Round Shield
	HideSubObjects		   = SHLD_02	; Steel Tower Shield
;	HideSubObjects		   = SHLD_03	; Steel Round Shield
	HideSubObjects		   = SHLD_04	; Wooden Tower Shield

	HideSubObjects		   = CHHW_SMNL	; Body
	HideSubObjects		   = HAIR_00	; Long hair

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End

	Scale = 1.6

	SelectPortrait = UpNeutralShelob
	ButtonImage = UPBarrowWight

	DisplayName = HellKnight Terror

	ShockwaveResistance = 9999999999999
	CommandPoints					= 0
	Side						= Neutral
	EditorSorting					= UNIT
	ThreatLevel			= 1.0
	VisionRange			= 175.0
	ShroudClearingRange		= 200.0
	CrushableLevel			= 2
	BuildCost			= 2000
	BuildTime			= 90
	TransportSlotCount	= TRANSPORTSLOTCOUNT_UNIT



AddModule
	Behavior = SlowDeathBehavior ModuleTag_DieAndSpawnHellKnight
		DeathTypes		= ALL
		DestructionDelay	= 0
		FX			= INITIAL FX_HellKnightReborn
		OCL			= INITIAL OCL_SpawnLivingHellKnight
;		Sound			= INITIAL FellBeastVoiceMove
	End
End

AddModule
	Body = ActiveBody ModuleTag_ActiveBody
		MaxHealth			= 48000 ;50000
		DodgePercent			= 0%
	End
End

	ArmorSet
		Conditions					= None
		Armor						= HellKnightArmor
;		DamageFX					= HellKnightDamageFX
	End

AddModule
	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		MoodAttackCheckRate        = 500
	End
END

	LocomotorSet
		Locomotor			= HeroHumanScalingLocomotor
		Condition			= SET_NORMAL
		Speed				= 0
	End

	KindOf			= HERO PRELOAD CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY UNATTACKABLE NOT_AUTOACQUIRABLE


	CommandSet  = HellKnightCommandSet

	Geometry		= CYLINDER
	GeometryMajorRadius	= 1.0
	GeometryMinorRadius	= 1.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	PathfindDiameter	= 2

	HealthBoxHeightOffset	= 400


END






























Object CINE_GoblinSwordsman			; Live Hellknight object

AddModule
	Draw = W3DScriptedModelDraw ModuleTag_Draw

		DefaultModelConditionState
			Model               = CHHW_CG_U_SKN
			Skeleton            = CHHW_CG_U_SKL
	            ParticleSysBone = B_WAIST HellKnightSmokeCenter FollowBone:Yes
	            ParticleSysBone = B_WAIST HellKnightFireCenter FollowBone:Yes
	            ParticleSysBone = BAT_RIBS HellKnightFireCenter2 FollowBone:Yes

	
;			WeaponLaunchBone	= PRIMARY Bat_HandL
		End

;-------------- Special anims for Resurrection ----------------------

	AnimationState        = RESURRECTED				; Played when this object spawns
		StateName           = STATE_Sword
		Animation
			AnimationName     = CHHW_CG_U_ATNA
			AnimationMode     = ONCE
			AnimationSpeedFactorRange = 0.5 0.5
		End

		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_RiseUp") end
		EndScript

	End

		TransitionState       = TRANS_RiseUp
			Animation           = ATND
				AnimationName     = CHHW_CG_U_RBNA 
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.5 0.5
			END
		End



AnimationState        = USER_4					; Played when this object spawns, part 2
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHHW_CG_U_ATNA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1 1
	End
End

;------------------------------------

//------------------  DYING -------------------------------------------------------------

// --- Flying through the air.
AnimationState        = STUNNED_FLAILING 
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHHW_CG_U_FLYA
		AnimationMode     = LOOP
	End
	Flags               = RANDOMSTART
End

// --- Dying anims
AnimationState        = DYING SPLATTED
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHHW_CG_U_LNDA
		AnimationMode     = ONCE
	End
End

AnimationState        = DYING
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHHW_CG_U_DIEA
		AnimationMode     = ONCE
	End
	Animation           = GUHero_DIEB
		AnimationName     = CHHW_CG_U_DIEB
		AnimationMode     = ONCE
	End
End

// --- Stunned anims


AnimationState        = STUNNED_STANDING_UP
	StateName           = STATE_Sword
	Animation
		AnimationName     = CHHW_CG_U_GTPA
		AnimationMode     = ONCE
		AnimationSpeedFactorRange = 1.5 1.5
	End
End

AnimationState        = STUNNED 
	StateName           = STATE_Sword
	Animation           = GUHero_LNDA
		AnimationName     = CHHW_CG_U_LNDA
		AnimationMode     = ONCE
	End
End				

//------------------ SPECIAL POWER ANIMS ---------------------

// DOMINATE SPECIAL POWER //
AnimationState				= PACKING_TYPE_1
	StateName				= Curse
	Animation
		AnimationName		= CHHW_CG_U_LVLA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

// TELEPORT SPECIAL POWER //
AnimationState				= PACKING_TYPE_3
	StateName				= Curse
	Animation
		AnimationName		= CHHW_CG_U_SPCA
		AnimationMode		= ONCE
	End
//			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
End

//------------------ MOVING -------------------------------------------------------------

		//--- Running with sword
		AnimationState			= MOVING
			StateName           = STATE_RunningSword
			Flags               = RANDOMSTART
			//ParticleSysBone    = None InfantryDustTrails
			Animation
				AnimationName   = CHHW_CG_U_IDLA		; RUNA		; Now he slides rather than run (He has no legs)
//				AnimationMode   = LOOP
				AnimationSpeedFactorRange = 0.85 0.85
//				Distance = 28
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
				if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
				if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
			EndScript
		End


;--------- Attacking ---------------

		AnimationState				= FIRING_OR_PREATTACK_A // Melee attack.
			Animation
				AnimationName		= CHHW_CG_U_ATKA
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName		= CHHW_CG_U_ATKB
				AnimationMode		= ONCE
				UseWeaponTiming		= Yes
			End
		End


		
//-------------------- HIT REACTIONS -----------------------------------------------------------

		AnimationState = HIT_REACTION
			Animation = Sword_HITA
				AnimationName = CHHW_CG_U_HITA
				AnimationMode = ONCE
			End
			Animation = Sword_HITB
				AnimationName = CHHW_CG_U_HITB
				AnimationMode = ONCE
			End

			BeginScript
				PrevAnim = CurDrawablePrevAnimation()
				if PrevAnim == "Foot_IDLB"
				then
					return "Sword_HITB"
				else
					return "Swort_HITA"
				end
			EndScript
		End

//------------ SPECIAL POWERS ------------------------------------------------------------------		

		AnimationState		  =	SPECIAL_WEAPON_ONE
			StateName		  =	Attacking
			Animation
				AnimationName =	CHHW_CG_U_TNTA
				AnimationMode =	ONCE
				AnimationSpeedFactorRange	= 2 2
			End
		End


;---------------------------------------

		//	Special Power 1
		AnimationState		  =	PACKING_TYPE_1 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHHW_CG_U_SPCC CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_1 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHHW_CG_U_SPCA CHHW_CG_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_1 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHHW_CG_U_SPCB CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
		End

		// (specific) dwarf train allies.
		AnimationState		  =	PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
			Animation
				AnimationName =	CHHW_CG_U_SPCC
				AnimationMode =	LOOP
			End
		End

		//	Special Power 2
		AnimationState		  =	PACKING_TYPE_2 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHHW_CG_U_SPCC CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_2 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHHW_CG_U_SPCA CHHW_CG_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_2 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHHW_CG_U_SPCB CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
		End
		

//----------- Captain of Gondor - Bow -----------------------------------------------
		AnimationState        = PACKING_TYPE_2
			StateName		  =	STATE_CaptainBow
			Animation           = GUHero_CHRD
				AnimationName     = CHHW_CG_U_SPCE CHHW_CG_U_SPCA CHHW_CG_U_CHRD
				AnimationMode     = ONCE
//				AnimationSpeedFactorRange = 0.75 0.75
			End
		End

		//	Special Power 3
		AnimationState		  =	PACKING_TYPE_3 UNPACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordStart
				AnimationName =	CHHW_CG_U_SPCC CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
			FXEvent			  =	Frame:14 Name:FX_CreateAHeroLightningCharge
//			FXEvent			  =	Frame:70 Name:FX_GandalfLightningFizzle
			FXEvent			  =	Frame:14 Name:FX_GandalfLightningSword	FrameStop:70
		End
	
		AnimationState		  =	PACKING_TYPE_3 PREPARING
			StateName		  =	Attacking
			Animation		  =	LightningSwordLoop
				AnimationName =	CHHW_CG_U_SPCA CHHW_CG_U_ATKA
				AnimationMode =	LOOP
			End
		End

		AnimationState		  =	PACKING_TYPE_3 PACKING
			StateName		  =	Attacking
			Animation		  =	LightningSwordPutAway
				AnimationName =	CHHW_CG_U_SPCB CHHW_CG_U_ATKA
				AnimationMode =	ONCE
			End
		End
		
		//	Special Power 4
		AnimationState		  =	PACKING_TYPE_4 UNPACKING	  
			Animation		  
				AnimationName =	CHHW_CG_U_SPCA
				AnimationMode =	ONCE
			End
		End
	
		AnimationState		  =	PACKING_TYPE_4 PREPARING
			Animation		 
				AnimationName =	CHHW_CG_U_SPCA
				AnimationMode =	ONCE
			End
		End

		AnimationState		  =	PACKING_TYPE_4 PACKING
			Animation		  
				AnimationName =	CHHW_CG_U_SPCA
				AnimationMode =	ONCE
			End
		End
		
		AnimationState		  =	PACKING_TYPE_5 PACKING WEAPONSET_TOGGLE_1
			Animation		  
				AnimationName =	CHHW_CG_B_SPCB
				AnimationMode =	ONCE
				AnimationSpeedFactorRange = 0.7333 0.7333
			End
		End
		
		AnimationState		  =	PACKING_TYPE_5 PACKING
			Animation		  
				AnimationName =	CHHW_CG_U_SPCB
				AnimationMode =	ONCE
			End
		End
		
		AnimationState		  =	PACKING_TYPE_6 PACKING
			Animation		  
				AnimationName =	CHHW_CG_U_SPCD
				AnimationMode =	ONCE
			End
		End




//====== LEVELED

		AnimationState				= LEVELED 						// This state clears itself in 3 seconds
			Animation				= LevelUp
				AnimationName		= CHHW_CG_U_CHRA CHHW_CG_U_LVLA
				AnimationMode		= ONCE
			End
		End

//---------------------- EMOTIONS ---------------------------------------------------------------

		// cheer, on foot
		AnimationState				=	EMOTION_CELEBRATING
			Animation CHRA
				AnimationName		=	CHHW_CG_U_CHRA CHHW_CG_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHHW_CG_U_CHRB CHHW_CG_U_CHRA CHHW_CG_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
		// taunt, on foot
		AnimationState				=	EMOTION_TAUNTING
			Animation CHRA
				AnimationName		=	CHHW_CG_U_TNTA
				AnimationMode		=	ONCE
			End
			Animation CHRB
				AnimationName		=	CHHW_CG_U_TNTB CHHW_CG_U_TNTA
				AnimationMode		=	ONCE
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
		End
		
//====== ENGAGED
		AnimationState				= ENGAGED
			StateName				= STATE_ready
			Animation
				AnimationName		= CHHW_CG_U_IDLA
				AnimationMode		= ONCE
			End
		End
		
		IdleAnimationState
			StateName	= STATE_Idle_Sword	
			Animation = Foot_IDLB // Bored Idle
				AnimationName       = CHHW_CG_U_ATNB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End

			BeginScript
				CurDrawableHideSubObject("arrow")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
				if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
			EndScript
		End

	End ; draw
END ; AddModule


;--------------- Paralyze (too lazy to find proper name) -----------------

AddModule
	Behavior = SpecialPowerModule ModuleTag_HellKnightParalyzeStarterr
		SpecialPowerTemplate		= SpecialAbilityHellKnightParalyze
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= FellBeastVoiceMove
	End
End

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_HellKnightParalyzzeUpdate
		SpecialPowerTemplate    = SpecialAbilityHellKnightParalyze
		SkipContinue			= Yes

		UnpackTime			= 1150
		PreparationTime			= 1
		PersistentPrepTime		= 1400
		PackTime			= 1
		MustFinishAbility		= Yes
		
		AwardXPForTriggering		= 0		
		StartAbilityRange		= 15.0
		
		SpecialWeapon			= WildShelobPoisonedStinger	;HellKnightParalyzeWeapon
		WhichSpecialWeapon		= 1
	End
END

;-----------------------

AddModule	
	Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
	End
End

	EvaEventDieOwner 		= None

;	RecruitText = CONTROLBAR:GloinRecruit
;	ReviveText	= CONTROLBAR:GloinRevive

AddModule
	Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
		HitReactionLifeTimer1 = 2200 ; level 1 (light  damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer2 = 15 ; level 2 (medium damage)  hit reaction animations in frames (5 per sec)
		HitReactionLifeTimer3 = 10 ; level 3 (heavy  damage)  hit reaction animations in frames (5 per sec)

		HitReactionThreshold1 = 800.0   ; level 1 (light  damage) threshold trigger
		HitReactionThreshold2 = 2500.0  ; level 2 (medium damage) threshold trigger
		HitReactionThreshold3 = 5000.0  ; level 3 (heavy  damage) threshold trigger
	End
END

AddModule
	Behavior = ModelConditionUpgrade ModuleTag_BuildHackUserFlag
		TriggeredBy				= Upgrade_DamrodLeadership
		RequiresAllTriggers			= Yes
		AddTempConditionFlag			= ModelConditionState:RESURRECTED		;For raise animation - From the ground to attack stance
		TempConditionTime			= 6.4 ; Model condition fades afterwards
	End
END

  AddModule
	Behavior 		= AttributeModifierUpgrade ModuleTag_FreezeWhileResurrecting
	TriggeredBy 		= Upgrade_DamrodLeadership
	AttributeModifier 	= HellKnightFreezeWhileResurrecting
	End
  END

AddModule
	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
	End
END

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_1
		UpgradeToGrant = Upgrade_DamrodLeadership
	End 
End

AddModule
	Behavior = SubObjectsUpgrade ModuleTag_ChooseArmorPieces
	TriggeredBy			   = Upgrade_DamrodLeadership

	HideSubObjects		   = AXE_01		; Axe
;	HideSubObjects		   = Belthronding	; Belthronding		(Claymore)
	HideSubObjects		   = WESTRONSWORD	; Belthronding again	(Claymore)
;	HideSubObjects		   = Firebrand		; Firebrand		(Flaming Longsword)
;	HideSubObjects		   = Firebrand_FX01	; Firebrand's fire effect
	HideSubObjects		   = GURTHANG		; Damascus Longsword
	HideSubObjects		   = SWRD_05		; Gladius
;	HideSubObjects		   = TROLLBANE		; Greatsword of Greater Giant Bane
	HideSubObjects		   = SPEAR		; Spear

	HideSubObjects		   = SLDR_01	; Golden shoulder pads
;	HideSubObjects		   = SLDR_02	; Plate shoulder pads

	HideSubObjects		   = HLMT_01	; Golden Helmet
;	HideSubObjects		   = HLMT_02	; Plate Hemlet

;	HideSubObjects		   = GNLT_00	; Plate Gauntlets
	HideSubObjects		   = GNLT_01	; Golden Gauntlets
	HideSubObjects		   = GNLT_02	; Scale Gauntlets

	HideSubObjects		   = BOOT_00	; Plate Greaves
	HideSubObjects		   = BOOT_01	; Golden Greaves
	HideSubObjects		   = BOOT_02	; Scaled Greaves


	HideSubObjects		   = Shield_01	; Misc round shield
	HideSubObjects		   = SHLD_01	; Wooden Round Shield
	HideSubObjects		   = SHLD_02	; Steel Tower Shield
;	HideSubObjects		   = SHLD_03	; Steel Round Shield
	HideSubObjects		   = SHLD_04	; Wooden Tower Shield

	HideSubObjects		   = CHHW_SMNL	; Body
	HideSubObjects		   = HAIR_00	; Long hair

	FadeTimeInSeconds          = 0.0
	RecolorHouse	   	   = No

	End
End



;-----------
;Voices
;-----------
	VoiceAttack 				= FellBeastVoiceMove
	VoiceAttackCharge 			= FellBeastVoiceMove
	VoiceAttackStructure 			= FellBeastVoiceMove
	VoiceAttackMachine 			= FellBeastVoiceMove
	VoiceCreated 				= FellBeastVoiceMove
	VoiceFullyCreated 			= FellBeastVoiceMove
	VoiceGuard				= FellBeastVoiceMove
	VoiceMove 				= FellBeastVoiceMove
	VoiceMoveToCamp 			= FellBeastVoiceMove
	VoiceMoveWhileAttacking 		= FellBeastVoiceMove
	VoicePriority				= 30
	VoiceFear				= FellBeastVoiceMove
	VoiceRetreatToCastle 			= FellBeastVoiceMove
	VoiceSelect 				= FellBeastVoiceMove
	VoiceSelectBattle  			= FellBeastVoiceMove
;------------

	Scale = 1.6

	SelectPortrait = UpNeutralShelob
	ButtonImage = UPBarrowWight

	DisplayName = HellKnight Terror

	ShockwaveResistance = 99999
	CommandPoints					= 0
	Side						= Neutral
	EditorSorting					= UNIT
	ThreatLevel			= 1.0
	VisionRange			= 175.0
	ShroudClearingRange		= 200.0
	CrushableLevel			= 2
	BuildCost			= 2000
	BuildTime			= 90
	TransportSlotCount	= TRANSPORTSLOTCOUNT_UNIT



AddModule
	Behavior = SlowDeathBehavior ModuleTag_DieAndSpawnDeadBody
		DeathTypes		= ALL
		DestructionDelay	= 0
		FX			= INITIAL FX_HellKnightDie
		OCL			= INITIAL OCL_SpawnDeadHellKnight
		Sound			= INITIAL FellBeastVoiceMove
	End
End

;AddModule
;  Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveResurrector
;	TriggeredBy			= Upgrade_ResurrectorRemove
;	UpgradeToRemove			= Upgrade_Resurrector
;	RemoveFromAllPlayerObjects	= Yes
;  End
;END

AddModule
	Body = ActiveBody ModuleTag_ActiveBody
		MaxHealth			= 3000 ; 4000
		DodgePercent			= 20%
	End
End

	WeaponSet
		Conditions					= None
		Weapon						= PRIMARY    HellKnightSword
		AutoChooseSources				= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

;	WeaponSet
;		Conditions		= WEAPONSET_HERO_MODE
;		Weapon			= PRIMARY    RheiaHeroWeapon
;	End


	ArmorSet
		Conditions					= None
		Armor						= HellKnightArmor
		DamageFX					= HellKnightDamageFX
	End

AddModule
  Behavior = AIUpdateInterface ModuleTag_MakesLocomotorWork
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		MoodAttackCheckRate        = 500
  End
END
	LocomotorSet
		Locomotor			= HeroHumanScalingLocomotor
		Condition			= SET_NORMAL
		Speed				= 50
	End

	KindOf			= HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT ; CAN_CLIMB_WALLS

	CommandSet  = HellKnightCommandSet

	Geometry		= CYLINDER
	GeometryMajorRadius	= 8.0
	GeometryMinorRadius	= 8.0
	GeometryHeight		= 19.2
	GeometryIsSmall		= Yes
	PathfindDiameter	= 20.0
	HealthBoxHeightOffset	= 38


END


;------------------------------------------------------------------
;----------------------- END HELLKNIGHT ---------------------------
;------------------------------------------------------------------






